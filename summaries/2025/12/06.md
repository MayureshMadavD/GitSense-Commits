# Activity Summary for 06/12/2025

## 19:08:13
The code changes primarily focus on enhancing the "Upsell On Checkout" functionality and refining UI components within the `checkout-dashboard-ui` application, alongside minor adjustments in the `dashboard-ui-configuration` setup.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellCheckout.tsx`**
    *   **Timestamps:** Multiple changes observed between `03/12/2025, 23:27:39` and `04/12/2025, 11:37:15`.
    *   **Updates:**
        *   Initial changes involved frequent adjustments to the `key` prop of `Collapse` items and the `index` passed to `UpsellFormRenderer` within the `buildUpsellCollapse` function. This aimed to correctly identify and render individual upsell rules.
        *   The logic for displaying the "Rule {index + 1}" label underwent several iterations (`rules.length - 1`, `rules.length === 1 ? index + 1 : index`, `rules?.length < 1 ? index + 1 : index`, `rules?.length > 0 ? index + 1 : index`, `rules?.length || 0`). This indicates an attempt to refine how rule numbers are displayed, particularly when rules are added or there's only one rule. The final version reverts to `index + 1`.
        *   The `activeKey` state for `Collapse` was modified several times, specifically in `buildUpsellCollapse` to automatically expand the newly added rule (e.g., `setActiveKey([String(rules?.length - 1)])`, then `setActiveKey([String(rules?.length)])`, and finally `setActiveKey(['0'])` on adding a new rule or after form submission).
        *   The `position` parameter passed to `setIsModalOpen` (for delete confirmation) was also refined, with several attempts to correctly capture the index or ID of the rule being deleted.
        *   A significant change introduced `upsellEnabled = Form.useWatch(['cart_upsell', 'enabled'], form)` to conditionally hide or show the "Cap Quantity" section and the list of upsell rules, based on whether "Cart Upsell" is enabled (`04/12/2025, 00:48:47` and `04/12/2025, 00:50:07`, `04/12/2025, 00:50:33`).
        *   The "Add New Upsell Rule" button was moved to be outside the mapped `upsellItems` loop and its `onClick` handler was updated to correctly set the `activeKey` to expand the newly added rule (`04/12/2025, 00:44:38`, `04/12/2025, 11:37:15`).
        *   Imports were adjusted, adding `Alert` but removing `UpOutlined` from `gokwik-ui-kit`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/customize-ui/richtexteditor.tsx`**
    *   **Timestamps:** Changes occurred between `04/12/2025, 01:04:54` and `04/12/2025, 01:10:35`.
    *   **Updates:**
        *   Refinement of the placeholder behavior: the default `placeholder` prop changed from 'Enter Text To Update' to an empty string (`04/12/2025, 01:05:27`).
        *   The "Field cannot be empty" validation message's styling and positioning were adjusted (e.g., `mt-[-1rem]`, and enclosing the message with a `<span>` or `<div>` to control its layout relative to the character count display). Specifically, at `04/12/2025, 01:10:35`, it's conditionally rendered in a `<span>` along with a placeholder `<div>` to maintain layout if there's no error message.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx`**
    *   **Timestamp:** `04/12/2025, 01:00:41`.
    *   **Updates:**
        *   Added `isUpsellCall` prop to the `MobileStepUI` component.
        *   Imported `getCustomizeUiData` selector and `updateUpsellState` action from `@store/customize-ui`.
        *   Introduced `listOfProducts` derived from `customizeUiData?.upsell_data?.upsell_product_list?.products?.data` and conditionally rendered based on `isUpsellCall`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
    *   **Timestamp:** `04/12/2025, 12:27:04`.
    *   **Updates:**
        *   Added a `topUpGift` prop.
        *   Introduced UI elements for a "Freebie price" input within the product display, specifically for `topUpGift` functionality.
        *   Modified `handleGiftPrice` to update product `offered_price`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts`**
    *   **Timestamp:** `04/12/2025, 12:27:19`.
    *   **Updates:** Minor formatting changes, no functional differences compared to prior versions (based on visual inspection and context).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts`**
    *   **Timestamps:** `04/12/2025, 12:27:30` and `06/12/2025, 19:02:34`.
    *   **Updates:** No functional changes, as the content is identical across these two timestamps.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`**
    *   **Timestamp:** `04/12/2025, 12:27:58`.
    *   **Updates:** Minor formatting changes, no functional differences.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts`**
    *   **Timestamp:** `04/12/2025, 12:28:12`.
    *   **Updates:** Minor formatting changes, no functional differences.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
    *   **Timestamps:** `04/12/2025, 21:49:13` and `05/12/2025, 23:32:51`.
    *   **Updates:** For local development (`isLocal` condition), the source URLs for several `@gokwik` packages (`@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/checkout-platform`, `@gokwik/shopify-app`) were updated to point to `https://sandbox-dashboard.dev.gokwik.in` instead of `https://qa-dashboard.dev.gokwik.in`. This indicates a shift in the local development environment's dependency resolution to a sandbox environment.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellFormRenderer.tsx`**
    *   **Timestamps:** Multiple changes between `04/12/2025, 22:18:10` and `04/12/2025, 22:21:01`.
    *   **Updates:** The `Checkbox` component for "Configure upsell items on discount price" now includes an `onChange` handler that resets the `discount.value` and `discount.capping` to `0` when the checkbox is unchecked.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`**
    *   **Timestamps:** Multiple changes between `05/12/2025, 23:41:06` and `06/12/2025, 19:07:00`.
    *   **Updates:**
        *   Introduced `fetchProductById` function to fetch product details using `APIEndPoints.getProductById`.
        *   The `ProductSearch` component for selecting "free gift products" was updated. The logic for handling `onAdd` and `onRemove` for both `applicable_items` and `free_product` within the form fields was adjusted to correctly manage product/variant/collection IDs.
        *   The `hideControlInput` property for certain form fields (like `specific_products` and `specific_collections`) was updated to dynamically hide/show based on the `giftApplicableOn` radio selection.
        *   The "Agent led" sales channel option is now conditionally disabled if `applicationMethod` is not "auto".
        *   The `max` value for `selection_limit` input was updated to dynamically reflect `freePorduct?.data?.length` or default to 5.
        *   The default `activeKey` for the Collapse components in `UpsellCheckout` was initially `['0']` but later changed to `[]` when `handleAddNewUpsellRule` is called, allowing the newly added rule to be open.

### General Patterns and Recurring Elements:

*   **UI Component Library Usage:** Heavy reliance on `gokwik-ui-kit` components for building the user interface, including forms, buttons, cards, modals, and input fields.
*   **React Hooks:** Extensive use of `useState`, `useEffect`, `useRef`, `useCallback`, `useMemo`, and `Form.useWatch` for managing component state, side effects, performance optimization, and real-time form value tracking.
*   **Form Management:** Consistent pattern of using Ant Design `Form` for data input, validation, and submission, with form values often watched to trigger UI changes or logic.
*   **API Interaction:** Standardized `makeAPICall` utility for interacting with various backend endpoints, with specific API endpoints defined in `apiEndpoints.ts`.
*   **Redux for Global State:** `react-redux` (specifically `useDispatch` and `useSelector`) is used to manage and update application-wide state, such as `updateUpsellState` for upsell configurations.
*   **Conditional Rendering:** Frequent use of conditional rendering based on state variables (e.g., `upsellEnabled`, `discountedPrice`, `activeTab`, `applicationMethod`) to show or hide parts of the UI.
*   **Error Handling:** Common patterns for displaying messages (`message.warning`, `message.error`) and logging errors (`console.error`).
*   **Dynamic Data Handling:** Logic to fetch and set dynamic data for product searches and rule configurations using IDs and types.

## 19:11:04
The `local.properties` file, located in `/Users/mayuresh.madav/Documents/sdk/kwikpass-app-rn/example/android/`, was updated twice in quick succession on **04/12/2025**.
*   At `15:06:18`, the `sdk.dir` property was set to `/Users/mac/Library/Android/sdk`.
*   Just nineteen seconds later, at `15:06:37`, it was revised to `/Users/mayuresh.madav/Library/Android/sdk`, indicating a correction or update to the Android SDK path.

The `Checkout.tsx` file, found at `/Users/mayuresh.madav/Documents/sdk/kwikpass-app-rn/example/src/screens/app/`, received a substantial update on the same day, **04/12/2025, at 15:23:24**.
This React Native component now imports `getCheckoutMultiPassToken` and `KPCheckout` from the SDK. It defines a `Checkout` screen that integrates the `KPCheckout` component, passing specific `checkoutData` including a `cartId`.
Key functionalities added include:
*   A `handleEvent` function to process various events from the checkout flow:
    *   It displays an `Alert` for `checkout-initiation-failure`.
    *   For `orderSuccess`, it conditionally calls `getCheckoutMultiPassToken` with user details if a `gk_access_token` is present, logging the response.
    *   It navigates back (`navigation.goBack()`) upon `order-complete`, `modal_closed`, `checkout-close`, or `orderSuccess`.
*   `handleError` and `handleNavigationState` functions are provided to log errors and WebView navigation state changes, respectively.

Overall, the changes highlight a focused effort on **04/12/2025** to configure the local Android SDK environment and simultaneously develop a robust checkout flow within a Kwikpass React Native example application, incorporating detailed event handling, error logging, and navigation logic.

## 19:11:46
The `.env` files are not summarized as per instructions to avoid exposing sensitive information.

**File: `/packages/kwikpassV2/src/components/KwikPassCheckout.js` and `/src/kwikpassV2/src/components/KwikPassCheckout.js`**
(Note: Changes appear in both these paths, suggesting a potential package restructuring or duplication within the project. The changes are largely identical across these paths after the initial split.)

*   **27/11/2025, 18:51:28 - 27/11/2025, 18:52:00**:
    *   Introduced the `KwikPassCheckout` React Native component, which integrates with `@appmaker-packages/extension-kwikpass-expo-package`'s `KPCheckout`.
    *   It defines an `onEvent` handler to process messages from a WebView, specifically for `modal_closed`, `orderSuccess`, `openInBrowserTab`, and `gk-checkout-disable` events originating from the `gokwikSdk`.
    *   The `orderSuccess` case includes logic to extract `orderID` from a GraphQL ID and `orderKey` from a `checkoutUrl` using regex, then dispatches `SET_ORDER_COMPLETE` and `KWIKPASS_LOGIN` actions.
    *   `openInBrowserTab` manages opening URLs in the app's WebView or delegating to custom URL handlers.
*   **27/11/2025, 22:53:59 - 27/11/2025, 23:22:43**:
    *   Multiple iterative changes to the `orderSuccess` event handling. This period saw the addition of various `console.log` statements for debugging `orderKey` and `orderID` extraction.
    *   A new regex `orderKeyRegexExtra` was temporarily added (27/11/2025, 23:16:36) to improve `orderKey` extraction from the `checkoutUrl`.
*   **27/11/2025, 23:30:22 (Significant Change)**:
    *   A major refactoring of the `orderSuccess` handler occurred. The logic shifted from directly extracting `orderKey` to prioritize navigating the user to the `checkoutUrl` provided by GoKwik using an `OPEN_IN_WEBVIEW` action. `orderID` extraction was simplified, and explicit comments were added to the code emphasizing this new approach, stating not to manually extract `orderKey` or rebuild Shopify URLs. The `SET_ORDER_COMPLETE` action's reliance on `orderKey` became less direct.
*   **27/11/2025, 23:50:11 - 28/11/2025, 11:13:51 (Rollback and Refinement)**:
    *   The code effectively reverted some of the changes made at `23:30:22`. It reintroduced the explicit extraction of `orderKey` from the `checkoutUrl`.
    *   Added logic to ensure `checkoutUrl` is properly prefixed with `https://` if missing (28/11/2025, 00:25:40 onwards).
    *   Further debugging logs and minor adjustments to how `orderKey` is passed to `SET_ORDER_COMPLETE` were made.
*   **28/11/2025, 12:25:54 - 28/11/2025, 12:29:10 (Experimentation with Navigation)**:
    *   The `orderSuccess` logic was again significantly modified. It briefly experimented with navigating to a constructed Shopify `/thank_you?order_id=${orderId}` page using `OPEN_IN_WEBVIEW` (28/11/2025, 12:25:54).
    *   The `SET_ORDER_COMPLETE` action was temporarily commented out or simplified.
*   **28/11/2025, 12:37:42 - 28/11/2025, 12:41:56 (Further Refinement)**:
    *   The navigation logic in `orderSuccess` was adjusted to use the provided `checkoutUrl` for `OPEN_IN_WEBVIEW` if `orderKey` was not found (28/11/2025, 12:41:56). The `SET_ORDER_COMPLETE` action was restored and made conditional or more robust with `orderKey: orderKey || ''`.
*   **28/11/2025, 17:10:35 - 28/11/2025, 17:11:12 (Stabilization)**:
    *   The `orderSuccess` logic appears to stabilize to a version where both `orderID` and `orderKey` are extracted (reintroducing `orderKeyRegex` and `matches`), and `SET_ORDER_COMPLETE` is dispatched with these values. Debugging `console.log` statements for event names were added.
*   **01/12/2025, 17:55:47 - 01/12/2025, 18:04:25 (Final Debugging and Cleanup)**:
    *   A debugging block to count `gokwik_events` was added, corrected (due to a typo `eventnamer`), and then commented out, indicating final cleanup of temporary debugging code. The core logic from `28/11/2025, 17:11:12` remained intact.

**File: `/packages/kwikpassV2/src/pages/CheckoutOptions.js`**

*   **28/11/2025, 14:48:50 - 28/11/2025, 14:52:20**:
    *   This file defines a static configuration object `CheckoutOptions` for a page within the Appmaker framework. It specifies a single block named `kwikpass/checkout`, indicating how the `KwikPassCheckout` component is integrated into the application's page structure. There were no functional changes recorded in this file.

**File: `/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**

*   **27/11/2025, 18:54:00**:
    *   This file provides the `KPCheckout` React component, acting as a wrapper for the core `Checkout` WebView component. It handles passing `checkoutData` (including `cartId`, `storefrontToken`, various tracking IDs, `sessionId`, `utmParams`, `orderTags`) and event callbacks (`onEvent`, `onError`, `onNavigationStateChange`) to the underlying `Checkout` implementation.

**File: `/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**

*   **27/11/2025, 18:57:26 - 27/11/2025, 20:35:26**:
    *   This is the core WebView component. It contains `injectJavaScript` to set up communication between the WebView and the native React Native environment, listening for GoKwik SDK events (`modal_closed`, `orderSuccess`, `openInBrowserTab`) and custom events.
    *   Includes a `UPI_APP_PACKAGES` map and logic (`convertToIntentUrl`, `handlePaymentIntent`) for handling UPI deep links on Android.
    *   The `InitiateCheckout` function dynamically constructs the WebView URL based on merchant type (Shopify/custom), environment, and user data, encoding store information for Shopify checkouts.
    *   Includes handlers for app state changes and hardware back button presses, which communicate with the WebView. There were no functional changes recorded in this file during the provided log.

**Patterns and Recurring Elements:**

1.  **Iterative Debugging and Refinement of `orderSuccess`**: The most prominent pattern is the continuous modification and debugging of the `orderSuccess` event handler in `KwikPassCheckout.js`. This indicates challenges in reliably extracting necessary order details (like `orderID` and `orderKey`) and correctly managing the post-checkout user flow (e.g., navigation to thank-you page vs. setting order complete).
2.  **WebView Interaction**: There is a clear pattern of extensive communication between the React Native host and an embedded WebView, using `window.ReactNativeWebView.postMessage` from the WebView and an `onEvent` callback in React Native.
3.  **URL Validation and Formatting**: Recurring logic ensures that URLs, especially the `checkoutUrl` obtained from GoKwik, are properly prefixed with `https://`.
4.  **Shopify Integration**: The code heavily interacts with Shopify concepts, such as GraphQL order IDs (`gid://shopify/Order/`), cart IDs (`gid://shopify/Cart/`), and storefront access tokens, indicating a specific integration for Shopify merchants.
5.  **Console Logging for Development**: Numerous `console.log` statements throughout the code entries (and their subsequent removal or commenting out) are a strong indicator of active development and debugging during the period.
6.  **Conditional User Login**: The `KWIKPASS_LOGIN` action is consistently dispatched only if the user is not already logged in after an `orderSuccess` event, promoting a seamless user experience.