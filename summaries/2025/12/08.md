# Activity Summary for 08/12/2025

## 13:37:04
The `local.properties` file in the `example/android` directory underwent two quick updates on April 12, 2025. Initially, at 15:06:18, the `sdk.dir` property was set to `/Users/mac/Library/Android/sdk`. This was subsequently changed at 15:06:37 to `/Users/mayuresh.madav/Library/Android/sdk`, indicating a modification to the local Android SDK path.

A significant update occurred at 15:23:24 on April 12, 2025, within the `example/src/screens/app/Checkout.tsx` file. This file introduces a React Native `Checkout` screen responsible for handling a checkout flow. Key aspects of this change include:
- Importing and utilizing components and functions from a local SDK (`../../../../src`), specifically `KPCheckout` and `getCheckoutMultiPassToken`.
- Implementing an `handleEvent` function to manage various checkout states:
    - Displaying an `Alert` for `checkout-initiation-failure`.
    - On `orderSuccess`, it checks for a `gk_access_token` and, if present, calls `getCheckoutMultiPassToken` with user details (phone, email) before logging the response.
    - It triggers `navigation.goBack()` for `order-complete`, `modal_closed`, `checkout-close`, and `orderSuccess` events.
- Providing `handleError` and `handleNavigationState` functions for comprehensive logging of errors and WebView navigation state changes during the checkout process.
- The `KPCheckout` component is rendered with `checkoutData` that includes `merchantParams` specifying a `cartId` (e.g., `gid://shopify/Cart/...`).
- The component itself is memoized using `memo` for performance optimization.

**Patterns and Recurring Elements:**
- All recorded changes occurred on the same day, April 12, 2025, within a short timeframe (approximately 17 minutes).
- The file paths indicate these changes are part of an example application (`kwikpass-app-rn/example`) demonstrating the usage of a `kwikpass` SDK.
- The `Checkout.tsx` file heavily relies on logging (`console.log`) for debugging and monitoring, specifically using `JSON.stringify` to log object details for events, errors, and navigation states.

## 13:41:02
**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellCheckout.tsx`**

This file, primarily dealing with Upsell rule management on the checkout dashboard, underwent several small, iterative changes on **04/12/2025** between **11:21:12** and **11:37:15**.
- **Collapsible Rule Rendering Logic**: The `children` prop of the `Collapse` component within `buildUpsellCollapse` was frequently adjusted. Initially, it used `index === 0 ? index : index - 1`, then `index === 0 ? index : rules.length`, before stabilizing on simply `index` for determining the `UpsellFormRenderer`'s `index` prop.
- **"Add New Upsell Rule" Button Behavior**: The logic for setting the active key after adding a new upsell rule changed from activating the newly added rule (which would be at `upsellItems.length`) to always activating the first rule (`'0'`).
- **UI Layout for Adding Rules**: A significant visual change occurred around **11:37:15** where the "Add New Upsell Rule" button was re-positioned to appear *before* the list of existing upsell rules, enhancing user flow for adding new configurations.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**

On **04/12/2025, 12:27:04**, a `topUpGift` boolean prop was added to the `ProductSearch` component's interface. This prop is used to conditionally display a "Freebie" text within the component's rendering logic, suggesting an extension to support free gift product search and display functionality.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts`**

This utility file handles API calls for product, collection, and upsell data.
- **04/12/2025, 12:27:19**: The `getVariantNCollectionDetailsbyId` function was enhanced to support fetching product details using `product_query` for `getProductById` and improved data mapping for variants and collections. The `fetchShopifyCollectionsOrProducts` function was updated to filter products by `status === 'active'`.
- **06/12/2025, 20:07:40 - 06/12/2025, 20:55:14**: The `fetchProductById` (later renamed `fetchProductByVaraintId`) function within `freeGift.tsx` was modified to use `APIEndPoints.getVariantById` instead of `APIEndPoints.getProductById` and adjust its payload to `variant_id: payload.map(String)`, indicating a shift to variant-specific data fetching for free gifts.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts`**

On **04/12/2025, 12:27:30**, new API endpoints for `checkoutLinks` (list, get by ID, create, update) were introduced. Additionally, specific endpoints for `getVariantById`, `getCollectionById`, and `getProductById` were added or updated. A notable change on **06/12/2025, 19:02:34** was the removal of the `upsellCheckout` endpoints (`getandDeleteUpsellData`, `updateUpsellData`) from this file, suggesting a restructuring or deprecation of how upsell API endpoints are managed.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`**

This file contains various helper functions.
- On **06/12/2025** between **20:07:40** and **20:08:56**, a new helper function `extractVariantIdsFromRules` was added. This function likely assists in processing rule sets to extract relevant variant identifiers, which is then imported and used in the `freeGift.tsx` component. No other significant changes were observed for this file.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts`**

On **04/12/2025, 12:28:12**, the `upsell_data` structure within the Redux `initialState` was expanded. It now explicitly includes `upsell_product_list` and `products` fields, each with a `data` array, along with `discount` properties (`value`, `capping`), `title`, and `upsell_items`. This indicates a richer data model for managing upsell configurations in the UI state.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellFormRenderer.tsx`**

This component is responsible for rendering individual upsell rule forms and saw several updates on **04/12/2025** between **22:18:10** and **22:21:01**.
- **Form Initialization Logic**: An `useEffect` hook was added to handle the initial population of the form fields based on existing upsell rules, including fetching product/collection details using `getVariantNCollectionDetailsbyId` (which dynamically uses 'variant', 'product', or 'collection' types). It ensures that `applicable_items` are correctly set, defaulting to 'all' if no specific products/collections are defined.
- **Discount Price Checkbox Logic**: The `onChange` handler for the "Configure upsell items on discount price" checkbox was modified. Initially, it only logged the event. Later, logic was added to reset `discount.value` and `discount.capping` to `0` when the checkbox is *unchecked*, effectively clearing discount fields when the feature is disabled.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`**

This file, managing the "Free Gift Settings" page, experienced numerous updates, particularly on **05/12/2025** and **06/12/2025**.
- **Initial Setup and Form Fields**: The component sets up a form with fields for creating and managing free gift rules, including rule name, sales channels (app, web, agent-led), purchase requirements (cart value, quantity), min/max values, applicability (all products, specific products/collections), free gift product selection, quantity, price, and application method (auto/selection). Breadcrumbs were initialized to reflect the page path.
- **Product Fetching for Free Gifts**: A local `fetchProductById` (later `fetchProductByVaraintId`) function was introduced around **06/12/2025, 19:07:00** to fetch product details. This function was subsequently updated on **06/12/2025, 20:07:40** to fetch by `variant_id` instead of `product_id` using `APIEndPoints.getVariantById`, and the payload was adjusted accordingly. This indicates a shift to more granular variant-level control for free gift products.
- **`handleEdit` Function Logic**: The `handleEdit` function was refined to filter out the 'shopify_agent' sales channel option if the `application_method` of the edited rule is not 'auto', preventing incompatible configurations.
- **Frequent Minor Commits**: A recurring pattern observed across many timestamps (e.g., **05/12/2025, 23:50:25** to **05/12/2025, 23:55:46**, and multiple blocks on **06/12/2025**) involved little to no functional code changes. These likely represent frequent saves, minor formatting adjustments, or commits with no significant delta. A `console.log(specificProducts,"Specific Products")` was added around **06/12/2025, 20:26:15** for debugging.
- **Helper Import**: The `extractVariantIdsFromRules` helper from `library/utilities/helpers/helper.ts` was imported around **06/12/2025, 19:29:38**, signifying its planned or actual use in processing free gift rules.

**Patterns and Recurring Elements Across Changes:**
- **Modular Component Design**: Heavy reliance on reusable components like `ProductSearch` and `RenderField` for consistent UI elements and form field rendering.
- **Form Management with Ant Design (Form.useForm, Form.useWatch)**: Consistent use of Ant Design's form utilities for state management and reactive form updates.
- **Redux Integration**: `useDispatch` and `updateUpsellState` are used to manage global state related to UI customization, indicating a Redux-based state management approach.
- **API Interaction**: Direct use of `makeAPICall` and `APIEndPoints` for fetching and pushing data, typically within `useEffect` hooks or form submission handlers.
- **Iterative UI Refinements**: Multiple small changes focusing on improving user experience, such as adjusting UI element order or refining form field behavior (e.g., checkbox logic, index handling for collapsible items).
- **Debugging Statements**: Presence of `console.log` statements in various files, indicating ongoing development and debugging efforts.
- **Emphasis on Product/Variant-level Control**: Evolution of API calls and data handling to move from broad product-level identification to more specific variant-level details, particularly evident in `freeGift.tsx` and `api.ts`.