# Activity Summary for 14/12/2025

## 13:52:07
This code log details changes to the `adsAnalytics.tsx` file, a React component designed for managing various ad and analytics integration settings within a checkout dashboard UI. The timestamp of the change is 14/12/2025, 12:52:39.

**File-Specific Updates (`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/integration-settings/adsAnalytics.tsx`):**

*   **Core Functionality:** The component, `AdsAnalytics`, provides an interface for merchants to enable, disable, and customize integrations with different ad and analytics platforms.
*   **Integrations Supported:** It explicitly supports integrations for Meta Ads (Facebook Pixels), Google Analytics (GA4), Elevar, Snapchat, Edge Tag (Blotout), Ingest Labs, Customer Labs, and Google Ads. Each integration is represented with an icon, title, and a `customize` flag indicating if it has detailed settings.
*   **UI Components:** It extensively uses `gokwik-ui-kit` components such as `Button`, `Card`, `Checkbox`, `Drawer`, `Form`, `Input`, `Switch`, and `Tooltip` to create the settings interface.
*   **State Management:**
    *   `useState` hooks manage the visibility of a customization drawer (`drawer`), the enabled/disabled state of various integrations (`enabledStates`), the title for the drawer (`title`), and the currently selected integration (`selectedKey`).
    *   `Form.useForm()` is used for handling form state and validation within the customization drawer.
    *   Redux (`useAppDispatch`, `useSelector(selectMerchantCreds)`) is utilized for managing merchant credentials related to these integrations.
*   **API Interaction:** A custom `useMerchantConfigApi` hook is employed to fetch (`config`) and save (`saveConfig`) the overall merchant configuration, specifically focusing on the `custom_config` property.
*   **Integration Logic:**
    *   **Enabling/Disabling (`handleSwitchChange`):** When an integration is toggled off, its corresponding entry (or entries, especially for Meta, Snapchat, Elevar, GA4, Google Ads which might have multiple associated pixels or objects) is filtered out from `config.custom_config.pixels`. If GA4 is disabled, `is_ga4S2s_enabled` is also set to `false`. When toggled on, it's added to `pixels`, and if customizable, the customization drawer is opened.
    *   **Customization (`handleCustomizeClick`):** This function initializes the form fields within the drawer based on the selected integration. It provides default events for GA4 (standard and custom), Meta/Snapchat (e.g., `fb_initiate_checkout`), and Elevar, and transforms Google Ads data for display (e.g., removing `AW-` prefix from AdWord IDs).
    *   **Saving Changes (`handleSave`):**
        *   Validates form fields.
        *   Contains intricate conditional logic based on the `selectedKey` to transform and structure data for saving:
            *   For GA4, it prefixes the ID with `G-`, ensures specific custom events (`gokwik_checkout_initiated`, `coupon_applied`) are included, and stores GA4 events as an object within `pixels`.
            *   For Meta Ads and Snapchat, it consolidates multiple pixel IDs and access tokens into comma-separated strings.
            *   For Google Ads, it transforms the form data back into a structured array, adding back the `AW-` prefix to AdWord IDs, and stores it as an object within `pixels`.
            *   For Edge Tag, it updates specific nested properties (`analytics_pixel_data.edgeTag`, `analytics_pixel.edgeTag`).
        *   It dispatches `saveCreds` if credentials for an integration have changed.
        *   It calls `saveConfig` to update the `custom_config` if any configuration changes are detected using `deepEqualAndDiff`.
        *   Includes error handling and messaging.
*   **`populateFormConfig`:** This function, though cut off in the log, appears to be responsible for pre-filling the form fields in the drawer when it opens, based on the existing `config.custom_config`.

**Patterns and Recurring Elements:**

*   **Conditional Logic by `selectedKey`:** A prominent pattern is the extensive use of `if (selectedKey === 'integrationName')` blocks throughout `handleSwitchChange`, `handleCustomizeClick`, and `handleSave`. This allows for highly specific data handling, form initialization, and configuration updates for each distinct integration.
*   **`config.custom_config.pixels` Array:** The `pixels` array within `config.custom_config` serves as the central data structure to track enabled integrations. It holds a mix of simple strings (for basic integrations like Ingest Labs) and complex objects (for integrations like GA4 or Google Ads that require more detailed configurations).
*   **Data Transformation:** There's a recurring need to transform data between the UI's form representation and the backend's expected structure (e.g., adding/removing prefixes, combining/splitting strings, restructuring objects).
*   **`deepEqualAndDiff` Utility:** This utility is consistently used before saving both credentials and merchant configurations. This pattern ensures that API calls are only made if actual changes have occurred, optimizing performance and reducing unnecessary writes.
*   **Prefix-based Filtering:** For integrations like Meta Ads (`fb_pixels`), Snapchat, and Elevar, a common approach is to filter `pixels` entries based on specific string prefixes (`fb`, `snapchat`, `dl`) when enabling/disabling or saving, to manage multiple associated pixels or events.