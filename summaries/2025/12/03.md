# Activity Summary for 03/12/2025

## 10:58:05
The following code changes were logged on December 1, 2025, between 16:48:13 and 16:56:07, indicating a concentrated effort on related features.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (01/12/2025, 16:48:13):**
This file introduces a `ProductSearch` React component, designed for selecting Shopify products or collections within a dashboard environment. Key functionalities include:
- **Dynamic Search:** Supports searching for products or collections, with options to hide search input or buttons.
- **Pagination & Infinite Scroll:** Implements `useIntersectionObserver` for loading more results.
- **Product/Variant Handling:** Processes search results to group product variants and manage quantities for selected items. It includes logic for "collateProducts" to display variant counts.
- **Agent-Led Filtering:** Filters products based on an `isAgentLed` prop, excluding items tagged 'no-agent'.
- **Quantity & Price Management:** Allows incrementing/decrementing item quantities and handles specific gift pricing scenarios. It enforces minimum purchase quantity constraints for collections.
- **UI & State Management:** Utilizes `gokwik-ui-kit` components, Redux `useAppDispatch`, and React `useState`/`useRef` hooks for managing loading states, modal visibility, search text, and selected items.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (01/12/2025, 16:49:34):**
This file centralizes a large and comprehensive set of API endpoints for a `checkout-dashboard-ui`. The collection covers diverse functionalities, including:
- **Order and Customer Management:** Endpoints for fetching, creating, updating orders, addresses, and customer details.
- **Abandoned Carts (ABC) & Agent Orders:** Specific routes for managing abandoned carts, creating/updating agent-led orders, and fetching related counts.
- **Product and Collection Discovery:** Endpoints for searching products, fetching all products/collections, and retrieving details by ID.
- **Pincode & Shipping:** Management of pincode lists, shipping configurations, and file uploads/downloads related to pincodes.
- **Discounts and Promotions:** A substantial section including endpoints for creating, listing, deleting, generating codes for discounts (both general and specific DIY/bulk discounts), and managing discount configurations. This includes `getProductsList`, `getCustomersList`, `getCustomerSegments`, and `getCollectionsList` for targeting discounts.
- **Analytics and Metrics:** Extensive endpoints for `checkoutAnalytics`, `websiteAnalytics`, `discountAnalytics`, and `marketingAnalytics`, covering various metrics like funnels, trends, order stats, social/marketing sales, payment details, top products, returning customers, and discount usage/failures.
- **Merchant Configuration:** Routes for fetching and updating merchant-specific settings, Shopify app configurations, billing status, and merchant health.
- **Refunds, Edit Orders, UTM, Legality, GST, Upsell & Checkout Links:** Dedicated endpoints for initiating refunds, editing existing orders, retrieving UTM lists, legal document generation, GST validation/setting, managing cart upsell rules, and handling checkout links.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (01/12/2025, 16:50:12):**
This utility file provides wrapper functions for making API calls, abstracting the `makeAPICall` utility and leveraging the `APIEndPoints` constants. Key functions include:
- **`fetchShopifyCollectionsOrProducts`:** Handles fetching products or collections, supporting both title-based search and paginated retrieval. It filters active products and transforms product data to include variant information, enhancing product display.
- **`updateMerchantData`:** Generic function to update merchant-specific data.
- **`getAndDeleteUpsellData` and `pushUpsellData`:** Functions dedicated to fetching, deleting, and updating upsell rule data.
- **`getVariantNCollectionDetailsbyId`:** A versatile function to fetch details for multiple variants, collections, or products by their IDs, mapping the responses into a structured format.
- **`validateGstData`:** A function to interact with the GST validation/setting API.
All API calls prepend `process.env.REACT_APP_BASE_URL` and include basic error handling.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (01/12/2025, 16:51:23):**
This file compiles a diverse set of helper utility functions:
- **Filtering & Formatting:** `getDynamicSearchFilters` for UI filters, `formatDateString`, `setCurrencySymbol`, and `formatAmount` for currency formatting (defaulting to 'â‚¹'), and `formatNumber` for locale-specific number formatting.
- **Date & Time Utilities:** `disabledBeforeDate`, `disabledBeforeTime`, `disabledDate`, and `disabledTime` for restricting date/time selections in pickers using `dayjs`. `getFutureDateString` generates future dates.
- **Object & Array Manipulation:** `deepCompare` for robust object comparison (with special handling for `pincodes` arrays), `debounce` for controlling function execution rate, and `compareAndCaptureArrayFields` for identifying added/removed items between two arrays.
- **Text & UI Helpers:** `capitalizeFirstLetter` for string formatting and `extractTitlesAndDataIndexes` for processing Ant Design table column configurations.
- **File Upload & Validation:** `uploadCohortCsv` specifically handles CSV uploads, validating if the content consists purely of phone numbers or emails, and sets form fields accordingly with error messages for invalid formats.
- **Specific Business Logic:** `shopifyAppCheckoutEnabledStatus` checks if a Shopify app checkout is enabled based on recent login activity. `areBothRangesMoreThanOneDay` validates date ranges. `extractUniqueCKeysForAntColumn` transforms analytics data for table display.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (01/12/2025, 16:52:44):**
This file defines a Redux Toolkit slice named `banner` (likely managing general UI customization) for the dashboard. It sets up an `initialState` object with detailed configurations for various UI elements:
- **`brand_data`:** For branding elements like CSS rules and logos.
- **`login_data`:** Comprehensive settings for the login screen, including background/text colors, banner content, visibility/auto-select for consent, continue button text, and banner timers.
- **`address_data`:** Primary colors and button text for the address section.
- **`payment_data`:** Similar to login data, includes background/text colors, banner visibility, content, and timers for the payment screen.
- **`button_toogle`:** A simple state for login button toggles.
- **`upsell_data`:** An extensive configuration for upsell offers, detailing enablement, item count limits, rule applicability, discounted prices, discount values/capping, applicable product/variant/collection IDs, titles, and product lists.
The slice provides reducers like `updateLoginData`, `updatePaymentData`, `updateBrandData`, `updateAddressData`, `updateButtonState`, and `updateUpsellState` to manage and merge updates to these specific customization areas.

**`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (01/12/2025, 16:56:07):**
This component, `MobileStepUI`, acts as a preview interface for UI customizations on a mobile device within the dashboard settings.
- **Dynamic Tab Rendering:** It uses an `activeTab` state to conditionally render different sections corresponding to 'brand', 'login', 'payments', 'checkout-element', 'address', and 'coupons' tabs passed as props.
- **Redux Integration:** Fetches `customizeUiData` from the Redux store to apply dynamic styles and content to the preview.
- **Live Preview:** Displays a mobile-like layout showing:
    - Branding (logo).
    - Checkout progress steps (Mobile - Address - Pay).
    - Login/Payment banners (using a `Carousel` with customizable content, colors, and timers).
    - Placeholder input boxes.
    - Coupon entry and available offers section (dynamically showing coupon lists or skeletons).
    - Trust banners based on `checkoutElementData`.
    - A list of upsell products, reflecting the `upsell_data` from the Redux store.
This component allows users to visualize how their customization settings will appear on the actual mobile checkout interface.

**Patterns and Recurring Elements:**
- **Centralized Utilities:** Consistent use of `@library` alias for internal imports and `gokwik-ui-kit` for UI components across React files.
- **Redux Toolkit:** State management relies heavily on Redux Toolkit for structured and predictable updates, especially for UI customization.
- **E-commerce Dashboard Focus:** The file paths (`checkout-dashboard-ui`), API endpoints, and component functionalities strongly indicate a development context related to an e-commerce dashboard.
- **Shopify Integration:** Numerous mentions and logic relating to Shopify products, collections, customers, and app configurations.
- **Configuration-Driven UI:** A significant emphasis on allowing users to extensively customize the checkout UI through a dedicated Redux store and a preview component.
- **API-Centric Data Flow:** Data fetching is standardized through a comprehensive `apiEndpoints.ts` file and a `api.ts` utility, which consistently uses `process.env.REACT_APP_BASE_URL`.

## 11:04:21
The provided log details changes across three files: `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`, and `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`.

**File-Specific Summaries:**

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts` (30/11/2025, 12:17:26 - 20:53:50):**
    *   This file primarily handles foreign analytics tracking, integrating with various third-party services like Facebook Pixel, Google Analytics (GA4), Snapchat, CleverTap, Klaviyo, MoEngage, WebEngage, Wigzo, Growlytics, Contlo, Netcore, EdgeTag, CustomerLabs, Shopify Analytics, and Google Ads.
    *   The code uses Svelte stores (`store_discountAmount`, `store_page`, `store_codCharges`, `store_priceBreakUp`, etc.) to reactively update local variables (`discountAmount`, `pageNumber`, `priceBreakup.cod_fee`, `totalValue`, etc.) and data structures (`commonAnalyticsData`, `priceBreakup`, `marketingData`).
    *   Significant changes include:
        *   Initial code defining a wide range of variables for analytics data, price breakdowns, and configuration for various pixel integrations.
        *   A series of console logs were added and then removed, suggesting debugging efforts (`console.log(res,"Total Price Amount")`, `console.log("Triggered")`).
        *   Logic was refined in `store_totalPrice.subscribe` to correctly calculate `cart_total_price` and `cart_after_discount` based on `cart` and `res` (total price) and to update `commonAnalyticsData['cart_after_discount']`.
        *   The `store_priceBreakUp.subscribe` callback was updated to also set `cart_total_price` and `cart_after_discount` using `res?.subTotal` and `res?.total` if available, falling back to `cart` values.
        *   The initialization of `cart_total_price` and `cart_after_discount` at the top level was changed from `let cart_total_price; let cart_after_discount;` to a direct assignment using `cart?.original_total_price / 100` and `cart?.total_price / 100`.
        *   A console log `console.log(res,"Price Breakup ===>")` was temporarily added within `store_priceBreakUp.subscribe`.
    *   The `adSourceMapping` function for UTM parameter parsing and `getDecodedURIComponent` for decoding URIs are consistently present.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html` (30/11/2025, 12:22:55):**
    *   This is an HTML file for a merchant page, likely for testing the GoKwik SDK.
    *   It contains an embedded JavaScript SDK (`gokwikSdk`) that handles initialization, checkout processing (`initCheckout`), event emission (`emit`), and listening for events (`on`), as well as a `hideButton` function.
    *   The `gokwikSdk` is initialized on `document.onreadystatechange` and a custom `initGKJS` event.
    *   Cookie management for `gk_landing_page` and `gk_orig_referrer` is implemented using `getCookieGk` and `setCookieGk` functions.
    *   The page features a "click me" button that triggers `goKwikCheckout` and passes `merchantInfo` to a `window.postMessage`.
    *   A JavaScript `merchantInfo` object is defined with various `mid` values (commented out except for one, and including 'qa', 'sandbox', 'local' environments), `storeId`, and `fbpixel`.
    *   An event listener `window.onmessage` checks for "Gokwik ready!" to post `merchantInfo`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts` (30/11/2025, 12:23:13 - 12:23:22):**
    *   This file defines service URLs and tokens based on the current environment (`env`).
    *   It subscribes to `store_merchanturl`, `store_environment`, and `store_cashToPrepaid`.
    *   A series of functions (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`, `XGokwikToken`, `XKWIKPASSToken`) determine base URLs and tokens for various APIs across different environments (dev, qa, sandbox, production, local, hdev, ndev, idev, qa-rto, qaone, qatwo, pci-prod).
    *   The primary change in this log entry is an update to the `api_url` function, specifically for the `local` environment, changing the commented-out `url` options and setting `url = 'https://sandbox.gokwik.co';`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts` (01/12/2025, 12:09:23):**
    *   This file provides `getCall` and `postCall` functions for making API requests, encapsulating error handling, loaders, and specific header requirements (e.g., `shopifySessionId`, `shopifyCookieInfo`).
    *   It subscribes to various Svelte stores like `common_loader`, `store_orderType`, `store_shopifySessionId`, `store_shopifyCookieInfo`, `store_sourceValue`, `store_merchantInfo`, and `store_isHydrogen`.
    *   URL construction logic adapts based on the API endpoint (e.g., health service, analytics, address suggestion).
    *   Error handling includes `APIErrorHandling`, `cardApiMessages`, `ShippingMethod`, `invalidEasyRewardPoints`, `healthService`, `httpsErrorStatusCode`, and `createOrderErrorMapping`.
    *   The `postCall` function includes logic for updating `store_priceBreakUp` and `store_gyftr` based on API responses, especially for price breakdown data.
    *   It also contains logic for merchant health checks and redirecting on unhealthy checkout or specific HTTP error codes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts` (01/12/2025, 12:34:26 - 18:47:11):**
    *   This service handles user authentication and login flow, including Truecaller integration, SSO, and address processing.
    *   It subscribes to numerous stores (`store_isNotIncognito`, `store_merchantInfo`, `store_truecallerActive`, `store_isSkipOtp`, `common_loader`, etc.) to manage state.
    *   The `verifyUser` function is central, handling different login scenarios (skipped OTP, Truecaller, existing JWT tokens).
    *   It performs actions like setting address data (`store_selectedAddress`, `store_partialAddressId`, `store_partialAddress`, `store_pincode`), updating user type, handling GST information, triggering analytics events (`fireAnalyticsGa4`, `initFBTracking`, `loginEvent`), and updating cart data.
    *   Significant changes revolve around the `else if (response.data.address?.partial_address)` block within the `verifyUser` function:
        *   Initially, it handles `response.data.address?.partial_address || (response.data.address[0]?.default === true)`.
        *   It then changes to `response.data.address?.partial_address`.
        *   A more complex condition is introduced: `response.data.address?.partial_address || (Array.isArray(response?.data?.address) && response?.data?.address?.length && response?.data?.address.some( (addr) => addr.default === true && (!addr.first_name || addr.first_name.trim() === '') && (!addr.last_name || addr.last_name.trim() === '') ))`, with console logs added around this logic (`console.log(addAddressInitialValue,"Address Initial Value")`, `console.log(response?.data?.address.some(...),"Address Initial Value in verify user")`, `console.log(response.data.address,'Response Address after verify user')`, `console.log("Idar AA gaya Response")`). This suggests an attempt to refine the detection of partial addresses or default addresses with missing name fields.
    *   The `.finally` block consistently handles `jwtTokensList` for SSO duplicacy and setting `goKwikToken` in `localStorage` and cookies.
    *   The `getTruecallerUserData` function fetches Truecaller data and then calls `verifyUser`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts` (01/12/2025, 12:36:44 - 20:16:25):**
    *   This service manages address validation and processing for various flows (adding, editing, deleting addresses).
    *   It subscribes to `store_addressesMasked`, `store_checkMappedEmail`, `store_emailBasedCohortDiscounts`, `store_validOffersState`, and `store_selectedAddress`.
    *   The `addressValidate` function performs extensive validation on address fields (pincode length, address length, email validity, name format) and updates `store_exsitingAddressErrorField` with error codes.
    *   The `processAddresses` function fetches and processes address data, setting various stores (`store_selectedAddress`, `store_allAddresses`, `store_addressCount`, `store_addressExperiments`, `store_fb_external_id`, `store_mappedEmail`, `store_skipToPayment`, `store_disableContinueButton`, `store_loader`) and logging events.
    *   A key focus of changes in this file is within the `addressValidate` function, specifically the conditions for `errorMsg` and `status`:
        *   Initial conditions for `status` are expanded to include `(selectedAddress?.fullname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))` at 12:44:16.
        *   This condition is then changed to `(selectedAddress?.firstname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))` at 12:45:22 and `(selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` at 18:42:28.
        *   Further, a block is added within `addressValidate` (at 18:43:27, 18:43:46, 18:49:36, 18:49:53, 18:55:24, 18:55:50, 18:56:22) to handle cases where `firstname` and `lastname` are empty, setting `selectedAddress.partial_address = true`, updating `store_partialAddress`, calling `setPartialAddress`, and showing a snackbar error (`Address.partialAddressName`).
        *   The condition `!addressValidate(defaultAddress, false)` in `processAddresses` is consistently checking the `status` property of the `addressValidate` function's return object, with a slight change to `!addressValidate(defaultAddress, false)?.status` at 17:40:34.
        *   Temporary `console.log` statements are frequently added, particularly within `processAddresses` (e.g., "Api Call for address", "Fetched Address before deletion", "Default Address after deletion", "Validation Adderss").
        *   At 01/12/2025, 14:00:14, the `fetchedAddress` mapping in `processAddresses` includes a change for `partial_address`: `partial_address: address?.partial_address && !!address?.firstname?.trim() && !!address?.lastname?.trim()`. This change is reverted at 14:07:50 and reapplied at 14:03:05 with `partial_address: true` for the `lastname === '.'` case, indicating an attempt to explicitly mark addresses as partial under certain conditions.
        *   At 01/12/2025, 20:16:25, a condition `!selectedAddressNameTrimmed?.trim()` is added to trigger the partial address handling and snackbar error within `addressValidate`. This explicitly checks for empty full names after trimming.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte` (01/12/2025, 13:07:21 - 13:08:17):**
    *   This Svelte component renders a list of addresses for the user to select from.
    *   It uses `svelte/animate` for flip transitions.
    *   It subscribes to `store_allAddresses`, `store_phoneNo`, `store_page`, `store_orderType`, `store_triggerContinueFunction`, `store_selectedAddress`, etc., to manage displayed addresses and UI state.
    *   Key functionalities include: deleting an address (`deleteAddressFnc`), changing the selected address (`onChangeAddress`, `selectAddress`), and navigating to the order page (`goToOrderPage`).
    *   It integrates with `ForeignAnalytics` for `fireAnalyticsGa4` and `userSelectedAddress` events, and `EventService` for `fireGtmEvent` and `logEvent`.
    *   The main change is adding `box-sizing: border-box;` to the `.see-all-button-container` style in the CSS, suggesting a layout fix.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts` (01/12/2025, 14:14:59 - 14:18:52):**
    *   This file contains various helper functions for managing application state, UI interactions, and API call processing.
    *   It subscribes to a vast array of stores from both `CommonStore` and `LoginStore`, and `OrderStore`.
    *   The `setAddress` function is updated to explicitly set `newAddressBody.partial_address` based on whether `address.partial_address` is true, or if `firstname` and `lastname` are not empty strings. This indicates a refinement in determining if an address is considered partial.
    *   Other functions include `detectAutofill`, `autofillEvents`, `closeBottomSheet`, `closeIframe`, `closeFullScreenPopUp`, `setCreateOrderStores`, and `getBadgeTitle`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte` (01/12/2025, 17:33:01 - 17:34:37):**
    *   This Svelte component handles the "Add Address" or "Edit Address" screen, including pincode input, geolocation, and dynamic address inputs.
    *   It uses `store_pincode`, `store_selectedAddress`, `store_page`, etc., for managing form data and UI.
    *   Key functions include `handlePincodeInput` for validating and submitting pincode, `handleContinueClick` for advancing the flow, and `triggerGeolocationAPI` for using device location.
    *   No significant functional changes are visible between these two timestamps, suggesting minor edits or re-saves without major code alterations.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte` (02/12/2025, 01:22:32 - 01:39:54):**
    *   This Svelte component renders the dynamic input fields for addresses, adapting based on flags like `store_additionalAddress` or `store_addressSuggestionFlow`.
    *   It defines two sets of address input configurations: `oldaddressInputs` and `suggestedAddressInputs`.
    *   It manages various address-related stores (`store_pincode`, `store_selectedAddress`, `store_editAddress`, `store_disableContinueButton`, etc.).
    *   The main change between these timestamps involves the `suggestedAddressInputs` initialization. Initially, it uses `suggestedAddressInputs.splice(suggestedAddressInputs.length - 1, 0, ...)` to add a recipient phone number field. This indicates a reordering of how input fields are defined, likely to ensure correct placement or conditional rendering of the recipient phone number field.
    *   The logic for `addressFields` and `addressInputs` based on `store_additionalAddress` is handled in `beforeUpdate`.

**Patterns and Recurring Elements:**

1.  **Svelte Store Integration:** A dominant pattern is the extensive use of Svelte stores (e.g., `store_selectedAddress`, `store_pincode`, `store_merchantInfo`, `store_page`, `store_cartjsObject`) for state management across different services and components. Components and services subscribe to these stores to react to changes, demonstrating a reactive programming paradigm.
2.  **Analytics and Event Logging:** There's a strong emphasis on analytics and event logging. Multiple files (`ForeignAnalytics.ts`, `Login.service.ts`, `Address.service.ts`, `AddressListing.svelte`, `Address.svelte`, `AddressInputs.svelte`, `ApiService.ts`) frequently call `logEvent`, `fireAnalytics`, `fireAnalyticsGa4`, `fireGtmEvent`, and `stabilityEvent` to track user actions, page loads, errors, and feature usage.
3.  **Environment-Specific Configuration:** The `EnvironmentService.ts` file clearly shows a pattern of defining URLs and tokens based on the deployment environment (local, dev, qa, sandbox, production). This is crucial for managing different API endpoints and security tokens across development and production stages.
4.  **Address Management Logic:** There's a recurring focus on address validation and processing.
    *   `Address.service.ts` contains core logic for `addressValidate` and `processAddresses`, including checks for pincode, address length, email validity, and first/last name.
    *   `Login.service.ts` integrates with `processAddresses` after user login.
    *   `AddressListing.svelte` and `Address.svelte` use these services to display and capture address information.
    *   Recent changes suggest an ongoing effort to improve the handling and validation of "partial addresses" and default addresses, especially when name fields are missing or deemed insufficient (`selectedAddress?.firstname === '' && selectedAddress?.lastname === ''`).
5.  **Error Handling and UI Feedback:** Many files include logic for displaying error messages (`snackbar_state.set`) and managing UI states (e.g., `store_disableContinueButton`, `store_loader`, `store_pincode_error_flag`) in response to API errors or validation failures.
6.  **Checkout Flow Management:** The files contribute to a complex checkout flow, with `store_page`, `store_skipToPayment`, and `store_triggerContinueFunction` playing central roles in navigating between different stages (login, address selection, payment).
7.  **Merchant-Specific Customizations:** The `merchant.html` and `EnvironmentService.ts` files demonstrate the ability to customize behavior and endpoints based on specific merchant IDs (`mid`). This indicates a multi-tenant or white-label architecture.
8.  **Third-Party Integrations:** The extensive list of analytics services (`postClevertapMessage`, `postKlaviyoMessage`, etc.) in `ForeignAnalytics.ts` and the `checkLogin` function in `Login.service.ts` for Truecaller integration highlight a system that relies heavily on external services.

## 11:23:55
Key information from these changes highlights continuous development and debugging around KwikPass checkout functionality within an AppMaker Expo application.

**File-Specific Updates:**

*   **`/packages/kwikpassV2/src/components/KwikPassCheckout.js` (and later `/src/kwikpassV2/src/components/KwikPassCheckout.js`)**: This React Native component, responsible for handling the KwikPass checkout flow, saw the most extensive and iterative changes.
    *   **Initial Setup and Event Handling**: The component sets up a `KPCheckout` WebView, handling various events from the embedded GoKwik SDK, including `modal_closed`, `orderSuccess`, `openInBrowserTab`, and `gk-checkout-disable`. It integrates with AppMaker's core (`appStorageApi`, `analytics`) and Shopify (`useShopifyAccessToken`) for data and actions.
    *   **Order Success Logic Evolution**: The `orderSuccess` event handler was a central point of modification.
        *   Initially, logic was developed to extract both `orderID` from a GraphQL GID and `orderKey` from the `checkoutUrl` using regular expressions. (e.g., 27/11/2025, 18:51:28; 27/11/2025, 23:16:36).
        *   There was a significant refactoring attempt (27/11/2025, 23:30:22) to simplify this, primarily focusing on navigating to the provided `checkoutUrl` in a WebView and extracting only the `orderID`, explicitly removing the `orderKey` extraction and `SET_ORDER_COMPLETE` action's `orderKey` parameter.
        *   However, this refactoring was largely reverted (27/11/2025, 23:50:11), bringing back the `orderKey` extraction using multiple regex patterns and including `orderKey` in the `SET_ORDER_COMPLETE` action.
        *   Further refinements included ensuring the `checkoutUrl` always has an `https://` prefix (28/11/2025, 00:25:40; 28/11/2025, 07:48:18; 28/11/2025, 07:55:12).
        *   Another major change involved commenting out much of the `checkoutUrl` and `orderKey` extraction to redirect directly to a Shopify `thank_you` page using `order_id` (28/11/2025, 12:25:54), only to later re-enable the `SET_ORDER_COMPLETE` action (28/11/2025, 12:40:35) and make `OPEN_IN_WEBVIEW` conditional on `orderKey` absence (28/11/2025, 12:41:56).
    *   **Debugging Efforts**: Numerous `console.log` statements were added and modified to inspect event names, data, and intermediate regex matches, indicating an active debugging phase. Temporary debugging code for `gokwik_events` with a counter was added and later commented out (01/12/2025, 17:55:47 to 01/12/2025, 18:02:38).

*   **`/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**: This wrapper component (`KPCheckout`) primarily serves to pass `checkoutData` and event callbacks to the underlying `Checkout` component. It remained relatively stable, with its main role being prop relaying (27/11/2025, 18:54:00).

*   **`/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**: This core WebView component handles the low-level rendering and interaction with the GoKwik checkout.
    *   **WebView Configuration**: It defines `injectJavaScript` to set up event listeners within the WebView for `gokwikSdk` events and general `window` messages, which are then relayed back to the React Native layer (27/11/2025, 18:57:26).
    *   **Dynamic URL Construction**: The component dynamically constructs the WebView URL based on merchant type (Shopify or custom), incorporating various parameters like merchant IDs, environment, tokens, cart data, and analytics IDs.
    *   **UPI Payment Handling**: It includes specific logic for handling UPI deep links, converting them to Android Intent URLs and displaying platform-specific alerts if UPI apps are not installed.
    *   **App State Management**: It listens to `BackHandler` and `AppState` changes to interact with the WebView, for instance, notifying the WebView about app state changes.

*   **`/packages/kwikpassV2/src/pages/CheckoutOptions.js`**: This file (first logged 28/11/2025, 14:48:50) defines a page structure that includes the `kwikpass/checkout` component, configured to display without a header and within a safe area view.

**Timestamps of Significant Changes:**

*   **27/11/2025, 18:51:28 - 20:35:26**: Initial implementation and minor updates across KwikPass checkout components.
*   **27/11/2025, 23:16:36**: `KwikPassCheckout.js` enhances order key extraction regex.
*   **27/11/2025, 23:20:30**: `KwikPassCheckout.js` experiences a path change, moving to `src/kwikpassV2/src/components`.
*   **27/11/2025, 23:30:22**: A major structural change in `KwikPassCheckout.js`'s `orderSuccess` handling is introduced, focusing on direct WebView redirection.
*   **27/11/2025, 23:50:11**: `KwikPassCheckout.js` reverts some of the previous major changes, restoring previous `orderKey` extraction and `SET_ORDER_COMPLETE` logic.
*   **28/11/2025, 00:25:40 - 07:55:36**: `KwikPassCheckout.js` undergoes multiple iterations to standardize `checkoutUrl` with `https://` prefix.
*   **28/11/2025, 12:25:54**: Another major re-evaluation of `orderSuccess` in `KwikPassCheckout.js`, shifting towards navigating to a generic Shopify thank you page.
*   **28/11/2025, 12:41:56**: `KwikPassCheckout.js` again adjusts the `orderSuccess` flow, making `OPEN_IN_WEBVIEW` conditional on the absence of an `orderKey` and reinstating `orderKey` extraction.
*   **28/11/2025, 14:48:50**: A new page configuration file `CheckoutOptions.js` is introduced.
*   **28/11/2025, 17:10:35 - 01/12/2025, 18:04:25**: Debugging logs are actively added, modified, and eventually commented out in `KwikPassCheckout.js`.

**Patterns or Recurring Elements:**

*   **Iterative Refinement**: The `orderSuccess` event handler in `KwikPassCheckout.js` demonstrates an iterative development pattern, with frequent changes, additions, removals, and occasional reversions of logic, particularly concerning how `orderID`, `orderKey`, and `checkoutUrl` are processed and used for post-checkout actions. This suggests a search for the optimal or most reliable post-checkout flow.
*   **Debugging-Heavy Development**: The consistent insertion and modification of `console.log` statements across multiple timestamps highlight a strong focus on debugging and understanding data flow during development.
*   **Inter-component Communication**: The system relies heavily on passing data and actions between a React Native component and an embedded WebView using message posting.
*   **External SDK Integration**: The codebase is tightly coupled with the GoKwik SDK, managing its lifecycle and event callbacks, and integrating it within a larger AppMaker/Shopify ecosystem.
*   **Path Fluctuations**: The `KwikPassCheckout.js` file appears to move between different directory paths (`packages/kwikpassV2` and `src/kwikpassV2`), which could indicate reorganization or experimental changes in module structure.

## 11:57:59
The changes, all occurring on 01/12/2025 between 16:48:13 and 16:56:07, reflect a concentrated effort to enhance the checkout dashboard's UI and backend capabilities, particularly for product/collection management, discounts, and upsell features.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (16:48:13)**:
    *   Introduces a sophisticated `ProductSearch` component for finding and managing products or collections.
    *   Key features include debounced search, infinite scrolling, pagination, the ability to collate product variants, quantity management, filtering for "agent-led" items, and options for top-up gifts.
    *   The component handles state for loading, selected items, search text, modal visibility, and API results.
    *   It renders a search input, buttons, and a list of selected products/collections with dynamic details like variant counts, quantities, and gift pricing inputs.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (16:49:34)**:
    *   Underwent a substantial expansion, adding numerous API endpoints for various dashboard functionalities.
    *   Significant additions include a suite of `agent-order` endpoints for abandoned carts, customer management, discounts, and payments.
    *   New dedicated endpoints for product and collection search and details (`productSearch`, `allProducts`, `allCollections`, `getVariantById`, `getCollectionById`, `getProductById`).
    *   Introduced `upsellCheckout` endpoints (`getandDeleteUpsellData`, `updateUpsellData`).
    *   Added endpoints for `diyDiscounts` and `bulkDiscounts` for Shopify integration, `checkoutLinks`, and various analytics categories (checkout, website, discount).
    *   New entries for cohort management, merchant configurations, and Shopify app specific settings (billing, shipping/payment rules, prepaid discounts).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (16:50:12)**:
    *   New helper functions were added to streamline API interactions:
        *   `fetchShopifyCollectionsOrProducts` now supports both title-based search and paginated listings of all products/collections, including filtering active products and flattening product variants for individual selection.
        *   `getAndDeleteUpsellData` and `pushUpsellData` for fetching, deleting, and updating upsell rules.
        *   `getVariantNCollectionDetailsbyId` to retrieve detailed information for specific variants, collections, or products, providing a unified response format.
        *   `validateGstData` for GST-related data validation.
    *   All API calls consistently leverage a `makeAPICall` utility and the base URL from environment variables, including error handling.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (16:51:23)**:
    *   Enriched with a wide array of general utility functions.
    *   Key additions include: `deepCompare` for object comparison (with special handling for `pincodes`), a `debounce` function, and `sortDataByKey` for flexible data sorting.
    *   A significant `uploadCohortCsv` function was added to handle CSV file uploads, validating if the content consists purely of phone numbers or emails before updating form fields.
    *   Enhanced functionality for date/time manipulation (`disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`), number/currency formatting (`formatAmount`, `formatNumber`), and text capitalization.
    *   New utilities for extracting data from UI column configurations (`extractTitlesAndDataIndexes`), comparing arrays for changes (`compareAndCaptureArrayFields`), and transforming data for tabular analytics display (`extractUniqueCKeysForAntColumn`).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (16:52:44)**:
    *   Introduced a complex `upsell_data` structure within the Redux store's `customize-ui` slice. This new state manages upsell enablement, item limits, applicability rules (product, variant, collection IDs), discount details (value, capping), and a list of upsell products.
    *   A corresponding `updateUpsellState` reducer was added to manage updates to this new upsell configuration.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (16:56:07)**:
    *   The `MobileStepUI` component, responsible for previewing UI customizations, was updated to reflect the new capabilities.
    *   It now dynamically renders different sections based on the active customization tab (brand, login, payments, checkout elements, address, coupons).
    *   Integrates deeply with the Redux `customizeUiData`, particularly the new `upsell_data`, to display upsell product lists within the mobile preview when an upsell call is active.
    *   Features include customizable banners, coupon code inputs, and trust banner displays, demonstrating the impact of the UI customization settings.

**Patterns and Recurring Elements:**

*   **Comprehensive Upsell Feature:** The coordinated changes across API endpoints, Redux state, and UI components strongly indicate the introduction or significant enhancement of a robust upsell functionality within the checkout dashboard.
*   **API Standardization:** A majority of the new API endpoints follow a `/api/dashboard/` prefix, suggesting a consistent and modular API architecture.
*   **Redux for Centralized UI State:** The `customize-ui` Redux slice is a central hub for managing diverse UI customization options, including banners, colors, and now intricate upsell rules.
*   **UI Kit Consistency:** The widespread use of components from `gokwik-ui-kit` (e.g., `Button`, `Input`, `Modal`, `Carousel`, `Skeleton`, `Layout`) ensures a uniform design language across the application.
*   **Focus on Data Management:** Several updates emphasize efficient handling of large datasets, including pagination, infinite scroll, and detailed filtering for products and collections.
*   **Utility-Driven Development:** The extensive additions to `helper.ts` highlight a proactive approach to encapsulating common functionalities (data formatting, validation, array/object manipulation) for reusability.

## 12:04:45
The provided log details significant activity across three files: `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts` and `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`.

### File-Specific Updates:

1.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** Multiple changes occurred on 30/11/2025 between 12:17:26 and 20:53:50.
    *   **Key Changes:**
        *   Initial commits define a comprehensive analytics service, importing numerous stores (LoginStore, OrderStore, CommonStore) and event posting services (Clevertap, Klaviyo, Moengage, WebEngage, Wigzo, FB, GA, Growlytics, Contlo, Ga4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, GoogleAds).
        *   A large number of `let` variables are declared to hold various analytics-related data points like `cart`, `risk_flag`, `merchant_user_type`, `coupon`, `phoneNumber`, `currency`, `pincode`, `userAddress`, `shippingMethod`, `paymentMethod`, `request_id`, `merchantUrl`, `totalValue`, `discountAmount`, `orderName`, `merchantInfo`, `gaTotalAmount`, `shopifyCustomerId`, `moengageCustomerId`, `sourceUrl`, `userType`, `ga4Id`, `google_ads_enhanced_tracking`, `snapchatAttributes`, `localStorageObject`, `finalPayablePrice`, `analyticsPixelObj`, `countryCode`, `gift_card_total`, `twidpayReward`, `gyftrAmount`, `discountBasedRewards`, `fbExternalId`, `kpFbCliId`, `kpUserToken`, `shopId`, `configObject`, `enableSku`, `ga4S2sEnabled`, `clevertapS2SEnabled`, `kwikOptimizerPixelIds`, `shopifySessionId`, `timestamp`, `addressFound`, `editPartialAddress`, `cart_total_price`, `cart_after_discount`, `marketingData`, `pageNumber`, and `mobileApp`.
        *   A `priceBreakup` object is initialized with various financial components (`line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, `tax`).
        *   An `fbPixelEventsAndKeys` object maps human-readable event names to Facebook Pixel keys.
        *   Numerous `store_*.subscribe` calls update local variables with data from different stores (e.g., `store_discountAmount`, `store_codCharges`, `store_priceBreakUp`, `store_discountCode`, `store_phoneNo`, `store_snapchatAttributes`, `store_localStorageObject`, `store_sourceUrl`, `store_fbc`, `store_fbp`, `store_pincode`, `store_selectedAddress`, `store_giftCardTotal`, `store_twidPay`, `store_gstInfo`, `store_discountBasedRewards`, `store_selectedShippingMethod`, `store_orderType`, `store_requestId`, `store_merchanturl`, `store_moid`, `store_shopifySessionId`, `store_requestIdObject`, `store_foreignAnalytics`, `store_merchantInfo`, `store_webengageCustomerId`, `store_checkout_url`, `store_methodShopifyCustomerId`, `store_newUser`, `store_country_code`, `store_shopifyAddressFound`, `store_editPartialAddress`, `store_order_name`, `store_riskFlag`, `store_merchantUserType`, `store_cartjsObject`, `store_finalPayablePrice`, `store_totalPrice`, `store_gyftr`, `store_shopifyCookieInfo`, `store_sourceValue`, `store_fbExternalId`).
        *   Functions `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping` are defined for utility purposes, primarily related to analytics data processing and UTM parameter handling.
        *   The change at **20:39:30** specifically adds a `console.log(res)` within the `store_priceBreakUp.subscribe` block.
        *   A significant change around **12:34:05** to **12:35:11** involves updating how `cart_total_price` and `cart_after_discount` are derived within the `store_priceBreakUp` subscription. Instead of directly from `cart` object, they now conditionally check `res?.subTotal` and `res?.total` from the price breakup response, falling back to `cart` values.
        *   Another change at **12:35:05** initializes `cart_total_price` and `cart_after_discount` directly at their declaration points.
        *   The log `console.log("Triggered")` was added at **12:20:53** within the `store_finalPayablePrice` subscription. This was subsequently removed, as it's not present in later logs.
        *   Changes at **12:27:14** and **12:27:27** adjust the logic for `cart_total_price` and `cart_after_discount` in `store_priceBreakUp.subscribe` to be based on `cart?.original_total_price / 100` and `cart?.total_price / 100` respectively, and removes `console.log(res,"Total Price Amount")`.
        *   **20:39:30**: `console.log(res)` is added to `store_priceBreakUp` subscription.
        *   **20:46:19**: Minor whitespace changes.
        *   **20:53:50**: No significant content changes visible in the provided snippet compared to the previous one.

2.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp:** 30/11/2025, 12:22:55.
    *   **Key Changes:**
        *   This is an HTML file serving as a merchant page for testing the `gokwikSdk`.
        *   It defines a `gokwikSdk` object with `init`, `initCheckout`, `emit`, `on`, and `hideButton` methods.
        *   The `init` function conditionally loads `gokwik.js` from `http://localhost:8080/build/gokwik.js` if no parameters are provided or the script is not already present. It also removes certain DOM elements if they exist (`.gokwik-disabled`, `#line_r_gokwik`).
        *   `document.onreadystatechange` and `document.addEventListener('initGKJS')` are used to call `gokwikSdk.init()`.
        *   Cookie functions `getCookieGk` and `setCookieGk` are defined and used to set `gk_landing_page` and `gk_orig_referrer` cookies.
        *   A "click me" button triggers `goKwikCheckout()` which posts `merchantInfo` to the window.
        *   The `merchantInfo` object contains various `mid` values (commented out for different environments/merchants), `environment: 'local'`, `storeId`, and `fbpixel`.
        *   An event listener `window.onmessage` is set up to handle 'Gokwik ready!' messages and then post `merchantInfo`.
        *   Contains commented out `mid` values for different test/production merchants (e.g., qa, neemans, bsc, boat, sandbox-plus, qa-plus, qa-1, ww, sandbox-auto).

3.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** Two changes occurred on 30/11/2025 at 12:23:13 and 12:23:22.
    *   **Key Changes:**
        *   Defines functions for retrieving various API base URLs (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`) based on the current environment (`env`).
        *   The `env` variable is subscribed from `store_environment` in `LoginStore`.
        *   The `api_url` function has multiple conditional returns for different environments (dev, qa-rto, qaone, sandbox, production, qa, hdev, ndev, local, qatwo, dev-core, qa-core, sandbox-core, pci-prod, idev).
        *   At **12:23:22**, the `api_url` for `env === 'local'` was changed from `'https://api.gokwik.co'` to `'https://sandbox.gokwik.co'`. This suggests an adjustment in the local development environment's API endpoint.
        *   Functions `XGokwikToken` and `XKWIKPASSToken` are provided to return environment-specific tokens.

4.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`**
    *   **Timestamp:** 01/12/2025, 12:09:23.
    *   **Key Changes:**
        *   This file focuses on API call mechanisms (`getCall`, `postCall`) and includes extensive error handling, loader management, and analytics event logging.
        *   Imports numerous stores and utility functions.
        *   The `postCall` function includes logic for updating `store_priceBreakUp` and `store_gyftr` based on `response.data?.priceBreakup`. This involves extracting `finalPayableAmount`, `originalPrice`, `totalDiscountAmount`, `totalGiftCardsAndRewards`, `customDiscount`, `shopifyDiscounts`, `automaticDiscounts`, `cashback`, `paymentOffer`, `prepaidDiscount`, and `loyaltyPoints`.
        *   It also contains logic for merchant health checks, shipping method error handling, and various status code-based responses.
        *   A `shopifyRedirectEvent` or `triggerCheckoutRedirect('checkoutHealth')` is called if `is_checkout_healthy` is false.

5.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`**
    *   **Timestamps:** Multiple changes on 01/12/2025 between 12:34:26 and 18:47:11.
    *   **Key Changes:**
        *   Handles user verification and login flows, including Truecaller integration and SSO.
        *   Subscribes to many stores for user-related data (`isNotIncognito`, `merchantInfo`, `truecallerActive`, `isSkipOtp`, `isAbandonCart`, `environment`, `page`, `requestIdObject`, `fireEvents`, `skipToPayment`, `offersList`, `localStorageObject`, `discountCode`).
        *   The `verifyUser` function manages different login scenarios (skip OTP, no JWT tokens, Truecaller login).
        *   If login is successful, it updates various stores (`store_selectedAddress`, `store_partialAddressId`, `store_partialAddress`, `store_pincode`, `store_merchantUserType`, `store_localStorageObject`, `store_GSTBilling`, `store_phoneNo`, `store_requestId`, `store_cartId`, `store_customerId`, `store_skipOtpMobile`, `store_skipToPayment`, `store_addressSuggestionFlow`, `store_additionalAddress`, `store_geolocationMMIFlow`, `store_addressOnPaymentsPage`, `store_freeShipping`).
        *   Includes calls to `fireAnalyticsGa4`, `initFBTracking`, `gokwikTokenMessage`, `setCookie`.
        *   The `processAddresses` function (imported from `Address.service`) is called to handle address data.
        *   **14:25:08**: The `else if` condition for `response.data.address?.partial_address` was extended to include a check for an array of addresses where a default address might have empty `first_name` or `last_name`. This also includes a `console.log(addAddressInitialValue,"Address Initial Value")` for debugging.
        *   **14:34:30**: Added a console log for debugging `Address Initial Value in verify user` inside the `if (response.statusCode === 200)` block.
        *   **14:36:57**: Added a `console.log` for the address validation condition.
        *   **14:40:04**: Added `console.log(response.data.address,'Response Address after verify user');`
        *   **18:44:46**: Added `console.log("Idar AA gaya Response")` before `getAllAddress()` call.

6.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`**
    *   **Timestamps:** Multiple changes on 01/12/2025 between 12:36:44 and 20:16:25. This file has the most frequent changes.
    *   **Key Changes:**
        *   Contains functions (`addressValidate`, `processAddresses`) related to address management and validation.
        *   Subscribes to `store_addressesMasked`, `store_checkMappedEmail`, `store_emailBasedCohortDiscounts`, `store_validOffersState`, `store_selectedAddress`.
        *   The `addressValidate` function performs extensive checks on `selectedAddress` for validity (pincode length, address length, email validity, name format) and updates `store_exsitingAddressErrorField`.
        *   The `processAddresses` function processes fetched addresses, setting `store_addressesMasked`, logging events, updating `store_selectedAddress`, `store_allAddresses`, `store_addressCount`, `store_addressExperiments`, `store_fb_external_id`, and `store_mappedEmail`. It also handles `update_items` by calling `updateCart`.
        *   Numerous `console.log` statements are added and removed throughout the changes for debugging purposes, particularly within `addressValidate` and `processAddresses`.
        *   **12:38:10**: The condition `if (!res.data.address)` was changed to `if (!res?.data?.address?.length)` to check for an empty array, and logs `Api Call for address`.
        *   **12:44:16**: Adds a new condition to `addressValidate` status check: `(selectedAddress?.fullname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))`. This aims to catch addresses with empty full names.
        *   **12:45:01**: Added `console.log(selectedAddress?.partial_address || (selectedAddress?.fullname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.')))` for debugging.
        *   **12:51:25**: Added `console.log("coming here ==>")` to an `else` block after `addressValidate` in `processAddresses`.
        *   **12:52:26**: Added `console.log(!addressValidate(defaultAddress, false),"Validation Adderss")` for debugging.
        *   **12:57:54**: Switched the condition in `processAddresses` from `if (!addressValidate(defaultAddress, false))` to `if (addressValidate(defaultAddress, false))`. This is a logical inversion, possibly a bug fix or a change in desired flow.
        *   **12:58:22 to 13:00:05**: The condition for `errorMsg = Address.partialAddress` in `addressValidate` was modified, including `(selectedAddress?.firstname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))` within the first `if` block.
        *   **13:00:14**: The `fetchedAddress.map` function in `processAddresses` was updated to explicitly set `partial_address: address?.partial_address && !!address?.firstname?.trim() && !!address?.lastname?.trim()` if `lastname` is not `.` (or empty). This logic was then reverted in subsequent commits.
        *   **13:03:05**: The `fetchedAddress.map` function was modified again. If `address.lastname === '.'`, `lastname` is set to `''` and `partial_address` is set to `true`. This suggests a refinement in handling incomplete names and marking addresses as partial. This change was reverted later on.
        *   **17:39:24**: The `if` condition within `addressValidate` that checks `!addressValidate(defaultAddress, false)` in `processAddresses` was updated to check for `?.status`.
        *   **18:42:28**: Adds a new validation for empty `firstname` and `lastname` within `addressValidate`, setting `errorMsg` and `updateErrorFields('is_partial_address')`.
        *   **18:43:27**: If `firstname` and `lastname` are empty, it now sets `store_partialAddress` and `selectedAddress.partial_address = true`.
        *   **18:48:12**: Changes `store_partialAddress.set(selectedAddress)` to `store_partialAddress.set(addAddressInitialValue)` when `firstname` and `lastname` are empty in `addressValidate`.
        *   **18:48:42**: Added `console.log(selectedAddress, " Selected Address in validation ");`
        *   **18:55:24**: Added `snackbar_state.set` to show an error message when `firstname` and `lastname` are empty, and removed the `store_partialAddress.set` and `setPartialAddress` calls from `addressValidate`.
        *   **18:55:50**: Reverted the `snackbar_state.set` and related `store_partialAddress.set`/`setPartialAddress` logic back to commented-out in `addressValidate`, indicating uncertainty or temporary disablement of this error message and store update.
        *   **18:56:22**: The `snackbar_state.set` logic for empty names was reintroduced in `addressValidate`, along with `store_partialAddress.set(addAddressInitialValue); setPartialAddress(selectedAddress);`.
        *   **19:59:11**: Added a comment `#CHECKOUT-21591` to the partial address logic for empty `firstname` and `lastname` in `addressValidate`.
        *   **20:11:51**: Added `console.log("Selected Address in validation: ", selectedAddressNameTrimmed);` in `addressValidate`.
        *   **20:16:25**: Modified the condition for detecting empty names in `addressValidate` from `selectedAddress?.firstname === '' && selectedAddress?.lastname === ''` to `!selectedAddressNameTrimmed?.trim()`, which is more robust.

7.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`**
    *   **Timestamp:** 01/12/2025, 13:07:21 and 13:08:17.
    *   **Key Changes:**
        *   This Svelte component is responsible for displaying and managing a list of addresses.
        *   It imports various stores (LoginStore, CommonStore, OrderStore) and services (EventService, ForeignAnalytics, Helper.service, MerchantAPI, Discounts.service, Address.service).
        *   Initializes variables for addresses, phone number, order type, colors, and flags.
        *   `onMount` hook sets up event logging, initializes store states (`store_addressAdded`, `store_codCharges`, `store_disableContinueButton`, `store_moveToAddressListing`, `store_editPartialAddress`), and subscribes to numerous stores to react to state changes.
        *   The `unsubscribeContinueFunction` callback now checks `addressValidate($store_selectedAddress, true)` and conditionally calls `getUserVerify(true)` or redirects to add/edit address. It also handles shipping error flags and navigates to the order page or shows a snackbar.
        *   `deleteAddressFnc` handles deleting an address and calls `processAddresses(deleteAddressRes, true)`.
        *   `onChangeAddress` calls `discountShippingCall` and updates `selectedAddressServiceable`.
        *   `selectAddress` updates the `selectedAddress` store and reorders the `addresses` array to bring the selected address to the top. It also potentially calls `getAvailableOffers`.
        *   The component uses `<AddressCard>`, `<ShippingMethod>`, and `<HighlightedMessage>` sub-components.
        *   **13:08:17**: No significant content changes visible in the provided snippet compared to the previous one; likely whitespace or minor formatting.

8.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`**
    *   **Timestamps:** 01/12/2025, 17:33:01 and 17:34:37.
    *   **Key Changes:**
        *   This Svelte component is for adding or editing an address.
        *   Imports stores (LoginStore, CommonStore, OrderStore) and services (MerchantAPI, EventService, ForeignAnalytics, Helper.service, addressSuggestionHelper, Discounts.service).
        *   Manages pincode input, geolocation API integration, and rendering of `AddressInputs` and `ShippingMethod`.
        *   `onMount` initializes `tempPreviousAddressAndShipping`, logs address page loads, and subscribes to various stores (`store_selectedAddress`, `store_partialAddress`, `store_geolocationMMIFlow`, `store_phoneNo`, `store_page`, `store_editAddress`, `store_triggerContinueFunction`, `store_primary_color`, `store_cityState`).
        *   `handlePincodeInput` validates pincode length, updates stores, and calls `submitPincode`.
        *   `handleContinueClick` triggers either pincode submission or delegates to `AddressInputs`'s continue function.
        *   `triggerGeolocationAPI` initiates a geolocation process and listens for `geolocation_api_response` messages, then calls `rgeocodeAPI` to fetch address details based on coordinates.
        *   **17:34:37**: Minor whitespace/formatting changes appear to be the only difference.

9.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts`**
    *   **Timestamp:** 01/12/2025, 14:14:59 and 14:18:52.
    *   **Key Changes:**
        *   This file provides a collection of helper functions related to checkout flow, address handling, API interactions, and analytics.
        *   Extensive imports from LoginStore, CommonStore, OrderStore for various state management.
        *   The `setAddress` function constructs and sets the `store_selectedAddress` with provided address details, including handling `partial_address` flag.
        *   `autofillEvents` logs when autofill is used.
        *   `closeBottomSheet`, `closeIframe`, `closeFullScreenPopUp` manage the visibility and state of UI components.
        *   `setCreateOrderStores` updates various order-related stores (`store_webengageCustomerId`, `store_retryCreate`, `store_moid`, `store_gokwikOid`, `store_order_name`, `store_checkout_url`, `store_customCheckoutUrl`, `store_original_checkout_url`, `store_graphqlOrderId`, `store_prepaidDiscount`, `store_finalPayablePrice`, `store_cartjsObject`).
        *   `getBadgeTitle` determines a discount badge title based on merchant URL.
        *   **14:18:52**: The `setAddress` function had a change to `newAddressBody.partial_address`. It was updated from `true` to `address.partial_address ? address.partial_address : address.firstname !== '' && address.lastname !== '' ? true : false;`. This makes the `partial_address` flag more conditional based on the incoming address object and presence of first/last names.

10. **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`**
    *   **Timestamps:** Multiple changes on 02/12/2025 between 01:22:32 and 01:39:54.
    *   **Key Changes:**
        *   This Svelte component handles address input fields.
        *   It imports a vast array of stores from LoginStore, CommonStore, OrderStore, and services (MerchantAPI, ForeignAnalytics, EventService, Helper.service, EnvironmentService, addressSuggestionHelper, Discounts.service).
        *   Defines `oldaddressFields`, `oldaddressInputs`, `suggestedAddressFields`, `suggestedAddressInputs` arrays to structure address form fields.
        *   Conditional logic to `splice` in `recipient_phone` and `apartment_name` fields based on store values (`$store_enableRecipientPhone`, `addressMMIFlow`).
        *   `beforeUpdate` and `afterUpdate` hooks dynamically set `addressInputs` and `addressFields` based on `$store_additionalAddress` and `isBillingAddress`.
        *   `onMount` subscribes to various stores, sets `emailDisabled` based on KwikPass login, populates `addressFields` from `store_GSTBilling` if `isBillingAddress` and `billing_address_object` is present, and sets up an outside click listener.
        *   **01:29:36 to 01:39:54**: No significant content differences were observed, indicating minor changes like whitespace or reordering.

### Patterns and Recurring Elements:

*   **Svelte Store Integration:** A dominant pattern across multiple `.ts` and `.svelte` files is the heavy reliance on Svelte stores (e.g., `store_page`, `store_selectedAddress`, `store_merchantInfo`, `store_cartjsObject`, `store_discountCode`) for state management and data flow. Components subscribe to these stores to reactively update their state.
*   **Analytics and Event Logging:** `ForeignAnalytics.ts`, `Login.service.ts`, `Address.service.ts`, `AddressListing.svelte`, and `Address.svelte` all heavily interact with analytics and event logging services (e.g., `logEvent`, `fireAnalytics`, `fireGtmEvent`, `fireAnalyticsGa4`, `initFBTracking`, `stabilityEvent`). This indicates a strong focus on tracking user behavior and system stability.
*   **Environment-Specific Configuration:** `EnvironmentService.ts` demonstrates that the application supports multiple deployment environments (local, dev, qa, sandbox, production, etc.) with different API endpoints and tokens, which is a common practice in complex applications.
*   **Address Management Logic:** There's a concentrated effort around address handling.
    *   **Validation:** `addressValidate` in `Address.service.ts` includes checks for pincode, address length, email format, and name validity. Recent changes suggest continuous refinement of these validation rules, especially for partial addresses and names.
    *   **Processing:** `processAddresses` (in `Address.service.ts`) is crucial for loading, mapping, and potentially reordering addresses based on various flags (`leading_indicators_flag`, `last_used_address_flag`).
    *   **Prefill/Autofill:** Logic for prefilling addresses from Truecaller, Shopify, or geolocation is present (`Login.service.ts`, `Address.svelte`, `Helper.service.ts`).
    *   **UI Components:** `AddressListing.svelte` and `Address.svelte` are dedicated Svelte components for displaying address lists and input forms, respectively. `AddressInputs.svelte` handles the granular input fields.
*   **Debugging and Logging:** Frequent addition and removal of `console.log` statements in various files (`ForeignAnalytics.ts`, `Address.service.ts`, `Login.service.ts`) indicate active debugging during development.
*   **Error Handling and UI Feedback:** `snackbar_state` is frequently updated to provide user feedback on errors or success, and error fields are managed through `store_exsitingAddressErrorField`.
*   **Conditional UI Rendering:** Svelte's reactive syntax (`$:`) and `{#if}` blocks are used extensively to conditionally render UI elements and apply styles based on store values (e.g., `usePartnerOfferCss`, `showMMIButton`, `$store_show_input`).
*   **Checkout Flow:** The code snippets collectively demonstrate a complex checkout flow involving login, address selection/addition, shipping method determination, and payment preparation, with many interdependencies between stores and services. The `store_skipToPayment` and `store_page` stores are critical for managing the flow state.

## 12:23:44
The changes log primarily revolves around the integration and event handling of a "KwikPass" checkout system within a React Native application, specifically focusing on interactions with a WebView that hosts the GoKwik SDK.

**File-Specific Updates:**

1.  **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/components/KwikPassCheckout.js`** and **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/src/kwikpassV2/src/components/KwikPassCheckout.js`**
    *   These two file paths contain almost identical code and are the most frequently modified. This suggests they might be different locations for the same component (e.g., source vs. packaged version) or a temporary development strategy. Updates often propagate between these two paths.
    *   **Initial Logic (27/11/2025, 18:51:28)**: The component `KwikPassCheckout` is responsible for rendering the `KPCheckout` component (from `@appmaker-packages/extension-kwikpass-expo-package`) and handling various events received from it via the `onEvent` prop.
    *   **Event Handling Focus**: The `onEvent` callback handles several key events:
        *   `modal_closed`: Navigates back.
        *   `orderSuccess`: The most heavily modified section. It aims to extract `orderID` from `graphqlOrderId` (GID) and `orderKey` from `checkoutUrl` using regex. After extraction, it dispatches a `SET_ORDER_COMPLETE` action and attempts a `KWIKPASS_LOGIN` if the user is not already logged in.
        *   `openInBrowserTab`: Handles opening URLs either within the app's WebView or via a custom URL scheme.
        *   `gk-checkout-disable`: Triggers `OPEN_SHOPIFY_NATIVE_CHECKOUT`.
    *   **Debugging and Refinements in `orderSuccess` (27/11, 22:53:59 - 28/11, 12:41:56)**:
        *   Numerous `console.log` statements were added, modified, and removed to debug the extraction of `orderId` and `orderKey` and the flow logic.
        *   Multiple regex patterns (`orderKeyRegex`, `orderKeyRegexExtra`) were tried to extract `orderKey` more robustly, indicating challenges with varying `checkoutUrl` formats.
        *   Logic for ensuring `checkoutUrl` starts with `http://` or `https://` was repeatedly added, refined, and sometimes reverted.
        *   A significant temporary refactor (27/11, 23:30:22) moved away from manual `orderKey` extraction and focused on directly redirecting to the provided `checkoutUrl` for `orderSuccess`, but this was later largely reverted (27/11, 23:50:11).
        *   The condition for dispatching `SET_ORDER_COMPLETE` shifted from requiring both `orderId` and `orderKey` to only `orderId || orderKey` and then back to conditional actions based on `orderKey` presence (e.g., `OPEN_IN_WEBVIEW` only if `orderKey` is missing).
    *   **Temporary Debugging (01/12, 17:55:47 - 01/12, 18:02:38)**: A brief, slightly erroneous debug block for `gokwik_events` was introduced, corrected for a typo, and then commented out, suggesting local testing or discarded tracing.

2.  **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**
    *   **Initial Setup (27/11/2025, 18:54:00)**: This file defines the `KPCheckout` component, a wrapper that passes props like `cartId`, `storefrontToken`, `storeId`, `sessionId`, `utmParams`, and analytics IDs to the actual `Checkout` WebView component.
    *   A `console.log` was added to show `checkoutData` during rendering, likely for debugging purposes.

3.  **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**
    *   **Initial Setup (27/11/2025, 18:57:26)**: This is the core WebView component. It contains `injectJavaScript` to communicate with the `gokwikSdk` within the WebView, listening for `modal_closed`, `orderSuccess`, `openInBrowserTab`, `gokwikLoaded`, `gokwik_events`, and `gk-checkout-disable` events, and posting them back to the React Native side.
    *   **Checkout Initialization**: The `InitiateCheckout` function constructs the WebView URL based on merchant type (Shopify or custom), fetching various tokens and IDs from a `CacheInstance` and encoding `storeInfo` and `gkToken` using `base64`.
    *   **UPI Handling**: Includes `UPI_APP_PACKAGES` and logic (`convertToIntentUrl`, `handlePaymentIntent`) to handle UPI deep links for Android.
    *   This file remained relatively stable compared to `KwikPassCheckout.js`, mostly seeing minor formatting changes, indicating its core structure was established early.

4.  **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/pages/CheckoutOptions.js`**
    *   **Initial Setup (28/11/2025, 14:48:50)**: Defines a `CheckoutOptions` configuration object, which specifies a `kwikpass/checkout` block to be rendered, likely as part of a larger page structure in the AppMaker SDK. No functional changes observed.

**Timestamps of Significant Changes:**

*   **27/11/2025, 18:51:28 - 18:57:26**: Initial commit of the core `KwikPassCheckout.js` and `Checkout.tsx` components, establishing basic GoKwik SDK integration and event handling.
*   **27/11/2025, 23:16:36**: Introduction of a secondary regex (`orderKeyRegexExtra`) in `KwikPassCheckout.js` to improve `orderKey` extraction reliability in the `orderSuccess` event.
*   **27/11/2025, 23:30:22**: A significant (though temporary/reverted) refactor in `KwikPassCheckout.js` to streamline `orderSuccess` handling, deprecating manual `orderKey` extraction in favor of direct redirection.
*   **28/11/2025, 00:25:40 - 07:48:18**: Iterative bug fixes and refinements in `KwikPassCheckout.js` to correctly prepend `https://` to `checkoutUrl` to ensure valid URLs for WebView navigation.
*   **28/11/2025, 12:25:54 - 12:41:56**: Multiple critical changes in `KwikPassCheckout.js` regarding `orderSuccess`: attempts to generate a Shopify thank you URL, then a return to using the GoKwik `checkoutUrl` with conditional `OPEN_IN_WEBVIEW` based on `orderKey` presence, and reinstatement of `SET_ORDER_COMPLETE`.

**Patterns and Recurring Elements:**

*   **GoKwik SDK Integration**: The primary purpose of these changes is to integrate the GoKwik SDK for checkout and user authentication within the AppMaker framework, especially for Shopify stores.
*   **WebView Communication**: A consistent pattern is the use of `WebView` with injected JavaScript to listen for specific `gokwikSdk` events and communicate them back to the native React Native component using `window.ReactNativeWebView.postMessage`.
*   **Event-Driven Logic**: The checkout flow is heavily event-driven, with different actions (`GO_BACK`, `SET_ORDER_COMPLETE`, `KWIKPASS_LOGIN`, `OPEN_IN_WEBVIEW`, `OPEN_SHOPIFY_NATIVE_CHECKOUT`) triggered based on `message.eventname`.
*   **Debugging Verbosity**: Frequent additions and modifications of `console.log` statements throughout the code indicate active and often intricate debugging, particularly within the `orderSuccess` event handler, suggesting challenges in ensuring a smooth and reliable post-checkout process.
*   **URL Parsing and Sanitization**: Recurring efforts to correctly extract data (like `orderKey`) from URLs using regex and to ensure URLs are properly prefixed with schemes (`http://`, `https://`) demonstrate common issues in handling external URLs.
*   **Code Duplication/Sync Issues**: The presence of almost identical files in `/packages/kwikpassV2/src/components/` and `/src/kwikpassV2/src/components/` that are updated in parallel or with slight discrepancies suggests a complex build setup, temporary development copies, or manual synchronization, which might lead to inconsistencies.
*   **User Authentication Flow**: A consistent element is the logic to automatically log in a user via `KWIKPASS_LOGIN` if an `email` and `gkAccessToken` are provided in the `orderSuccess` event and the user is not already logged in.

## 12:57:58
The provided log details several code changes within a `checkout-dashboard-ui` project, largely focusing on UI customization, API integration, and utility functions, with a notable emphasis on upsell features.

### File-Specific Updates and Significant Timestamps:

**1. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 01/12/2025, 16:48:13)**
This file defines a React component, `ProductSearch`, used for searching and selecting products or collections within the dashboard. Key functionalities include:
*   **Dynamic Search:** Allows searching for 'products' or 'collections' with debounced input and infinite scroll pagination.
*   **Product/Collection Handling:** Parses API responses to group product variants and distinguishes between product and collection items.
*   **Quantity Management:** Supports adding, removing, incrementing items, and handling specific collection quantities.
*   **Conditional UI:** Renders various UI elements (search input, buttons, modals, product/collection displays) based on props like `hideSearch`, `hideButton`, `showQuantity`, `collateProducts`, `isAgentLed`, and `topUpGift`.
*   **Integration:** Leverages `gokwik-ui-kit` for UI components, local API utilities, and Redux hooks.

**2. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (Timestamp: 01/12/2025, 16:49:34)**
This file is a central repository for all API endpoint definitions used in the application. It's a comprehensive list covering a wide array of dashboard functionalities:
*   **Core Operations:** Includes endpoints for orders, customers, abandoned carts, and sensitive information logging.
*   **Product & Collections:** Defines paths for searching, fetching all, and getting details for products and collections (e.g., `productSearch`, `allProducts`, `getVariantById`).
*   **Discount Management:** Extensive endpoints for creating, listing, generating codes, uploading files, and searching related items for various discount types (`discountConfig`, `diyDiscounts`).
*   **Analytics:** Grouped endpoints for checkout, website, discount, marketing, and order analytics.
*   **Merchant Configuration:** Paths for managing merchant-specific settings, Shopify app integrations, billing, and health status.
*   **New Features:** Includes endpoints for `upsellCheckout` (get/delete/update upsell data), `checkoutLinks`, and `validateGstData`/`setGstData`.
Many endpoints are parameterized to dynamically construct URLs.

**3. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (Timestamp: 01/12/2025, 16:50:12)**
This file provides higher-level API abstraction functions built on top of `makeAPICall` and the defined `APIEndPoints`.
*   **Shopify Product/Collection Fetching:** `fetchShopifyCollectionsOrProducts` handles fetching products or collections, including search functionality, pagination, filtering by `active` status, and mapping product variants.
*   **Merchant and Upsell Data:** Contains functions to `updateMerchantData`, `getAndDeleteUpsellData` (for fetching or deleting upsell rules), and `pushUpsellData` (for updating upsell configurations).
*   **Detail Fetching:** `getVariantNCollectionDetailsbyId` fetches details for products, variants, or collections by ID, standardizing the response format.
*   **GST Validation:** `validateGstData` handles API calls for GST validation.

**4. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamp: 01/12/2025, 16:51:23)**
This file is a collection of general-purpose utility functions:
*   **Formatting:** `formatDateString`, `formatAmount` (with dynamic currency symbol), `formatNumber`, `capitalizeFirstLetter`.
*   **UI & Data Manipulation:** `getDynamicSearchFilters`, `extractTitlesAndDataIndexes`, `sortDataByKey`, `deepCompare`.
*   **Date/Time Handling:** `dayjs` integration for `disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`.
*   **Event Handling:** A standard `debounce` function.
*   **File Processing:** `uploadCohortCsv` specifically for validating CSV uploads (all phone numbers or all emails) for cohort management.
*   **Specific Logic:** `shopifyAppCheckoutEnabledStatus` checks last login date, `compareAndCaptureArrayFields` identifies additions/removals in arrays, and `areBothRangesMoreThanOneDay` for date range validation.

**5. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (Timestamp: 01/12/2025, 16:52:44)**
This Redux slice manages the state for UI customization across the checkout dashboard:
*   **State Structure:** Defines `initialState` for `brand_data`, `login_data`, `address_data`, `payment_data`, `button_toogle`.
*   **Expanded `upsell_data`:** The `upsell_data` section is significantly detailed, including `is_upsell_enabled`, `item_count_limit`, `rule_applicable_on`, `upsell_product_list`, `discounted_price`, `discount` parameters, and `applicable_items` based on product/variant/collection IDs. This indicates a robust implementation for upsell customization.
*   **Reducers:** Provides `update` reducers for each section of the customization data, including `updateUpsellState` for the detailed upsell configurations.

**6. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (Timestamp: 01/12/2025, 16:56:07)**
This React component renders a mobile-view preview of the customized checkout UI.
*   **Dynamic Preview:** Displays different sections (brand, login, address, payments, coupons, checkout elements) based on an `activeTab` state, allowing users to see changes in real-time.
*   **Redux Integration:** Uses `useSelector` to retrieve `customizeUiData` (including the detailed `upsell_data`) to dynamically populate content, styles, and banner information.
*   **Carousel for Banners:** Features a carousel for displaying login and payment banners, pulling content and timing from Redux state.
*   **Coupon/Discount Preview:** Includes specific UI for entering coupon codes and displaying available offers.
*   **Trust Banners:** Manages the display of trust banners, allowing custom banners or defaulting to a predefined list.
*   **Upsell Preview Emphasis:** Explicitly logs `customizeUiData?.upsell_data` and derives `listOfProducts` for an upsell preview, highlighting its role in visualizing upsell configurations.

### Patterns and Recurring Elements:

*   **Checkout Dashboard UI Focus:** All changes are centered around a "checkout-dashboard-ui" project, indicating a comprehensive system for managing and customizing checkout experiences.
*   **Gokwik UI Kit:** The `gokwik-ui-kit` is consistently used for UI components across multiple React files, ensuring a uniform look and feel.
*   **Shopify Integration:** Numerous API endpoints and utility functions (`fetchShopifyCollectionsOrProducts`, `shopifyAppCheckoutEnabledStatus`, `shopifyMerchantConfigs`, etc.) confirm deep integration with the Shopify ecosystem for products, collections, and merchant configurations.
*   **API-Centric Architecture:** The project heavily relies on a well-defined API layer (`apiEndpoints.ts`, `api.ts`) for all data interactions, promoting modularity.
*   **Redux State Management:** Redux Toolkit is the chosen state management solution, particularly evident in the `customize-ui` slice and its consumption in `mobilePage.tsx`, for handling global UI customization data.
*   **Emphasis on Upsell Feature:** The detailed `upsell_data` in the Redux store, specific API endpoints for upsells, and the explicit upsell preview logic in `mobilePage.tsx` suggest that upsell functionality is a significant and actively developed area.
*   **Utility-Driven Development:** The presence of a `helpers` directory with diverse utility functions (formatting, validation, data manipulation) indicates a focus on reusability and clean code.
*   **Timestamp Consistency:** All changes occurred on **01/12/2025**, within a span of approximately 8 minutes (16:48:13 to 16:56:07), suggesting a single session of related development or deployment activity.

## 13:04:39
The changes across these files primarily focus on refining analytics tracking, address validation logic, and environment-specific API configurations within a GoKwik PDP (Product Detail Page) project.

**File-specific Updates:**

1.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** Multiple changes throughout November 30, 2025 (from 12:17:26 to 20:53:50).
    *   **Key Changes:** This file, responsible for foreign analytics integration, underwent several minor adjustments. The most notable repeated change is the refinement of how `cart_total_price` and `cart_after_discount` are calculated. Initially, they directly used `cart.original_total_price / 100` and `cart.total_price / 100`, respectively. This was modified to prioritize values from `store_priceBreakUp` (`res?.subTotal` and `res?.total`) if available, falling back to the `cart` object if not. Console logs were added (`console.log(res,"Total Price Amount")`, `console.log(res,"Price Breakup ===>")`) for debugging price breakup and total amount. A console log for `totalValue` (`console.log(res)`) was also added in the `store_priceBreakUp` subscription.

2.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp:** 30/11/2025, 12:22:55.
    *   **Key Changes:** This HTML file, likely a test or development merchant page, saw minor cosmetic changes in its `window.merchantInfo` object, specifically commenting out and adding various `mid` (merchant ID) values. No significant functional changes were introduced here beyond these commented test values.

3.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** Two changes on November 30, 2025 (12:23:13 and 12:23:22).
    *   **Key Changes:** The primary change here is in the `api_url` function, specifically for the `env === 'local'` condition. The commented-out options for local environment URLs were reordered, and the active local API URL was changed from `'https://api.gokwik.co'` to `'https://sandbox.gokwik.co'`. This suggests a shift in the default local development environment configuration.

4.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`**
    *   **Timestamp:** 01/12/2025, 12:09:23.
    *   **Key Changes:** In the `postCall` function, a new condition `!url.includes(APIConfig.giftCard.getGiftCard) && res.statusCode === 400` was added to ensure that if a gift card API call returns a 400 status code, the response is still resolved (not rejected or treated as a generic error). This implies a specific handling requirement for gift card errors.

5.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`**
    *   **Timestamps:** Multiple changes throughout December 1, 2025 (from 12:34:26 to 18:47:11).
    *   **Key Changes:**
        *   An array `newLoginMerchants` was added and used to determine redirection logic if `merchantJwtTokens` are empty.
        *   Console logs were added, particularly around `processAddresses` call and `response.data.address` for debugging address handling in `verifyUser`.
        *   The logic for setting `store_partialAddress` was updated. Previously, it was set based on `response.data.address?.partial_address`. Now, an additional condition `(Array.isArray(response?.data?.address) && response?.data?.address?.length && response?.data?.address.some((addr) => addr.default === true && (!addr.first_name || addr.first_name.trim() === '') && (!addr.last_name || addr.last_name.trim() === '')))` was added. This means a partial address is also identified if a default address exists but has empty first or last names, suggesting an improvement in handling incomplete pre-filled addresses.

6.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`**
    *   **Timestamps:** Numerous changes throughout December 1, 2025 (from 12:36:44 to 20:16:25). This file saw the most frequent updates.
    *   **Key Changes:**
        *   **Address Validation (`addressValidate`):** The validation logic was extensively modified. A new condition `(selectedAddress?.fullname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))` was added to the `status` return value, indicating an address is invalid if full name is empty (or lastname is just a period). This evolved to explicitly check for `firstname === '' && lastname === ''`. Console logs were frequently added (`"Validation Adderss"`, `"Selected Address in validation"`) for debugging the validation process.
        *   **`processAddresses` Function:**
            *   Initially, if `!res?.data?.address`, it would clear selected address/all addresses/count and set page to 3 (add address bottom sheet). This was updated to directly call `addAddressBottomSheet()` and set loader status.
            *   The mapping of `fetchedAddress` was modified to conditionally set `partial_address: true` for addresses where `lastname` is '.', indicating an incomplete address needing further input. This was refined further to check `!!address?.firstname?.trim() && !!address?.lastname?.trim()` for a more robust partial address detection, and then reverted to simpler logic (just `lastname === '.' ? { ...address, lastname: ''} : address`) before being updated again to `!selectedAddressNameTrimmed?.trim()`.
            *   The logic for updating `store_skipToPayment` based on `addressValidate` result was changed to check `!addressValidate(defaultAddress, false)?.status` implying a direct check on the status property of the returned object.
            *   Explicit `console.log` statements were added for debugging purposes at various points in the `processAddresses` function, especially for `fetchedAddress` and `defaultAddress`.
            *   The logic for handling empty `firstname` and `lastname` was moved inside the `addressValidate` function, and it now triggers a `snackbar_state` with a "partial address name" error. This logic was added and removed in quick succession, indicating active development and testing of this specific edge case.

7.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts`**
    *   **Timestamps:** Two changes on December 1, 2025 (14:14:59 and 14:18:52).
    *   **Key Changes:** In the `setAddress` function, the `newAddressBody.partial_address` property's assignment logic was updated from simply `true` to `address.partial_address ? address.partial_address : address.firstname !== '' && address.lastname !== '' ? true : false;`. This makes the `partial_address` status more dynamic based on the presence of first and last names.

8.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`**
    *   **Timestamps:** Two changes on December 1, 2025 (13:07:21 and 13:08:17).
    *   **Key Changes:** A new style property `box-sizing: border-box;` was added to the `.see-all-button-container` CSS class, and `display: flex;` was added to `.see-all-button`. These are minor UI/layout adjustments.

9.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`**
    *   **Timestamps:** Two changes on December 1, 2025 (17:33:01 and 17:34:37).
    *   **Key Changes:** The `background-color` for the `.floating-label` in the CSS was changed from `white` to `var(--white)`, likely to use a CSS variable for theme consistency.

10. **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`**
    *   **Timestamps:** Three changes on December 2, 2025 (01:22:32, 01:29:36, 01:29:57).
    *   **Key Changes:**
        *   The default `label` for the 'Apartment, Area, Sector, Village' address field was adjusted based on `$store_additionalAddress` or `$store_addressSuggestionFlow`.
        *   The `suggestedAddressInputs` array had a `placeholder` added to its 'Apartment, Area, Sector, Village' field.
        *   The `changeAllowed` property for the 'Recipient Phone Number' in `suggestedAddressInputs` was made conditional based on `isBillingAddress`.

**Patterns and Recurring Elements:**

*   **Frequent Debugging:** Extensive use of `console.log` statements (e.g., in `ForeignAnalytics.ts`, `Address.service.ts`, `Login.service.ts`) indicates active debugging and monitoring of data flow and logic, especially around price calculations, address validation, and API responses.
*   **Store Subscriptions:** All `.ts` files heavily rely on Svelte's store subscription pattern (`store_X.subscribe((res) => { ... });`) to react to changes in application state. This is a core architectural pattern in this codebase.
*   **Analytics and Event Tracking:** There's a strong emphasis on logging events (`logEvent`, `fireGtmEvent`, `fireAnalyticsGa4`, `facebookEvents`) at various stages of user interaction and data processing (e.g., `addaddress_pageload`, `address_selected`, `geolocation_button_clicked`, `mmi_address_autofilled`, `verify_token`, `sso_validation_failure`, `addresslistloaded`). This suggests a detailed analytics framework is in place.
*   **Address Management Complexity:** The `Address.service.ts` and `Login.service.ts` files show significant, iterative changes related to address validation, processing, and display. This includes handling partial addresses, masked addresses, different address sources (Shopify, Truecaller), and error messaging. The repeated refinements indicate that address handling is a critical and complex area of the application.
*   **Conditional Logic based on `res.data` and `env`:** Many functions utilize conditional checks based on `response.data` properties (e.g., `res.data?.areAaddressesMasked`, `res.data.leading_indicators_flag`, `res.data.last_used_address_flag`) and the current environment (`env`) to adapt behavior and API endpoints.
*   **Error Handling and User Feedback:** The use of `snackbar_state.set` for displaying error messages (`APIErrorHandling.generic`, `Address.partialAddressName`, `ShippingMethod.reCalculating`) is a consistent pattern for informing the user about issues.
*   **Skipping Flows/Pre-filling:** The `store_skipToPayment` and `partial_address` flags suggest functionality for streamlining the checkout process by pre-filling information or skipping steps if valid data is available.

## 13:23:48
The `KwikPassCheckout.js` file, located under both `/packages/kwikpassV2/src/components/` and `/src/kwikpassV2/src/components/` (indicating possible file movement or duplication), underwent the most extensive and iterative modifications. This component is responsible for integrating the GoKwik checkout experience within a React Native application using a WebView.

**Key Changes in `KwikPassCheckout.js`:**

*   **Initial Event Handling (27/11/2025, 18:51:28):** The component was established to handle various GoKwik SDK events received via the WebView, including `modal_closed`, `orderSuccess`, `openInBrowserTab`, and `gk-checkout-disable`. A primary focus was on the `orderSuccess` event, where it attempted to extract `shopifyOrderId` and `orderKey` from the `checkoutUrl` and `graphqlOrderId` using regular expressions, then trigger a `SET_ORDER_COMPLETE` action and conditionally log in the user via `KWIKPASS_LOGIN`.
*   **Order Key Extraction Refinement (27/11/2025, 23:16:36 - 23:16:45):** An additional regex (`orderKeyRegexExtra`) was introduced to improve the reliability of extracting the `orderKey` from the `checkoutUrl`, addressing potential issues with URL formats. Debugging `console.log` statements were frequently added and removed during this period.
*   **Major `orderSuccess` Refactoring and Subsequent Revert (27/11/2025, 23:30:22 & 23:50:11):** A significant change was introduced to simplify the `orderSuccess` flow by removing the manual `orderKey` extraction and directly redirecting to the `checkoutUrl` using `OPEN_IN_WEBVIEW`. However, this refactoring was largely reverted, returning to the `orderKey` extraction and `SET_ORDER_COMPLETE` action, though without the `orderKeyRegexExtra` initially.
*   **Checkout URL Prefixing Logic (28/11/2025, 00:25:40 - 07:55:36):** Multiple iterations were made to ensure the `checkoutUrl` received from the GoKwik SDK was correctly prefixed with `https://` if it lacked a full scheme. This involved several attempts to correctly initialize and modify the `checkoutUrl` variable. The logic was stabilized around 28/11/2025, 07:48:18, and refined slightly at 07:55:12.
*   **Evolving `orderSuccess` Navigation (28/11/2025, 12:25:54 - 12:41:56):** The handling of `orderSuccess` continued to evolve:
    *   Initially, the `orderKey` extraction was commented out, and a Shopify `thank_you` page URL was constructed and opened in a WebView (12:25:54).
    *   This was later adjusted to use the provided `checkoutUrl` from the message, with robust URL prefixing logic (12:37:42, 12:38:50, 12:38:59).
    *   The `SET_ORDER_COMPLETE` action, previously commented out, was re-enabled (12:40:35).
    *   A conditional navigation approach was introduced: if `orderKey` couldn't be extracted, `OPEN_IN_WEBVIEW` was used with the `checkoutUrl`; otherwise, `SET_ORDER_COMPLETE` was called with the extracted `orderKey` (12:41:56).
*   **Debugging and Minor Adjustments (28/11/2025, 17:10:35 - 01/12/2025, 18:04:25):** The `orderSuccess` logic appeared to partially revert to an earlier state (missing `orderKeyRegexExtra`) while maintaining `orderKey` null-safety. Debugging `console.log` statements were added, corrected for typos, and then commented out, focusing on logging event names and data.

**Other File Updates:**

*   **`node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx` (27/11/2025, 18:54:00):** This file defines the `KPCheckout` component, acting as a wrapper that passes `merchantParams` and event handlers to the core `Checkout` WebView component. No significant changes were observed after its initial state.
*   **`node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx` (27/11/2025, 18:57:26):** This is the core WebView component, containing JavaScript injected into the WebView to communicate with `gokwikSdk` and post messages back to the native app. It also handles UPI app deep linking and app state changes. No functional changes were observed in this file after its initial entry.
*   **`packages/kwikpassV2/src/pages/CheckoutOptions.js` (28/11/2025, 14:48:50 - 14:52:20):** This file defines the page configuration for `CheckoutOptions`, specifying it uses the `kwikpass/checkout` block. No code changes were recorded here.

**Patterns and Recurring Elements:**

*   **Focus on `orderSuccess` event handling:** The most consistent pattern is the iterative development and debugging centered around the `orderSuccess` event from the GoKwik SDK. This includes repeated efforts to extract order identifiers and manage post-checkout navigation and user login.
*   **Debugging with `console.log`:** Frequent addition and removal of `console.log` statements indicate an active debugging process throughout the changes.
*   **URL and Regex Manipulation:** Regular expressions are consistently used to parse Shopify Global IDs and extract keys from URLs. There's an ongoing effort to ensure URLs are correctly formatted and handled for navigation.
*   **Conditional User Login:** The logic to automatically log in a user with `KWIKPASS_LOGIN` using `email` and `gkAccessToken` upon successful order, but only if the user is not already logged in, remains a constant feature across all relevant versions of `KwikPassCheckout.js`.
*   **File Duplication/Movement:** The existence of identical content for `KwikPassCheckout.js` in both `/packages/` and `/src/` paths suggests a build process, file refactoring, or synchronization issue that led to duplicated log entries for the same logical component.

## 13:57:51
The provided log details several code changes focused on enhancing a checkout dashboard UI, primarily around product/collection management, discounts, analytics, and UI customization. All changes are timestamped on **01/12/2025** between **16:48:13** and **16:56:07**, suggesting a concentrated development or deployment activity.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 01/12/2025, 16:48:13)**
    *   Introduces/modifies the `ProductSearch` component, a versatile tool for searching and selecting products or collections.
    *   It supports dynamic search types (`products` or `collections`), pagination via `useIntersectionObserver` for infinite scrolling, and debounced input for efficient API calls.
    *   Key functionalities include managing items to add (including collating product variants), incrementing/removing quantities, and handling collection-specific quantity rules with validation.
    *   Integrates with `isAgentLed` flag to filter out specific products and `topUpGift` logic for special pricing.
    *   The UI displays selected items with images, names, variant details, and quantity controls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (Timestamp: 01/12/2025, 16:49:34)**
    *   This file, a central repository for API endpoints, has been significantly expanded and structured.
    *   It defines numerous endpoints for `dashboard` operations, including `orders`, `abandoned carts`, `customer` data, `pincode` management, and various `analytics` (checkout, website, discount).
    *   New additions or prominent existing entries include comprehensive `product` and `collection` search/details (`productSearch`, `allProducts`, `allCollections`, `getVariantById`, `getCollectionById`, `getProductById`).
    *   Crucially, it now includes specific endpoints for `upsellCheckout` (`getandDeleteUpsellData`, `updateUpsellData`) and `checkoutLinks` (list, create, update), indicating new features for cart upsells and checkout link management.
    *   `diyDiscounts` and `bulkDiscounts` sections further detail discount management capabilities.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (Timestamp: 01/12/2025, 16:50:12)**
    *   Updates to the API utility functions to support the new endpoints and features.
    *   `fetchShopifyCollectionsOrProducts` is refined to handle both search by title and paginated fetching, filtering active products and mapping product variants appropriately.
    *   New functions `getAndDeleteUpsellData` and `pushUpsellData` are added to interact with the `upsellCheckout` endpoints, allowing fetching, deleting, and updating upsell rules.
    *   `getVariantNCollectionDetailsbyId` provides a consolidated way to fetch detailed information for variants, collections, or products based on their IDs, mapping the responses into a structured format.
    *   `validateGstData` is also present for handling GST-related API calls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamp: 01/12/2025, 16:51:23)**
    *   This file aggregates a variety of helper functions, indicating ongoing refinement of shared utilities.
    *   Notable additions include enhanced date and time manipulation functions (`disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`), string formatting utilities (`capitalizeFirstLetter`, `formatNumber`), and complex object comparison (`deepCompare`).
    *   New functionalities include `uploadCohortCsv` for validating and processing CSV files containing either phone numbers or emails for cohort management, and `compareAndCaptureArrayFields` for identifying changes between two arrays.
    *   Currency formatting (`setCurrencySymbol`, `formatAmount`) is made more flexible.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (Timestamp: 01/12/2025, 16:52:44)**
    *   This Redux slice, named `banner`, has been expanded to manage a broader range of UI customization data beyond just banners.
    *   The `initialState` now includes comprehensive configurations for `brand_data` (logo, CSS), `login_data` (background, banner, consent, button text), `address_data`, and `payment_data`.
    *   **A significant new addition is `upsell_data`**, which stores settings for upsell features, including whether upsells are enabled, item limits, rule applicability, discounted pricing, and lists of applicable products/variants/collections.
    *   Corresponding `updateUpsellState` reducer is added to manage this new data.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (Timestamp: 01/12/2025, 16:56:07)**
    *   This React component provides a mobile preview for UI customization settings.
    *   It dynamically renders different sections (brand, login, payments, checkout elements, address, coupons) based on the active tab, pulling data from the `customizeUiData` Redux store.
    *   The component now specifically integrates with and displays `upsell_data`, rendering `listOfProducts` from the upsell configuration if `isUpsellCall` is true.
    *   It simulates a checkout flow visually, including dynamic banners, coupon input fields, and placeholders for product/payment sections, making extensive use of `gokwik-ui-kit` components.

### Patterns and Recurring Elements:

*   **UI Customization Focus:** A strong pattern across these changes is the emphasis on allowing deep customization of the checkout UI, from branding and login screens to payment options and the introduction of upsell experiences.
*   **E-commerce Feature Expansion:** The updates consistently add or enhance core e-commerce functionalities like product/collection management, discount application, and post-purchase (upsell) features.
*   **Shopify Integration:** Numerous references to "Shopify" related entities (collections, products, customers) and `shopify-app` configurations indicate a tight integration with the Shopify ecosystem.
*   **Data-Driven UI:** The use of Redux for managing UI state (`customizeUiData`) and extensive API calls to fetch dynamic content (`apiEndpoints.ts`, `api.ts`) points to a highly data-driven approach for rendering UI.
*   **Utility-First Development:** The presence of a comprehensive `helper.ts` file with diverse utility functions suggests a focus on reusability and clean code practices.
*   **Ant Design / Gokwik-UI-Kit:** Components from `gokwik-ui-kit` (likely an internal wrapper around Ant Design) are used consistently across UI files, ensuring a unified look and feel.
*   **Agent-Led Flows:** Specific logic and endpoints for "agent-order" and filtering by `isAgentLed` indicate support for assisted checkout processes.
*   **Unified Timestamp:** All changes occurring on the same date and within a short timeframe indicate a cohesive set of updates, possibly part of a single feature release or a concentrated bug-fixing/enhancement effort.

## 14:07:18
The provided log details changes across three files: `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`, and `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`.

### File-Specific Updates:

1.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** 30/11/2025, 12:17:26; 30/11/2025, 12:20:53; 30/11/2025, 12:22:25; 30/11/2025, 12:25:10; 30/11/2025, 12:27:14; 30/11/2025, 12:27:27; 30/11/2025, 12:29:18; 30/11/2025, 12:34:05; 30/11/2025, 12:35:05; 30/11/2025, 12:35:11; 30/11/2025, 20:39:30; 30/11/2025, 20:46:19; 30/11/2025, 20:53:50
    *   **Key Changes:**
        *   **Initial Setup (12:17:26):** Extensive imports from various stores (`LoginStore`, `OrderStore`, `CommonStore`) and services (`EventService`), type definitions (`Interfaces`), and constants (`TextConstants`). Declaration of numerous `let` variables for analytics data (e.g., `cart`, `risk_flag`, `merchant_user_type`, `coupon`, `phoneNumber`, `priceBreakup`). Definition of `fbPixelEventsAndKeys` and initialization of `marketingData`. Numerous `store.subscribe` calls for various data points like `discountAmount`, `page`, `codCharges`, `priceBreakUp`, `discountCode`, `phoneNo`, `snapchatAttributes`, `localStorageObject`, `sourceUrl`, `fbc`, `fbp`, `pincode`, `selectedAddress`, `giftCardTotal`, `twidPay`, `gstInfo`, `discountBasedRewards`, `selectedShippingMethod`, `orderType`, `requestId`, `merchanturl`, `moid`, `shopifySessionId`, `requestIdObject`, `foreignAnalytics`, `merchantInfo`, `webengageCustomerId`, `checkout_url`, `methodShopifyCustomerId`, `newUser`, `country_code`, `shopifyAddressFound`, `editPartialAddress`, `localStorageObject` (again for `token`), `order_name`, `riskFlag`, `merchantUserType`, `cartjsObject`, `finalPayablePrice`, `totalPrice`, `gyftr`, `shopifyCookieInfo`, `sourceValue`, `fbExternalId`). Introduction of `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping` functions.
        *   **Minor Console Log Additions (12:20:53, 12:22:25):** A `console.log("Triggered")` was added before `store_totalPrice.subscribe` (12:20:53) and then removed (12:22:25), indicating debug activity.
        *   **Refinement of Cart Price Calculation (12:25:10):** Updated `cart_total_price` and `cart_after_discount` calculations in `store_totalPrice.subscribe` to use optional chaining (`cart?.original_total_price` and `cart?.total_price`) for safer access.
        *   **Relocation of Cart Price Calculation (12:27:27, 12:29:18, 12:34:05):** `cart_total_price` and `cart_after_discount` calculations were moved from `store_totalPrice.subscribe` to `store_priceBreakUp.subscribe` (12:27:27), along with a debug `console.log(res,"Price Breakup ===>")` (12:29:18). Later, the calculation was refined further to use `res?.subTotal` and `res?.total` from `store_priceBreakUp` if available, falling back to `cart` object values (12:34:05).
        *   **Initialization of Cart Prices (12:35:05, 12:35:11):** The variables `cart_total_price` and `cart_after_discount` were initialized directly at their declaration with `cart?.original_total_price / 100` and `cart?.total_price / 100`, respectively.
        *   **Console Log Removal (20:39:30):** The `console.log(res)` was removed from `store_priceBreakUp.subscribe`.
        *   **No other significant content changes were observed in subsequent timestamps for this file.** The primary focus was on managing and reacting to state changes from various Svelte stores to gather analytics data.

2.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp:** 30/11/2025, 12:22:55
    *   **Key Changes:** This HTML file defines a merchant test page.
        *   Includes a basic HTML structure with a title "Merchant" and a favicon.
        *   Contains a `<script>` tag defining `gokwikSdk` for managing SDK initialization (`init`), payment processing (`initCheckout`), event handling (`on`, `emit`), and button visibility (`hideButton`).
        *   The `gokwikSdk.init()` is called `document.onreadystatechange` and `document.addEventListener('initGKJS')`.
        *   Functions `getCookieGk` and `setCookieGk` are defined for cookie management, specifically for `gk_landing_page` and `gk_orig_referrer`.
        *   A "click me" button with `data-mid`, `data-appid`, and `data-appsecret` attributes is present, which triggers `goKwikCheckout()` on click.
        *   A `window.merchantInfo` object is defined with `mid`, `environment`, `type`, `storeId`, and `fbpixel` (commented out various `mid` values). The `environment` is set to `'local'`.
        *   A `window.onmessage` listener handles a "Gokwik ready!" message.
        *   An `analytics-js` script is dynamically created and appended to the head, with a `dog` event listener for console logging.
        *   Includes a `<div id="privy-widget">` with nested elements, possibly for a marketing widget.

3.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** 30/11/2025, 12:23:13; 30/11/2025, 12:23:22
    *   **Key Changes:**
        *   **Initial Definition (12:23:13):** Exports `merchantUrl`, `env`, `cashToPrepaid`. Subscribes to `store_merchanturl`, `store_environment`, and `store_cashToPrepaid`. Defines several functions to get base URLs for different services (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`) based on the `env` variable. Also defines `XGokwikToken` and `XKWIKPASSToken` to return environment-specific tokens. The `api_url` for `local` environment is commented out with multiple options and set to `'https://api.gokwik.co'`.
        *   **Change in Local API URL (12:23:22):** The `api_url` function's `local` environment URL was changed from `'https://api.gokwik.co'` to `'https://sandbox.gokwik.co'`.

4.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`**
    *   **Timestamp:** 01/12/2025, 12:09:23
    *   **Key Changes:**
        *   Imports various stores and services.
        *   `getCall` function: Added `source` parameter to `getCallURl` for most API calls, excluding "hits", `analytics_api()`, "orders-count", and `kpLoginToken`. Also, headers now include `shopifySessionId` and `shopifyCookieInfo` for non-analytics/hits calls.
        *   `postCall` function: Similarly added `source` to `params` for most API calls, excluding specific endpoints like `/v1/payment/`, `shopifyCart`, `truecaller`, and `createShopifyAbandonCart`.
        *   Introduced `merchantHealthCheckEndpoints` array to `postCall` for specific endpoints where a health check is performed. If `is_checkout_healthy` is false, it logs events (`merchant_unhealthy`, `stabilityEvent`) and redirects.
        *   Enhanced `priceBreakUp` handling: In `postCall`, if `res?.data?.priceBreakup` exists, it extracts `gyftr` item and updates `store_gyftr` and `store_priceBreakUp` with detailed price components (total, subtotal, discounts, cashback, payment offers, loyalty points).
        *   Improved shipping method error handling in `postCall`: If `shippingOptions` API returns `statusCode === 400`, `store_selectedShippingMethod` is set to `null`.
        *   Specific error handling for `APIConfig.login.truecaller` (resolves without further checks) and `APIConfig.giftCard.getGiftCard` (resolves on 400 status).
        *   Added handling for `APIConfig.create.retry` to disable click if applicable and specific error messages.
        *   Added logic for `APIConfig.create.create` to handle `update_msg` and `401` status (e.g., duplicate order).

5.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`**
    *   **Timestamps:** 01/12/2025, 12:34:26; 01/12/2025, 12:34:44; 01/12/2025, 14:12:31; 01/12/2025, 14:12:41; 01/12/2025, 14:13:39; 01/12/2025, 14:22:15; 01/12/2025, 14:23:39; 01/12/2025, 14:25:08; 01/12/2025, 14:26:03; 01/12/2025, 14:34:30; 01/12/2025, 14:36:57; 01/12/2025, 14:38:06; 01/12/2025, 14:40:04; 01/12/2025, 18:44:46; 01/12/2025, 18:47:11
    *   **Key Changes:**
        *   **Refinement in Address Handling (12:34:26):** In `verifyUser`, the `else if (response.data.address?.partial_address || (response.data.address[0]?.default === true))` condition for handling partial addresses was changed. The `(response.data.address[0]?.default === true)` part was removed (12:34:44).
        *   **Console Log Additions (14:12:31, 14:22:15, 14:36:57, 14:40:04, 18:44:46, 18:47:11):** Multiple `console.log` statements were added to `verifyUser` to debug `truecallerUserData` and `response.data.address` at various points, particularly after `getAllAddress()` is called, and after checking `response.data.address?.partial_address`.
        *   **Conditional Partial Address Logic (14:23:39, 14:25:08):** The condition for setting `store_shopifyAddressFound(false)` and `store_partialAddress(addAddressInitialValue)` was modified. It was initially checking `response.data.address?.partial_address` OR `(Array.isArray(response?.data?.address) && response?.data?.address?.length && response?.data?.address.some((addr) => addr.default === true && (!addr.first_name || addr.first_name.trim() === '') && (!addr.last_name || addr.last_name.trim() === '')))`. This was temporarily simplified to just `response.data.address?.partial_address` (14:25:08) and then reverted back to the more complex condition in subsequent commits.
        *   **General Pattern:** The file `Login.service.ts` consistently deals with user verification, token handling, address processing (fetching, setting partial/selected), and analytics logging (FB, GA4, GTM). There's frequent use of Svelte stores (`store_selectedAddress`, `store_partialAddress`, `store_page`, `store_localStorageObject`, etc.) to manage application state. Debugging `console.log` statements were added and removed repeatedly, indicating active development and testing.

6.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`**
    *   **Timestamps:** 01/12/2025, 12:36:44; 01/12/2025, 12:38:10; 01/12/2025, 12:38:21; 01/12/2025, 12:44:16; 01/12/2025, 12:45:01; 01/12/2025, 12:45:22; 01/12/2025, 12:51:25; 01/12/2025, 12:52:26; 01/12/2025, 12:52:57; 01/12/2025, 12:55:49; 01/12/2025, 12:56:17; 01/12/2025, 12:56:27; 01/12/2025, 12:57:54; 01/12/2025, 12:58:22; 01/12/2025, 12:58:39; 01/12/2025, 12:58:46; 01/12/2025, 13:00:05; 01/12/2025, 13:00:59; 01/12/2025, 14:00:14; 01/12/2025, 14:00:40; 01/12/2025, 14:03:05; 01/12/2025, 14:04:06; 01/12/2025, 14:07:50; 01/12/2025, 14:09:44; 01/12/2025, 14:10:13; 01/12/2025, 14:11:19; 01/12/2025, 17:39:24; 01/12/2025, 17:40:34; 01/12/2025, 17:43:31; 01/12/2025, 18:42:28; 01/12/2025, 18:43:27; 01/12/2025, 18:43:46; 01/12/2025, 18:45:32; 01/12/2025, 18:48:12; 01/12/2025, 18:48:42; 01/12/2025, 18:49:36; 01/12/2025, 18:49:53; 01/12/2025, 19:59:11; 01/12/2025, 20:01:03; 01/12/2025, 20:02:32; 01/12/2025, 20:11:51; 01/12/2025, 20:16:25
    *   **Key Changes:**
        *   **Initial `processAddresses` and `addressValidate` (12:36:44):** The `processAddresses` function is responsible for handling address data, including masking, setting selected/all addresses, updating cart, and logging events. `addressValidate` performs validation checks on various address fields like length, pincode format, email validity, and name format. Console logs for "Api Call for address" are present.
        *   **Empty Address Handling (12:38:10, 12:38:21, 12:52:57):** The condition `if (!res.data.address)` was changed to `if (!res?.data?.address?.length)` (12:38:10) and then back to `if (!res?.data?.address)` (12:38:21). It was then changed again to `store_allAddresses.set(null); store_addressCount.set(null);` (12:52:57). This indicates fluctuating logic for how an empty address list is handled.
        *   **Address Name Validation (12:44:16, 12:45:01, 12:45:22):** The `addressValidate` function's return `status` logic was extended to include `(selectedAddress?.fullname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))`. This was then simplified by adding a console log to track the boolean value (12:45:01) and then back to the original form (12:45:22).
        *   **Removal of `store_loader.set` (12:54:40):** A `store_loader.set` call was commented out within the `if (!addressValidate(defaultAddress, false))` block, indicating a change in loading state management.
        *   **Partial Address Name Handling (12:55:49):** The `addressValidate` function was updated to handle cases where `firstname` and `lastname` are empty, specifically setting `selectedAddress.partial_address = true` and displaying a snackbar error. This was temporarily commented out (12:55:50) and then uncommented (12:56:22).
        *   **Default Address `partial_address` flag (01/12/2025, 13:16:25):** If `defaultAddress` exists, its `partial_address` property is explicitly set to `true` before validation, possibly to force a certain validation path. This change was reverted at 14:04:06, but a similar change was seen in Login.service.ts for specific conditions.
        *   **Debugging Console Logs (various timestamps):** Numerous `console.log` statements were added and removed throughout the `processAddresses` and `addressValidate` functions, often logging the `res` object or the validation status. This points to extensive debugging of address processing and validation logic.
        *   **Refinement of `fetchedAddress` mapping (14:00:14, 14:03:05):** The mapping logic for `fetchedAddress` was updated. Initially, it handled `lastname === '.'` by setting `lastname: ''`. Then, it also conditionally set `partial_address: address?.partial_address && !!address?.firstname?.trim() && !!address?.lastname?.trim()` (14:00:14). This was later simplified back to just handling `lastname` and explicitly setting `partial_address: true` for all non-`lastname === '.'` addresses (14:03:05). This change was reverted again in 14:04:06 to only handle `lastname === '.'`.
        *   **Default Address Validation Status (17:39:24):** The `addressValidate` call was updated from `if (!addressValidate(defaultAddress, false))` to `if (!addressValidate(defaultAddress, false)?.status)`, safely accessing the `status` property (17:40:34).
        *   **Refined Partial Address Name Logic in `addressValidate` (18:42:28, 18:43:27, 18:43:46, 18:45:32, 18:48:12, 18:48:42, 18:49:36, 18:49:53, 19:59:11, 20:01:03, 20:02:32, 20:11:51, 20:16:25):** Repeated additions and removals of a block that sets `errorMsg`, `selectedAddress.partial_address = true`, `store_partialAddress.set(selectedAddress)`, and `setPartialAddress(selectedAddress)` if `selectedAddress?.firstname === '' && selectedAddress?.lastname === ''`. A snackbar message was added for this case (18:55:24) and temporarily commented out (18:55:50). Finally, a new condition `!selectedAddressNameTrimmed?.trim()` was introduced for this logic, along with the snackbar error, and a comment `#CHECKOUT-21591` (20:16:25).

7.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`**
    *   **Timestamps:** 01/12/2025, 13:07:21; 01/12/2025, 13:08:17
    *   **Key Changes:**
        *   **Initial Component Setup (13:07:21):** Svelte component for displaying an address list. Subscribes to numerous stores for address data, user information, and UI state. Includes lifecycle hooks (`onMount`, `onDestroy`, `afterUpdate`). Implements `deleteAddressFnc`, `onChangeAddress`, `goToOrderPage`, `showAllAddress`, and `selectAddress` functions. Contains conditional rendering for a "Partner Offer Banner" based on screen width and offer eligibility.
        *   **CSS Styling for `see-all-button-container` (13:08:17):** Added `box-sizing: border-box;` to the `.see-all-button-container` style block, suggesting a minor layout fix.

8.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts`**
    *   **Timestamps:** 01/12/2025, 14:14:59; 01/12/2025, 14:18:52
    *   **Key Changes:**
        *   **Initial Setup (14:14:59):** Extensive imports from various stores for managing application state. Declaration of numerous `let` variables to hold subscribed store values. Defines a `setAddress` function to normalize and set the selected address, including `partial_address` and `hasNoEmail` flags. Includes `detectAutofill`, `autofillEvents`, `closeBottomSheet`, `closeIframe`, `closeFullScreenPopUp`, `setCreateOrderStores`, and `getBadgeTitle` functions.
        *   **`partial_address` logic in `setAddress` (14:18:52):** The `newAddressBody.partial_address` assignment was changed from `newAddressBody.partial_address = true;` to `newAddressBody.partial_address = address.partial_address ? address.partial_address : address.firstname !== '' && address.lastname !== '' ? true : false;`. This makes the `partial_address` flag more conditional based on the incoming address object's properties.

9.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`**
    *   **Timestamps:** 01/12/2025, 17:33:01; 01/12/2025, 17:34:37
    *   **Key Changes:**
        *   **Initial Component Setup (17:33:01):** This Svelte component handles address input and related logic, including pincode verification, geolocation, and integration with shipping methods and GST. It subscribes to a wide range of Svelte stores to manage its state. It defines `handlePincodeInput`, `handleContinueClick`, `scrollIntoView`, `triggerGeolocationAPI`, `geoLocationMessageListener`, and `hideMMIFlow` functions.
        *   **`store_triggerContinueFunction` subscription change (17:34:37):** A `setTimeout` block within the `onMount` hook, which was commented out (`$store_pincodeRef && $store_pincodeRef.focus();`), was removed. This was likely for focusing the pincode input field.

10. **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`**
    *   **Timestamps:** 02/12/2025, 01:22:32; 02/12/2025, 01:29:36; 02/12/2025, 01:29:57; 02/12/2025, 01:39:54
    *   **Key Changes:**
        *   **Initial Component Setup (01:22:32):** This Svelte component manages address input fields, including validation, autofill, and integration with KwikPass login. It defines `oldaddressFields`, `oldaddressInputs`, `suggestedAddressFields`, and `suggestedAddressInputs` for different address input configurations. It handles various subscriptions to Svelte stores for managing address data, edit flags, and UI states.
        *   **Recipient Phone Placement (01:29:36):** The `splice` operations to insert the `recipient_phone` input field into `oldaddressInputs` and `suggestedAddressInputs` were updated to use `oldaddressInputs.length - 1` and `suggestedAddressInputs.length - 1` respectively, ensuring it's inserted before the last element (email field). This was to adjust the order of the fields.
        *   **Conditional `addressFields` Assignment (01:39:54):** The logic in `beforeUpdate` that assigns `addressFields` and `addressInputs` was made more explicit. It now uses `requiredGstFields` (filtered to remove 'email' and 'additional') for `isBillingAddress` true cases, and either `suggestedAddressInputs` or `oldaddressInputs` otherwise.

### Patterns and Recurring Elements:

*   **Svelte Stores:** A predominant pattern is the extensive use of Svelte stores (e.g., `store_discountCode`, `store_merchantUserType`, `store_page`, `store_phoneNo`, `store_selectedAddress`, `store_moid`, `store_totalPrice`, `store_cartjsObject`, `store_foreignAnalytics`, `store_merchantInfo`, `store_requestId`, `store_localStorageObject`, `store_skipToPayment`, `store_addressCount`, `store_loader`) for managing and reacting to application-wide state. This indicates a highly reactive and component-driven architecture.
*   **Analytics and Logging:** Many changes involve `logEvent`, `fireAnalytics`, `fireAnalyticsGa4`, `fireGtmEvent`, and other related functions. This suggests a strong emphasis on tracking user interactions, page loads, API calls, and checkout flow events for analytics and performance monitoring. Events like `addresslistloaded`, `leading_indicators_exp_flag_true`, `merchant_last_order_exp_flag_true`, `geolocation_available`, `mmi_address_autofilled`, `autofill_details_used` are frequently logged.
*   **Address Management:** A significant portion of changes revolves around address handling:
    *   **Validation:** `addressValidate` function is frequently modified and called to ensure address data (pincode, length, email, name) is correct, with specific error messages.
    *   **Prefilling/Autofill:** Logic for prefilling addresses (e.g., from Truecaller or Shopify webhook), partial addresses, and geolocation-based autofill is common across `Login.service.ts`, `Address.service.ts`, and `Address.svelte`.
    *   **Experimentation:** Flags like `leading_indicators_flag` and `last_used_address_flag` in `store_addressExperiments` suggest A/B testing or feature flagging related to address handling.
*   **Debugging and Refinement:** Repeated additions and removals of `console.log` statements, along with minor adjustments to logic (e.g., optional chaining, conditional assignments, splicing arrays), indicate active debugging and iterative refinement of the codebase.
*   **Environment-Specific Configuration:** The `EnvironmentService.ts` clearly shows a robust system for managing API endpoints and tokens based on different deployment environments (dev, qa, sandbox, production, local), demonstrating a well-structured approach to environment management.
*   **Checkout Flow Integration:** Changes across files like `ForeignAnalytics.ts`, `ApiService.ts`, `Login.service.ts`, and `Address.service.ts` reveal a complex integration of various services and components to manage the checkout process, including price breakdowns, shipping options, payment methods, and user authentication.
*   **Error Handling:** Consistent use of `snackbar_state.set` to display user-friendly error messages and `stabilityEvent` for internal error logging points to a focus on robust error handling.

Overall, the changes indicate an ongoing development process focused on enhancing the user checkout experience, improving analytics tracking, refining address management, and maintaining a robust, environment-aware architecture. The frequent minor adjustments and debugging suggest an agile development cycle.

## 14:23:10
The provided log shows a series of frequent changes occurring on November 27th and 28th, and December 1st, 2025, primarily affecting files related to a KwikPass checkout implementation within an Appmaker Expo application.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/.env`**:
    *   **Timestamp (Significant Changes):** 27/11/2025, 17:45:53; 27/11/2025, 23:41:49; 28/11/2025, 00:21:22; 01/12/2025, 18:01:49.
    *   **Content Updates:** This file shows repeated uncommenting and re-commenting of different `EXPO_PUBLIC_APPMAKER_PROJECT_ID` values, along with a consistent `EXPO_PUBLIC_DISABLE_SHOPIFY_API_DEPRECATION_WARNING=true`. This indicates a developer is frequently switching between different project IDs (e.g., `the derma co.`, `sandbox-plus`) for testing or deployment purposes. The value `194419` (`the derma co.`) is toggled between active and commented out states multiple times.

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/components/KwikPassCheckout.js`**:
    *   **Timestamp (Frequent Changes):** This file was heavily modified throughout November 27th (starting 18:51:28) and November 28th, 2025 (up to 12:41:56, and again on December 1st from 16:14:46 to 18:04:25).
    *   **Content Updates:**
        *   **Initial Focus (27/11, ~18:51-18:52):** The `onEvent` callback for the WebView, specifically the `orderSuccess` case, was the primary focus. This involved extracting `orderId` and `orderKey` from `checkoutUrl` and `orderGID` using regex. There's logic to call `props?.onAction({ action: 'SET_ORDER_COMPLETE' })` and `KWIKPASS_LOGIN` if the user is not logged in.
        *   **Debugging and Refinements (27/11, ~22:53 - 28/11, ~00:00):** Multiple changes involve adding and modifying console logs (e.g., `=== Matches for order key ===`, `checkoutURL Is Coming`, `orderId Is Coming`, `This is coming from here`, `ORDER ID =========`, `ORDER KEY =========`). There's also the introduction of `orderKeyRegexExtra` to handle alternative URL patterns for the order key.
        *   **Refactor in `orderSuccess` (27/11, 23:30:22):** A more structured handling for `orderSuccess` was introduced, with clear comments for 1) Extracting Shopify Order ID, 2) Redirecting to GoKwik's `checkoutUrl` in a WebView, and 3) Auto-logging in the user using the GoKwik token. This version explicitly removes the manual `orderKey` extraction and emphasizes using the provided `checkoutUrl` for redirection. It also changed the `SET_ORDER_COMPLETE` action to only include `orderID` and an empty `orderKey`.
        *   **Checkout URL Protocol Handling (28/11, ~00:25-07:55):** Logic was added within the `orderSuccess` handler to prepend `https://` to `checkoutUrl` if it's missing the protocol. This was refined over several commits to ensure `checkoutUrl` is properly formatted.
        *   **Reverting/Adjusting `orderSuccess` Logic (28/11, ~11:09 - 12:41):** There are several changes that appear to revert or re-implement parts of the `orderSuccess` logic, specifically regarding how `orderKey` is extracted and used. Some commits re-introduce the `orderKeyRegex` and `orderKeyRegexExtra` and the `matches` variable for extracting `orderKey`, while others comment out the `orderKey` extraction or pass an empty string. A significant change around 12:25:54 and subsequent commits changes the `SET_ORDER_COMPLETE` action to only pass `orderID` and an empty `orderKey`, and introduces an `OPEN_IN_WEBVIEW` action to redirect to a Shopify `thank_you` page constructed with the `order_id`. This change implies a shift in how post-checkout redirection and order completion tracking are handled. The logic for constructing the thank-you URL was also refined.
        *   **Console Log Adjustments (01/12, ~16:14-18:04):** Minor changes were made to add `console.log(message?.eventname,"Event Name and Data")` and temporary debugging `count` variables for `gokwik_events`.

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**:
    *   **Timestamp (Single Change):** 27/11/2025, 18:54:00.
    *   **Content Updates:** This file, `KPCheckout` component, received an update to its `console.log` statement, now explicitly logging `checkoutData` when rendering. The `handleCheckoutMessage` callback simply forwards messages to `onEvent`. No functional changes were observed in the core props passed to `Checkout`.

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**:
    *   **Timestamp (Frequent Changes, but content is identical across changes):** This file was modified several times on 27/11/2025 between 18:57:26 and 20:35:26.
    *   **Content Updates:** All logs for this file are identical. It defines the core `Checkout` component, including injected JavaScript for `gokwikSdk` event listeners (`modal_closed`, `orderSuccess`, `openInBrowserTab`, `gokwikLoaded`, `gokwik_events`, `gk-checkout-disable`), and logic for handling UPI app intents. The component fetches merchant and user data from `CacheInstance` to construct the WebView URL for both "custom" and "shopify" merchant types. There's also extensive logic for handling hardware back presses and app state changes, and a `showAlert` utility for platform-specific error messages, particularly for UPI app issues. No visible functional changes across these logged entries.

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/src/kwikpassV2/src/components/KwikPassCheckout.js`**:
    *   **Timestamp (Mirrored changes):** This file shows changes on 27/11/2025 (starting 23:20:30) and 28/11/2025 (up to 07:55:36).
    *   **Content Updates:** The changes in this file are identical to those in `/packages/kwikpassV2/src/components/KwikPassCheckout.js` for the corresponding timestamps. This suggests either a refactoring where the component was moved, or a duplicate file was being modified in parallel. Given the timestamps, it's likely a component was moved/copied from `packages` to `src` or vice-versa, or there are parallel development branches. The log for `src/kwikpassV2` largely duplicates the changes seen in `packages/kwikpassV2`.

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/pages/CheckoutOptions.js`**:
    *   **Timestamp (Two identical entries):** 28/11/2025, 14:48:50 and 28/11/2025, 14:52:20.
    *   **Content Updates:** This file defines a `CheckoutOptions` object with a single `kwikpass/checkout` block. No functional changes observed between the two entries.

### Patterns and Recurring Elements:

1.  **KwikPass Integration Focus:** The vast majority of changes revolve around the integration and refinement of a "KwikPass" checkout system within an Expo application.
2.  **WebView Communication:** There's a strong emphasis on communication between the native React Native environment and a WebView, particularly through `window.ReactNativeWebView.postMessage` to handle events like `modal_closed`, `orderSuccess`, `openInBrowserTab`, `gokwikLoaded`, `gokwik_events`, and `gk-checkout-disable` originating from the `gokwikSdk` within the WebView.
3.  **Shopify Order Processing:** The `orderSuccess` event handling is a critical and frequently modified section. It involves extracting Shopify order IDs (`graphqlOrderId`), and at various points, also attempted to extract an `orderKey` from the `checkoutUrl`. The logic evolved from directly extracting `orderKey` to favoring redirection to the provided `checkoutUrl` and constructing a `thank_you` page URL using only the extracted `orderID`.
4.  **User Login Flow:** Post-order success, there's a recurring pattern to check if the user is logged in and, if not, to initiate a `KWIKPASS_LOGIN` action using the email and `gk_access_token` provided by the `orderSuccess` event.
5.  **URL Handling:** Consistent logic is present for opening URLs in a WebView (`OPEN_IN_WEBVIEW`) or letting the `webViewCanHandleCurrentUrl` function manage custom URL schemes, including the addition of `https://` prefixing to checkout URLs if missing.
6.  **Debugging via Console Logs:** Frequent additions and modifications of `console.log` statements indicate active debugging efforts, especially within the `orderSuccess` flow to track extracted IDs, keys, and event data.
7.  **File Duplication/Movement:** The `/packages/kwikpassV2/src/components/KwikPassCheckout.js` and `/src/kwikpassV2/src/components/KwikPassCheckout.js` files show identical content changes across overlapping timestamps, suggesting either a component move, a duplicated working copy, or a source control anomaly.
8.  **UPI Payment Handling:** The `Checkout.tsx` file includes specific logic for identifying and handling UPI payment intent URLs (`phonepe`, `googlepay`, `paytm`, `bhim`), including platform-specific error messages for uninstalled UPI apps.
9.  **Environment Variable Toggling:** The `.env` file shows consistent manipulation of `EXPO_PUBLIC_APPMAKER_PROJECT_ID`, indicating frequent switching between development/production environments or client projects.

## 14:58:00
The code changes primarily focus on enhancing the checkout dashboard's UI customization capabilities, particularly for discount and upsell features, along with significant updates to API endpoints and general utility functions. A notable aspect is the introduction and refinement of an upsell mechanism and a strong emphasis on production monitoring.

**File-specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 01/12/2025, 16:48:13)**
    *   The `ProductSearch` component, used for finding Shopify products or collections, received updates to its functionality and props.
    *   New props like `btnSearch` were added to control button visibility.
    *   Enhanced logic for `collateProducts`, `isAgentLed` (filtering products based on agent-specific tags), `topUpGift` (handling offered prices for gifts), and `collectionSpecificData` (for managing collection quantities and enforcing minimum purchase quantity rules).
    *   Product display now explicitly shows the number of variants selected or the quantity for individual items.
    *   Improved modal and search functionality, including debouncing for text input and infinite scroll with `useIntersectionObserver`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (Timestamp: 01/12/2025, 16:49:34)**
    *   A large number of new API endpoints were added across various categories.
    *   New endpoints for agent-led orders (e.g., `getAbcCart`, `createAbcOrder`, `capturePayment`, `sendOtp`, `verifyOtp`).
    *   Expanded endpoints for product and collection management (e.g., `productSearch`, `allProducts`, `allCollections`, `getProductDetails`, `getVariantDetails`, `getVariantById`, `getCollectionById`, `getProductById`).
    *   New API paths for `refund`, `upsellCheckout` (for managing cart upsells), and `checkoutLinks`.
    *   Extensive additions for various analytics metrics including `checkoutAnalytics`, `websiteAnalytics`, `discountAnalytics`, and campaign data.
    *   Discount configuration endpoints were further detailed, including those for DIY discounts and bulk discount campaigns.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (Timestamp: 01/12/2025, 16:50:12)**
    *   The `fetchShopifyCollectionsOrProducts` function was refactored to support both title-based search and paginated fetching of all products/collections, including filtering active products and transforming variant data.
    *   Introduced new utility functions:
        *   `updateMerchantData`: For general merchant configuration updates.
        *   `getAndDeleteUpsellData` and `pushUpsellData`: Dedicated API calls for retrieving, deleting, and updating upsell rules.
        *   `getVariantNCollectionDetailsbyId`: A versatile function to fetch details for variants, collections, or products by their IDs, consolidating responses into a standardized format.
        *   `validateGstData`: For GST-related data validation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamp: 01/12/2025, 16:51:23)**
    *   Several new helper functions were added, indicating an expansion of common utilities:
        *   Date and time utilities: `disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`, `disabledDate`, `disabledTime`.
        *   Formatting functions: `capitalizeFirstLetter`, `formatNumber`.
        *   Data manipulation and comparison: `deepCompare` (with specific handling for 'pincodes' arrays), `sortDataByKey`, `compareAndCaptureArrayFields`, `areBothRangesMoreThanOneDay`.
        *   UI-related helpers: `extractTitlesAndDataIndexes` (for Ant Design columns), `extractUniqueCKeysForAntColumn`.
        *   File upload handling: `uploadCohortCsv` for validating and processing CSV files containing phone numbers or emails.
    *   The `formatAmount` function was updated to support different `notation` types and a `.replace('T', 'K')` transformation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (Timestamp: 01/12/2025, 16:52:44)**
    *   The Redux state for UI customization was significantly expanded to include a new `upsell_data` object within `initialState`.
    *   `upsell_data` contains detailed fields for configuring upsells, such as `is_upsell_enabled`, `item_count_limit`, `rule_applicable_on`, `upsell_product_list`, `discounted_price`, `discount` value/capping, and `applicable_items` (with `product_ids`, `variant_ids`, `collection_ids`).
    *   A new reducer, `updateUpsellState`, was added to manage changes to this `upsell_data`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (Timestamp: 01/12/2025, 16:56:07)**
    *   This component, serving as a mobile UI preview for customization settings, was updated to reflect the new upsell and coupon features.
    *   State variables like `trustBannerData`, `recommendedOffers`, `couponScreen`, and `discountArray` were introduced to manage dynamic content related to offers.
    *   Conditional rendering was implemented to display a coupon input and available offers list (with skeleton loaders) when the "coupons" tab is active.
    *   It now integrates and displays `customizeUiData?.upsell_data?.upsell_product_list` if an upsell call is active.
    *   The dynamic status bar ("Mobile - Address - Pay") now updates based on the active tab.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs` (Timestamp: 03/12/2025, 14:50:48)**
    *   The `Content-Security-Policy` was updated to allow WebSocket connections to localhost and `*.gokwik.io`.
    *   SystemJS import maps were updated across different deployment environments (`local`, `dev`, `qa`, `sandbox`, `production`), including the addition of `@gokwik/kwikcomm` for `dev` and `qa`.
    *   Crucially, comprehensive New Relic browser monitoring scripts were integrated into the `production` environment block, along with a conditional Microsoft Clarity analytics script, indicating a strong focus on production performance and user behavior analytics.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellFormRenderer.tsx` (Timestamp: 03/12/2025, 14:54:29)**
    *   This new component provides a dedicated form for configuring upsell rules within the UI.
    *   It utilizes existing `ProductSearch` and `RichTextEditor` components for selecting items and editing promotional text.
    *   It dynamically renders discount value and capping input fields based on a `discounted_price` checkbox.
    *   An `useEffect` hook debounces form changes and dispatches updates to the Redux store (`updateUpsellState`).
    *   Another `useEffect` hook handles the initial loading of upsell rule data, fetching product/collection details using `getVariantNCollectionDetailsbyId` to pre-populate the form when editing existing rules.

**Patterns and Recurring Elements:**

*   **UI Customization & Upsell Feature Development:** A significant recurring theme is the expansion of UI customization capabilities, particularly with the introduction and detailed implementation of an upsell feature, affecting Redux state, API endpoints, and several UI components.
*   **API-driven Architecture:** There is a consistent pattern of defining numerous API endpoints in `apiEndpoints.ts` and abstracting API calls through `api.ts` using `makeAPICall`. This indicates a microservices-oriented backend or a clear separation of API concerns.
*   **Component Modularity and Reusability:** Components like `ProductSearch` and `RichTextEditor` are reused across different features (discounts, upsells), demonstrating a modular design approach.
*   **Redux for State Management:** The Redux store (`customize-ui` slice) plays a central role in managing UI-related configurations and data, particularly for the new upsell features.
*   **Production Monitoring:** The addition of New Relic and Microsoft Clarity scripts in the core `index.ejs` file highlights a strategic initiative to collect detailed performance and user interaction data in the production environment.
*   **Timestamp Clustering:** The majority of the changes occurred on `01/12/2025`, suggesting a concentrated development sprint focused on feature implementation. The updates on `03/12/2025` primarily refine the upsell functionality and implement production monitoring.

## 15:04:54
This log details extensive changes across several core services and UI components, primarily focusing on **address validation, analytics, and environmental configuration** within a "gokwik.pdp" project. The changes span from November 30, 2025, to December 1, 2025.

### File-Specific Updates:

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`
*(Multiple timestamps on 30/11/2025 and 01/12/2025)*
This file, responsible for foreign analytics tracking, underwent numerous minor updates:
- **Initialization and Variable Management:** Consistent additions and adjustments to variable declarations (`cart_total_price`, `cart_after_discount`) and their initial assignments.
- **Store Subscriptions:** Modifications within `store_priceBreakUp` and `store_totalPrice` subscriptions to ensure `cart_total_price` and `cart_after_discount` are correctly calculated, potentially handling cases where `totalValue` might be undefined.
- **Logging:** Introduction and removal of `console.log` statements for debugging purposes (e.g., "Triggered", "Total Price Amount", "Price Breakup ===>").
- **Address Handling:** Changes related to `addressFound` and `editPartialAddress` state management, potentially to refine how pre-filled addresses affect analytics events.
- **UTM Parameter Mapping:** Enhanced logic within `adSourceMapping` to correctly parse and store UTM parameters (`utm_source`, `utm_medium`, `utm_campaign`, `utm_term`, `utm_content`) from the `source` URL.
- **FB External ID Handling:** Expanded logic in `store_fbExternalId` subscription to capture `kp_fb_cli_id` and `kp_user_token` in addition to `fbExternalId`.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`
*(Timestamp: 30/11/2025, 12:22:55)*
This HTML file, likely a test or demonstration merchant page, saw minor updates:
- **Console Logging:** An addition of `console.log('abc', document);` within the `document.onreadystatechange` function.
- **Commented-out Code:** Several `mid` values in the `window.merchantInfo` object are commented out, suggesting testing with various merchant IDs.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`
*(Multiple timestamps on 30/11/2025)*
This file handles API endpoint configuration based on the environment:
- **Local Environment URL:** The `api_url` function's `local` environment URL was updated, specifically changing from `https://api.gokwik.co` to `https://sandbox.gokwik.co` (after being commented out multiple times). This indicates active testing and configuration of local development environments.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`
*(Timestamp: 01/12/2025, 12:09:23)*
This file, responsible for API calls, received updates related to price breakup and error handling:
- **Price Breakup Data:** Enhanced parsing and storage of `priceBreakup` data from API responses. It now explicitly handles `totalDiscount`, `giftCardDiscountTotal`, `couponDiscount`, `automaticDiscount`, `cashback`, `paymentOffer`, `prepaidDiscount`, and `loyaltyPoints`.
- **Gyftr Integration:** Specific logic added to extract and store Gyftr-related applied amounts from `rewards.items`.
- **Shipping Method Error Handling:** Modified handling for shipping options API calls where a 400 status code will now explicitly set `store_selectedShippingMethod` to `null`.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`
*(Multiple timestamps on 01/12/2025)*
This service handles user login, verification, and address management:
- **Address Processing Logic:** Significant changes to how addresses are processed after user verification.
    - An explicit `console.log` for "Address Initial Value in verify user" was added for debugging.
    - The condition for setting `store_partialAddress` and `store_shopifyAddressFound` when `response.data.address?.partial_address` is true was expanded to also consider cases where default addresses have empty first or last names.
    - A `console.log("Idar AA gaya Response")` was added at 18:44:46, likely for debugging the asynchronous flow.
- **Truecaller Integration:** Enhanced logic within the `isTruecaller` block, specifically for new users, to ensure `store_partialAddress` is correctly set and `addAddressBottomSheet()` is triggered.
- **Redundant `fireAnalytics(5, '')`:** The `fireAnalytics(5, '')` call was commented out or moved in several branches of the `verifyUser` function, suggesting a re-evaluation of its placement or necessity.
- **Explicit `processAddresses` Call:** The `getAllAddress().then(async (res: any) => { await processAddresses(res); });` block is consistently present, emphasizing address processing after login.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`
*(Multiple timestamps on 01/12/2025)*
This service manages address-related logic, including validation and processing:
- **Initial Logging:** Several `console.log(res, "Api Call for address")` and `console.log(fetchedAddress, "Fetched Address before deletion")`, `console.log(defaultAddress,"Default Address after deletion")` statements were added and removed, indicating active debugging of address data flow.
- **Partial Address Handling:**
    - A specific condition was added to `addressValidate` to set `selectedAddress.partial_address = true;` and display a `snackbar_state` error message if `firstname` and `lastname` are empty (`selectedAddress?.firstname === '' && selectedAddress?.lastname === ''`). This was later refined to be conditional on `!selectedAddressNameTrimmed?.trim()`.
    - In `processAddresses`, the mapping of addresses was modified at 14:00:14 to explicitly set `partial_address: address?.partial_address && !!address?.firstname?.trim() && !!address?.lastname?.trim()` if `lastname` is '.', and then changed to just `partial_address: true` at 14:03:05, and then back to ignoring `partial_address` setting from `lastname == '.'` at 14:07:50, indicating an iterative approach to managing partial addresses.
- **Skip to Payment Logic:** The `addressValidate` function now uses `addressValidate(defaultAddress, false)?.status` to check the validity of the default address, and if it's invalid, it updates `store_skipToPayment` to enable skip flow and set `address_check` to true.
- **Loader Management:** The `store_loader` is set to `false` and `background: true` when address processing is complete, suggesting visual feedback on address loading.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Helper.service.ts`
*(Multiple timestamps on 01/12/2025)*
This helper service saw changes in address setting logic:
- **`setAddress` function:** The logic for `newAddressBody.partial_address` was updated. Initially, it was simply `true`; later, it became `address.partial_address ? address.partial_address : address.firstname !== '' && address.lastname !== '' ? true : false;`, suggesting a more nuanced determination of whether an address is considered partial. This was further refined at 18:48:12 to use `store_partialAddress.set(addAddressInitialValue); selectedAddress.partial_address = true; setPartialAddress(selectedAddress);` when `selectedAddress?.firstname === '' && selectedAddress?.lastname === ''`.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`
*(Multiple timestamps on 01/12/2025)*
This Svelte component for displaying address listings received minor updates:
- **Styling:** A `box-sizing: border-box;` was added to the `.see-all-button-container` style.
- **Debugging:** A `console.log("Triggered continue function from address listing")` was added inside the `handleContinueClick` function.
- **Conditional Class:** The `partner-offer-banner` class is dynamically applied based on `usePartnerOfferCss`.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`
*(Multiple timestamps on 01/12/2025)*
This Svelte component for adding/editing addresses saw changes:
- **Geolocation Integration:** Logic for triggering and handling `geolocation_api_response` from a `window.addEventListener` was added, allowing users to autofill their address using their current location. Event logging for geolocation actions (`geolocation_available`, `geolocation_button_clicked`, `mmi_address_autofilled`, `mmi_api_error`, `geolocation_hide`) was implemented.
- **Address MMIFlow:** The `addressMMIFlow` variable is used to pre-fill address fields if geolocation is successful.
- **Pincode Input Handling:** Updates to `handlePincodeInput` to validate pincode length and trigger `submitPincode`.
- **CSS Class `partner-offer-banner`:** Similar to `AddressListing.svelte`, this class is conditionally applied based on `usePartnerOfferCss`.
- **Debugging:** `console.log` statements were added (then removed) for debugging the default address after deletion.

#### `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`
*(Multiple timestamps on 02/12/2025)*
This component for address input fields had several updates:
- **Recipient Phone Number:** Added conditional inclusion of a "Recipient Phone Number" input field if `$store_enableRecipientPhone` is true.
- **Address Suggestion Flow:** Logging for `ds_address_shown` if `$store_addressSuggestionFlow` is enabled.
- **KwikPass Email Handling:** Logic was added to handle KwikPass login, setting `emailDisabled` and `addressFields['email']` based on `$store_kpEmail` and an email domain check.
- **Partial Address Handling:**
    - The `addressValidate` function was modified to handle cases where `selectedAddressNameTrimmed` is empty or only whitespace, triggering a `partial_address` flag and displaying an error snackbar message. This logic was specifically tied to `#CHECKOUT-21591`.
    - `setPartialAddress(selectedAddress)` and `store_partialAddress.set(addAddressInitialValue)` were also called within this condition.
- **GST Billing:** The `addressFields` are populated from `$store_GSTBilling?.billing_address_object` if `isBillingAddress` is true.
- **Debugging:** A `console.log("Selected Address in validation: ", selectedAddressNameTrimmed);` was added.
- **Address Input Structure:** Adjusted how `addressInputs` array is populated based on `$store_additionalAddress` or `$store_addressSuggestionFlow`.

### Patterns and Recurring Elements:

1.  **Store Management (Svelte Stores):** A prominent pattern is the heavy reliance on Svelte stores (`store_discountCode`, `store_selectedAddress`, `store_cartjsObject`, `store_page`, `store_loader`, `store_skipToPayment`, etc.) for managing application state across different components and services.
2.  **Analytics and Event Logging:** Extensive logging and analytics (`logEvent`, `fireAnalytics`, `fireAnalyticsGa4`, `fireGtmEvent`) are integrated throughout the codebase, particularly for user actions, page loads, and error conditions. This suggests a strong focus on tracking user behavior and system performance.
3.  **Conditional Logic for Features:** Many features (e.g., recipient phone number, address suggestion flow, KwikPass email editing, skip-to-payment flow, address masking, leading indicators, last used address) are controlled by feature flags or configuration objects, indicating a modular and configurable system.
4.  **Error Handling and User Feedback:** Consistent use of `snackbar_state.set` for displaying user-friendly error messages and `updateErrorFields` for tracking specific validation failures. Stability events (`stabilityEvent`) are logged for critical failures.
5.  **Address Object Manipulation:** Frequent mapping and modification of `AddressResponseInterface` objects (e.g., setting `lastname` to an empty string if it's '.', and handling `partial_address` status) suggest ongoing refinement of address data consistency and validation.
6.  **Environment-Specific Configuration:** The `EnvironmentService.ts` file clearly defines different API endpoints for various environments (`dev`, `qa`, `sandbox`, `production`, `local`), highlighting a robust deployment strategy.
7.  **Debugging (`console.log`):** Numerous `console.log` statements are temporarily added and sometimes removed, indicating an active development and debugging process, especially around complex data flows like address validation and processing.
8.  **Asynchronous Operations:** Heavy use of `async/await` and Promises for API calls (`getAllAddress().then(async (res: any) => { await processAddresses(res); });`), typical in modern web applications.

## 15:23:41
The changes across the logs primarily revolve around the integration and event handling of a KwikPass/GoKwik checkout system within an AppMaker Expo application. The majority of modifications focus on the `KwikPassCheckout.js` component, which acts as a bridge between the native app and the WebView-based checkout.

**File-specific Updates:**

*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/components/KwikPassCheckout.js`**:
    *   **Timestamp 27/11/2025, 18:51:28 (Initial state)**: This file defines the `KwikPassCheckout` React Native component, responsible for rendering the `KPCheckout` (KwikPass) WebView. It sets up an `onEvent` handler to listen for various `gokwikSdk` events like `modal_closed`, `orderSuccess`, `openInBrowserTab`, and `gk-checkout-disable`.
        *   The `orderSuccess` event handler attempts to extract `orderID` from a GraphQL GID and `orderKey` from the `checkoutUrl` using regex. It then dispatches `SET_ORDER_COMPLETE` and potentially `KWIKPASS_LOGIN` if the user isn't logged in.
        *   `openInBrowserTab` handles opening URLs either in a WebView or via custom URL schemes.
    *   **Timestamp 27/11/2025, 22:53:59 - 23:06:37**: A series of minor changes and extensive `console.log` additions were introduced primarily for debugging the `orderSuccess` flow. A temporary regression was introduced where `orderKey` extraction using `matches` (derived from `orderKeyRegex`) became undefined, leading to potential issues, and the `orderGID` check was temporarily removed from the `if` condition.
    *   **Timestamp 27/11/2025, 23:16:36**: This timestamp marks a significant fix, reintroducing the `orderKeyRegexExtra` and restoring the robust `orderKey` extraction logic, as well as the `if (checkoutUrl && orderGID)` condition for `orderSuccess`.
    *   **Timestamp 27/11/2025, 23:30:22**: A major refactoring of the `orderSuccess` logic occurred. The `orderKey` extraction was removed, and the primary action became `OPEN_IN_WEBVIEW` to redirect to the `checkoutUrl` directly. `SET_ORDER_COMPLETE` was updated to only pass `orderID` (with `orderKey` as null).
    *   **Timestamp 27/11/2025, 23:50:11**: The refactoring from 23:30:22 was largely reverted, bringing back the `orderKey` extraction and the `SET_ORDER_COMPLETE` action with both `orderID` and `orderKey`.
    *   **Timestamp 28/11/2025, 00:25:40 - 07:55:36**: Several iterative changes were made to the `checkoutUrl` handling within `orderSuccess`. The goal was to ensure `checkoutUrl` always starts with `https://`, adding prefixing logic, and refining the regex matching for `orderKey`. There were temporary bugs in the conditional prefixing logic that were subsequently fixed.
    *   **Timestamp 28/11/2025, 11:09:45 - 11:13:51**: Further refinements to `orderKey` assignment, explicitly ensuring a default empty string. A change in `SET_ORDER_COMPLETE` condition from `if (orderId && orderKey)` to `if (orderId || orderKey)` was introduced.
    *   **Timestamp 28/11/2025, 12:25:54 - 12:41:56**: Another period of significant, iterative changes to `orderSuccess`:
        *   Initial changes commented out `checkoutUrl` and `orderKey` extraction, attempting to navigate to a hardcoded Shopify `thank_you` page. This introduced bugs due to commented-out variables.
        *   Subsequent changes fixed the variable issues, re-enabled the `OPEN_IN_WEBVIEW` to the original `checkoutUrl` (with prefixing logic), and eventually restored `SET_ORDER_COMPLETE` action with `orderID` and an empty `orderKey`.
        *   Conditional logic for `OPEN_IN_WEBVIEW` based on `orderKey` presence was added.
    *   **Timestamp 28/11/2025, 17:10:35 - 17:11:12**: Reintroduced `console.log` statements for event names and restored the `orderKey` extraction logic similar to prior states.
    *   **Timestamp 01/12/2025, 17:55:47 - 17:58:52**: Attempted to add debugging for a `gokwik_events` event with a `count` variable, initially introducing typos and undeclared variables which were quickly corrected.
    *   **Timestamp 01/12/2025, 18:02:38 - 18:04:25**: The `gokwik_events` debugging logic was commented out, effectively reverting the changes from 17:55:47.
*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/packages/kwikpassV2/src/pages/CheckoutOptions.js`**:
    *   **Timestamp 28/11/2025, 14:48:50**: This file defines a configuration object for a `CheckoutOptions` page, specifying a `kwikpass/checkout` block and basic styling attributes.
    *   **Timestamp 28/11/2025, 14:52:20**: No functional changes.
*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**:
    *   **Timestamp 27/11/2025, 18:54:00**: This file defines the `KPCheckout` React component, which serves as a wrapper for the `Checkout` component. It passes checkout-related data and event handlers to the underlying WebView implementation.
*   **`/Users/mayuresh.madav/Documents/sdk/appmaker-starter-app-expo-53-update/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**:
    *   **Timestamp 27/11/2025, 18:57:26 (Initial state)**: This file contains the core WebView component (`Checkout`). It injects JavaScript to listen for `gokwikSdk` events within the WebView and post them back to React Native. It handles the initiation of checkout URLs (for both Shopify and custom merchants), manages back button behavior, app state changes, and includes specific logic for handling UPI payment intents on Android.
    *   **Timestamp 27/11/2025, 18:59:47 - 20:35:26**: No functional changes, suggesting stability in the core WebView wrapper logic during this period.

**Timestamps of Significant Changes:**

*   **27/11/2025, 18:51:28**: Initial implementation of `KwikPassCheckout.js` with core event handling.
*   **27/11/2025, 23:16:36**: Key fix for `orderKey` extraction and `orderGID` check in `KwikPassCheckout.js`.
*   **27/11/2025, 23:30:22**: Major refactoring attempt in `KwikPassCheckout.js` for `orderSuccess` (later largely reverted).
*   **27/11/2025, 23:50:11**: Reversion of the `orderSuccess` refactoring in `KwikPassCheckout.js`.
*   **28/11/2025, 07:48:18**: Corrected `checkoutUrl` prefixing logic in `KwikPassCheckout.js`.
*   **28/11/2025, 12:25:54**: Significant, but initially buggy, overhaul of `orderSuccess` handling in `KwikPassCheckout.js` to redirect to a Shopify thank-you page.
*   **28/11/2025, 12:41:56**: Finalized a specific approach to `orderSuccess` in `KwikPassCheckout.js`, involving conditional `OPEN_IN_WEBVIEW` and `SET_ORDER_COMPLETE`.
*   **28/11/2025, 17:10:35**: Restored older `orderKey` extraction logic and `orderId`/`orderKey` usage for `SET_ORDER_COMPLETE`.

**Patterns and Recurring Elements:**

*   **GoKwik SDK Integration**: The central theme is deep integration with the GoKwik SDK via a WebView, specifically handling checkout flows and associated events (`modal_closed`, `orderSuccess`, `openInBrowserTab`, `gk-checkout-disable`).
*   **Shopify Order Processing**: A consistent focus is on extracting Shopify-specific order identifiers (GraphQL GIDs for `orderId`, and `orderKey` from URLs) to enable native app actions like `SET_ORDER_COMPLETE` and user login (`KWIKPASS_LOGIN`).
*   **URL Handling and Normalization**: Repeated efforts are seen in ensuring `checkoutUrl` and other URLs are correctly formatted (e.g., prepending `https://`) and parsed to extract necessary information.
*   **Debugging via `console.log`**: Numerous `console.log` statements are added, modified, and removed throughout the changes in `KwikPassCheckout.js`, indicating an active debugging process to understand and verify event data and logic flow.
*   **Iterative Development and Reversions**: The log shows a pattern of introducing functional changes, sometimes leading to bugs, followed by quick fixes or even complete reversions of previous major changes. This suggests an exploratory or rapid iteration development style.
*   **Cache Utilization**: The `Checkout.tsx` component extensively uses a `CacheInstance` to retrieve merchant-specific configurations and user data, indicating a state management pattern.

## 15:57:52
The changes across these files indicate a significant focus on enhancing product search, upsell customization, and general UI customization within a checkout dashboard application.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 01/12/2025, 16:48:13)**:
    *   This file defines a `ProductSearch` React component, which is a versatile search interface for both products and collections.
    *   It handles fetching data from Shopify (collections or products), displaying results, managing pagination via `useIntersectionObserver`, and allowing users to select items.
    *   Key functionalities include:
        *   `fetchData` for initial and paginated loading.
        *   `useEffect` hooks for debounced search input and modal state management.
        *   `parseResponse` to process API results, especially for collating product variants.
        *   `onAdd` and `onRemove` callbacks for managing selected items.
        *   Conditional rendering based on `searchType`, `hideButton`, `hideSearchInput`, `isAgentLed`, `topUpGift`, and `collectionSpecificData`.
        *   Introduces logic for handling collection-specific quantities and minimum purchase requirements, with error messages if constraints are violated.
        *   The UI allows for searching, displaying product/collection thumbnails, names, variant details, and quantity controls (for `topUpGift`).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts` (Timestamp: 01/12/2025, 16:49:34)**:
    *   This file, `apiEndpoints.ts`, expands its API definitions significantly.
    *   **New Endpoints Added**:
        *   `productSearch`, `getProductDetails`, `getVariantDetails`, `allProducts`, `allCollections` (indicating robust product/collection management).
        *   `getEditOrder`, `saveEditOrder` (for order editing capabilities).
        *   `getUtmList`, `legality`.
        *   `getVariantById`, `getCollectionById`, `getProductById` (for fetching specific details).
        *   A new nested `checkoutAnalytics` object containing numerous metrics endpoints (e.g., `checkoutFunnel`, `orderMetrics`, `socialMetrics`, `topProducts`, `discountUsageOverTimeMetrics`, `realtimeStats`).
        *   New `websiteAnalytics` endpoints (e.g., `websiteFunnel`, `websiteFunnelTrendMetrics`).
        *   New `discountAnalytics` endpoints (e.g., `discountStats`, `discountCouponStats`, `discountTrend`).
        *   Endpoints for cohort CSV download, marketing analytics (`campaign-data`), merchant configurations (`merchant-config`), and discount configurations (`discountConfig`, `diyDiscounts`).
        *   Shopify app related endpoints like `shopifyMerchantConfigs`, `shopifyShippingAndPaymentRule`, `shopifyAppPrepaidDiscountSaveConfig`, `shopifyReviewAndRating`, `fetchBillingStatus`, `getRemainingTrialDays`.
        *   `userEvent`, `getBulkMerchantHealth`, `updateMerchantHealth`, `getGlobalStatus`, `updateGlobalStatus`, `getMerchantHealth`.
        *   `bulkDiscounts` endpoints for campaign and price rule validation.
        *   `getCustomerPrepaidHistory`, `getKwikflowDetails`, `getColumnPreferences`, `updateColumnPreferences`, `orderAnalytics`, `merchantCreds`, `merchantRewards`, `getStatesList`.
        *   A new `upsellCheckout` object with `getandDeleteUpsellData` and `updateUpsellData` (directly relevant to the upsell functionality seen in other files).
        *   A new `checkoutLinks` object for managing checkout links.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts` (Timestamp: 01/12/2025, 16:50:12)**:
    *   This file, `api.ts`, is updated to include new API call functions.
    *   **`fetchShopifyCollectionsOrProducts`**: Now takes `searchType`, `title`, `page`, and `pageSize` parameters. It dynamically uses `APIEndPoints.productSearch` or `APIEndPoints.diyDiscounts.collection` for title-based searches, and `APIEndPoints.allProducts` or `APIEndPoints.allCollections` for paginated results. It also filters active products and maps product variants for consistent data structure.
    *   **`updateMerchantData`**: A new function for updating merchant-specific data.
    *   **`getAndDeleteUpsellData`** and **`pushUpsellData`**: New functions for managing upsell rule data, indicating a new upsell feature. `getAndDeleteUpsellData` handles both fetching and deleting based on `params`.
    *   **`getVariantNCollectionDetailsbyId`**: A crucial new function that fetches details for variants, collections, or products by ID, mapping them into a consistent format used for displaying selected items.
    *   **`validateGstData`**: A new utility function for GST data validation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamp: 01/12/2025, 16:51:23)**:
    *   This helper utility file adds several new functions:
        *   `getDynamicSearchFilters`: Creates filter options from a list of `SearchFilters`.
        *   `formatDateString`: Formats a raw date into a readable string.
        *   `setCurrencySymbol` and `formatAmount`: Functions for currency formatting.
        *   `shopifyAppCheckoutEnabledStatus`: Checks if Shopify app checkout is enabled based on last login date (within 2 days).
        *   `deepCompare`: Performs a deep comparison between two objects, with special handling for 'pincodes' arrays.
        *   `debounce`: A standard debounce utility.
        *   `disabledBeforeDate`, `disabledBeforeTime`: Utilities for date/time picker disabling.
        *   `capitalizeFirstLetter`, `formatNumber`.
        *   `extractTitlesAndDataIndexes`, `sortDataByKey`: For table data manipulation.
        *   `uploadCohortCsv`: Handles CSV file uploads for cohorts, validating if content is all phone numbers or all emails.
        *   `getFutureDateString`, `compareAndCaptureArrayFields`, `areBothRangesMoreThanOneDay`, `extractUniqueCKeysForAntColumn`, `disabledDate`, `disabledTime`. These functions suggest expanded features related to data filtering, date range management, and analytics.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/store/customize-ui/index.ts` (Timestamp: 01/12/2025, 16:52:44)**:
    *   The Redux slice for UI customization is significantly expanded.
    *   **New `upsell_data` state**: Introduced to manage upsell configurations. This includes `is_upsell_enabled`, `item_count_limit`, `rule_applicable_on`, `upsell_product_list`, `discounted_price`, `discount` details (`value`, `capping`), `applicable_items` (product IDs, variant IDs, collection IDs), `title`, and `upsell_items`.
    *   A new `updateUpsellState` reducer is added to manage this new upsell data.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/mobilePage.tsx` (Timestamp: 01/12/2025, 16:56:07)**:
    *   This file, `mobilePage.tsx`, implements a mobile preview UI for various customization settings, including a newly added "coupons" tab and upsell display logic.
    *   It retrieves `customizeUiData` from the Redux store, including the new `upsell_data`.
    *   The `useEffect` hook now manages `recommendedOffers`, `couponScreen`, and `discountArray` based on `couponsData`.
    *   The rendering logic includes a new "couponScreen" view and conditionally displays upsell products if `isUpsellCall` is true and `customizeUiData?.upsell_data?.upsell_product_list?.products?.data` exists.
    *   The navigation status (`Mobile - Address - Pay`) is dynamically updated based on the `activeTab`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/upsell/upsellFormRenderer.tsx` (Multiple timestamps between 03/12/2025, 14:54:29 and 03/12/2025, 15:44:12)**:
    *   This component, `UpsellFormRenderer`, is a new addition and the subject of frequent, minor updates. It's responsible for rendering the UI to configure upsell rules.
    *   It uses Ant Design `Form`, `Card`, `Checkbox`, `InputNumber`, `Radio`, and `Row` components.
    *   It integrates `RichTextEditor` for managing the upsell title text and `ProductSearch` (from `/src/library/components/discounts/productSearch.tsx`) to select applicable products/collections and upsell items.
    *   The component leverages `Form.useWatch` to react to changes in `applicableRule` and `discountedPrice`.
    *   **Core functionality**:
        *   **Applicability**: Allows defining upsell rules for 'all products', 'specific collections', or 'specific products' using radio buttons and the `ProductSearch` component.
        *   **Upsell Items**: Uses `ProductSearch` to select products to be offered as upsells.
        *   **Discount Configuration**: Provides checkboxes and input fields for `discounted_price`, `discount.value`, and `discount.capping`, which are conditionally visible.
        *   **Initialization**: An `hasInitialized` ref and `useEffect` are used to pre-populate the form with existing upsell rule data by fetching variant/collection details via `getVariantNCollectionDetailsbyId` from the API.
        *   **State Management**: Dispatches `updateUpsellState` to the Redux store (defined in `customize-ui/index.ts`) with a debounce, reflecting changes in the form.
    *   **Recurring changes**: Most changes in this file across multiple timestamps involve minor adjustments or debugging `console.log` statements in the `onRemove` function for `ProductSearch`, particularly related to how `applicable_items` are updated. For instance, the `onRemove` logic was iteratively refined to correctly filter out `product_ids`, `variant_ids`, and `collection_ids` based on the `applicableRule`. The general structure and purpose remain consistent, indicating a focused effort on perfecting the upsell rule editing experience.

### Timestamps of Significant Changes:

*   **01/12/2025, 16:48:13**: Major update to `productSearch.tsx`, extending its functionality for collection-specific data and agent-led scenarios.
*   **01/12/2025, 16:49:34**: Extensive expansion of `apiEndpoints.ts`, adding a wide array of new endpoints for analytics, order editing, upsells, and Shopify app integrations. This indicates a broad feature rollout.
*   **01/12/2025, 16:50:12**: Complementary updates to `api.ts` to implement the new API calls defined in `apiEndpoints.ts`, including `fetchShopifyCollectionsOrProducts`, `updateMerchantData`, `getAndDeleteUpsellData`, `pushUpsellData`, `getVariantNCollectionDetailsbyId`, and `validateGstData`.
*   **01/12/2025, 16:52:44**: Introduction of `upsell_data` state and `updateUpsellState` reducer in Redux store, preparing the UI for upsell customization.
*   **01/12/2025, 16:56:07**: UI integration of new upsell and coupon display logic in `mobilePage.tsx`, showcasing the new features in the mobile preview.
*   **03/12/2025, 14:54:29 - 15:44:12**: Repeated, iterative updates to `upsellFormRenderer.tsx`, suggesting a concentrated development effort on the upsell configuration UI, particularly on the `onRemove` logic for managing `applicable_items` (product, variant, and collection IDs).

### Patterns and Recurring Elements:

*   **Upsell Feature Development**: There's a clear pattern of introducing and iteratively refining an "upsell" feature, affecting multiple layers of the application:
    *   API endpoints (`upsellCheckout` in `apiEndpoints.ts`)
    *   API utility functions (`getAndDeleteUpsellData`, `pushUpsellData`, `getVariantNCollectionDetailsbyId` in `api.ts`)
    *   Redux state management (`upsell_data`, `updateUpsellState` in `customize-ui/index.ts`)
    *   UI components (`upsellFormRenderer.tsx`, `mobilePage.tsx`)
    *   A core component (`productSearch.tsx`) is heavily utilized by the new upsell feature for item selection.
*   **Modular Component Design**: The use of reusable components like `ProductSearch` and `RichTextEditor` within `UpsellFormRenderer` indicates a modular approach to UI development.
*   **UI Customization**: The Redux store's `customize-ui` slice and `mobilePage.tsx` demonstrate a comprehensive system for customizing various parts of the checkout UI (brand, login, address, payment, upsell).
*   **Data Fetching and Transformation**: Functions like `parseResponse` in `productSearch.tsx` and `getVariantNCollectionDetailsbyId` in `api.ts` highlight the need for transforming raw API responses into a UI-friendly format, especially when dealing with product variants and different entity types (products, collections, variants).
*   **Form Management**: Heavy reliance on Ant Design's `Form` API, including `Form.useWatch` and `form.setFieldValue`, for dynamic form behavior and state updates, particularly evident in `upsellFormRenderer.tsx`.
*   **Debugging/Refinement**: The frequent, minor changes to `upsellFormRenderer.tsx` on December 3rd, often including `console.log` statements, suggest an active debugging and refinement phase for the `onRemove` logic within the upsell configuration. Specifically, the logic for filtering `product_ids`, `variant_ids`, and `collection_ids` during item removal from applicable rules was a recurring point of adjustment.

## 16:04:33
The provided log details changes across three files: `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`, and `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`, and `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`, `/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`.

### File-Specific Summaries:

1.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`** (Multiple changes between 30/11/2025, 12:17:26 and 30/11/2025, 20:53:50):
    *   This file is central to handling foreign analytics and tracking events.
    *   **Timestamp 12:17:26:** Initial state, imports various stores (LoginStore, OrderStore, CommonStore) and services (EventService) to gather data for analytics. It initializes numerous variables related to cart, user, merchant, pricing, and tracking (FB, GA, Snapchat, etc.). It defines `fbPixelEventsAndKeys` for custom Facebook events. Subscribes to various stores to update local variables and `priceBreakup` object.
    *   **Timestamp 12:20:53:** A `console.log("Triggered")` statement was added before `store_totalPrice.subscribe`, indicating a debugging step. No functional change.
    *   **Timestamp 12:22:25:** The `console.log("Triggered")` statement added at 12:20:53 was removed.
    *   **Timestamp 12:25:10:** The calculation of `cart_total_price` and `cart_after_discount` within `store_totalPrice.subscribe` was updated to use optional chaining (`cart?.original_total_price` and `cart?.total_price`) to prevent potential errors if `cart` is undefined.
    *   **Timestamp 12:27:14:** The `console.log(res,"Total Price Amount")` was removed from the `store_totalPrice.subscribe` block.
    *   **Timestamp 12:27:27:** The `cart_total_price` and `cart_after_discount` calculations were moved from `store_totalPrice.subscribe` to `store_priceBreakUp.subscribe`, suggesting a refactoring to ensure these values are updated when the price breakdown is available. The `console.log(res,"Total Price Amount")` was re-added to `store_totalPrice.subscribe`.
    *   **Timestamp 12:29:18:** A `console.log(res,"Price Breakup ===>")` was added within the `store_priceBreakUp.subscribe` block.
    *   **Timestamp 12:34:05:** The `cart_total_price` and `cart_after_discount` calculations in `store_priceBreakUp.subscribe` were modified to prioritize `res?.subTotal` and `res?.total` from the price breakup response, falling back to `cart?.original_total_price` and `cart?.total_price` if not present.
    *   **Timestamp 12:35:05:** The declarations for `cart_total_price` and `cart_after_discount` were moved from `let cart_total_price; let cart_after_discount;` to a single line initialization with default values if `cart` is undefined: `let cart_total_price = cart?.original_total_price / 100, cart_after_discount = cart?.total_price / 100;`.
    *   **Timestamp 12:35:11:** This change reverts the previous one, splitting the declarations of `cart_total_price` and `cart_after_discount` back into separate `let` statements without initial values.
    *   **Timestamp 20:39:30:** The `cart_total_price` and `cart_after_discount` declarations were again combined and initialized with default values using optional chaining, similar to the 12:35:05 change. A `console.log(res)` was added to `store_priceBreakUp.subscribe`.
    *   **Timestamp 20:46:19:** The `console.log(res)` from `store_priceBreakUp.subscribe` was removed.
    *   **Timestamp 20:53:50:** No visible change in the provided snippet compared to the previous one.

2.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`** (Timestamp: 30/11/2025, 12:22:55):
    *   This is an HTML file for a merchant page, likely used for testing or demonstration of the `gokwikSdk`.
    *   The `gokwikSdk` is defined to initialize the GoKwik script, process payments, and handle event subscriptions.
    *   It sets and retrieves cookies (`gk_landing_page`, `gk_orig_referrer`) to track user's landing page and referrer information.
    *   The page includes a button to trigger `goKwikCheckout` and defines `window.merchantInfo` with various IDs and an environment setting (`'local'`), including several commented-out `mid` values for different merchants/environments.

3.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`** (Multiple changes between 30/11/2025, 12:23:13 and 30/11/2025, 12:23:22):
    *   This file defines API base URLs and tokens based on the current environment (`env`).
    *   **Timestamp 12:23:13:** The `api_url` function for a 'local' environment was commented out, and `url` was set to `https://api.gokwik.co`. This suggests a temporary change to point local development to the production API or a specific QA API.
    *   **Timestamp 12:23:22:** The `api_url` for 'local' environment was changed to `https://sandbox.gokwik.co`, indicating a shift in the local development target.

4.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ApiService.ts`** (Timestamp: 01/12/2025, 12:09:23):
    *   This file manages API calls (`getCall`, `postCall`).
    *   It introduced a new `if` condition within the `postCall`'s `onload` method. This condition specifically checks `apiEndpontsToTrack` and `httpsErrorStatusCode` to trigger a `triggerCheckoutRedirect('shopifyRedirect')` if certain API endpoints return specific HTTP error codes, indicating a new error handling or redirect mechanism for checkout stability.
    *   It also includes updated logic for processing `priceBreakup` data from API responses, extracting `gyftr` item and setting various price components (total, subtotal, discounts, cashback, offers, loyalty points) into `store_priceBreakUp`.

5.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/login/Login.service.ts`** (Multiple changes between 01/12/2025, 12:34:26 and 01/12/2025, 18:47:11):
    *   This file handles user login, verification, and address management, primarily interacting with various stores and analytics services.
    *   **Timestamp 12:34:26:** Introduced `getAllAddress().then(async (res: any) => { await processAddresses(res); });` after successful login and verification. This indicates that address processing now immediately follows user verification. It also removed a `store_page.set(5)` and changed a commented `store_page.set(3)` to `addAddressBottomSheet()`. The `else if` for `response.data.address?.partial_address` previously used `(response.data.address[0]?.default === true)` which was removed.
    *   **Timestamp 12:34:44:** No visible functional changes in the provided snippets.
    *   **Timestamp 14:12:31:** A `console.log(truecallerUserData,"Truecaller User Data")` was added in the `isTruecaller` block.
    *   **Timestamp 14:12:41:** No visible functional changes.
    *   **Timestamp 14:13:39:** A `console.log` for "Address Initial Value in verify user" was added within the `checkLogin` response handling, specifically in the `else if` block for partial address conditions.
    *   **Timestamp 14:22:15:** No functional change.
    *   **Timestamp 14:23:39:** No functional change.
    *   **Timestamp 14:25:08:** The `else` block handling `response.data?.user_type !== 'new'` and `addressEvent('prefilled_address_listing', ...)` was commented out. It was replaced by a more direct handling for `partial_address` or default address without first/last name, indicating a refactoring of address handling logic post-login. A `console.log(addAddressInitialValue,"Address Initial Value")` was added inside this new block.
    *   **Timestamp 14:26:03:** The commented-out `else` block was restored, and the new `else if` condition added in 14:25:08 was adjusted. The logic now prioritizes partial address or addresses with missing names for prefilling, and if not applicable, falls back to address listing.
    *   **Timestamp 14:34:30:** The logic for checking for a default address with empty first/last name was made more robust by checking `Array.isArray(response?.data?.address) && response?.data?.address?.length && response?.data?.address.some(...)`.
    *   **Timestamp 14:36:57:** A `console.log` for the "Address Initial Value in verify user" condition was added, and the previous `console.log(addAddressInitialValue,"Address Initial Value")` was retained.
    *   **Timestamp 14:38:06:** The first `console.log` for "Address Initial Value in verify user" was modified to only log the result of the `some` check, not the entire `addAddressInitialValue`.
    *   **Timestamp 14:40:04:** A `console.log(response.data.address,'Response Address after verify user')` was added at the start of the `if (response.statusCode === 200)` block. Another `console.log(addAddressInitialValue," Initial Value")` was added in the final `else` block.
    *   **Timestamp 17:35:34:** The `console.log(response.data.address,'Response Address after verify user')` was changed to `console.log("Idar AA gaya Response")`.
    *   **Timestamp 18:44:46:** No visible functional change.
    *   **Timestamp 18:47:11:** No visible functional change.

6.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/Address.service.ts`** (Multiple changes between 01/12/2025, 12:36:44 and 01/12/2025, 20:16:25):
    *   This file provides functions for address validation and processing fetched addresses.
    *   **Timestamp 12:36:44:** Added an initial `console.log(res,"Api Call for address")` to `processAddresses`. The condition `!res.data.address` now leads to setting `store_selectedAddress`, `store_allAddresses`, and `store_addressCount` to null/0, triggering `addAddressBottomSheet()`, and hiding the loader. Logic for handling `leading_indicators_flag` and `last_used_address_flag` for logging analytics events was introduced.
    *   **Timestamp 12:38:10:** The condition `!res.data.address` was updated to `!res?.data?.address?.length`, indicating a more precise check for an empty address array.
    *   **Timestamp 12:38:21:** The condition was reverted from `!res?.data?.address?.length` back to `!res?.data?.address`.
    *   **Timestamp 12:44:16:** The `addressValidate` function's `status` return was updated to include a check for empty `fullname` (firstname and lastname being empty or just a dot), indicating a new validation rule for address names.
    *   **Timestamp 12:45:01:** A `console.log` was added to `addressValidate` to log the new fullname check.
    *   **Timestamp 12:45:22:** The fullname check in `addressValidate` was slightly modified, changing `selectedAddress?.fullname` to `selectedAddress?.firstname`.
    *   **Timestamp 12:46:09:** No visible functional change.
    *   **Timestamp 12:51:25:** A `console.log` was added in the `else` branch of the `if (!addressValidate(defaultAddress, false))` block within `processAddresses`, indicating a debugging step.
    *   **Timestamp 12:52:26:** A `console.log` for "Validation Adderss" was added to the `if (!addressValidate(defaultAddress, false))` block in `processAddresses`.
    *   **Timestamp 12:52:57:** The `store_allAddresses.set(null)` and `store_addressCount.set(null)` were changed to `store_allAddresses.set(fetchedAddress)` and `store_addressCount.set(fetchedAddress.length)` in the main `processAddresses` flow. This seems like a correction, as these stores should be updated with the fetched addresses rather than cleared.
    *   **Timestamp 12:55:49:** The `store_loader.set` in the `else` branch of the validation block was commented out.
    *   **Timestamp 12:56:17:** The `store_loader.set` in the validation `else` block was uncommented. A new line `if(defaultAddress)defaultAddress.partial_address = true` was added before the validation call, suggesting a forced `partial_address` flag for the default address under certain conditions.
    *   **Timestamp 12:56:27:** The `console.log` for "Validation Adderss" was re-added.
    *   **Timestamp 12:57:54:** The condition `!addressValidate(defaultAddress, false)` was changed to `addressValidate(defaultAddress, false)`. This is a significant change, flipping the logic of the `if` block for `store_skipToPayment`.
    *   **Timestamp 12:58:22:** The line `(item.id != selectedAddress?.id || item.pincode != selectedAddress?.pincode) && store_selectedAddress.set();` in `fetchedAddress.forEach` was changed to `store_selectedAddress.set(null);` if conditions are met, causing an address deselect.
    *   **Timestamp 12:58:31:** The change from 12:58:22 was reverted, and `store_selectedAddress.set(item)` was restored.
    *   **Timestamp 12:58:46:** No visible functional change.
    *   **Timestamp 13:00:05:** The `if` condition in `addressValidate` (for `selectedAddressTrimmed?.length < 12` etc.) was extended to also include `(selectedAddress?.firstname === '' && (selectedAddress?.lastname === '' || selectedAddress?.lastname === '.'))`, refining the error logic for missing names.
    *   **Timestamp 13:00:59:** The logic within `processAddresses` for mapping addresses was changed. For addresses where `lastname` is '.', the `partial_address` field is dynamically set based on `firstname` and `lastname` being trimmed and present: `{ ...address, lastname: '', partial_address: address?.partial_address && !!address?.firstname?.trim() && !!address?.lastname?.trim() }`.
    *   **Timestamp 14:00:14:** No visible functional change.
    *   **Timestamp 14:00:40:** The dynamic `partial_address` logic from 13:00:59 was reverted, simplifying it back to `{ ...address, lastname: ''}` if `lastname` is '.'.
    *   **Timestamp 14:03:05:** The mapping of `fetchedAddress` in `processAddresses` was updated. If `lastname` is '.', it's set to empty string, and `partial_address` is *always* set to `true` for such cases, regardless of `firstname/lastname` presence, indicating a more aggressive "partial address" classification.
    *   **Timestamp 14:04:06:** The logic for `fetchedAddress` mapping in `processAddresses` was reverted again. If `lastname` is '.', `partial_address` is now completely removed from the mapping and `lastname` is set to an empty string. If `lastname` is not '.', the entire address object is returned as is, meaning `partial_address: true` is only set if it already exists or if it's the `firstname === ''` case.
    *   **Timestamp 14:07:50:** The `addressValidate` call within `processAddresses`'s `if (!isDeleteCall)` block was changed from `!addressValidate(defaultAddress, false)` to `!addressValidate(defaultAddress, false)?.status`. This explicitly checks the `status` property of the returned object from `addressValidate`.
    *   **Timestamp 14:09:44:** No visible functional change.
    *   **Timestamp 14:10:13:** No visible functional change.
    *   **Timestamp 14:11:19:** No visible functional change.
    *   **Timestamp 17:39:24:** A `console.log(addressValidate(defaultAddress, false));` was added to `processAddresses`, likely for debugging the address validation result.
    *   **Timestamp 17:40:34:** The `if (!addressValidate(defaultAddress, false))` was changed to `if (!addressValidate(defaultAddress, false)?.status)`. This ensures that the `.status` property of the return value from `addressValidate` is explicitly checked for truthiness.
    *   **Timestamp 17:43:31:** No visible functional change.
    *   **Timestamp 18:42:28:** A new validation rule was added in `addressValidate`: if both `firstname` and `lastname` are empty strings, an `errorMsg` is set to `Address.partialAddressName`, and `is_partial_address` is added to `exsitingAddressErrorField`.
    *   **Timestamp 18:43:27:** The new validation rule for empty `firstname` and `lastname` now also sets `store_partialAddress.set(selectedAddress)`, indicating that if the name is missing, the address is considered partial and its data is stored.
    *   **Timestamp 18:43:46:** The `partial_address` flag is explicitly set to `true` on `selectedAddress` when `firstname` and `lastname` are empty, before calling `setPartialAddress(selectedAddress)`.
    *   **Timestamp 18:48:12:** The `store_partialAddress.set(selectedAddress)` was changed to `store_partialAddress.set(addAddressInitialValue)`, but `setPartialAddress(selectedAddress)` is still called afterward. This might be an attempt to reset the partial address store before setting new partial details.
    *   **Timestamp 18:48:42:** A `console.log(selectedAddress, " Selected Address in validation ");` was added inside `addressValidate`.
    *   **Timestamp 18:49:36:** No visible functional change.
    *   **Timestamp 18:49:53:** The `snackbar_state.set` for `Address.partialAddressName` was re-introduced when `firstname` and `lastname` are empty in `addressValidate`.
    *   **Timestamp 18:50:15:** No visible functional change.
    *   **Timestamp 18:55:24:** The `if (selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` block in `addressValidate` had its `store_partialAddress.set` and `setPartialAddress` calls commented out, removing the direct update of stores from validation, while keeping the `partial_address = true` and `snackbar_state.set` logic.
    *   **Timestamp 18:55:50:** The `store_partialAddress.set(addAddressInitialValue)` and `setPartialAddress(selectedAddress)` calls were restored within the `if (selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` block in `addressValidate`.
    *   **Timestamp 18:56:22:** No visible functional change.
    *   **Timestamp 19:59:11:** A comment `#CHECKOUT-21591` was added to the `if (selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` block in `addressValidate`, indicating a specific bug fix or feature related to partial address handling for missing names.
    *   **Timestamp 20:01:03:** The `if (selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` logic was commented out entirely within `addressValidate`.
    *   **Timestamp 20:02:32:** The commented-out block from 20:01:03 was restored.
    *   **Timestamp 20:11:51:** A `console.log("Selected Address in validation: ", selectedAddressNameTrimmed);` was added within `addressValidate`.
    *   **Timestamp 20:16:25:** The `if (selectedAddress?.firstname === '' && selectedAddress?.lastname === '')` condition was changed to `if (!selectedAddressNameTrimmed?.trim())`, making the check for empty names more robust by using the trimmed `selectedAddressNameTrimmed`.

7.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressListing.svelte`** (Multiple changes between 01/12/2025, 13:07:21 and 01/12/2025, 13:08:17):
    *   This Svelte component displays a list of addresses and related shipping options.
    *   **Timestamp 13:07:21:** Initial state, sets up subscriptions to various stores (e.g., `store_allAddresses`, `store_phoneNo`, `store_page`). It handles loading states, address deletion, and navigation based on address validation. Introduced logic for `usePartnerOfferCss` based on screen width and partner acquisition offer status.
    *   **Timestamp 13:08:17:** Added `box-sizing: border-box;` to the `.see-all-button-container` style and `display: block;` to `.see-all-button` style, indicating minor CSS adjustments.

8.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/Address.svelte`** (Multiple changes between 01/12/2025, 17:33:01 and 01/12/2025, 17:34:37):
    *   This Svelte component handles adding and editing addresses, including pincode input and geolocation features.
    *   **Timestamp 17:33:01:** Initial state, manages address input fields, pincode validation, geolocation API interaction, and navigation based on address submission. Uses various stores for state management.
    *   **Timestamp 17:34:37:** Added `background-color: var(--white);` to the `.floating-label` style, indicating a minor CSS adjustment.

9.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/address/AddressInputs.svelte`** (Multiple changes between 02/12/2025, 01:22:32 and 02/12/2025, 01:39:54):
    *   This Svelte component manages individual address input fields and their validation.
    *   **Timestamp 01:22:32:** Initial state, defines `oldaddressFields`, `oldaddressInputs`, `suggestedAddressFields`, and `suggestedAddressInputs` for different address input configurations. It handles logic for KwikPass email editing, recipient phone number display, and geolocation address autofill. Includes validation and submission logic.
    *   **Timestamp 01:29:36:** No visible functional changes in the provided snippets.
    *   **Timestamp 01:29:57:** No visible functional changes.
    *   **Timestamp 01:39:54:** No visible functional changes.

### Patterns and Recurring Elements:

*   **Svelte Stores:** A prevalent pattern is the extensive use of Svelte stores (`store_discountCode`, `store_merchantInfo`, `store_page`, `store_selectedAddress`, etc.) for state management across multiple components and services. This indicates a reactive programming model.
*   **Analytics and Logging:** Many files involve `logEvent`, `fireAnalytics`, `fireAnalyticsGa4`, `fireGtmEvent`, and `stabilityEvent` calls, suggesting a strong emphasis on tracking user behavior, performance, and errors for analytics and debugging. Events like `mobileNumberEnter`, `address_selected`, `addaddress_pageload`, `geolocation_available`, `mmi_address_autofilled`, and `verify_token` are frequently logged.
*   **Address Handling:** There's a significant focus on address-related logic across `ForeignAnalytics.ts`, `Login.service.ts`, `Address.service.ts`, `AddressListing.svelte`, and `Address.svelte`. This includes:
    *   Fetching and processing addresses (`processAddresses`, `getAllAddress`).
    *   Validation of address fields (`addressValidate`), especially pincode, email, and name length/format.
    *   Prefilling addresses and partial addresses.
    *   Handling different address input layouts (`oldaddressInputs`, `suggestedAddressInputs`).
    *   Geolocation integration for address input.
    *   Managing address-related error messages.
*   **Conditional Logic and Feature Flags:** Numerous `if` and `else if` conditions based on flags like `isTruecaller`, `isSkipOtp`, `editFlag`, `exisitingShopifyUser`, `isBillingAddress`, `isKwikPassLogin`, `showMMIButton`, `isDeleteCall`, `emailBasedCohortDiscounts`, `validOffersState`, `store_additionalAddress`, `store_addressSuggestionFlow`, `store_enableRecipientPhone`, `store_skipToPayment.skip_flow`, `store_skipToPayment.address_check`, `store_requestIdObject.custom_config.skip_to_payment`, `store_addressesMasked`, `store_selectedAddress?.partial_address`, `store_editAddress`, `store_newUser`, `store_deliveryEstimate`, `store_GSTBilling`, `store_shippingAsProduct`, `store_partnerAcquisitionOffer`, etc., are used to control application flow and UI elements, indicating a highly configurable system that adapts to different user states, merchant settings, and experimental features.
*   **Error Handling:** Extensive error message handling and display via `snackbar_state.set` are present, providing user feedback for various issues like invalid addresses, shipping errors, or API failures.
*   **Environment Configuration:** `EnvironmentService.ts` clearly shows a robust system for managing API endpoints and tokens across different deployment environments (dev, qa, sandbox, production, local), with specific tokens like `SANDBOXKWIKSESSIONTOKEN` and `KWIKSESSIONTOKEN`.
*   **Debugging Statements:** The presence and subsequent removal/modification of `console.log` statements throughout the log indicate active development and debugging efforts.
*   **Shopify Integration:** Several store names and logic (`store_shopifySessionId`, `store_shopifyCookieInfo`, `store_shopifyAddAddressCall`, `store_shopifyAddressFound`, `shopifyAddressStepReached`, `shopifyRedirectEvent`, `shopify_merchant_webhook`) suggest a strong integration with the Shopify platform for checkout and analytics.

## 16:23:29
The changes primarily focus on refining the integration of a KwikPass/GoKwik checkout flow within an Expo React Native application, specifically dealing with event handling from a WebView and managing the order completion and user login processes.

**File-Specific Updates:**

*   **`/packages/kwikpassV2/src/components/KwikPassCheckout.js`** (and its duplicated path `/src/kwikpassV2/src/components/KwikPassCheckout.js`):
    *   **27/11/2025 (18:51:28 - 23:16:45):** This file saw numerous iterative changes, primarily within the `orderSuccess` event handler. The core logic involved extracting `orderID` from `graphqlOrderId` (`orderGID`) and `orderKey` from `checkoutUrl` using regular expressions. Several debugging `console.log` statements were added and removed to trace these extractions (e.g., `checkoutURL Is Coming`, `ORDER KEY MATCHES`). Initially, `orderKey` extraction was made more robust with `orderKeyRegexExtra`, then reverted, then reinstated. There was also a temporary removal of `orderGID` from the `if` condition check.
    *   **27/11/2025 (23:30:22):** A significant refactor of the `orderSuccess` handler occurred. The `orderKey` extraction logic was simplified to *only* extract `orderId` from `orderGID`. The `SET_ORDER_COMPLETE` action was modified to pass an empty string for `orderKey`. Crucially, an explicit `OPEN_IN_WEBVIEW` action was introduced to redirect to the `checkoutUrl` provided by the GoKwik SDK, alongside robust comments explaining the three steps: Shopify Order ID extraction, customer redirection, and auto-login using the GoKwik token.
    *   **27/11/2025 (23:50:11):** The refactored `orderSuccess` logic was largely reverted to an earlier state, bringing back the `orderKey` extraction using regex and dispatching `SET_ORDER_COMPLETE` with the extracted key.
    *   **28/11/2025 (00:25:40 - 07:55:36):** Multiple updates focused on ensuring the `checkoutUrl` is correctly prefixed with `https://` if it lacks a protocol, demonstrating ongoing sanitization efforts for external URLs.
    *   **28/11/2025 (11:09:45 - 11:13:51):** The `SET_ORDER_COMPLETE` action was updated to ensure `orderKey` is always a string (`orderKey || ''`). The condition for dispatching `SET_ORDER_COMPLETE` was changed from `if (orderId && orderKey)` to `if (orderId || orderKey)`, allowing completion even if only the `orderId` is available.
    *   **28/11/2025 (12:25:54 - 12:41:56):** A new approach to handling `orderSuccess` emerged. The `checkoutUrl` and `orderKey` extraction were commented out. Instead, the application would construct a Shopify "thank you" page URL using the `orderId` and `shopDomain`, and navigate to it via `OPEN_IN_WEBVIEW`. The `SET_ORDER_COMPLETE` action was dispatched with an empty `orderKey`. This was then partially reverted, and later, the `OPEN_IN_WEBVIEW` for the original `checkoutUrl` was made conditional (only if `orderKey` was not found), while `SET_ORDER_COMPLETE` always dispatched with the (potentially extracted) `orderKey`.
    *   **28/11/2025 (17:10:35 - 17:11:12):** Added general console logs for `message?.eventname` and `message?.eventname, "Event Name and Data"` at the top of the `onEvent` function for broader debugging.
    *   **01/12/2025 (17:55:47 - 18:02:38):** Temporary debugging code involving a `count` variable and a specific check for `gokwik_events` was added, refined (correcting a typo `eventnamer` to `eventname`), and then commented out.
    *   The `KWIKPASS_LOGIN` action is consistently used to log in users post-order if they are not already logged in, using `email` and `gkAccessToken`.
    *   The `openInBrowserTab` event handler consistently directs HTTP/HTTPS URLs to `OPEN_IN_WEBVIEW` and other URLs to `webViewCanHandleCurrentUrl`.
    *   The `gk-checkout-disable` event consistently triggers `OPEN_SHOPIFY_NATIVE_CHECKOUT`.

*   **`/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/index.tsx`**
    *   **27/11/2025 (18:54:00):** This file, representing the `KPCheckout` component, remained stable throughout the log. It primarily acts as a wrapper, passing `checkoutData` and event handlers (`onEvent`, `onError`, `onNavigationStateChange`) to the underlying `Checkout` component. It includes a console log indicating when it's rendering with `checkoutData`.

*   **`/node_modules/@appmaker-packages/extension-kwikpass-expo-package/src/checkout/Checkout.tsx`**
    *   **27/11/2025 (18:57:26 - 20:35:26):** This file defines the core WebView logic. It contains injected JavaScript to listen for `gokwikSdk` events (`modal_closed`, `orderSuccess`, `openInBrowserTab`, `gokwikLoaded`, `gokwik_events`, `gk-checkout-disable`) and post them back to React Native. It handles WebView URL construction, app state changes, hardware back presses, and UPI payment intents (using `convertToIntentUrl` and `UPI_APP_PACKAGES`). There were no substantive code changes within the provided logs for this specific file beyond its initial entry, indicating its stability during the `KwikPassCheckout.js` modifications.

*   **`/packages/kwikpassV2/src/pages/CheckoutOptions.js`**
    *   **28/11/2025 (14:48:50 - 14:52:20):** This file defines a static page configuration for a `CheckoutOptions` screen, embedding the `kwikpass/checkout` component. It remained stable, likely representing a consistent UI structure.

**Timestamps of Significant Changes:**

*   **27/11/2025, 23:30:22:** A major refactor in `KwikPassCheckout.js` simplified order key extraction and introduced explicit WebView redirection to the `checkoutUrl`.
*   **27/11/2025, 23:50:11:** This refactor was subsequently reverted, bringing back more complex order key extraction and modifying the post-order navigation flow.
*   **28/11/2025, 12:25:54:** Another substantial change in `KwikPassCheckout.js` where the `checkoutUrl` from the SDK was largely bypassed in favor of constructing a specific Shopify "thank you" page URL for `OPEN_IN_WEBVIEW`. This was then quickly iterated upon.

**Patterns and Recurring Elements:**

*   **Frequent Iteration on `orderSuccess` Logic:** The `orderSuccess` handler in `KwikPassCheckout.js` is the most volatile part of the codebase, undergoing numerous changes related to extracting order details (`orderId`, `orderKey`) and determining the post-order navigation and completion actions (e.g., `SET_ORDER_COMPLETE`, `OPEN_IN_WEBVIEW`). This suggests challenges or ongoing refinement in reliably integrating GoKwik's order success flow with the Shopify platform and Appmaker actions.
*   **Debugging with `console.log`:** Extensive use of `console.log` statements throughout `KwikPassCheckout.js` at various stages indicates active development and debugging, especially when dealing with data extraction and event flows.
*   **URL Handling:** Consistent logic is present for ensuring URLs are correctly prefixed with `https://` before being opened in a WebView, and for handling different types of URLs (HTTP/HTTPS vs. custom schemes).
*   **User Login Post-Checkout:** The pattern of checking if a user is logged in and, if not, attempting to log them in using `KWIKPASS_LOGIN` with `email` and `gkAccessToken` after a successful order is a recurring and stable feature.
*   **WebView Communication:** The pattern of the `Checkout.tsx` component injecting JavaScript to listen for `gokwikSdk` events and then posting messages back to its parent `KwikPassCheckout.js` component for further handling is central to the integration.
*   **Redundant Logs/Saves:** Many timestamps show identical code content, which could be due to frequent saving, automated tools, or minor non-code changes (like whitespace) not visible in the provided diff.
*   **File Path Duplication:** The presence of both `/packages/kwikpassV2/...` and `/src/kwikpassV2/...` paths for `KwikPassCheckout.js` suggests a possible migration, renaming, or duplicate component in the project structure.