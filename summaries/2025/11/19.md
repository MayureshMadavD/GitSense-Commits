# Activity Summary for 19/11/2025

## 11:53:15
The provided log details changes across multiple files in a dashboard UI, focusing on customization, order management, and discounts.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file, responsible for the brand customization page, received updates related to logo upload functionality and theme color management.
    *   It includes logic for validating image files (type, size), handling uploads to AWS S3, and fetching pre-signed URLs.
    *   The form (`Form.useForm()`) manages `brand_data`, including `logo`, `logoImg`, and `cssRules.primaryColor`.
    *   `useEffect` hooks are used to initialize logo data from `merchant_details` and update primary color from `config.custom_config`.
    *   The component renders UI for uploading a logo, displaying a preview, and a color picker for the primary theme color.
    *   Saving changes (`onFinish`) involves updating the merchant logo via API and saving configuration.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51)
    *   This component manages product and collection search functionality for discounts.
    *   It was updated to support collating products (grouping variants under a single product), handling quantities for collections, and filtering products based on tags for 'agent-led' scenarios.
    *   The `parseResponse` function was modified to correctly group product variants when `collateProducts` is true and to handle filtering for `isAgentLed` items.
    *   New props like `collateProducts`, `showQuantity`, `alloweditemscount`, `hideSearchInput`, `isAgentLed`, `topUpGift`, and `collectionSpecificData` were introduced.
    *   Logic for incrementing/decrementing item quantities and handling gift prices was added.
    *   The UI renders search input, a modal for search results with checkboxes for selection, and displays selected products/collections with their details and quantity controls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file, for displaying order details, received significant updates to its data processing and display logic.
    *   New helper functions `formatCurrency` and `formatAmountWithCurrency` were introduced for improved currency formatting.
    *   A `mergeRepeatedRefunds` function was added to aggregate multiple refund attempts for a single `gokwik_rid` and determine the final status (`Completed`, `Failed`, `Initiated`).
    *   The `fetchOrderDetails` function now handles various price breakup components (discounts, taxes, shipping, gift cards, rewards, store credits) and calculates the total refundable amount, setting the state for the refund button.
    *   It includes logic to set an `editTitle` and `disableEdit` state based on applied rewards, GWP discounts, or loyalty points.
    *   Improved handling for `is_deleted` and `is_auto_refund` flags for transactions.
    *   Introduced `order_failure_reason` and `showRTOActions` logic.
    *   The component leverages `useMemo` for `discountBreakup` calculation to optimize performance.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Timestamp: 18/11/2025, 00:45:31)
    *   This EJS template defines the structure of the dashboard UI.
    *   It includes a Content Security Policy (CSP) for security.
    *   The primary change involves updating the `systemjs-importmap` configurations for various environments (`local`, `dev`, `qa`, `sandbox`, `production`).
    *   Specific Micro-frontend applications (e.g., `@gokwik/configuration`, `@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/checkout`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, `@gokwik/shopify-app`, `@gokwik/kwikcomm`) now point to their respective deployment URLs based on the `deployedEnv` variable.
    *   New Relic and Clarity analytics scripts are conditionally included for the `production` environment.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Timestamp: 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, 18/11/2025, 00:58:39)
    *   These three entries show identical code changes, indicating repeated saves or minor, non-substantive changes in quick succession.
    *   This file manages the Free Gift settings.
    *   It defines a `FreeGift` component with state for rules, editing, and changes.
    *   The `useMerchantConfigApi` hook is used for fetching and saving configuration.
    *   It uses `Form.useWatch` to react to changes in free gift configuration, specific products/collections, free product, application method, and applicable on settings.
    *   An `initialValues` object defines the default configuration for auto gift rules.
    *   `useEffect` is used to update breadcrumbs for navigation.
    *   The `fields` array defines the structure and validation rules for a dynamic form, including input, checkbox, radio, inputNumber, and search types, with conditional visibility (`hideControlInput`, `hidden`) based on other form values.
    *   The `columns` array defines the structure for a table to display free gift rules, including name, free gift product (with image), status (toggle switch), and actions (edit/delete dropdown).
    *   `handleEdit`, `handleDelete`, `handleAddFreeGiftProduct`, and `handleRemoveFreeGiftProduct` functions manage the state of free gift rules and their associated products.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component organizes various UI customization fields for the order confirmation page into collapsible sections.
    *   It uses `Form.useWatch` to react to changes in `customize` data.
    *   The component defines separate field configurations (`orderDetailFields`, `customerInformationFields`, `supportDetailFields`) for different sections of the order confirmation page, including switches for enabling/disabling sections, input fields for text, and `ColorPickerHelper` for background and text colors.
    *   The `items` array structures these sections into a `Collapse` component, allowing each section to be toggled, with an additional switch in the `extra` prop for enabling/disabling the entire section.
    *   It integrates other components like `LogoPage`, `RenderEditorFunction` (for dynamic banners), and `TrustBadgeForm`.
    *   Introduces drag-and-drop functionality for reordering collapse items, allowing users to customize the layout of the order confirmation page fields.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34**: Significant updates to brand customization, particularly logo upload and theme color.
*   **17/11/2025, 16:22:51**: Major enhancements to product/collection search, including product collation, quantity management, and filtering.
*   **17/11/2025, 16:23:04**: Substantial changes to order details display, refund logic, and currency formatting.
*   **18/11/2025, 00:45:31**: Core infrastructure update with environment-specific import map configurations and analytics scripts in `index.ejs`.
*   **18/11/2025, 23:42:52**: Introduction of drag-and-drop and extensive customization options for the order confirmation page.

### Patterns or Recurring Elements:

*   **`useMerchantConfigApi` Hook**: Frequently used across `BrandPage` and `FreeGift` components for fetching, updating, and saving merchant-specific configurations, indicating a centralized configuration management system.
*   **Form Management with Ant Design (Gokwik-UI-Kit)**: Extensive use of `Form.useForm()`, `Form.Item`, `Form.useWatch`, and `form.setFieldsValue()` for managing form state, validation, and interaction, particularly in `BrandPage`, `FreeGift`, and `collapseFields`.
*   **Dynamic UI Rendering with `RenderField`**: The `RenderField` utility component is used to dynamically render various form input types based on a configuration array (e.g., in `FreeGift` and `collapseFields`), promoting reusability and declarative UI construction.
*   **Customization and Configuration**: A strong theme of enabling merchants to customize various aspects of the checkout UI (brand logo, theme color, order confirmation page sections, free gift rules).
*   **API Interactions**: Frequent use of `makeAPICall` and `makeAWSPutCall` for backend communication (e.g., fetching order details, uploading images, saving configurations).
*   **Breadcrumb Navigation**: `updateBreadcrumbs` utility is used in `FreeGift` to manage consistent navigation paths across the application.
*   **Date Formatting and Currency Handling**: Specific helper functions (e.g., `formatAmount`, `setCurrencySymbol`, newly added `formatCurrency` and `formatAmountWithCurrency`) are used to ensure consistent display of numerical and monetary values.
*   **Timestamp Proximity**: The three identical `freeGift.tsx` entries on 18/11/2025 suggest either rapid iteration, minor non-functional changes, or repeated saves without actual code differences being logged.
*   **Environment-Specific Deployments**: The `index.ejs` file clearly demonstrates a pattern of setting up different Micro-frontend module URLs based on the deployment environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust CI/CD and deployment strategy.
*   **New Relic Integration**: The `index.ejs` also shows a pattern of integrating New Relic monitoring for performance and error tracking, specifically in the production environment.

## 12:00:41
The provided log details changes across several files, primarily focusing on checkout, payment, and analytics functionalities within a SvelteKit application.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** Consistent updates on `12/11/2025, 21:20:24` and `15/11/2025, 12:00:15`.
    *   **Updates:** This service is heavily involved in managing discounts and shipping options.
        *   Numerous Svelte stores are subscribed to, indicating a highly reactive and state-driven component.
        *   The `callShippingDiscountApi` function handles discount application, removal, and combination calls. It includes logic for clearing API timers, displaying confetti for successful discounts (conditional on user type and redirection flow), and handling Gyftr rewards.
        *   Error handling for invalid discount channels is present.
        *   `processShippingDiscountResponse` further processes API responses, updating shipping methods, discounts, and handling gift card reapplication on cart updates.
        *   Specific fixes for issues like `CHECKOUT-15842` (GiftCard on Cart Update) and `CHECKOUT-12982` (Payment Methods on Shipping Options) are noted.
        *   New logic for UTM auto-apply discount/shipping options failure is added, which prevents displaying an error message on the UI in such cases.
        *   Introduces logic for `discount_shipping_retry` based on available shipping options.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:15` and `17/11/2025, 23:34:43`.
    *   **Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, analytics) based on the environment (dev, qa, sandbox, production, local).
        *   Consistently updates the `api_url` for the `local` environment, switching between different development/production endpoints, indicating active testing and environment configuration changes.
        *   The `XGokwikToken` and `XKWIKPASSToken` functions dynamically return session tokens based on the environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:36` and `17/11/2025, 23:35:35`, and then more on `18/11/2025` around `14:50:00`.
    *   **Updates:** This is a merchant integration HTML file.
        *   The `gokwikSdk` is defined to manage checkout initiation, event handling (`on`, `emit`), and UI interactions like hiding buttons.
        *   Initial script loading (`gokwik.js`) and event listeners (`DOMContentLoaded`, `initGKJS`) are present.
        *   Cookie management (`getCookieGk`, `setCookieGk`) for tracking landing page and referrer is included.
        *   The `window.merchantInfo` object, crucial for merchant-specific configurations like `mid`, `environment`, `storeId`, and `fbpixel`, is frequently updated (different `mid` values are commented out, suggesting testing across multiple merchant IDs).
        *   The `initKwikCheckout` function (in `kwik-checkout.html` variant) loads integration and analytics scripts dynamically.
        *   Listeners for `checkoutHealth` and `shopifyRedirect` are present, which trigger a custom event `gk-checkout-disable` for fallback.
        *   Recent changes in `kwik-checkout.html` (18/11/2025) include adding `window.__KP_EMAIL__ = kpEmail;` which suggests handling Kwikpass email information more directly in the global scope.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** Frequent updates on `13/11/2025` (multiple times around `20:56:52` to `21:25:07`) and `15/11/2025, 12:01:15`.
    *   **Updates:** This Svelte component is central to payment options display and logic.
        *   Imports a vast array of Svelte stores from `CommonStore` and `OrderStore`, highlighting a highly interconnected and stateful component.
        *   Manages various payment-related states: `totalPrice`, `screen_width`, `codPaymentFailed`, `availableAutoOffers`, `recommendedOptions`.
        *   Initializes tracking events on mount (`payment_step_landed`, `AddPaymentInfo`).
        *   Includes logic for applying recommended TwidPay rewards, fetching Shopify credits, and handling COD confirmation.
        *   Filters and reorders `availableAutoOffers` based on payment methods and screen width.
        *   Introduces `store_availableOffersCheck`, `store_isLoggedInUser`, `store_isCartUpdated` in the latest version (15/11/2025), indicating more granular control over offer display and user state.
        *   Adds `AutomaticGiftHeader` and `GiftJourney` components in the latest update, suggesting new features for free gift management.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** Consistent updates on `15/11/2025, 11:49:48` and `15/11/2025, 11:52:44`.
    *   **Updates:** This component manages the order summary display.
        *   Calculates `totalPrice` based on `subTotal`, various discounts (coupon, prepaid, partner acquisition, gift card, loyalty, Gyftr), shipping, and COD charges.
        *   Handles logic for displaying automatic discounts and segregating free products (BXGY offers).
        *   Includes subscriptions to numerous stores (`cartjsObject`, `discountAmount`, `prepaidDiscount`, `codCharges`, `selectedShippingMethod`, `giftCardTotal`, etc.) to reactively update the summary.
        *   Introduces `lineItemEdds` and `earnedLoyaltyDetails` to influence loyalty display amount calculations.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 13:05:00` and `17/11/2025, 14:14:00`.
    *   **Updates:** This file integrates with Contlo analytics.
        *   Initially, it defined a dummy `window.contlo` object, but subsequent updates remove this, implying the actual Contlo SDK is expected to be present.
        *   Consolidates `createBody` function to prepare data for Contlo events, including product IDs, promo code, cart total, and UTM marketing data.
        *   Defines functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) to call `contloSendEvent` with specific event names and data.
        *   A key change in the `createBody` function (17/11/2025, 14:07:01) is to ensure `cart_total_price` is a valid number by checking `!isNaN(Number(commonAnalyticsData?.cart_after_discount))`. This is further refined to check for `!!commonAnalyticsData?.cart_after_discount` (17/11/2025, 14:13:04), indicating a robustness improvement for handling `cart_after_discount` values.
        *   `contloSendEvent` is wrapped in a try-catch block, logging an error if `window.contlo.sendEvent` is not found, suggesting more robust error handling for external SDKs.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 12:56:56` and `17/11/2025, 14:05:25`.
    *   **Updates:** This service is responsible for integrating various third-party analytics platforms.
        *   Imports and subscribes to a vast number of Svelte stores related to user data, cart information, discounts, and merchant configurations.
        *   Maintains a `priceBreakup` object to aggregate financial details for analytics.
        *   Manages `fbPixelEventsAndKeys` for Facebook pixel custom events.
        *   Dynamically builds `configObject` based on `store_foreignAnalytics` to enable/disable different analytics pixels.
        *   Includes logic to integrate `kwikOptimizerPixelIds` with Facebook custom events.
        *   The `generateTrackingData` function is called reactively when `cartjsObject` or `totalPrice` updates.
        *   A `console.log(res)` was added to the `store_totalPrice` subscription on 17/11/2025, 13:55:47, likely for debugging purposes, and then removed in the next commit.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** `17/11/2025, 22:38:42`.
    *   **Updates:** Displays promotional text related to loyalty points, store credits, and gift cards.
        *   Dynamically constructs `redeemableText` based on the availability and enablement of loyalty, credits, and Gyftr features.
        *   The `loyaltyDiscountText` message is conditional on the current page (`$store_page`).
        *   Includes several `JSON.stringify` console logs, suggesting debugging for the logic controlling loyalty/credits/Gyftr visibility.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** Frequent updates between `17/11/2025, 23:52:04` and `18/11/2025, 12:45:43`.
    *   **Updates:** Manages discount application, display, and related UI elements.
        *   Consolidates a wide range of Svelte stores to manage discount state, including stacking, automatic discounts, gift cards, and partner offers.
        *   The `allAppliedOffers` reactive block constructs a list of applied discounts, determining their type (automatic, stacked, Cred offer), amount saved, and removability.
        *   Includes logic for re-applying credits (`store_reapplyEr`).
        *   Calculates `allowDiscountApplication` based on stacking configuration and number of clubbed discounts.
        *   Processes partner offers and filters available coupons based on screen width.
        *   Frequent minor changes (e.g., adding a `console.log`) suggest ongoing debugging and refinement of discount logic.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** Multiple updates between `18/11/2025, 12:22:24` and `18/11/2025, 12:40:55`.
    *   **Updates:** This is the main application component, orchestrating various sub-components and global state.
        *   Extensive use of Svelte stores for managing application-wide state (page, cart, merchant info, user details, analytics flags, etc.).
        *   Handles browser `onpopstate` events to manage navigation history and confirm exit flows, specifically for non-cash-to-prepaid scenarios and various popup/bottom sheet states.
        *   Includes logic for automatically showing a free gift popup if available for logged-in users.
        *   Processes `launch` messages from a parent iframe to initialize various stores with merchant-specific data, cookies, and user info.
        *   Attempts to retrieve/set session tokens from `localStorage` and cookies, with fallback for incognito mode detection.
        *   Includes duplicate `logEvent` calls for `checkout_assets_loaded` on 18/11/2025, 12:22:24, which might be a temporary debugging artifact.
        *   Adds `store_availableOffersCheck` to LoginStore imports, suggesting further integration with discount/offer logic.

### Patterns and Recurring Elements:

1.  **Svelte Stores for State Management:** A pervasive pattern is the heavy reliance on Svelte stores (`store_...`) for managing application state across different components. This indicates a highly reactive and component-based architecture where data flow is central.
2.  **Environment-Specific Configuration:** The `EnvironmentService.ts` file clearly shows the application's capability to operate in multiple environments (local, dev, qa, sandbox, production) with different API endpoints. This is crucial for development, testing, and production deployment.
3.  **Analytics Integration:** Many files, especially `ForeignAnalytics.ts`, `Merchant.svelte`, and `Contlo.ts`, are concerned with integrating various analytics platforms (Facebook Pixel, Google Analytics, WebEngage, MoEngage, Snapchat, Contlo, CleverTap, Klaviyo, etc.). There's a strong focus on tracking user actions, cart data, discounts, and payment events.
4.  **Discount and Offer Management:** The discount functionality is complex, involving:
    *   Multiple types of discounts (coupon, automatic, loyalty, gift card, Gyftr, partner acquisition).
    *   Stacking logic for discounts.
    *   Conditional application and display of discounts based on user type, cart state, and custom configurations.
    *   Confetti animations for successful discount applications.
5.  **Checkout Flow and UI Components:** `PaymentOptions.svelte`, `OrderSummary.svelte`, and `App.svelte` demonstrate a detailed checkout flow, including:
    *   Displaying payment methods and associated charges.
    *   Handling COD confirmations.
    *   Dynamically updating order summaries.
    *   Managing popups and bottom sheets for various user interactions (e.g., exit confirmation, free gifts).
6.  **Cookie and Local Storage Management:** The application frequently interacts with browser cookies and local storage to persist user sessions, tracking information (UTM parameters, Shopify session IDs), and temporary data (`kp_email`, `cash_to_prepaid`).
7.  **Debugging and Refinement:** The presence of `console.log` statements, commented-out code (especially different merchant IDs in `merchant.html`), and minor incremental changes in timestamps suggest an active development and debugging process. The `cart_total_price` validation in `Contlo.ts` and the duplicate `logEvent` in `App.svelte` are prime examples.
8.  **Security/Token Handling:** Functions like `XGokwikToken` and `getTokenName` in `EnvironmentService.ts`, along with `jwtTokensArray` and `localStorage.getItem(XGokwikToken())` in `Merchant.svelte`, indicate a system for managing session tokens securely across different environments and storage mechanisms (cookies, local storage).

In summary, the changes reflect ongoing development of a robust e-commerce checkout system with sophisticated discount handling, comprehensive analytics integration, and careful management of client-side state and browser interactions, including specific handling for different deployment environments and mobile user experiences.

## 13:01:16
The provided log details changes across several Svelte and TypeScript files within a `gokwik.pdp` project, primarily related to checkout, payment, and discount functionalities, along with environmental configurations and analytics integration.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
    *   **Key Updates:** This service manages shipping discounts and their application during checkout. It subscribes to numerous stores (`CommonStore`, `OrderStore`, `LoginStore`) to get and update state related to discounts, shipping, cart details, user info, and UI elements.
        *   **Discount & Shipping Logic:** Handles `callShippingDiscountApi` and `processShippingDiscountResponse`. It clears API timers on coupon removal, applies confetti for valid discounts, integrates with Gyftr for reapplication/removal, and manages shipping method selection based on discount responses.
        *   **Gift Cards & Cart Updates:** Includes logic to reapply or remove gift cards if the cart has been modified (`modified_cart`) and updates `store_giftCard` and `store_giftCardTotal`.
        *   **Error Handling:** Manages error messages, specifically excluding UI error messages for UTM auto-application failures.
        *   **Loyalty Integration:** Logs loyalty points applied, including details like provider, redeemed credits, and auto-application status.
        *   **Consistency:** The changes between the two timestamps appear to be identical, suggesting a re-save or re-commit without functional changes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** 13/11/2025, 14:31:15; 15/11/2025, 11:32:02; 15/11/2025, 11:32:38; 17/11/2025, 13:02:34; 17/11/2025, 22:33:16
    *   **Key Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, KP, CDN, analytics) based on the `env` variable (environment).
        *   **Environment Configuration:** Contains conditional logic to set different API endpoints for `dev`, `qa`, `sandbox`, `production`, `local`, `hdev`, `ndev`, `qa-rto`, `qaone`, `qatwo`, `dev-core`, `qa-core`, `sandbox-core`, `pci-prod`, and `idev` environments.
        *   **Localhost API URL Changes:** The `api_url` function shows a pattern of commented-out `localhost` and `api.gokwik.co` URLs, with the active `local` URL changing from `https://api.gokwik.co` (13/11/2025) to `https://sandbox.gokwik.co` (15/11/2025) and back to `https://api.gokwik.co` (17/11/2025). This indicates frequent local development testing against different environments.
        *   **Token Generation:** Includes functions `XGokwikToken` and `XKWIKPASSToken` to return environment-specific session tokens.
        *   **Consistency:** Multiple identical changes across various timestamps suggest repeated saving or CI/CD updates. The actual functional changes are limited to the `api_url` for the 'local' environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** 13/11/2025, 14:31:36; 15/11/2025, 11:32:20; 17/11/2025, 13:01:29; 17/11/2025, 22:33:43
    *   **Key Updates:** This HTML file acts as a testing ground for the GoKwik SDK, embedded within a merchant page.
        *   **SDK Initialization:** Defines `gokwikSdk` for managing checkout, events, and script loading. It initializes the SDK on `DOMContentLoaded` and via custom `initGKJS` event.
        *   **Cookie Management:** Includes `getCookieGk` and `setCookieGk` functions to manage cookies like `gk_landing_page` and `gk_orig_referrer`.
        *   **Merchant Info Configuration:** Contains a `window.merchantInfo` object with various `mid` (merchant ID) values commented out, showing different test MIDs for `qa`, `neemans`, `bsc`, `sandbox-test`, `plus store`, `prod`, `boat`, `sandbox-plus`, `qa-plus`, `qa-1`, `ww`, `sandbox-auto`, and a currently active `mid` for `local` environment. The active `mid` is frequently updated across timestamps (e.g., 'gh0pf67komht38g' -> 'eey3m1vkrm1rbo7' -> '19g6ilboxukh6' -> '19g6jlssscg1r' -> '19g6im5qdaj7w').
        *   **Analytics Script Loading:** Dynamically loads an `analytics.js` script and a custom analytics script.
        *   **UI Elements:** Includes a "click me" button to trigger `goKwikCheckout` and divs for SDK integration (`gokwik-div`) and a "privy-widget".
        *   **Consistency:** The changes between timestamps are almost exclusively to the `mid` value within `window.merchantInfo`, confirming its use as a configurable testing parameter.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** 13/11/2025, 20:56:52; 13/11/2025, 20:58:06; 13/11/2025, 21:00:07; 13/11/2025, 21:00:59; 13/11/2025, 21:01:56; 13/11/2025, 21:03:33; 13/11/2025, 21:20:47; 13/11/2025, 21:22:28; 13/11/2025, 21:23:51; 15/11/2025, 12:01:15
    *   **Key Updates:** This Svelte component handles the payment options UI and logic during checkout.
        *   **State Management:** Subscribes to numerous stores (`LoginStore`, `OrderStore`, `CommonStore`) to manage payment-related states like total price, payment methods, discounts, COD options, and user preferences.
        *   **Payment Flow:** Initiates `callPaymentMethods` on mount or after discount resolution, processes saved cards, and logs various analytics events (GTM, Shopify, Facebook).
        *   **Conditional UI:** Manages visibility of payment headers, UPI collect options, and limited payment methods based on configuration and state.
        *   **Discount & Loyalty Integration:** Updates `store_onpl` based on TwidPay and COD availability. Handles `applyRecommendedReward` and processes auto-applied offers.
        *   **New Store Import:** On 15/11/2025, 12:01:15, `store_isLoggedInUser` and `store_isCartUpdated` are imported from `CommonStore`, and `AutomaticGiftHeader` and `GiftJourney` components are imported.
        *   **`store_availableOffersCheck`:** Added to imports on 13/11/2025, 21:22:28 and 13/11/2025, 21:23:51.
        *   **Consistency:** Many identical commits, indicating frequent saving. The most significant change is the import of new stores and components. The final changes include logic for recommended options and intent flow for UPI, conditional on screen width.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** 15/11/2025, 11:49:48; 15/11/2025, 11:52:44
    *   **Key Updates:** This Svelte component displays the order summary during checkout.
        *   **Price Calculation:** Dynamically calculates `totalPrice` by subtracting various discounts (coupon, partner acquisition offer, discount-based rewards, Shopify store credit, prepaid discount, gift card, TwidPay, Gyftr) and adding shipping charges and GST.
        *   **Cart Item Handling:** Processes `cartjsObject` to update cart items, including segregating free products (BXGY logic) and adding auto-gifts.
        *   **State Subscriptions:** Subscribes to `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
        *   **Loyalty Calculation:** Includes logic to calculate `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.
        *   **New Order Summary UI:** `showNewOrderSummary` is set to `true` for a predefined set of `currentPage` values, suggesting a new UI/feature rollout.
        *   **Consistency:** The two changes are identical, likely a re-save.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** 17/11/2025, 22:38:42
    *   **Key Updates:** This Svelte component displays promotional text related to loyalty, store credits, and gift cards.
        *   **Dynamic Text:** The `loyaltyDiscountText` is dynamically generated based on the availability of gift cards, loyalty, credits, and Gyftr, and the current page (`$store_page`).
        *   **State Subscriptions:** Subscribes to `store_requestIdObject`, `store_page`, `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit`.
        *   **UI/Logic for Promotions:** Shows a `discount-text-wrapper` if any of these promotional methods are enabled and the current page is less than 3.
        *   **New Variable:** `gyftrEnabled` variable introduced.

*   **`/Users/mayuresh.mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** 17/11/2025, 13:05:00; 17/11/2025, 13:19:38; 17/11/2025, 13:45:19; 17/11/2025, 13:55:05; 17/11/2025, 14:07:01; 17/11/2025, 14:13:04; 17/11/2025, 14:13:49; 17/11/2025, 14:14:00
    *   **Key Updates:** This file integrates with the Contlo analytics SDK.
        *   **Contlo Dummy Object:** An inline `window.contlo` dummy object is defined for local testing/development, logging calls to `init`, `identify`, `track`, and `push`.
        *   **Event Tracking:** Exports `callContlo` function to handle various events: `mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, and `coupon_applied_success_gk`/`coupon_applied_failed_gk`.
        *   **Data Structuring:** The `createBody` function constructs a common payload for Contlo events, including cart details, user information (first name, last name, email, address, city, state, pincode, address type), shipping method, payment method, ABC URL, and UTM parameters.
        *   **`cart_total_price` Logic:** The `createBody` function updated its logic for `cart_total_price`. Initially, it directly used `commonAnalyticsData?.cart_after_discount`. In later versions (from 17/11/2025, 14:07:01), it adds a check (`!isNaN(Number(commonAnalyticsData?.cart_after_discount)) ? commonAnalyticsData?.cart_after_discount : commonAnalyticsData?.cart_total_price`) to ensure `cart_after_discount` is a valid number before using it, falling back to `cart_total_price` if not. This refinement improves robustness for analytics data.
        *   **`contloSendEvent`:** Wraps `window.contlo.sendEvent` in a `try-catch` block to gracefully handle cases where the Contlo SDK might not be loaded, logging a console message instead of crashing.
        *   **Consistency:** Multiple commits with identical code or minor logging changes, again indicating active development and frequent saving. The main functional change is the improved `cart_total_price` calculation.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** 17/11/2025, 12:56:56; 17/11/2025, 13:43:21; 17/11/2025, 13:44:00; 17/11/2025, 13:44:52; 17/11/2025, 14:05:25
    *   **Key Updates:** This file is responsible for integrating with various third-party analytics platforms.
        *   **State Subscriptions:** Subscribes to numerous stores from both `LoginStore` and `OrderStore`, as well as `CommonStore`, to gather comprehensive data for analytics events (e.g., cart details, user info, discount amounts, shipping methods, risk flags, UTM data).
        *   **Pixel/Analytics Configuration:** Dynamically builds a `configObject` based on `store_foreignAnalytics` and `kwikOptimizerPixelIds` to determine which analytics pixels are active.
        *   **Event Handling:** Defines `fbPixelEventsAndKeys` for mapping Facebook pixel events and includes helper functions like `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping`.
        *   **Price Breakup:** Maintains a `priceBreakup` object with details like `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
        *   **Logging `totalValue`:** On 17/11/2025, 13:44:52, a `console.log(res)` was added within the `store_totalPrice.subscribe` block. This was removed in the following commit at 17/11/2025, 14:05:25.
        *   **Consistency:** Repeated commits of mostly identical code, with a brief logging addition and removal. This suggests iterative development with frequent saves.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** 18/11/2025, 12:22:24; 18/11/2025, 12:23:52; 18/11/2025, 12:24:20; 18/11/2025, 12:24:44; 18/11/2025, 12:25:25; 18/11/2025, 12:40:55
    *   **Key Updates:** This is the main application component, orchestrating various parts of the checkout flow.
        *   **State Management:** Imports and subscribes to a vast number of Svelte stores from both `LoginStore`, `CommonStore`, and `OrderStore` to manage the entire application state.
        *   **Navigation & History:** Implements `history.pushState` for navigation control and handles `window.onpopstate` for back button functionality, including custom logic for closing popups/modals and calling analytics beacons.
        *   **Initialization Logic:** On `onMount`, it dispatches a `gokwikLoaded` event, checks the environment, loads cookies (`_shopify_s`, `_scid`, `gk_utm_source`, `_fbp`, `_fbc`, `discount_code`, `gk_landing_page`, `SP_DUID`, `gk_orig_referrer`, `_shopify_y`, `_shopify_sa_t`, `localization`, `kp_user_id`, `KWIKUSERTOKEN`, `kpmclid`, `_ga` cookies). It also handles URL parameters (`mrid`, `gkref`, `so_token`, `gk_token`) for special flows like abandon cart or token-based logins.
        *   **Message Listener:** Sets up a `window.addEventListener('message')` to handle messages from the merchant page, including 'launch' (initializing checkout with merchant info), 'cartOpen' (logging analytics when other checkouts are clicked), and 'checkoutHealth'.
        *   **Truecaller Integration:** Configures Truecaller keys for different environments.
        *   **Cookie Session Token:** A `cookieSessionToken` variable was introduced and assigned `tokenData?.coreToken` when a `gk_token` is present in the URL (17/11/2025, 18:16:05). This appears to be a variable name change from `backupToken` (17/11/2025, 18:14:56).
        *   **Logging `checkout_assets_loaded`:** There are two identical `logEvent` calls for `checkout_assets_loaded` within the `onMount` function.
        *   **Email Handling:** Logic for `kpEmail` is present, ensuring it's not a comma-separated string before setting it to `store_kpEmail`.
        *   **Incognito Check:** Includes logic to check if the browser is in incognito mode due to iframe limitations for `localStorage`.
        *   **Dynamic Discounts:** Subscribes to `store_requestIdObject` to get configurations for `dynamicAutomaticExtraDiscounts` and `dynamicAutomaticOverwriteDiscounts`.
        *   **`store_fullScreenPopUp`:** Added to imports on 18/11/2025, 12:40:55.
        *   **Consistency:** Numerous re-saves of nearly identical code. Key functional changes are limited, primarily token handling, some logging, and store imports.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** 17/11/2025, 23:52:04; 17/11/2025, 23:53:11; 17/11/2025, 23:53:19; 18/11/2025, 00:00:01; 18/11/2025, 00:02:54; 18/11/2025, 00:03:11; 18/11/2025, 00:03:40; 18/11/2025, 00:05:32; 18/11/2025, 00:08:46; 18/11/2025, 00:15:34; 18/11/2025, 00:21:40; 18/11/2025, 00:21:50; 18/11/2025, 00:22:39; 18/11/2025, 00:29:30; 18/11/2025, 12:19:54; 18/11/2025, 12:21:27; 18/11/2025, 12:23:13; 18/11/2025, 12:41:34; 18/11/2025, 12:42:12; 18/11/2025, 12:43:07; 18/11/2025, 12:45:43
    *   **Key Updates:** This Svelte component manages the display and application of discounts and offers.
        *   **Discount Application Logic:** Handles applying and removing coupons, including stacking discounts, credits, gift cards, and partner acquisition offers.
        *   **State Management:** Subscribes to numerous common and order stores to track discount codes, drawer visibility, loyalty points, cart details, offers, and payment information.
        *   **Dynamic Discount Configuration:** Retrieves `disable_discount_with_credits`, `disable_discount_with_giftcard`, `loyaltyApp`, `disable_cod_with_loyalty`, `dynamicAutomaticExtraDiscountList`, `dynamicAutomaticOverwriteDiscountList`, `isExtraAutomaticEnabled`, and `isOverwriteAutomaticenabled` from `store_requestIdObject`.
        *   **Applied Offers Display:** Dynamically constructs `allAppliedOffers` array to display automatic, stacked, coupon, and partner acquisition (Cred) discounts, including their removal logic.
        *   **Offer Filtering:** Filters available coupons based on `viewInListing` flag and screen width.
        *   **`showExperimentalDiscountPopup`:** Added to imports on 17/11/2025, 23:52:04.
        *   **`couponListUpdated`:** Added as a variable on 18/11/2025, 00:00:01.
        *   **Consistency:** This file shows the most frequent, nearly identical commits, suggesting very active, incremental development or continuous saving during a refactoring period for discount logic. The core functionality remains consistent across these many small updates.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
    *   **Timestamps:** 18/11/2025, 14:49:20; 18/11/2025, 14:50:49; 18/11/2025, 14:51:01; 18/11/2025, 14:57:07; 18/11/2025, 14:57:19; 18/11/2025, 14:58:02; 18/11/2025, 14:58:58
    *   **Key Updates:** This file seems to be a client-side integration script for the GoKwik checkout.
        *   **SDK Initialization:** `initKwikCheckout` function loads GoKwik integration and analytics scripts based on environment (sandbox/production).
        *   **Cart Fetching:** `fetchCart` function makes an XMLHttpRequest to a Shopify cart API to get cart details, then initializes the `gokwikSdk` checkout with this information.
        *   **Pixel Integration:** Dynamically creates scripts for Facebook Pixel, Google Analytics, MoEngage, and WebEngage if configured and `blockExternalEvents` is not `true`.
        *   **Listeners:** `initListeners` handles messages from the iframe for checkout health status and Shopify redirects. Also handles `hardwareBackPress` events.
        *   **UTM Parameters and Cookies:** On `DOMContentLoaded`, it parses `storeInfo` and `kp_email` from URL parameters, sets `_shopify_s` cookie for session ID, and sets various UTM-related cookies (`_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`).
        *   **`kpEmail` Parsing:** Updated `kpEmail` parsing logic on 18/11/2025, 14:58:58 to include a `try-catch` block for `atob(kpEmail)` to prevent errors if `kpEmail` is not base64 encoded.
        *   **Consistency:** Numerous identical changes, likely due to re-saves. The `kp_email` parsing improvement is the most notable functional change.

### Timestamps of Significant Changes:

*   **12/11/2025, 21:20:24:** Initial log of `ShippingDiscount.service.ts` showing comprehensive discount/shipping logic.
*   **13/11/2025, 14:31:15:** Initial log of `EnvironmentService.ts` showing varied API endpoints.
*   **13/11/2025, 14:31:36:** Initial log of `merchant.html` showing SDK integration and merchant info setup.
*   **13/11/2025, 20:56:52:** Initial log of `PaymentOptions.svelte` demonstrating complex payment state management.
*   **13/11/2025, 21:22:28 / 21:23:51:** `PaymentOptions.svelte` imports `store_availableOffersCheck`.
*   **15/11/2025, 11:32:02 / 11:32:38:** `EnvironmentService.ts` shows a change in the 'local' environment `api_url` from `api.gokwik.co` to `sandbox.gokwik.co`, then reverted shortly after.
*   **15/11/2025, 11:49:48:** Initial log of `OrderSummary.svelte` with detailed price calculation and cart item handling.
*   **15/11/2025, 12:01:15:** `PaymentOptions.svelte` imports `store_isLoggedInUser`, `store_isCartUpdated`, and new gift components (`AutomaticGiftHeader`, `GiftJourney`).
*   **17/11/2025, 12:56:56:** Initial log of `ForeignAnalytics.ts` with extensive analytics integration logic.
*   **17/11/2025, 13:05:00:** Initial log of `Contlo.ts` showing Contlo SDK integration with dummy object.
*   **17/11/2025, 14:07:01:** `Contlo.ts` updates `createBody` to make `cart_total_price` calculation more robust.
*   **17/11/2025, 18:16:05:** `Merchant.svelte` introduces `cookieSessionToken` to handle `gk_token` more robustly.
*   **17/11/2025, 22:38:42:** `Promotion.svelte` updates `loyaltyDiscountText` logic to incorporate `gyftrEnabled`.
*   **18/11/2025, 00:00:01:** `Discounts.svelte` introduces `couponListUpdated` variable.
*   **18/11/2025, 12:22:24:** Initial log of `App.svelte` showing core application logic and numerous store subscriptions.
*   **18/11/2025, 14:49:20:** Initial log of `kwik-checkout.html` showing client-side GoKwik integration.
*   **18/11/2025, 14:58:58:** `kwik-checkout.html` improves `kpEmail` decoding with a `try-catch` block.

### Patterns and Recurring Elements:

1.  **Svelte Store-Based Architecture:** A strong pattern is the extensive use of Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_requestIdObject`, `store_merchantInfo`) across almost all Svelte components (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, `Promotion.svelte`, `App.svelte`, `Discounts.svelte`). This indicates a highly reactive and centralized state management approach.
2.  **Frequent Saves/Minor Updates:** Many file paths exhibit multiple entries with identical or very slight changes in code over short periods (e.g., `PaymentOptions.svelte`, `Discounts.svelte`, `EnvironmentService.ts`, `merchant.html`, `ForeignAnalytics.ts`, `Contlo.ts`). This suggests an iterative development style, potentially with auto-saving features, or rapid testing/refactoring cycles.
3.  **Analytics Integration:** There is a heavy emphasis on tracking and integrating with various analytics platforms (Facebook, Google Analytics, MoEngage, WebEngage, Contlo, Snapchat, CleverTap, Klaviyo, etc.) as seen in `ForeignAnalytics.ts`, `Merchant.svelte`, `Contlo.ts`, and `kwik-checkout.html`. This indicates a data-driven approach to understanding user behavior and checkout performance.
4.  **Environment-Specific Configurations:** `EnvironmentService.ts` and `merchant.html` consistently show configurations that vary by development environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust deployment pipeline and testing strategy across different stages.
5.  **Discount and Payment Complexity:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files reveal intricate logic for handling various discount types (coupon codes, loyalty, gift cards, automatic discounts, stacked discounts, partner offers like Cred, Gyftr), shipping methods, and payment flows (COD, UPI, card payments, TwidPay, Shopify store credit). This suggests a feature-rich and customizable checkout experience.
6.  **Error Handling and User Experience:** The presence of `snackbar_state`, `store_persistedErrorMessage`, and `manageErrorMessages` (in `ShippingDiscount.service.ts`), along with `ConfirmPopup` in `App.svelte`, indicates a focus on providing clear feedback and graceful error handling to the user.
7.  **Performance and Optimization:** Elements like `createApiResponseQueue` in `ShippingDiscount.service.ts`, `calculateLoadTime` in `PaymentOptions.svelte` (though commented out), and `insertKeyframes` in `Merchant.svelte` suggest attention to performance and smooth user experience.
8.  **Security and Token Management:** The handling of `XGokwikToken`, `XKWIKPASSToken`, `gk_token`, `so_token`, and various cookies across `EnvironmentService.ts`, `Merchant.svelte`, and `App.svelte` points to a system that manages authentication and session tokens for secure transactions.
9.  **Ongoing Development:** The numerous, detailed changes across multiple core components suggest active and continuous development of the GoKwik checkout platform, adding features, improving robustness, and enhancing analytics capabilities.

## 14:01:18
**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
- **Timestamp**: 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
- **Key Changes**:
    - This file heavily relies on Svelte stores (`CommonStore`, `OrderStore`, `LoginStore`) for state management related to shipping, discounts, and user information.
    - It defines `callShippingDiscountApi` and `processShippingDiscountResponse` for handling discount and shipping logic.
    - The `callShippingDiscountApi` function initiates a discount/shipping call, clears a timer if a coupon is removed, and triggers a confetti animation for valid discounts. It also logs loyalty point application events.
    - The `processShippingDiscountResponse` function updates shipping methods, shipping options, and discount responses based on the API call. It also contains logic for re-applying gift cards on cart updates and calling payment methods under specific conditions.
    - Error messages are managed, with exclusions for UTM auto-application failures.
    - Logic for retrying shipping method selection in case of discount-shipping retry scenarios.
- **Pattern/Recurring Elements**:
    - Extensive use of Svelte stores (`store_...`) for reactive data management.
    - Handling of discount application, removal, and re-application logic, often intertwined with shipping options and payment methods.
    - Logging events (GTM, general `logEvent`) at various stages of discount and shipping processing.
    - Conditional logic based on `currentPage` and flags like `isAbandonCart`, `isRedirectionFlowEnabled`, `modified_cart`.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
- **Timestamp**: 13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, 17/11/2025, 13:02:34, 17/11/2025, 22:33:16, 17/11/2025, 23:34:43
- **Key Changes**:
    - This file is dedicated to defining base URLs for various GoKwik services (health, address suggestion, core API, experiment, TwidPay, KP, CDN, analytics) based on the current `env` (environment).
    - It subscribes to `store_merchanturl`, `store_environment`, and `store_cashToPrepaid` to dynamically set `merchantUrl`, `env`, and `cashToPrepaid`.
    - Multiple `api_url` definitions for different environments (dev, qa-rto, qaone, sandbox, production, qa, hdev, ndev, local, qatwo, dev-core, qa-core, sandbox-core, pci-prod, idev). The `local` environment has several commented-out URL options, indicating frequent switching during local development.
    - Functions like `XGokwikToken` and `XKWIKPASSToken` provide environment-specific tokens.
- **Pattern/Recurring Elements**:
    - Heavy use of conditional `if/else if` statements to determine API endpoints based on the `env` variable.
    - Consistent pattern of defining separate base URLs for different services across various environments.
    - The `local` environment often has commented-out alternative URLs, suggesting a development-focused setup.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
- **Timestamp**: 13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, 17/11/2025, 22:33:43
- **Key Changes**:
    - This is an HTML file serving as a "Merchant Page" to simulate integration with the GoKwik SDK.
    - It includes a `gokwikSdk` IIFE (Immediately Invoked Function Expression) which provides methods like `init`, `initCheckout`, `emit`, `on`, and `hideButton`.
    - It initializes the `gokwikSdk` on `DOMContentLoaded` and `initGKJS` custom events.
    - Functions `getCookieGk` and `setCookieGk` are defined for managing `gk_landing_page` and `gk_orig_referrer` cookies.
    - Contains a `window.merchantInfo` object with various configuration parameters, most notably `mid` and `environment`. The `mid` is frequently commented and changed across timestamps, indicating testing different merchant configurations. The `environment` is consistently set to `'local'`.
    - A button `gokwik-button` triggers `goKwikCheckout`, which in turn sends `merchantInfo` via `window.postMessage`.
    - Dynamic script injection for analytics (`analytics-js`) is present.
- **Pattern/Recurring Elements**:
    - Consistent structure for SDK integration and analytics setup.
    - Frequent changes to the `mid` within `window.merchantInfo` for testing purposes.
    - Persistent use of `environment: 'local'` for development.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
- **Timestamp**: 13/11/2025, 20:56:52, 13/11/2025, 20:58:06, 13/11/2025, 21:00:07, 13/11/2025, 21:00:59, 13/11/2025, 21:01:56, 13/11/2025, 21:03:33, 13/11/2025, 21:20:47, 13/11/2025, 21:22:28, 13/11/2025, 21:23:51, 13/11/2025, 21:25:07, 15/11/2025, 12:01:15
- **Key Changes**:
    - This Svelte component manages the payment options screen logic.
    - It imports a large number of stores from both `CommonStore` and `OrderStore` to manage various aspects of checkout (discounts, shipping, payment methods, UI states, user data, etc.).
    - On `onMount`, it initializes payment-related states, logs analytics events (GTM, Shopify), fetches saved cards, and potentially calls payment methods.
    - It subscribes to numerous stores to react to changes in total price, discount status, TwidPay rewards, Shopify store credits, etc.
    - Conditional logic to apply recommended rewards or call payment methods based on `store_placeOrder`, `store_twidPay`, and `store_shopifyStoreCredit` states.
    - Manages COD payment failed/pending states and related error messages.
    - Includes logic for displaying UPI collect, limiting payment options, and integrating with experiment variants for risk-based discounts (`UPI_RTO_EXPERIMENT`).
    - The latest changes on 15/11/2025, 12:01:15, include new imports: `store_isLoggedInUser`, `store_isCartUpdated` from `CommonStore`, and two new components `AutomaticGiftHeader` and `GiftJourney`. This suggests new functionality for handling automatic gifts and gift-related user flows.
- **Pattern/Recurring Elements**:
    - Extensive reliance on Svelte stores for intricate state management.
    - Frequent logging of analytics and GTM events.
    - Complex conditional rendering and logic based on numerous store values (e.g., `$store_twidPay.status`, `$store_page`, `isCodAvailable`).
    - Multiple subscriptions to update local component variables and trigger side effects.
    - Focus on integrating various payment methods, discounts, and loyalty programs.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
- **Timestamp**: 15/11/2025, 11:49:48, 15/11/2025, 11:52:44
- **Key Changes**:
    - This Svelte component displays the order summary, including total price calculation, discounts, and cart item details.
    - It subscribes to `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
    - The `totalPrice` calculation is complex, accounting for various discounts (coupon, loyalty, Shopify store credit, prepaid, TwidPay, Gyftr), shipping charges, COD fees, and GST.
    - `handleCartUpdate` processes `cartjsObject` to update `subTotal`, identify automatic discounts, and segregate free products (BXGY logic).
    - Introduced a `showNewOrderSummary` flag based on `currentPage`.
    - Logic for calculating `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.
- **Pattern/Recurring Elements**:
    - Deep integration with Svelte stores for real-time order summary updates.
    - Complex reactive calculations (`$: totalPrice`) to reflect various pricing components.
    - Event logging for user interaction with the order summary drawer.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
- **Timestamp**: 14/11/2025, 13:55:06, 17/11/2025, 13:00:33, 17/11/2025, 17:36:22, 17/11/2025, 17:38:18, 17/11/2025, 18:14:56, 17/11/2025, 18:16:05, 17/11/2025, 18:16:16, 17/11/2025, 18:25:21, 18/11/2025, 14:25:07, 18/11/2025, 15:10:51, 18/11/2025, 15:14:20
- **Key Changes**:
    - This Svelte component is the main merchant integration point, responsible for loading the GoKwik checkout iframe and managing its lifecycle.
    - `onMount` initializes key components: inserting CSS keyframes, dispatching `gokwikLoaded` event, checking environment (Glance), and parsing URL parameters for checkout initiation (`mrid`, `gkref`).
    - It sets various cookies and local storage items related to Shopify session, UTM parameters, FBPixel, discount codes, and Kwikpass tokens.
    - Handles incoming messages from the iframe (e.g., `merchantInfo`, `cartOpen`, `checkoutHealth`) and dispatches relevant actions.
    - Integrates Truecaller configurations for different environments, including specific keys for `local`, `dev`, `ndev`, `production`, `sandbox`, `qa`, and `qatwo`.
    - Added a `backupToken` variable (17/11, 17:38:18), which was later renamed to `cookieSessionToken` (17/11, 18:14:56) and then used to store `tokenData?.coreToken` in the `try` block for `gk_token` processing. This suggests a focus on robust token handling and fallback mechanisms.
- **Pattern/Recurring Elements**:
    - Frequent updates to cookie and local storage handling, especially for session IDs and analytics parameters (`_shopify_s`, `_fbp`, `_fbc`, `gk_landing_page`, `gk_orig_referrer`).
    - Constant refinement of `truecallerConfig` keys for different environments.
    - Consistent message passing mechanism via `window.postMessage` to communicate with the iframe.
    - Debugging `console.log(error)` for token parsing issues, indicating a focus on error resilience.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
- **Timestamp**: 17/11/2025, 12:56:56, 17/11/2025, 13:43:21, 17/11/2025, 13:44:00, 17/11/2025, 13:44:52, 17/11/2025, 14:05:25
- **Key Changes**:
    - This file manages integration with various third-party analytics platforms (CleverTap, Klaviyo, WebEngage, MoEngage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, GoogleAds).
    - It subscribes to a vast array of Svelte stores (from `LoginStore`, `OrderStore`, `CommonStore`) to collect and prepare data for analytics events.
    - The `priceBreakup` object is used to aggregate price components for analytics reporting.
    - `fbPixelEventsAndKeys` maps internal event names to Facebook pixel event names, including custom events.
    - `marketingData` collects UTM and referrer information from cookies.
    - `adSourceMapping` function processes source values (e.g., UTM parameters) for analytics.
    - There are frequent updates (though content remains largely similar across most timestamps) to ensure all relevant data points are captured from stores and formatted correctly for each analytics platform. The `console.log(res)` on 17/11/2025, 13:44:52 for `store_totalPrice` might indicate a temporary debugging step.
- **Pattern/Recurring Elements**:
    - Extensive use of Svelte stores to centralize data collection for analytics.
    - Repetitive structure of `store_X.subscribe((res) => { ... })` for extracting data from stores.
    - Definition of a `configObject` to selectively enable or disable different analytics pixels.
    - Standardized `createDataObject` and `generateTrackingData` (functions not shown in full but implied) to prepare data consistently for multiple analytics services.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
- **Timestamp**: 17/11/2025, 13:05:00, 17/11/2025, 13:19:38, 17/11/2025, 13:45:19, 17/11/2025, 13:55:05, 17/11/2025, 14:07:01, 17/11/2025, 14:13:04, 17/11/2025, 14:13:49, 17/11/2025, 14:14:00
- **Key Changes**:
    - This file specifically handles Contlo analytics integration.
    - It defines a `contlo` dummy object to log calls to `init`, `identify`, `track`, and `push` to the console if the actual Contlo SDK isn't loaded. This is a robust debugging/fallback mechanism.
    - The `createBody` function aggregates various common analytics data points (`tag`, `promo_code`, `cart_total_price`, `product_id`, `userAddress` details, `marketingData` including UTMs) into a structured object for Contlo events.
    - `callContlo` acts as a dispatcher for different Contlo events (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`/`coupon_applied_failed_gk`).
    - Each `contloX` function constructs event-specific data using `createBody` and calls `contloSendEvent`.
    - **Significant Change (17/11, 14:07:01)**: The `cart_total_price` calculation in `createBody` was modified to explicitly check `!isNaN(Number(commonAnalyticsData?.cart_after_discount))` to ensure it's a valid number before using `cart_after_discount`, falling back to `commonAnalyticsData?.cart_total_price`. This change was refined further on 17/11, 14:13:04 to `!!commonAnalyticsData?.cart_after_discount && !isNaN(discountedAmount) ? discountedAmount : commonAnalyticsData?.cart_total_price`, making the check more explicit for non-null/undefined `cart_after_discount`.
- **Pattern/Recurring Elements**:
    - Consistent structure for handling different Contlo events, each mapping to a specific function (`contloMobile`, `contloPincode`, etc.).
    - Centralized `createBody` function to ensure consistency in data sent to Contlo.
    - The `contloSendEvent` includes a `try-catch` block to gracefully handle cases where the Contlo SDK might not be available, preventing runtime errors.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
- **Timestamp**: 17/11/2025, 22:38:42
- **Key Changes**:
    - This Svelte component displays promotional text related to loyalty points, store credits, or gift cards.
    - It derives `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` from Svelte stores (`store_useStoreCredit`, `store_requestIdObject`, `store_gyftr`, `store_enableGiftCard`).
    - The `loyaltyDiscountText` is dynamically constructed based on which of these features are enabled, indicating what the user can "Login to Redeem" or "Enter OTP to Redeem".
    - It subscribes to `store_requestIdObject` to retrieve custom display names for credits and loyalty.
- **Pattern/Recurring Elements**:
    - Reactive logic (`$: (() => { ... })()`) to update displayed text based on multiple store values.
    - Conditional rendering (`{#if ...}`) to show the promotion wrapper only when applicable.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
- **Timestamp**: 17/11/2025, 23:52:04, 17/11/2025, 23:53:11, 17/11/2025, 23:53:19, 18/11/2025, 00:00:01, 18/11/2025, 00:02:54, 18/11/2025, 00:03:11, 18/11/2025, 00:03:40, 18/11/2025, 00:05:32, 18/11/2025, 00:21:40, 18/11/2025, 00:21:50, 18/11/2025, 00:22:39, 18/11/2025, 00:29:30, 18/11/2025, 12:19:54, 18/11/2025, 12:21:27, 18/11/2025, 12:23:13, 18/11/2025, 12:41:34, 18/11/2025, 12:45:43
- **Key Changes**:
    - This Svelte component manages the display and application of discounts, gift cards, and loyalty programs.
    - It imports a comprehensive set of stores from both `CommonStore` and `OrderStore` to manage discount-related states and user information.
    - `allAppliedOffers` is a reactive array that combines various types of applied discounts: automatic, stacked, manually applied coupons, and partner acquisition offers (Cred). This array is then set to `store_allAppliedDiscounts`.
    - On `onMount`, it subscribes to `store_requestIdObject` to get configuration flags for disabling discounts with credits/gift cards, loyalty app details, and dynamic automatic discount lists (extra/overwrite).
    - Logic for handling `store_reapplyEr` (reapplying credits) and `store_stackedDiscounts` (managing stacked discount configurations and `allowDiscountApplication`).
    - The `store_offers` subscription processes available discounts, filters them for display, and handles partner offers.
- **Pattern/Recurring Elements**:
    - High coupling with Svelte stores for intricate discount, loyalty, and payment interactions.
    - Complex reactive blocks (`$: { ... }`) to dynamically update the list of `allAppliedOffers` based on various store states.
    - Extensive conditional logic to determine discount eligibility, application rules, and UI visibility.
    - Focus on managing multiple types of discounts and promotions (coupons, credits, gift cards, stacked discounts, partner offers, automatic discounts).

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
- **Timestamp**: 18/11/2025, 12:22:24, 18/11/2025, 12:23:52, 18/11/2025, 12:24:20, 18/11/2025, 12:24:44, 18/11/2025, 12:25:25, 18/11/2025, 12:40:55
- **Key Changes**:
    - This is the root Svelte component for the GoKwik PDP (Payment Data Platform).
    - It imports a massive number of Svelte stores from both `LoginStore`, `CommonStore`, and `OrderStore`, indicating it orchestrates almost all state across the application.
    - `onMount` sets up global event listeners, especially for `window.onpopstate` to handle browser back button behavior and `window.addEventListener('message')` to receive messages from the parent merchant page.
    - The `onpopstate` logic is complex, managing navigation, popups, and logging back button clicks.
    - The `message` event listener processes `launch` messages from the parent, extracting and setting numerous initial parameters into various stores (e.g., `sourceValue`, `localStorageObject`, `isGlanceEnvironment`, `shopifySessionId`, `cashToPrepaidFlag`, `isSkipOtp`, `merchantInfo`, `environment`, cookies, tokens).
    - It handles token management (fetching from localStorage, setting cookies).
    - Incorporates debugging logs for `checkout_assets_loaded` events.
    - Dynamically loads AddressListing/Address components based on `getAddressComponent`.
- **Pattern/Recurring Elements**:
    - Centralized state management through an overwhelming number of Svelte store imports.
    - Deep integration with the browser's history API (`window.onpopstate`) and messaging API (`window.postMessage`, `window.addEventListener('message')`) for seamless checkout flow.
    - Extensive initialization logic on `onMount` to configure the application based on merchant and user data.
    - Frequent setting of store values based on incoming data from the parent frame.
    - The two `logEvent({ name: 'checkout_assets_loaded', ... })` calls indicate redundant logging or A/B testing.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
- **Timestamp**: 18/11/2025, 14:49:20, 18/11/2025, 14:50:49, 18/11/2025, 14:51:01, 18/11/2025, 14:57:07, 18/11/2025, 14:57:19, 18/11/2025, 14:58:02, 18/11/2025, 14:58:58
- **Key Changes**:
    - This HTML file is a wrapper for the GoKwik checkout, distinct from `merchant.html`.
    - It contains a `initKwikCheckout` function that dynamically loads the GoKwik integration script (`merchant.integration.js`) and various analytics scripts (Facebook Pixel, Google Analytics, WebEngage, MoEngage) based on `storeInfo`.
    - A `fetchCart` function makes an XHR request to `v1/user/shopify-cart` to get cart details and then initializes the `gokwikSdk` checkout.
    - `createScript`, `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, `createWebEngage` functions are responsible for injecting and initializing the respective external scripts and pixels.
    - `initListeners` sets up `window.onmessage` and `document.addEventListener('message')` to handle checkout health status and hardware back press events.
    - On `DOMContentLoaded`, it parses `storeInfo` and `kp_email` from URL parameters, and sets various cookies (`_shopify_s`, `_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`) based on `storeInfo` and UTM parameters.
    - **Significant Change (18/11, 14:58:58)**: Added a `try-catch` block when decoding `kpEmail` using `atob`, to handle potential errors during base64 decoding and ensure `window.__KP_EMAIL__` is still set even if `atob` fails.
- **Pattern/Recurring Elements**:
    - Consistent dynamic script injection for analytics and core integration.
    - Repeated use of `setCookieGk` for various tracking and session cookies.
    - Focus on robust error handling for `kp_email` decoding.
    - Centralized `initKwikCheckout` function to manage external integrations based on `storeInfo`.

**Overall Patterns and Recurring Elements**:
- **Svelte Store Dependency**: Almost all `.svelte` and `.service.ts` files extensively use Svelte stores (`store_...`) from `CommonStore`, `OrderStore`, and `LoginStore` for reactive state management and data sharing across components and services.
- **Analytics and Event Logging**: There's a strong emphasis on detailed analytics and event logging. Multiple services (`ForeignAnalytics.ts`, `EventService.ts`, `Contlo.ts`) are involved in tracking user interactions, payment steps, discount applications, and checkout health, using various platforms like GTM, Shopify, Facebook, Google Analytics, WebEngage, MoEngage, and Contlo. Events like `payment_step_landed`, `checkout_assets_loaded`, `coupon_applied_success_gk`, `address_added_gk` are frequently logged.
- **Environment-Specific Configurations**: The application frequently adapts its behavior and API endpoints based on the `environment` variable, leading to many `if/else if` blocks for different environments (`dev`, `qa`, `sandbox`, `production`, `local`, etc.). This is evident in `EnvironmentService.ts` and `Merchant.svelte`.
- **Cookie and Local Storage Management**: Consistent handling of cookies (`setCookie`, `getCookie`, `setCookieGk`) and local storage (`localStorage.setItem`, `localStorage.getItem`) for session IDs, tokens, and tracking parameters across `Merchant.svelte` and `kwik-checkout.html`.
- **Discount and Offer Management**: Complex logic for applying, re-applying, and removing various types of discounts, gift cards, and loyalty rewards is distributed across `ShippingDiscount.service.ts` and `Discounts.svelte`. This includes handling stacked discounts, automatic discounts, and partner-specific offers.
- **Modular Component Architecture**: The use of Svelte components (`PaymentOptions.svelte`, `OrderSummary.svelte`, `Discounts.svelte`, `App.svelte`) suggests a modular approach, but the heavy cross-component state management through global stores implies a tightly coupled system.
- **Debugging and Error Handling**: The presence of dummy analytics objects (`window.contlo`), `console.log` statements for errors, and `try-catch` blocks indicate an effort to make the application resilient and debuggable during development.

## 14:53:30
The log details recent development focusing on UI customization, feature enhancements, and infrastructure updates across the checkout dashboard.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (Timestamp: 16/11/2025, 13:10:34)**
    This file was updated to enhance the brand customization page. Key changes include:
    *   Implementation of logo upload functionality with validation for file types (JPEG, PNG, SVG) and size (under 2MB). It uses pre-signed URLs for direct AWS S3 uploads and includes image cleaning.
    *   Integration of a color picker for theme primary color customization, allowing merchants to control the checkout UI's branding.
    *   Dynamic loading of existing merchant logo and primary color settings into the form.
    *   Saving of brand data, including the new logo path and CSS rules, via API calls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 17/11/2025, 16:22:51)**
    This component received significant updates to its product/collection search capabilities for discount configurations:
    *   It now supports searching and displaying both individual products and collections, with options to hide search inputs or buttons.
    *   Enhanced product management allows for collating multiple variants of a product, managing quantities, and displaying min prices for grouped products.
    *   New features include `isAgentLed` filtering for items, `topUpGift` functionality for setting offered prices on gifts, and collection-specific quantity management with validation.
    *   Incorporates infinite scrolling (`useIntersectionObserver`) for search results and debounced input for efficient searching.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (Timestamp: 17/11/2025, 16:23:04)**
    The order details page was updated to provide a more comprehensive and controlled view of order information:
    *   Improved display of order status, customer information (with masked phone/email), and a detailed price breakup (discounts, taxes, shipping, gift cards, rewards).
    *   Introduced a `mergeRepeatedRefunds` function to consolidate multiple refund attempts into a single view.
    *   Enhanced refund functionality, including calculation of refundable amounts and disabling the refund button based on previous transactions.
    *   Dynamic currency formatting based on order data or merchant settings.
    *   Conditional display of RTO (Return to Origin) actions and scores based on merchant configuration and user permissions.
    *   Logic to disable order editing if specific reward or discount types are applied.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs` (Timestamp: 18/11/2025, 00:45:31)**
    This is an update to the core `index.html` template for the dashboard UI configuration application. Key changes include:
    *   Extensive integration of **New Relic browser monitoring**, with detailed configuration for distributed tracing, privacy, AJAX settings, and advanced features like session replay (including `mask_selector`, `block_selector`, `mask_input_options`).
    *   Conditional integration of **Clarity analytics** based on a `clarityKey`.
    *   Updates to `systemjs-importmap` URLs for various micro-frontend applications (`@gokwik/*`) across different deployment environments (local, dev, qa, sandbox, production).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (Timestamp: 18/11/2025, 00:49:40, 00:50:14, 00:58:39)**
    This file, appearing three times with identical content and close timestamps, indicates continued development on the free gift settings page:
    *   It provides a form-driven interface to create and manage free gift rules, including defining rule names, applicable sales channels, purchase requirements (cart value or quantity), and target products/collections.
    *   Allows configuration of free gift quantity, price, and the method of addition (automatic or customer selection with a limit).
    *   Uses `ProductSearch` to select specific products or collections for rule application.
    *   Displays gift rules in a table with options to toggle their status (enabled/disabled) and perform edit or delete actions.
    *   Includes validation logic for various input fields, such as minimum/maximum values and selection limits.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (Timestamp: 18/11/2025, 23:42:52)**
    A component designed for comprehensive customization of the order confirmation page:
    *   Structures customization options into collapsible panels, covering Brand Logo, Dynamic Banners, Trust Banners, Order Details, Customer Information, and Support & Communication.
    *   Each section offers granular control via switches to enable/disable visibility and various input fields for content, descriptions, and links.
    *   Extensive use of `ColorPickerHelper` for background and text color customization across different sections.
    *   Introduces a **drag-and-drop feature** to reorder the collapsible sections, allowing for dynamic arrangement of the confirmation page layout.

### Timestamps of Significant Changes:

*   **November 16, 2025, 13:10:34**: Focus on **Brand UI Customization**.
*   **November 17, 2025, 16:22:51 to 16:23:04**: Immediate follow-up on **Discount Product Search** and **Order Details** enhancements.
*   **November 18, 2025, 00:45:31 (early morning)**: Core infrastructure update with **New Relic and Clarity integration**, alongside micro-frontend URL management.
*   **November 18, 2025, 00:49:40 to 00:58:39 (early morning)**: Consecutive updates to **Free Gift Settings**.
*   **November 18, 2025, 23:42:52 (late evening)**: Major update to **Order Confirmation Page Customization** with drag-and-drop layout.

### Patterns and Recurring Elements:

*   **UI Customization Focus:** A consistent theme across multiple files (`brandPage.tsx`, `freeGift.tsx`, `collapseFields.tsx`) points to a strong emphasis on providing merchants with detailed control over the look and feel of the checkout and order confirmation pages.
*   **Component Reusability:** The `ProductSearch` component is designed to be versatile, used within discount settings, and `RenderField` and `ColorPickerHelper` are utility components used repeatedly for rendering form items and color choices across different customization forms.
*   **Merchant Configuration Management:** The `useMerchantConfigApi` hook is frequently used for fetching and saving merchant-specific settings, indicating a standardized approach to configuration management.
*   **Form-Driven UI:** Extensive reliance on `gokwik-ui-kit`'s `Form` component and `Form.useWatch` for handling complex form logic, validation, and conditional UI rendering.
*   **Micro-frontend Architecture:** The `index.ejs` clearly demonstrates the use of SystemJS import maps to manage and load various micro-frontend applications, indicating a modular development strategy.
*   **Observability:** The integration of New Relic and Clarity highlights a commitment to monitoring application performance and user behavior for continuous improvement, especially in production environments.
*   **Incremental Development:** The timestamps show a concentrated period of development, with updates across different but related areas of the dashboard (settings, orders, infrastructure).

## 15:00:59
`gokwik.pdp/src/common/services/ShippingDiscount.service.ts` (12/11/2025, 21:20:24 and 15/11/2025, 12:00:15):
This file is a Svelte service responsible for handling shipping and discount logic. Key updates involve:
- Extensive import of Svelte stores (`CommonStore`, `OrderStore`, `LoginStore`) for managing various states (e.g., cart, shipping, discounts, user info).
- Initialization of numerous local variables, many of which subscribe to these stores to reflect global state changes.
- The `callShippingDiscountApi` function initiates discount/shipping calls, clears API timers if a coupon is removed, processes responses, and handles loyalty discounts by logging events and showing confetti for valid discounts.
- The `processShippingDiscountResponse` function parses API responses to update shipping methods, shipping options, and discount information.
- Logic is included for re-applying or removing gift cards, handling cart updates, and invoking payment methods based on the state.
- Error message management is present, specifically excluding UI display for UTM auto-application failures.
- The logic around `currentPage` (page 7 in particular, often referring to the payment/shipping page) and interaction with `gyftr` (a gift card/reward system) indicates a detailed checkout flow.
- A `processDiscountShippingQueue` is used to manage API responses, suggesting a need for ordered processing of async operations.
- Between the two timestamps, there are no significant code changes, only a re-submission of the same content.

`gokwik.pdp/src/common/services/EnvironmentService.ts` (13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, and 17/11/2025, 13:02:34):
This file centralizes API endpoint URLs based on the current environment (dev, qa, sandbox, production, local, etc.).
- It exports variables `merchantUrl`, `env`, and `cashToPrepaid`, which are subscribed from `CommonStore` and `LoginStore`.
- Multiple functions (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`, `XGokwikToken`, `XKWIKPASSToken`) define base URLs for various services.
- A recurring pattern is the use of `if/else if` statements to determine the correct URL based on the `env` variable.
- There are commented-out `url` assignments in the `api_url` and `cdn_path` functions for `local` environment, suggesting frequent local testing and switching between different local development targets.
- Between the first and second timestamp, the `api_url` for `local` environment was changed from `https://api.gokwik.co` to `https://sandbox.gokwik.co`.
- Between the second and third timestamp, there are no significant changes, only a re-submission of the same content.
- Between the third and fourth timestamp, the `api_url` for `local` environment was changed from `https://sandbox.gokwik.co` to `https://api.gokwik.co`. This indicates a specific change in the default local API endpoint.

`gokwik.pdp/public/merchant.html` (13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, and 17/11/2025, 22:33:43):
This HTML file serves as a merchant integration page for the GoKwik SDK.
- It includes a JavaScript SDK (`gokwikSdk`) responsible for initializing the checkout process, managing events, and potentially hiding UI elements.
- Functions for setting and getting cookies (`getCookieGk`, `setCookieGk`) are defined and used to track landing page and referrer information.
- The `window.merchantInfo` object is configured with various IDs (`mid`, `storeId`, `fbpixel`) and an `environment` (typically 'local' in the provided logs), along with a `type`. This object is used to pass merchant-specific information to the GoKwik SDK.
- The file consistently loads `gokwik.js` from `http://localhost:8080/build/gokwik.js` for local development.
- Across multiple timestamps, the `mid` (merchant ID) in `window.merchantInfo` is repeatedly changed and commented out, indicating active development and testing across various merchant configurations. For example, from `'gh0yshvkmca4pw4'` to `'eey3k3mkrg55tcs'` to `'19g6jlssscg1r'` and then to `'19g6im5qdaj7w'`.

`gokwik.pdp/src/Components/place-order/PaymentOptions.svelte` (13/11/2025, 20:56:52, 13/11/2025, 20:58:06, 13/11/2025, 21:00:07, 13/11/2025, 21:00:59, 13/11/2025, 21:01:56, 13/11/2025, 21:03:33, 13/11/2025, 21:20:47, 13/11/2025, 21:23:51, and 15/11/2025, 12:01:15):
This Svelte component manages the payment options screen in the checkout flow.
- It imports a large number of stores from `CommonStore` and `OrderStore` to manage payment-related states, discounts, user information, and UI elements.
- Numerous local variables are declared for pricing, payment methods, discount status, and UI flags.
- The `onMount` lifecycle hook contains logic for initializing payment-related states, fetching saved cards, logging GTM and Shopify analytics events, and handling skipped payment flows.
- It subscribes to many Svelte stores to react to changes in total price, discount status, shipping options, and more.
- The component dynamically updates `isCodAvailable` based on whether a TwidPay reward is applied, indicating interaction between payment methods and rewards.
- Between 13/11/2025, 21:20:47 and 13/11/2025, 21:23:51, `store_availableOffersCheck` was added to the imports from `common/stores/OrderStore`.
- At 15/11/2025, 12:01:15, `store_isLoggedInUser` and `store_isCartUpdated` were added to imports from `common/stores/CommonStore`. Additionally, `AutomaticGiftHeader` and `GiftJourney` components were imported, suggesting the integration of free gift related UI.

`gokwik.pdp/src/Components/place-order/OrderSummary.svelte` (15/11/2025, 11:49:48 and 15/11/2025, 11:52:44):
This Svelte component displays the order summary during checkout.
- It subscribes to several stores (`LoginStore`, `CommonStore`, `OrderStore`) to retrieve and react to changes in cart details, discounts, shipping, and loyalty information.
- Key variables track `totalPrice`, `subTotal`, `couponDiscount`, `prepaidDiscount`, `codCharges`, `giftcardTotal`, `loyaltyDisplayAmount`, and `automaticDiscount`.
- The `totalPrice` is a reactive variable (`$:`) that recalculates based on various discounts, shipping costs, COD charges, gift cards, TwidPay rewards, GST, and Gyftr amounts. This highlights complex pricing logic.
- The `handleCartUpdate` function processes cart items, segregates free products, and calculates the `subTotal` and `automaticDiscount`.
- It also logs GTM and GA4 events related to viewing the order summary, indicating analytics tracking.
- There are no significant code changes between the two timestamps.

`gokwik.pdp/src/merchant/Merchant.svelte` (14/11/2025, 13:55:06, 17/11/2025, 13:00:33, 17/11/2025, 17:36:22, 17/11/2025, 18:14:56, 17/11/2025, 18:16:05, 17/11/2025, 18:16:16, and 18/11/2025, 14:25:07):
This Svelte component acts as the main entry point for the GoKwik merchant integration.
- It imports various analytics services (`CleverTap`, `Klaviyo`, `Wigzo`, `WebEngage`, `Moengage`, `Facebook`, `GAanalytics`, `Growlytics`, `Contlo`, `GA4`, `Netcore`, `Snapchat`, `edgetag`, `CustomerLabs`, `ShopifyAnalytics`, `GoogleAds`) indicating a comprehensive analytics integration.
- It also imports helper functions for cookie management, environment checks, and URL parsing.
- The `onMount` lifecycle hook initializes keyframes for animations, dispatches a 'gokwikLoaded' event, sets up environment and source URLs, and handles various query parameters (`mrid`, `gkref`, `so_token`, `gk_token`).
- It processes messages from the parent window, specifically 'merchantInfo' to launch the app and 'checkoutHealth' to check the checkout status.
- It sets cookies and local storage items related to user sessions, discounts, and analytics.
- A `truecallerConfig` object holds API keys for different environments, suggesting mobile-first authentication.
- A `sessionIDFixMerchants` array is used to exclude certain merchants from a Shopify session ID fix.
- Between 17/11/2025, 17:38:18 and 17/11/2025, 18:14:56, a new variable `cookieSessionToken` was introduced and used to store `tokenData?.coreToken`. This variable was then further modified, storing `tokenData?.coreToken` in `backupToken` initially, then directly into `cookieSessionToken` in subsequent changes.
- Across multiple timestamps, there are minor changes in comments and variable assignments related to `token` and `cookieSessionToken`, indicating debugging or refinement of token handling.

`gokwik.pdp/src/common/services/ForeignAnalytics.ts` (17/11/2025, 12:56:56, 17/11/2025, 13:43:21, 17/11/2025, 13:44:00, 17/11/2025, 13:44:52, and 17/11/2025, 14:05:25):
This file is dedicated to integrating with various foreign analytics platforms.
- It imports numerous Svelte stores to collect a wide range of data points, including discount codes, user types, order details, cart information, shipping methods, and pricing breakdowns.
- It defines many local variables to hold analytics-related data like `cart`, `risk_flag`, `commonAnalyticsData`, `coupon`, `phoneNumber`, `priceBreakup`, etc.
- It subscribes to most of the imported stores to keep its internal data structures (`priceBreakup`, `commonAnalyticsData`, `marketingData`) updated for analytics events.
- It defines `fbPixelEventsAndKeys` for mapping internal events to Facebook Pixel event names, including custom events.
- It processes `store_foreignAnalytics` to dynamically enable/disable various analytics pixels (e.g., `netcore`, `fb`, `customerlabs`).
- The `createDataObject` and `generateTrackingData` functions (not fully shown in the log) are crucial for preparing data for external analytics calls.
- The `adSourceMapping` function parses UTM parameters, indicating a focus on tracking marketing campaign effectiveness.
- Between 17/11/2025, 13:43:21 and 17/11/2025, 13:44:00, there is a minor change to add `console.log(res)` within the `store_totalPrice` subscription, likely for debugging the total value. This line was then removed in the next change, indicating a temporary debug addition.

`gokwik.pdp/src/merchant/Analytics/Contlo.ts` (17/11/2025, 13:05:00, 17/11/2025, 13:19:38, 17/11/2025, 13:45:19, 17/11/2025, 13:55:05, 17/11/2025, 14:07:01, 17/11/2025, 14:13:04, and 17/11/2025, 14:13:49, 17/11/2025, 14:14:00):
This file integrates with the Contlo analytics SDK.
- It defines a dummy `window.contlo` object with `init`, `identify`, `track`, and `push` methods, primarily for logging Contlo-related activities during development without a live SDK.
- The `createBody` function is central, preparing a standardized data object for Contlo events, including `promo_code`, `cart_total_price`, `product_id`, user details, shipping info, and UTM parameters.
- The `callContlo` function acts as a dispatcher for various checkout events (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`, `coupon_applied_failed_gk`).
- The specific event handlers (`contloMobile`, `contloPincode`, etc.) populate the `createBody` data with event-specific details.
- The `contloSendEvent` function wraps the call to the actual `window.contlo.sendEvent`, including a `try-catch` block to handle cases where the SDK is not found.
- At 17/11/2025, 13:19:38, the `window.contlo` dummy object was removed from the top of the file, implying that a real Contlo SDK might be loaded externally or that the dummy was no longer needed for that specific context.
- At 17/11/2025, 13:45:19, `console.log(data)` was added to `contloAddressAdded` for debugging, which was removed at 17/11/2025, 13:55:05.
- At 17/11/2025, 14:07:01, the `cart_total_price` in `createBody` was updated to check if `commonAnalyticsData?.cart_after_discount` is a valid number, and if so, use it; otherwise, fall back to `commonAnalyticsData?.cart_total_price`.
- At 17/11/2025, 14:13:04, the `cart_total_price` logic in `createBody` was further refined to explicitly use a `discountedAmount` variable and check `!!commonAnalyticsData?.cart_after_discount`. The same change was repeated in subsequent timestamps, likely indicating re-saves or minor formatting.

`gokwik.pdp/src/Components/common/Promotion.svelte` (17/11/2025, 22:38:42):
This Svelte component displays promotional text related to loyalty points, store credits, and gift cards.
- It imports `store_requestIdObject` from `CommonStore` and `store_page` from `LoginStore`, along with `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit` from `OrderStore`.
- It defines reactive variables (`loyaltyDisplayName`, `loyaltyDiscountText`, `creditsDisplayName`, `loyaltyEnabled`, `creditsEnabled`, `gyftrEnabled`) that dynamically update based on store values.
- The reactive block (`$:`) calculates `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` and constructs the `redeemableText` and `loyaltyDiscountText` based on which promotions are active and the current page.
- The `onMount` hook subscribes to `store_requestIdObject` to fetch custom display names for credits and loyalty.
- The component conditionally renders the promotional text if any of the promotion types are enabled and the current page is less than 3 (likely login/OTP pages).

`gokwik.pdp/src/App.svelte` (18/11/2025, 12:22:24, 18/11/2025, 12:23:52, 18/11/2025, 12:24:20, 18/11/2025, 12:24:44, and 18/11/2025, 12:25:25):
This is the main application component, orchestrating the entire checkout flow in Svelte.
- It imports a vast number of stores from `LoginStore`, `CommonStore`, and `OrderStore` to manage all aspects of the application state.
- It imports numerous components for different parts of the checkout (Address, Snackbar, Header, MobilePhoneInput, PaymentOptions, OtpInput, CodOrder, QrCode, Footer, OrderSuccessful, etc.).
- The `onMount` hook includes extensive initialization logic:
    - Setting up a `window.onpopstate` handler for back button navigation, with complex logic for different checkout pages and popup states.
    - Subscribing to `store_isLoggedInUser` to potentially show a free gift popup.
    - Subscribing to `store_confirmClose` to manage an exit confirmation popup.
    - Event listener for 'launch' messages to initialize various global stores (`sourceValue`, `localStorageObject`, `shopifySessionId`, `cashToPrepaidFlag`, `isSkipOtp`, `merchanturl`, `merchantInfo`, `environment`, `channelSource`, `channel`, `isHydrogen`, `gaCookies`, `mid`, `kwikKey`, `snapchatAttributes`).
    - Handles token management (reading from localStorage/cookies) and checks for incognito mode.
    - Sets view properties (mobile/desktop) based on parent width.
    - Logs 'checkout_assets_loaded' events with network information.
    - Logic for applying discount codes passed via event data.
- The component dynamically renders different sub-components based on `currentPage`.
- Between the multiple timestamps, there are no significant code changes, only re-saves or minor formatting.

`gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte` (17/11/2025, 23:52:04, 17/11/2025, 23:53:11, 17/11/2025, 23:53:19, 18/11/2025, 00:00:01, 18/11/2025, 00:02:54, 18/11/2025, 00:03:11, 18/11/2025, 00:03:40, 18/11/2025, 00:05:32, 18/11/2025, 00:08:46, 18/11/2025, 00:15:34, 18/11/2025, 00:21:40, 18/11/2025, 00:21:50, 18/11/2025, 00:22:39, 18/11/2025, 00:29:30, 18/11/2025, 12:19:54, 18/11/2025, 12:21:27, 18/11/2025, 12:23:13, 18/11/2025, 12:41:34, 18/11/2025, 12:43:07, and 18/11/2025, 12:45:43):
This Svelte component is dedicated to managing and displaying discounts and offers in the checkout process.
- It imports a wide array of stores from `CommonStore` and `OrderStore` to access and modify discount-related states (e.g., `discountCode`, `offers`, `stackedDiscounts`, `giftCardTotal`).
- It includes logic for applying and removing various types of discounts, including regular coupons, automatic discounts, stacked discounts, partner offers (like CredPay), gift cards, loyalty points, and Gyftr.
- The component maintains several boolean flags to control UI visibility and feature enablement (e.g., `discountCouponApplied`, `creditsApplied`, `showViewOffers`, `showOffersListing`, `disableGiftCards`, `allowDiscountApplication`).
- The reactive block (`$:`) dynamically constructs `allAppliedOffers` based on applied automatic, stacked, coupon-based, and partner acquisition offers, which is then set to `store_allAppliedDiscounts`. This is a central piece of logic for displaying active discounts.
- The `onMount` hook subscribes to `store_requestIdObject` to get configuration flags like `disable_discount_with_credits`, `disable_discount_with_giftcard`, and dynamic automatic discount lists.
- It also handles re-applying credits, processing partner offers, and calculating the length of available coupons.
- It includes conditional rendering for various discount-related UI elements such as `WalletCredits`, `AvailableOffers`, `GiftCard`, `CredPayApplied`, `Gyftr`, `TwidPay`, and `ExperimentCouponPopup`.
- Between the numerous timestamps (all within 17/11/2025 and 18/11/2025), there are no significant code changes observed. The repetitive entries suggest frequent saving or automated commits without substantive functional alterations.

`gokwik.pdp/public/kwik-checkout.html` (18/11/2025, 14:49:20, 18/11/2025, 14:50:49, 18/11/2025, 14:51:01, 18/11/2025, 14:57:07, 18/11/2025, 14:57:19, and 18/11/2025, 14:58:02, 18/11/2025, 14:58:58):
This HTML file is a public-facing checkout page that integrates the GoKwik SDK.
- It defines a `getApiUrl` function to determine API endpoints based on the environment (sandbox or production).
- It includes `setCookieGk` for setting cookies.
- The `fetchCart` function makes an XHR POST request to a Shopify cart API to retrieve cart details, which are then used to initialize the GoKwik SDK. It also sets `merchantInfo.appFlow` to `true` and adds `source`, `platform`, and `tag` attributes to the cart.
- The `initKwikCheckout` function is responsible for dynamically loading GoKwik integration scripts and various third-party analytics pixels (Facebook Pixel, Google Analytics, WebEngage, MoEngage) based on `storeInfo`.
- Functions like `createScript`, `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, and `createWebEngage` dynamically inject the necessary `<script>` tags into the document head.
- `initListeners` sets up a `window.onmessage` handler to react to `checkoutHealth` and `shopifyRedirect` events, triggering a `gk-checkout-disable` custom event if necessary. It also listens for 'hardwareBackPress' messages.
- The `DOMContentLoaded` listener parses `storeInfo` and `kp_email` from URL parameters, sets related cookies, and initializes the `initKwikCheckout` function.
- Between 18/11/2025, 14:57:07 and 18/11/2025, 14:58:02, `window.__KP_EMAIL__ = kpEmail;` was added before `kpEmail = atob(kpEmail);` in the `DOMContentLoaded` listener to ensure `__KP_EMAIL__` is set even if `atob` fails, which indicates a refinement in handling `kp_email` decoding. This was then further refined at 18/11/2025, 14:58:58 to include a `try-catch` block around `atob(kpEmail)` for `window.__KP_EMAIL__` and `localStorage.setItem('kp_email', kpEmail)` and setting `window.__KP_EMAIL__ = kpEmail;` outside the `try` block.

**General Patterns and Recurring Elements:**

1.  **Svelte Store-based State Management:** A pervasive pattern is the extensive use of Svelte stores (`store_...`) from `CommonStore`, `OrderStore`, and `LoginStore` across multiple `.svelte` and `.ts` files. This indicates a highly reactive and centralized state management architecture. Components subscribe to these stores (`.subscribe((res) => (variable = res))`) and use reactive declarations (`$:`) to update UI or logic when store values change.
2.  **API Endpoint Configuration:** `EnvironmentService.ts` consistently defines API URLs based on the `env` variable, demonstrating a robust environment-specific configuration strategy for various services (health, address, core API, experiments, CDN, analytics, etc.). There are frequent minor adjustments to local environment URLs, suggesting active development and testing.
3.  **Analytics Integration:** There's a strong emphasis on integrating with multiple analytics platforms (CleverTap, Klaviyo, WebEngage, Moengage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, edgetag, CustomerLabs, ShopifyAnalytics, GoogleAds). This is evident in `Merchant.svelte` importing all these services and `ForeignAnalytics.ts` acting as a central hub for data preparation and dispatch to these services. The `Contlo.ts` file shows event-specific data structuring and logging.
4.  **Checkout Flow Logic:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files demonstrate intricate logic for managing a multi-step checkout process, including:
    *   Applying/removing discounts (coupons, automatic, stacked, partner-based).
    *   Handling gift cards and loyalty points.
    *   Processing shipping options and methods.
    *   Managing COD (Cash on Delivery) confirmation and charges.
    *   Reacting to cart updates and user interactions.
    *   Conditional UI rendering based on applied offers or payment states.
5.  **Cookie and Local Storage Management:** Both `merchant.html` and `Merchant.svelte` heavily rely on cookies and local storage for persisting session information, user tokens, UTM parameters, and various checkout-related flags. Functions like `getCookieGk`, `setCookieGk`, `setCookie`, `getCookie`, `localStorage.setItem`, `localStorage.getItem` are frequently used.
6.  **URL Parameter Handling:** Query parameters in the URL (`mrid`, `gkref`, `so_token`, `gk_token`, `kp_email`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid`, `utmParams`) are actively parsed and used to initialize the application state and track user journeys.
7.  **Dynamic Script Loading:** `kwik-checkout.html` dynamically loads integration scripts and analytics pixels, allowing for flexible and environment-specific inclusion of external resources.
8.  **Event Logging:** `logEvent` (from `EventService.ts`) and `fireGtmEvent` are widely used across components and services to track user actions and application states for analytics and debugging.
9.  **Debugging Practices:** The presence of `console.log` statements, commented-out code blocks, and temporary variable assignments (`backupToken`) indicates ongoing development, testing, and debugging efforts.
10. **Consistent Timestamp Pattern:** The timestamps indicate work occurring primarily on December 11th, 13th, 14th, 15th, and 17th-18th, 2025, often with multiple changes to the same file within a short period, suggesting focused work sessions on specific components.