# Activity Summary for 19/11/2025

## 11:53:15
The provided log details changes across multiple files in a dashboard UI, focusing on customization, order management, and discounts.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file, responsible for the brand customization page, received updates related to logo upload functionality and theme color management.
    *   It includes logic for validating image files (type, size), handling uploads to AWS S3, and fetching pre-signed URLs.
    *   The form (`Form.useForm()`) manages `brand_data`, including `logo`, `logoImg`, and `cssRules.primaryColor`.
    *   `useEffect` hooks are used to initialize logo data from `merchant_details` and update primary color from `config.custom_config`.
    *   The component renders UI for uploading a logo, displaying a preview, and a color picker for the primary theme color.
    *   Saving changes (`onFinish`) involves updating the merchant logo via API and saving configuration.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51)
    *   This component manages product and collection search functionality for discounts.
    *   It was updated to support collating products (grouping variants under a single product), handling quantities for collections, and filtering products based on tags for 'agent-led' scenarios.
    *   The `parseResponse` function was modified to correctly group product variants when `collateProducts` is true and to handle filtering for `isAgentLed` items.
    *   New props like `collateProducts`, `showQuantity`, `alloweditemscount`, `hideSearchInput`, `isAgentLed`, `topUpGift`, and `collectionSpecificData` were introduced.
    *   Logic for incrementing/decrementing item quantities and handling gift prices was added.
    *   The UI renders search input, a modal for search results with checkboxes for selection, and displays selected products/collections with their details and quantity controls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file, for displaying order details, received significant updates to its data processing and display logic.
    *   New helper functions `formatCurrency` and `formatAmountWithCurrency` were introduced for improved currency formatting.
    *   A `mergeRepeatedRefunds` function was added to aggregate multiple refund attempts for a single `gokwik_rid` and determine the final status (`Completed`, `Failed`, `Initiated`).
    *   The `fetchOrderDetails` function now handles various price breakup components (discounts, taxes, shipping, gift cards, rewards, store credits) and calculates the total refundable amount, setting the state for the refund button.
    *   It includes logic to set an `editTitle` and `disableEdit` state based on applied rewards, GWP discounts, or loyalty points.
    *   Improved handling for `is_deleted` and `is_auto_refund` flags for transactions.
    *   Introduced `order_failure_reason` and `showRTOActions` logic.
    *   The component leverages `useMemo` for `discountBreakup` calculation to optimize performance.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Timestamp: 18/11/2025, 00:45:31)
    *   This EJS template defines the structure of the dashboard UI.
    *   It includes a Content Security Policy (CSP) for security.
    *   The primary change involves updating the `systemjs-importmap` configurations for various environments (`local`, `dev`, `qa`, `sandbox`, `production`).
    *   Specific Micro-frontend applications (e.g., `@gokwik/configuration`, `@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/checkout`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, `@gokwik/shopify-app`, `@gokwik/kwikcomm`) now point to their respective deployment URLs based on the `deployedEnv` variable.
    *   New Relic and Clarity analytics scripts are conditionally included for the `production` environment.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Timestamp: 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, 18/11/2025, 00:58:39)
    *   These three entries show identical code changes, indicating repeated saves or minor, non-substantive changes in quick succession.
    *   This file manages the Free Gift settings.
    *   It defines a `FreeGift` component with state for rules, editing, and changes.
    *   The `useMerchantConfigApi` hook is used for fetching and saving configuration.
    *   It uses `Form.useWatch` to react to changes in free gift configuration, specific products/collections, free product, application method, and applicable on settings.
    *   An `initialValues` object defines the default configuration for auto gift rules.
    *   `useEffect` is used to update breadcrumbs for navigation.
    *   The `fields` array defines the structure and validation rules for a dynamic form, including input, checkbox, radio, inputNumber, and search types, with conditional visibility (`hideControlInput`, `hidden`) based on other form values.
    *   The `columns` array defines the structure for a table to display free gift rules, including name, free gift product (with image), status (toggle switch), and actions (edit/delete dropdown).
    *   `handleEdit`, `handleDelete`, `handleAddFreeGiftProduct`, and `handleRemoveFreeGiftProduct` functions manage the state of free gift rules and their associated products.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component organizes various UI customization fields for the order confirmation page into collapsible sections.
    *   It uses `Form.useWatch` to react to changes in `customize` data.
    *   The component defines separate field configurations (`orderDetailFields`, `customerInformationFields`, `supportDetailFields`) for different sections of the order confirmation page, including switches for enabling/disabling sections, input fields for text, and `ColorPickerHelper` for background and text colors.
    *   The `items` array structures these sections into a `Collapse` component, allowing each section to be toggled, with an additional switch in the `extra` prop for enabling/disabling the entire section.
    *   It integrates other components like `LogoPage`, `RenderEditorFunction` (for dynamic banners), and `TrustBadgeForm`.
    *   Introduces drag-and-drop functionality for reordering collapse items, allowing users to customize the layout of the order confirmation page fields.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34**: Significant updates to brand customization, particularly logo upload and theme color.
*   **17/11/2025, 16:22:51**: Major enhancements to product/collection search, including product collation, quantity management, and filtering.
*   **17/11/2025, 16:23:04**: Substantial changes to order details display, refund logic, and currency formatting.
*   **18/11/2025, 00:45:31**: Core infrastructure update with environment-specific import map configurations and analytics scripts in `index.ejs`.
*   **18/11/2025, 23:42:52**: Introduction of drag-and-drop and extensive customization options for the order confirmation page.

### Patterns or Recurring Elements:

*   **`useMerchantConfigApi` Hook**: Frequently used across `BrandPage` and `FreeGift` components for fetching, updating, and saving merchant-specific configurations, indicating a centralized configuration management system.
*   **Form Management with Ant Design (Gokwik-UI-Kit)**: Extensive use of `Form.useForm()`, `Form.Item`, `Form.useWatch`, and `form.setFieldsValue()` for managing form state, validation, and interaction, particularly in `BrandPage`, `FreeGift`, and `collapseFields`.
*   **Dynamic UI Rendering with `RenderField`**: The `RenderField` utility component is used to dynamically render various form input types based on a configuration array (e.g., in `FreeGift` and `collapseFields`), promoting reusability and declarative UI construction.
*   **Customization and Configuration**: A strong theme of enabling merchants to customize various aspects of the checkout UI (brand logo, theme color, order confirmation page sections, free gift rules).
*   **API Interactions**: Frequent use of `makeAPICall` and `makeAWSPutCall` for backend communication (e.g., fetching order details, uploading images, saving configurations).
*   **Breadcrumb Navigation**: `updateBreadcrumbs` utility is used in `FreeGift` to manage consistent navigation paths across the application.
*   **Date Formatting and Currency Handling**: Specific helper functions (e.g., `formatAmount`, `setCurrencySymbol`, newly added `formatCurrency` and `formatAmountWithCurrency`) are used to ensure consistent display of numerical and monetary values.
*   **Timestamp Proximity**: The three identical `freeGift.tsx` entries on 18/11/2025 suggest either rapid iteration, minor non-functional changes, or repeated saves without actual code differences being logged.
*   **Environment-Specific Deployments**: The `index.ejs` file clearly demonstrates a pattern of setting up different Micro-frontend module URLs based on the deployment environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust CI/CD and deployment strategy.
*   **New Relic Integration**: The `index.ejs` also shows a pattern of integrating New Relic monitoring for performance and error tracking, specifically in the production environment.

## 12:00:41
The provided log details changes across several files, primarily focusing on checkout, payment, and analytics functionalities within a SvelteKit application.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** Consistent updates on `12/11/2025, 21:20:24` and `15/11/2025, 12:00:15`.
    *   **Updates:** This service is heavily involved in managing discounts and shipping options.
        *   Numerous Svelte stores are subscribed to, indicating a highly reactive and state-driven component.
        *   The `callShippingDiscountApi` function handles discount application, removal, and combination calls. It includes logic for clearing API timers, displaying confetti for successful discounts (conditional on user type and redirection flow), and handling Gyftr rewards.
        *   Error handling for invalid discount channels is present.
        *   `processShippingDiscountResponse` further processes API responses, updating shipping methods, discounts, and handling gift card reapplication on cart updates.
        *   Specific fixes for issues like `CHECKOUT-15842` (GiftCard on Cart Update) and `CHECKOUT-12982` (Payment Methods on Shipping Options) are noted.
        *   New logic for UTM auto-apply discount/shipping options failure is added, which prevents displaying an error message on the UI in such cases.
        *   Introduces logic for `discount_shipping_retry` based on available shipping options.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:15` and `17/11/2025, 23:34:43`.
    *   **Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, analytics) based on the environment (dev, qa, sandbox, production, local).
        *   Consistently updates the `api_url` for the `local` environment, switching between different development/production endpoints, indicating active testing and environment configuration changes.
        *   The `XGokwikToken` and `XKWIKPASSToken` functions dynamically return session tokens based on the environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:36` and `17/11/2025, 23:35:35`, and then more on `18/11/2025` around `14:50:00`.
    *   **Updates:** This is a merchant integration HTML file.
        *   The `gokwikSdk` is defined to manage checkout initiation, event handling (`on`, `emit`), and UI interactions like hiding buttons.
        *   Initial script loading (`gokwik.js`) and event listeners (`DOMContentLoaded`, `initGKJS`) are present.
        *   Cookie management (`getCookieGk`, `setCookieGk`) for tracking landing page and referrer is included.
        *   The `window.merchantInfo` object, crucial for merchant-specific configurations like `mid`, `environment`, `storeId`, and `fbpixel`, is frequently updated (different `mid` values are commented out, suggesting testing across multiple merchant IDs).
        *   The `initKwikCheckout` function (in `kwik-checkout.html` variant) loads integration and analytics scripts dynamically.
        *   Listeners for `checkoutHealth` and `shopifyRedirect` are present, which trigger a custom event `gk-checkout-disable` for fallback.
        *   Recent changes in `kwik-checkout.html` (18/11/2025) include adding `window.__KP_EMAIL__ = kpEmail;` which suggests handling Kwikpass email information more directly in the global scope.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** Frequent updates on `13/11/2025` (multiple times around `20:56:52` to `21:25:07`) and `15/11/2025, 12:01:15`.
    *   **Updates:** This Svelte component is central to payment options display and logic.
        *   Imports a vast array of Svelte stores from `CommonStore` and `OrderStore`, highlighting a highly interconnected and stateful component.
        *   Manages various payment-related states: `totalPrice`, `screen_width`, `codPaymentFailed`, `availableAutoOffers`, `recommendedOptions`.
        *   Initializes tracking events on mount (`payment_step_landed`, `AddPaymentInfo`).
        *   Includes logic for applying recommended TwidPay rewards, fetching Shopify credits, and handling COD confirmation.
        *   Filters and reorders `availableAutoOffers` based on payment methods and screen width.
        *   Introduces `store_availableOffersCheck`, `store_isLoggedInUser`, `store_isCartUpdated` in the latest version (15/11/2025), indicating more granular control over offer display and user state.
        *   Adds `AutomaticGiftHeader` and `GiftJourney` components in the latest update, suggesting new features for free gift management.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** Consistent updates on `15/11/2025, 11:49:48` and `15/11/2025, 11:52:44`.
    *   **Updates:** This component manages the order summary display.
        *   Calculates `totalPrice` based on `subTotal`, various discounts (coupon, prepaid, partner acquisition, gift card, loyalty, Gyftr), shipping, and COD charges.
        *   Handles logic for displaying automatic discounts and segregating free products (BXGY offers).
        *   Includes subscriptions to numerous stores (`cartjsObject`, `discountAmount`, `prepaidDiscount`, `codCharges`, `selectedShippingMethod`, `giftCardTotal`, etc.) to reactively update the summary.
        *   Introduces `lineItemEdds` and `earnedLoyaltyDetails` to influence loyalty display amount calculations.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 13:05:00` and `17/11/2025, 14:14:00`.
    *   **Updates:** This file integrates with Contlo analytics.
        *   Initially, it defined a dummy `window.contlo` object, but subsequent updates remove this, implying the actual Contlo SDK is expected to be present.
        *   Consolidates `createBody` function to prepare data for Contlo events, including product IDs, promo code, cart total, and UTM marketing data.
        *   Defines functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) to call `contloSendEvent` with specific event names and data.
        *   A key change in the `createBody` function (17/11/2025, 14:07:01) is to ensure `cart_total_price` is a valid number by checking `!isNaN(Number(commonAnalyticsData?.cart_after_discount))`. This is further refined to check for `!!commonAnalyticsData?.cart_after_discount` (17/11/2025, 14:13:04), indicating a robustness improvement for handling `cart_after_discount` values.
        *   `contloSendEvent` is wrapped in a try-catch block, logging an error if `window.contlo.sendEvent` is not found, suggesting more robust error handling for external SDKs.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 12:56:56` and `17/11/2025, 14:05:25`.
    *   **Updates:** This service is responsible for integrating various third-party analytics platforms.
        *   Imports and subscribes to a vast number of Svelte stores related to user data, cart information, discounts, and merchant configurations.
        *   Maintains a `priceBreakup` object to aggregate financial details for analytics.
        *   Manages `fbPixelEventsAndKeys` for Facebook pixel custom events.
        *   Dynamically builds `configObject` based on `store_foreignAnalytics` to enable/disable different analytics pixels.
        *   Includes logic to integrate `kwikOptimizerPixelIds` with Facebook custom events.
        *   The `generateTrackingData` function is called reactively when `cartjsObject` or `totalPrice` updates.
        *   A `console.log(res)` was added to the `store_totalPrice` subscription on 17/11/2025, 13:55:47, likely for debugging purposes, and then removed in the next commit.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** `17/11/2025, 22:38:42`.
    *   **Updates:** Displays promotional text related to loyalty points, store credits, and gift cards.
        *   Dynamically constructs `redeemableText` based on the availability and enablement of loyalty, credits, and Gyftr features.
        *   The `loyaltyDiscountText` message is conditional on the current page (`$store_page`).
        *   Includes several `JSON.stringify` console logs, suggesting debugging for the logic controlling loyalty/credits/Gyftr visibility.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** Frequent updates between `17/11/2025, 23:52:04` and `18/11/2025, 12:45:43`.
    *   **Updates:** Manages discount application, display, and related UI elements.
        *   Consolidates a wide range of Svelte stores to manage discount state, including stacking, automatic discounts, gift cards, and partner offers.
        *   The `allAppliedOffers` reactive block constructs a list of applied discounts, determining their type (automatic, stacked, Cred offer), amount saved, and removability.
        *   Includes logic for re-applying credits (`store_reapplyEr`).
        *   Calculates `allowDiscountApplication` based on stacking configuration and number of clubbed discounts.
        *   Processes partner offers and filters available coupons based on screen width.
        *   Frequent minor changes (e.g., adding a `console.log`) suggest ongoing debugging and refinement of discount logic.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** Multiple updates between `18/11/2025, 12:22:24` and `18/11/2025, 12:40:55`.
    *   **Updates:** This is the main application component, orchestrating various sub-components and global state.
        *   Extensive use of Svelte stores for managing application-wide state (page, cart, merchant info, user details, analytics flags, etc.).
        *   Handles browser `onpopstate` events to manage navigation history and confirm exit flows, specifically for non-cash-to-prepaid scenarios and various popup/bottom sheet states.
        *   Includes logic for automatically showing a free gift popup if available for logged-in users.
        *   Processes `launch` messages from a parent iframe to initialize various stores with merchant-specific data, cookies, and user info.
        *   Attempts to retrieve/set session tokens from `localStorage` and cookies, with fallback for incognito mode detection.
        *   Includes duplicate `logEvent` calls for `checkout_assets_loaded` on 18/11/2025, 12:22:24, which might be a temporary debugging artifact.
        *   Adds `store_availableOffersCheck` to LoginStore imports, suggesting further integration with discount/offer logic.

### Patterns and Recurring Elements:

1.  **Svelte Stores for State Management:** A pervasive pattern is the heavy reliance on Svelte stores (`store_...`) for managing application state across different components. This indicates a highly reactive and component-based architecture where data flow is central.
2.  **Environment-Specific Configuration:** The `EnvironmentService.ts` file clearly shows the application's capability to operate in multiple environments (local, dev, qa, sandbox, production) with different API endpoints. This is crucial for development, testing, and production deployment.
3.  **Analytics Integration:** Many files, especially `ForeignAnalytics.ts`, `Merchant.svelte`, and `Contlo.ts`, are concerned with integrating various analytics platforms (Facebook Pixel, Google Analytics, WebEngage, MoEngage, Snapchat, Contlo, CleverTap, Klaviyo, etc.). There's a strong focus on tracking user actions, cart data, discounts, and payment events.
4.  **Discount and Offer Management:** The discount functionality is complex, involving:
    *   Multiple types of discounts (coupon, automatic, loyalty, gift card, Gyftr, partner acquisition).
    *   Stacking logic for discounts.
    *   Conditional application and display of discounts based on user type, cart state, and custom configurations.
    *   Confetti animations for successful discount applications.
5.  **Checkout Flow and UI Components:** `PaymentOptions.svelte`, `OrderSummary.svelte`, and `App.svelte` demonstrate a detailed checkout flow, including:
    *   Displaying payment methods and associated charges.
    *   Handling COD confirmations.
    *   Dynamically updating order summaries.
    *   Managing popups and bottom sheets for various user interactions (e.g., exit confirmation, free gifts).
6.  **Cookie and Local Storage Management:** The application frequently interacts with browser cookies and local storage to persist user sessions, tracking information (UTM parameters, Shopify session IDs), and temporary data (`kp_email`, `cash_to_prepaid`).
7.  **Debugging and Refinement:** The presence of `console.log` statements, commented-out code (especially different merchant IDs in `merchant.html`), and minor incremental changes in timestamps suggest an active development and debugging process. The `cart_total_price` validation in `Contlo.ts` and the duplicate `logEvent` in `App.svelte` are prime examples.
8.  **Security/Token Handling:** Functions like `XGokwikToken` and `getTokenName` in `EnvironmentService.ts`, along with `jwtTokensArray` and `localStorage.getItem(XGokwikToken())` in `Merchant.svelte`, indicate a system for managing session tokens securely across different environments and storage mechanisms (cookies, local storage).

In summary, the changes reflect ongoing development of a robust e-commerce checkout system with sophisticated discount handling, comprehensive analytics integration, and careful management of client-side state and browser interactions, including specific handling for different deployment environments and mobile user experiences.

## 13:01:16
The provided log details changes across several Svelte and TypeScript files within a `gokwik.pdp` project, primarily related to checkout, payment, and discount functionalities, along with environmental configurations and analytics integration.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
    *   **Key Updates:** This service manages shipping discounts and their application during checkout. It subscribes to numerous stores (`CommonStore`, `OrderStore`, `LoginStore`) to get and update state related to discounts, shipping, cart details, user info, and UI elements.
        *   **Discount & Shipping Logic:** Handles `callShippingDiscountApi` and `processShippingDiscountResponse`. It clears API timers on coupon removal, applies confetti for valid discounts, integrates with Gyftr for reapplication/removal, and manages shipping method selection based on discount responses.
        *   **Gift Cards & Cart Updates:** Includes logic to reapply or remove gift cards if the cart has been modified (`modified_cart`) and updates `store_giftCard` and `store_giftCardTotal`.
        *   **Error Handling:** Manages error messages, specifically excluding UI error messages for UTM auto-application failures.
        *   **Loyalty Integration:** Logs loyalty points applied, including details like provider, redeemed credits, and auto-application status.
        *   **Consistency:** The changes between the two timestamps appear to be identical, suggesting a re-save or re-commit without functional changes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** 13/11/2025, 14:31:15; 15/11/2025, 11:32:02; 15/11/2025, 11:32:38; 17/11/2025, 13:02:34; 17/11/2025, 22:33:16
    *   **Key Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, KP, CDN, analytics) based on the `env` variable (environment).
        *   **Environment Configuration:** Contains conditional logic to set different API endpoints for `dev`, `qa`, `sandbox`, `production`, `local`, `hdev`, `ndev`, `qa-rto`, `qaone`, `qatwo`, `dev-core`, `qa-core`, `sandbox-core`, `pci-prod`, and `idev` environments.
        *   **Localhost API URL Changes:** The `api_url` function shows a pattern of commented-out `localhost` and `api.gokwik.co` URLs, with the active `local` URL changing from `https://api.gokwik.co` (13/11/2025) to `https://sandbox.gokwik.co` (15/11/2025) and back to `https://api.gokwik.co` (17/11/2025). This indicates frequent local development testing against different environments.
        *   **Token Generation:** Includes functions `XGokwikToken` and `XKWIKPASSToken` to return environment-specific session tokens.
        *   **Consistency:** Multiple identical changes across various timestamps suggest repeated saving or CI/CD updates. The actual functional changes are limited to the `api_url` for the 'local' environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** 13/11/2025, 14:31:36; 15/11/2025, 11:32:20; 17/11/2025, 13:01:29; 17/11/2025, 22:33:43
    *   **Key Updates:** This HTML file acts as a testing ground for the GoKwik SDK, embedded within a merchant page.
        *   **SDK Initialization:** Defines `gokwikSdk` for managing checkout, events, and script loading. It initializes the SDK on `DOMContentLoaded` and via custom `initGKJS` event.
        *   **Cookie Management:** Includes `getCookieGk` and `setCookieGk` functions to manage cookies like `gk_landing_page` and `gk_orig_referrer`.
        *   **Merchant Info Configuration:** Contains a `window.merchantInfo` object with various `mid` (merchant ID) values commented out, showing different test MIDs for `qa`, `neemans`, `bsc`, `sandbox-test`, `plus store`, `prod`, `boat`, `sandbox-plus`, `qa-plus`, `qa-1`, `ww`, `sandbox-auto`, and a currently active `mid` for `local` environment. The active `mid` is frequently updated across timestamps (e.g., 'gh0pf67komht38g' -> 'eey3m1vkrm1rbo7' -> '19g6ilboxukh6' -> '19g6jlssscg1r' -> '19g6im5qdaj7w').
        *   **Analytics Script Loading:** Dynamically loads an `analytics.js` script and a custom analytics script.
        *   **UI Elements:** Includes a "click me" button to trigger `goKwikCheckout` and divs for SDK integration (`gokwik-div`) and a "privy-widget".
        *   **Consistency:** The changes between timestamps are almost exclusively to the `mid` value within `window.merchantInfo`, confirming its use as a configurable testing parameter.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** 13/11/2025, 20:56:52; 13/11/2025, 20:58:06; 13/11/2025, 21:00:07; 13/11/2025, 21:00:59; 13/11/2025, 21:01:56; 13/11/2025, 21:03:33; 13/11/2025, 21:20:47; 13/11/2025, 21:22:28; 13/11/2025, 21:23:51; 15/11/2025, 12:01:15
    *   **Key Updates:** This Svelte component handles the payment options UI and logic during checkout.
        *   **State Management:** Subscribes to numerous stores (`LoginStore`, `OrderStore`, `CommonStore`) to manage payment-related states like total price, payment methods, discounts, COD options, and user preferences.
        *   **Payment Flow:** Initiates `callPaymentMethods` on mount or after discount resolution, processes saved cards, and logs various analytics events (GTM, Shopify, Facebook).
        *   **Conditional UI:** Manages visibility of payment headers, UPI collect options, and limited payment methods based on configuration and state.
        *   **Discount & Loyalty Integration:** Updates `store_onpl` based on TwidPay and COD availability. Handles `applyRecommendedReward` and processes auto-applied offers.
        *   **New Store Import:** On 15/11/2025, 12:01:15, `store_isLoggedInUser` and `store_isCartUpdated` are imported from `CommonStore`, and `AutomaticGiftHeader` and `GiftJourney` components are imported.
        *   **`store_availableOffersCheck`:** Added to imports on 13/11/2025, 21:22:28 and 13/11/2025, 21:23:51.
        *   **Consistency:** Many identical commits, indicating frequent saving. The most significant change is the import of new stores and components. The final changes include logic for recommended options and intent flow for UPI, conditional on screen width.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** 15/11/2025, 11:49:48; 15/11/2025, 11:52:44
    *   **Key Updates:** This Svelte component displays the order summary during checkout.
        *   **Price Calculation:** Dynamically calculates `totalPrice` by subtracting various discounts (coupon, partner acquisition offer, discount-based rewards, Shopify store credit, prepaid discount, gift card, TwidPay, Gyftr) and adding shipping charges and GST.
        *   **Cart Item Handling:** Processes `cartjsObject` to update cart items, including segregating free products (BXGY logic) and adding auto-gifts.
        *   **State Subscriptions:** Subscribes to `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
        *   **Loyalty Calculation:** Includes logic to calculate `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.
        *   **New Order Summary UI:** `showNewOrderSummary` is set to `true` for a predefined set of `currentPage` values, suggesting a new UI/feature rollout.
        *   **Consistency:** The two changes are identical, likely a re-save.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** 17/11/2025, 22:38:42
    *   **Key Updates:** This Svelte component displays promotional text related to loyalty, store credits, and gift cards.
        *   **Dynamic Text:** The `loyaltyDiscountText` is dynamically generated based on the availability of gift cards, loyalty, credits, and Gyftr, and the current page (`$store_page`).
        *   **State Subscriptions:** Subscribes to `store_requestIdObject`, `store_page`, `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit`.
        *   **UI/Logic for Promotions:** Shows a `discount-text-wrapper` if any of these promotional methods are enabled and the current page is less than 3.
        *   **New Variable:** `gyftrEnabled` variable introduced.

*   **`/Users/mayuresh.mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** 17/11/2025, 13:05:00; 17/11/2025, 13:19:38; 17/11/2025, 13:45:19; 17/11/2025, 13:55:05; 17/11/2025, 14:07:01; 17/11/2025, 14:13:04; 17/11/2025, 14:13:49; 17/11/2025, 14:14:00
    *   **Key Updates:** This file integrates with the Contlo analytics SDK.
        *   **Contlo Dummy Object:** An inline `window.contlo` dummy object is defined for local testing/development, logging calls to `init`, `identify`, `track`, and `push`.
        *   **Event Tracking:** Exports `callContlo` function to handle various events: `mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, and `coupon_applied_success_gk`/`coupon_applied_failed_gk`.
        *   **Data Structuring:** The `createBody` function constructs a common payload for Contlo events, including cart details, user information (first name, last name, email, address, city, state, pincode, address type), shipping method, payment method, ABC URL, and UTM parameters.
        *   **`cart_total_price` Logic:** The `createBody` function updated its logic for `cart_total_price`. Initially, it directly used `commonAnalyticsData?.cart_after_discount`. In later versions (from 17/11/2025, 14:07:01), it adds a check (`!isNaN(Number(commonAnalyticsData?.cart_after_discount)) ? commonAnalyticsData?.cart_after_discount : commonAnalyticsData?.cart_total_price`) to ensure `cart_after_discount` is a valid number before using it, falling back to `cart_total_price` if not. This refinement improves robustness for analytics data.
        *   **`contloSendEvent`:** Wraps `window.contlo.sendEvent` in a `try-catch` block to gracefully handle cases where the Contlo SDK might not be loaded, logging a console message instead of crashing.
        *   **Consistency:** Multiple commits with identical code or minor logging changes, again indicating active development and frequent saving. The main functional change is the improved `cart_total_price` calculation.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** 17/11/2025, 12:56:56; 17/11/2025, 13:43:21; 17/11/2025, 13:44:00; 17/11/2025, 13:44:52; 17/11/2025, 14:05:25
    *   **Key Updates:** This file is responsible for integrating with various third-party analytics platforms.
        *   **State Subscriptions:** Subscribes to numerous stores from both `LoginStore` and `OrderStore`, as well as `CommonStore`, to gather comprehensive data for analytics events (e.g., cart details, user info, discount amounts, shipping methods, risk flags, UTM data).
        *   **Pixel/Analytics Configuration:** Dynamically builds a `configObject` based on `store_foreignAnalytics` and `kwikOptimizerPixelIds` to determine which analytics pixels are active.
        *   **Event Handling:** Defines `fbPixelEventsAndKeys` for mapping Facebook pixel events and includes helper functions like `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping`.
        *   **Price Breakup:** Maintains a `priceBreakup` object with details like `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
        *   **Logging `totalValue`:** On 17/11/2025, 13:44:52, a `console.log(res)` was added within the `store_totalPrice.subscribe` block. This was removed in the following commit at 17/11/2025, 14:05:25.
        *   **Consistency:** Repeated commits of mostly identical code, with a brief logging addition and removal. This suggests iterative development with frequent saves.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** 18/11/2025, 12:22:24; 18/11/2025, 12:23:52; 18/11/2025, 12:24:20; 18/11/2025, 12:24:44; 18/11/2025, 12:25:25; 18/11/2025, 12:40:55
    *   **Key Updates:** This is the main application component, orchestrating various parts of the checkout flow.
        *   **State Management:** Imports and subscribes to a vast number of Svelte stores from both `LoginStore`, `CommonStore`, and `OrderStore` to manage the entire application state.
        *   **Navigation & History:** Implements `history.pushState` for navigation control and handles `window.onpopstate` for back button functionality, including custom logic for closing popups/modals and calling analytics beacons.
        *   **Initialization Logic:** On `onMount`, it dispatches a `gokwikLoaded` event, checks the environment, loads cookies (`_shopify_s`, `_scid`, `gk_utm_source`, `_fbp`, `_fbc`, `discount_code`, `gk_landing_page`, `SP_DUID`, `gk_orig_referrer`, `_shopify_y`, `_shopify_sa_t`, `localization`, `kp_user_id`, `KWIKUSERTOKEN`, `kpmclid`, `_ga` cookies). It also handles URL parameters (`mrid`, `gkref`, `so_token`, `gk_token`) for special flows like abandon cart or token-based logins.
        *   **Message Listener:** Sets up a `window.addEventListener('message')` to handle messages from the merchant page, including 'launch' (initializing checkout with merchant info), 'cartOpen' (logging analytics when other checkouts are clicked), and 'checkoutHealth'.
        *   **Truecaller Integration:** Configures Truecaller keys for different environments.
        *   **Cookie Session Token:** A `cookieSessionToken` variable was introduced and assigned `tokenData?.coreToken` when a `gk_token` is present in the URL (17/11/2025, 18:16:05). This appears to be a variable name change from `backupToken` (17/11/2025, 18:14:56).
        *   **Logging `checkout_assets_loaded`:** There are two identical `logEvent` calls for `checkout_assets_loaded` within the `onMount` function.
        *   **Email Handling:** Logic for `kpEmail` is present, ensuring it's not a comma-separated string before setting it to `store_kpEmail`.
        *   **Incognito Check:** Includes logic to check if the browser is in incognito mode due to iframe limitations for `localStorage`.
        *   **Dynamic Discounts:** Subscribes to `store_requestIdObject` to get configurations for `dynamicAutomaticExtraDiscounts` and `dynamicAutomaticOverwriteDiscounts`.
        *   **`store_fullScreenPopUp`:** Added to imports on 18/11/2025, 12:40:55.
        *   **Consistency:** Numerous re-saves of nearly identical code. Key functional changes are limited, primarily token handling, some logging, and store imports.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** 17/11/2025, 23:52:04; 17/11/2025, 23:53:11; 17/11/2025, 23:53:19; 18/11/2025, 00:00:01; 18/11/2025, 00:02:54; 18/11/2025, 00:03:11; 18/11/2025, 00:03:40; 18/11/2025, 00:05:32; 18/11/2025, 00:08:46; 18/11/2025, 00:15:34; 18/11/2025, 00:21:40; 18/11/2025, 00:21:50; 18/11/2025, 00:22:39; 18/11/2025, 00:29:30; 18/11/2025, 12:19:54; 18/11/2025, 12:21:27; 18/11/2025, 12:23:13; 18/11/2025, 12:41:34; 18/11/2025, 12:42:12; 18/11/2025, 12:43:07; 18/11/2025, 12:45:43
    *   **Key Updates:** This Svelte component manages the display and application of discounts and offers.
        *   **Discount Application Logic:** Handles applying and removing coupons, including stacking discounts, credits, gift cards, and partner acquisition offers.
        *   **State Management:** Subscribes to numerous common and order stores to track discount codes, drawer visibility, loyalty points, cart details, offers, and payment information.
        *   **Dynamic Discount Configuration:** Retrieves `disable_discount_with_credits`, `disable_discount_with_giftcard`, `loyaltyApp`, `disable_cod_with_loyalty`, `dynamicAutomaticExtraDiscountList`, `dynamicAutomaticOverwriteDiscountList`, `isExtraAutomaticEnabled`, and `isOverwriteAutomaticenabled` from `store_requestIdObject`.
        *   **Applied Offers Display:** Dynamically constructs `allAppliedOffers` array to display automatic, stacked, coupon, and partner acquisition (Cred) discounts, including their removal logic.
        *   **Offer Filtering:** Filters available coupons based on `viewInListing` flag and screen width.
        *   **`showExperimentalDiscountPopup`:** Added to imports on 17/11/2025, 23:52:04.
        *   **`couponListUpdated`:** Added as a variable on 18/11/2025, 00:00:01.
        *   **Consistency:** This file shows the most frequent, nearly identical commits, suggesting very active, incremental development or continuous saving during a refactoring period for discount logic. The core functionality remains consistent across these many small updates.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
    *   **Timestamps:** 18/11/2025, 14:49:20; 18/11/2025, 14:50:49; 18/11/2025, 14:51:01; 18/11/2025, 14:57:07; 18/11/2025, 14:57:19; 18/11/2025, 14:58:02; 18/11/2025, 14:58:58
    *   **Key Updates:** This file seems to be a client-side integration script for the GoKwik checkout.
        *   **SDK Initialization:** `initKwikCheckout` function loads GoKwik integration and analytics scripts based on environment (sandbox/production).
        *   **Cart Fetching:** `fetchCart` function makes an XMLHttpRequest to a Shopify cart API to get cart details, then initializes the `gokwikSdk` checkout with this information.
        *   **Pixel Integration:** Dynamically creates scripts for Facebook Pixel, Google Analytics, MoEngage, and WebEngage if configured and `blockExternalEvents` is not `true`.
        *   **Listeners:** `initListeners` handles messages from the iframe for checkout health status and Shopify redirects. Also handles `hardwareBackPress` events.
        *   **UTM Parameters and Cookies:** On `DOMContentLoaded`, it parses `storeInfo` and `kp_email` from URL parameters, sets `_shopify_s` cookie for session ID, and sets various UTM-related cookies (`_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`).
        *   **`kpEmail` Parsing:** Updated `kpEmail` parsing logic on 18/11/2025, 14:58:58 to include a `try-catch` block for `atob(kpEmail)` to prevent errors if `kpEmail` is not base64 encoded.
        *   **Consistency:** Numerous identical changes, likely due to re-saves. The `kp_email` parsing improvement is the most notable functional change.

### Timestamps of Significant Changes:

*   **12/11/2025, 21:20:24:** Initial log of `ShippingDiscount.service.ts` showing comprehensive discount/shipping logic.
*   **13/11/2025, 14:31:15:** Initial log of `EnvironmentService.ts` showing varied API endpoints.
*   **13/11/2025, 14:31:36:** Initial log of `merchant.html` showing SDK integration and merchant info setup.
*   **13/11/2025, 20:56:52:** Initial log of `PaymentOptions.svelte` demonstrating complex payment state management.
*   **13/11/2025, 21:22:28 / 21:23:51:** `PaymentOptions.svelte` imports `store_availableOffersCheck`.
*   **15/11/2025, 11:32:02 / 11:32:38:** `EnvironmentService.ts` shows a change in the 'local' environment `api_url` from `api.gokwik.co` to `sandbox.gokwik.co`, then reverted shortly after.
*   **15/11/2025, 11:49:48:** Initial log of `OrderSummary.svelte` with detailed price calculation and cart item handling.
*   **15/11/2025, 12:01:15:** `PaymentOptions.svelte` imports `store_isLoggedInUser`, `store_isCartUpdated`, and new gift components (`AutomaticGiftHeader`, `GiftJourney`).
*   **17/11/2025, 12:56:56:** Initial log of `ForeignAnalytics.ts` with extensive analytics integration logic.
*   **17/11/2025, 13:05:00:** Initial log of `Contlo.ts` showing Contlo SDK integration with dummy object.
*   **17/11/2025, 14:07:01:** `Contlo.ts` updates `createBody` to make `cart_total_price` calculation more robust.
*   **17/11/2025, 18:16:05:** `Merchant.svelte` introduces `cookieSessionToken` to handle `gk_token` more robustly.
*   **17/11/2025, 22:38:42:** `Promotion.svelte` updates `loyaltyDiscountText` logic to incorporate `gyftrEnabled`.
*   **18/11/2025, 00:00:01:** `Discounts.svelte` introduces `couponListUpdated` variable.
*   **18/11/2025, 12:22:24:** Initial log of `App.svelte` showing core application logic and numerous store subscriptions.
*   **18/11/2025, 14:49:20:** Initial log of `kwik-checkout.html` showing client-side GoKwik integration.
*   **18/11/2025, 14:58:58:** `kwik-checkout.html` improves `kpEmail` decoding with a `try-catch` block.

### Patterns and Recurring Elements:

1.  **Svelte Store-Based Architecture:** A strong pattern is the extensive use of Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_requestIdObject`, `store_merchantInfo`) across almost all Svelte components (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, `Promotion.svelte`, `App.svelte`, `Discounts.svelte`). This indicates a highly reactive and centralized state management approach.
2.  **Frequent Saves/Minor Updates:** Many file paths exhibit multiple entries with identical or very slight changes in code over short periods (e.g., `PaymentOptions.svelte`, `Discounts.svelte`, `EnvironmentService.ts`, `merchant.html`, `ForeignAnalytics.ts`, `Contlo.ts`). This suggests an iterative development style, potentially with auto-saving features, or rapid testing/refactoring cycles.
3.  **Analytics Integration:** There is a heavy emphasis on tracking and integrating with various analytics platforms (Facebook, Google Analytics, MoEngage, WebEngage, Contlo, Snapchat, CleverTap, Klaviyo, etc.) as seen in `ForeignAnalytics.ts`, `Merchant.svelte`, `Contlo.ts`, and `kwik-checkout.html`. This indicates a data-driven approach to understanding user behavior and checkout performance.
4.  **Environment-Specific Configurations:** `EnvironmentService.ts` and `merchant.html` consistently show configurations that vary by development environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust deployment pipeline and testing strategy across different stages.
5.  **Discount and Payment Complexity:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files reveal intricate logic for handling various discount types (coupon codes, loyalty, gift cards, automatic discounts, stacked discounts, partner offers like Cred, Gyftr), shipping methods, and payment flows (COD, UPI, card payments, TwidPay, Shopify store credit). This suggests a feature-rich and customizable checkout experience.
6.  **Error Handling and User Experience:** The presence of `snackbar_state`, `store_persistedErrorMessage`, and `manageErrorMessages` (in `ShippingDiscount.service.ts`), along with `ConfirmPopup` in `App.svelte`, indicates a focus on providing clear feedback and graceful error handling to the user.
7.  **Performance and Optimization:** Elements like `createApiResponseQueue` in `ShippingDiscount.service.ts`, `calculateLoadTime` in `PaymentOptions.svelte` (though commented out), and `insertKeyframes` in `Merchant.svelte` suggest attention to performance and smooth user experience.
8.  **Security and Token Management:** The handling of `XGokwikToken`, `XKWIKPASSToken`, `gk_token`, `so_token`, and various cookies across `EnvironmentService.ts`, `Merchant.svelte`, and `App.svelte` points to a system that manages authentication and session tokens for secure transactions.
9.  **Ongoing Development:** The numerous, detailed changes across multiple core components suggest active and continuous development of the GoKwik checkout platform, adding features, improving robustness, and enhancing analytics capabilities.