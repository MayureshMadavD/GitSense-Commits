# Activity Summary for 19/11/2025

## 11:53:15
The provided log details changes across multiple files in a dashboard UI, focusing on customization, order management, and discounts.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file, responsible for the brand customization page, received updates related to logo upload functionality and theme color management.
    *   It includes logic for validating image files (type, size), handling uploads to AWS S3, and fetching pre-signed URLs.
    *   The form (`Form.useForm()`) manages `brand_data`, including `logo`, `logoImg`, and `cssRules.primaryColor`.
    *   `useEffect` hooks are used to initialize logo data from `merchant_details` and update primary color from `config.custom_config`.
    *   The component renders UI for uploading a logo, displaying a preview, and a color picker for the primary theme color.
    *   Saving changes (`onFinish`) involves updating the merchant logo via API and saving configuration.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51)
    *   This component manages product and collection search functionality for discounts.
    *   It was updated to support collating products (grouping variants under a single product), handling quantities for collections, and filtering products based on tags for 'agent-led' scenarios.
    *   The `parseResponse` function was modified to correctly group product variants when `collateProducts` is true and to handle filtering for `isAgentLed` items.
    *   New props like `collateProducts`, `showQuantity`, `alloweditemscount`, `hideSearchInput`, `isAgentLed`, `topUpGift`, and `collectionSpecificData` were introduced.
    *   Logic for incrementing/decrementing item quantities and handling gift prices was added.
    *   The UI renders search input, a modal for search results with checkboxes for selection, and displays selected products/collections with their details and quantity controls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file, for displaying order details, received significant updates to its data processing and display logic.
    *   New helper functions `formatCurrency` and `formatAmountWithCurrency` were introduced for improved currency formatting.
    *   A `mergeRepeatedRefunds` function was added to aggregate multiple refund attempts for a single `gokwik_rid` and determine the final status (`Completed`, `Failed`, `Initiated`).
    *   The `fetchOrderDetails` function now handles various price breakup components (discounts, taxes, shipping, gift cards, rewards, store credits) and calculates the total refundable amount, setting the state for the refund button.
    *   It includes logic to set an `editTitle` and `disableEdit` state based on applied rewards, GWP discounts, or loyalty points.
    *   Improved handling for `is_deleted` and `is_auto_refund` flags for transactions.
    *   Introduced `order_failure_reason` and `showRTOActions` logic.
    *   The component leverages `useMemo` for `discountBreakup` calculation to optimize performance.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Timestamp: 18/11/2025, 00:45:31)
    *   This EJS template defines the structure of the dashboard UI.
    *   It includes a Content Security Policy (CSP) for security.
    *   The primary change involves updating the `systemjs-importmap` configurations for various environments (`local`, `dev`, `qa`, `sandbox`, `production`).
    *   Specific Micro-frontend applications (e.g., `@gokwik/configuration`, `@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/checkout`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, `@gokwik/shopify-app`, `@gokwik/kwikcomm`) now point to their respective deployment URLs based on the `deployedEnv` variable.
    *   New Relic and Clarity analytics scripts are conditionally included for the `production` environment.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Timestamp: 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, 18/11/2025, 00:58:39)
    *   These three entries show identical code changes, indicating repeated saves or minor, non-substantive changes in quick succession.
    *   This file manages the Free Gift settings.
    *   It defines a `FreeGift` component with state for rules, editing, and changes.
    *   The `useMerchantConfigApi` hook is used for fetching and saving configuration.
    *   It uses `Form.useWatch` to react to changes in free gift configuration, specific products/collections, free product, application method, and applicable on settings.
    *   An `initialValues` object defines the default configuration for auto gift rules.
    *   `useEffect` is used to update breadcrumbs for navigation.
    *   The `fields` array defines the structure and validation rules for a dynamic form, including input, checkbox, radio, inputNumber, and search types, with conditional visibility (`hideControlInput`, `hidden`) based on other form values.
    *   The `columns` array defines the structure for a table to display free gift rules, including name, free gift product (with image), status (toggle switch), and actions (edit/delete dropdown).
    *   `handleEdit`, `handleDelete`, `handleAddFreeGiftProduct`, and `handleRemoveFreeGiftProduct` functions manage the state of free gift rules and their associated products.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component organizes various UI customization fields for the order confirmation page into collapsible sections.
    *   It uses `Form.useWatch` to react to changes in `customize` data.
    *   The component defines separate field configurations (`orderDetailFields`, `customerInformationFields`, `supportDetailFields`) for different sections of the order confirmation page, including switches for enabling/disabling sections, input fields for text, and `ColorPickerHelper` for background and text colors.
    *   The `items` array structures these sections into a `Collapse` component, allowing each section to be toggled, with an additional switch in the `extra` prop for enabling/disabling the entire section.
    *   It integrates other components like `LogoPage`, `RenderEditorFunction` (for dynamic banners), and `TrustBadgeForm`.
    *   Introduces drag-and-drop functionality for reordering collapse items, allowing users to customize the layout of the order confirmation page fields.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34**: Significant updates to brand customization, particularly logo upload and theme color.
*   **17/11/2025, 16:22:51**: Major enhancements to product/collection search, including product collation, quantity management, and filtering.
*   **17/11/2025, 16:23:04**: Substantial changes to order details display, refund logic, and currency formatting.
*   **18/11/2025, 00:45:31**: Core infrastructure update with environment-specific import map configurations and analytics scripts in `index.ejs`.
*   **18/11/2025, 23:42:52**: Introduction of drag-and-drop and extensive customization options for the order confirmation page.

### Patterns or Recurring Elements:

*   **`useMerchantConfigApi` Hook**: Frequently used across `BrandPage` and `FreeGift` components for fetching, updating, and saving merchant-specific configurations, indicating a centralized configuration management system.
*   **Form Management with Ant Design (Gokwik-UI-Kit)**: Extensive use of `Form.useForm()`, `Form.Item`, `Form.useWatch`, and `form.setFieldsValue()` for managing form state, validation, and interaction, particularly in `BrandPage`, `FreeGift`, and `collapseFields`.
*   **Dynamic UI Rendering with `RenderField`**: The `RenderField` utility component is used to dynamically render various form input types based on a configuration array (e.g., in `FreeGift` and `collapseFields`), promoting reusability and declarative UI construction.
*   **Customization and Configuration**: A strong theme of enabling merchants to customize various aspects of the checkout UI (brand logo, theme color, order confirmation page sections, free gift rules).
*   **API Interactions**: Frequent use of `makeAPICall` and `makeAWSPutCall` for backend communication (e.g., fetching order details, uploading images, saving configurations).
*   **Breadcrumb Navigation**: `updateBreadcrumbs` utility is used in `FreeGift` to manage consistent navigation paths across the application.
*   **Date Formatting and Currency Handling**: Specific helper functions (e.g., `formatAmount`, `setCurrencySymbol`, newly added `formatCurrency` and `formatAmountWithCurrency`) are used to ensure consistent display of numerical and monetary values.
*   **Timestamp Proximity**: The three identical `freeGift.tsx` entries on 18/11/2025 suggest either rapid iteration, minor non-functional changes, or repeated saves without actual code differences being logged.
*   **Environment-Specific Deployments**: The `index.ejs` file clearly demonstrates a pattern of setting up different Micro-frontend module URLs based on the deployment environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust CI/CD and deployment strategy.
*   **New Relic Integration**: The `index.ejs` also shows a pattern of integrating New Relic monitoring for performance and error tracking, specifically in the production environment.

## 12:00:41
The provided log details changes across several files, primarily focusing on checkout, payment, and analytics functionalities within a SvelteKit application.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** Consistent updates on `12/11/2025, 21:20:24` and `15/11/2025, 12:00:15`.
    *   **Updates:** This service is heavily involved in managing discounts and shipping options.
        *   Numerous Svelte stores are subscribed to, indicating a highly reactive and state-driven component.
        *   The `callShippingDiscountApi` function handles discount application, removal, and combination calls. It includes logic for clearing API timers, displaying confetti for successful discounts (conditional on user type and redirection flow), and handling Gyftr rewards.
        *   Error handling for invalid discount channels is present.
        *   `processShippingDiscountResponse` further processes API responses, updating shipping methods, discounts, and handling gift card reapplication on cart updates.
        *   Specific fixes for issues like `CHECKOUT-15842` (GiftCard on Cart Update) and `CHECKOUT-12982` (Payment Methods on Shipping Options) are noted.
        *   New logic for UTM auto-apply discount/shipping options failure is added, which prevents displaying an error message on the UI in such cases.
        *   Introduces logic for `discount_shipping_retry` based on available shipping options.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:15` and `17/11/2025, 23:34:43`.
    *   **Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, analytics) based on the environment (dev, qa, sandbox, production, local).
        *   Consistently updates the `api_url` for the `local` environment, switching between different development/production endpoints, indicating active testing and environment configuration changes.
        *   The `XGokwikToken` and `XKWIKPASSToken` functions dynamically return session tokens based on the environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** Multiple updates between `13/11/2025, 14:31:36` and `17/11/2025, 23:35:35`, and then more on `18/11/2025` around `14:50:00`.
    *   **Updates:** This is a merchant integration HTML file.
        *   The `gokwikSdk` is defined to manage checkout initiation, event handling (`on`, `emit`), and UI interactions like hiding buttons.
        *   Initial script loading (`gokwik.js`) and event listeners (`DOMContentLoaded`, `initGKJS`) are present.
        *   Cookie management (`getCookieGk`, `setCookieGk`) for tracking landing page and referrer is included.
        *   The `window.merchantInfo` object, crucial for merchant-specific configurations like `mid`, `environment`, `storeId`, and `fbpixel`, is frequently updated (different `mid` values are commented out, suggesting testing across multiple merchant IDs).
        *   The `initKwikCheckout` function (in `kwik-checkout.html` variant) loads integration and analytics scripts dynamically.
        *   Listeners for `checkoutHealth` and `shopifyRedirect` are present, which trigger a custom event `gk-checkout-disable` for fallback.
        *   Recent changes in `kwik-checkout.html` (18/11/2025) include adding `window.__KP_EMAIL__ = kpEmail;` which suggests handling Kwikpass email information more directly in the global scope.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** Frequent updates on `13/11/2025` (multiple times around `20:56:52` to `21:25:07`) and `15/11/2025, 12:01:15`.
    *   **Updates:** This Svelte component is central to payment options display and logic.
        *   Imports a vast array of Svelte stores from `CommonStore` and `OrderStore`, highlighting a highly interconnected and stateful component.
        *   Manages various payment-related states: `totalPrice`, `screen_width`, `codPaymentFailed`, `availableAutoOffers`, `recommendedOptions`.
        *   Initializes tracking events on mount (`payment_step_landed`, `AddPaymentInfo`).
        *   Includes logic for applying recommended TwidPay rewards, fetching Shopify credits, and handling COD confirmation.
        *   Filters and reorders `availableAutoOffers` based on payment methods and screen width.
        *   Introduces `store_availableOffersCheck`, `store_isLoggedInUser`, `store_isCartUpdated` in the latest version (15/11/2025), indicating more granular control over offer display and user state.
        *   Adds `AutomaticGiftHeader` and `GiftJourney` components in the latest update, suggesting new features for free gift management.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** Consistent updates on `15/11/2025, 11:49:48` and `15/11/2025, 11:52:44`.
    *   **Updates:** This component manages the order summary display.
        *   Calculates `totalPrice` based on `subTotal`, various discounts (coupon, prepaid, partner acquisition, gift card, loyalty, Gyftr), shipping, and COD charges.
        *   Handles logic for displaying automatic discounts and segregating free products (BXGY offers).
        *   Includes subscriptions to numerous stores (`cartjsObject`, `discountAmount`, `prepaidDiscount`, `codCharges`, `selectedShippingMethod`, `giftCardTotal`, etc.) to reactively update the summary.
        *   Introduces `lineItemEdds` and `earnedLoyaltyDetails` to influence loyalty display amount calculations.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 13:05:00` and `17/11/2025, 14:14:00`.
    *   **Updates:** This file integrates with Contlo analytics.
        *   Initially, it defined a dummy `window.contlo` object, but subsequent updates remove this, implying the actual Contlo SDK is expected to be present.
        *   Consolidates `createBody` function to prepare data for Contlo events, including product IDs, promo code, cart total, and UTM marketing data.
        *   Defines functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) to call `contloSendEvent` with specific event names and data.
        *   A key change in the `createBody` function (17/11/2025, 14:07:01) is to ensure `cart_total_price` is a valid number by checking `!isNaN(Number(commonAnalyticsData?.cart_after_discount))`. This is further refined to check for `!!commonAnalyticsData?.cart_after_discount` (17/11/2025, 14:13:04), indicating a robustness improvement for handling `cart_after_discount` values.
        *   `contloSendEvent` is wrapped in a try-catch block, logging an error if `window.contlo.sendEvent` is not found, suggesting more robust error handling for external SDKs.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** Multiple updates between `17/11/2025, 12:56:56` and `17/11/2025, 14:05:25`.
    *   **Updates:** This service is responsible for integrating various third-party analytics platforms.
        *   Imports and subscribes to a vast number of Svelte stores related to user data, cart information, discounts, and merchant configurations.
        *   Maintains a `priceBreakup` object to aggregate financial details for analytics.
        *   Manages `fbPixelEventsAndKeys` for Facebook pixel custom events.
        *   Dynamically builds `configObject` based on `store_foreignAnalytics` to enable/disable different analytics pixels.
        *   Includes logic to integrate `kwikOptimizerPixelIds` with Facebook custom events.
        *   The `generateTrackingData` function is called reactively when `cartjsObject` or `totalPrice` updates.
        *   A `console.log(res)` was added to the `store_totalPrice` subscription on 17/11/2025, 13:55:47, likely for debugging purposes, and then removed in the next commit.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** `17/11/2025, 22:38:42`.
    *   **Updates:** Displays promotional text related to loyalty points, store credits, and gift cards.
        *   Dynamically constructs `redeemableText` based on the availability and enablement of loyalty, credits, and Gyftr features.
        *   The `loyaltyDiscountText` message is conditional on the current page (`$store_page`).
        *   Includes several `JSON.stringify` console logs, suggesting debugging for the logic controlling loyalty/credits/Gyftr visibility.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** Frequent updates between `17/11/2025, 23:52:04` and `18/11/2025, 12:45:43`.
    *   **Updates:** Manages discount application, display, and related UI elements.
        *   Consolidates a wide range of Svelte stores to manage discount state, including stacking, automatic discounts, gift cards, and partner offers.
        *   The `allAppliedOffers` reactive block constructs a list of applied discounts, determining their type (automatic, stacked, Cred offer), amount saved, and removability.
        *   Includes logic for re-applying credits (`store_reapplyEr`).
        *   Calculates `allowDiscountApplication` based on stacking configuration and number of clubbed discounts.
        *   Processes partner offers and filters available coupons based on screen width.
        *   Frequent minor changes (e.g., adding a `console.log`) suggest ongoing debugging and refinement of discount logic.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** Multiple updates between `18/11/2025, 12:22:24` and `18/11/2025, 12:40:55`.
    *   **Updates:** This is the main application component, orchestrating various sub-components and global state.
        *   Extensive use of Svelte stores for managing application-wide state (page, cart, merchant info, user details, analytics flags, etc.).
        *   Handles browser `onpopstate` events to manage navigation history and confirm exit flows, specifically for non-cash-to-prepaid scenarios and various popup/bottom sheet states.
        *   Includes logic for automatically showing a free gift popup if available for logged-in users.
        *   Processes `launch` messages from a parent iframe to initialize various stores with merchant-specific data, cookies, and user info.
        *   Attempts to retrieve/set session tokens from `localStorage` and cookies, with fallback for incognito mode detection.
        *   Includes duplicate `logEvent` calls for `checkout_assets_loaded` on 18/11/2025, 12:22:24, which might be a temporary debugging artifact.
        *   Adds `store_availableOffersCheck` to LoginStore imports, suggesting further integration with discount/offer logic.

### Patterns and Recurring Elements:

1.  **Svelte Stores for State Management:** A pervasive pattern is the heavy reliance on Svelte stores (`store_...`) for managing application state across different components. This indicates a highly reactive and component-based architecture where data flow is central.
2.  **Environment-Specific Configuration:** The `EnvironmentService.ts` file clearly shows the application's capability to operate in multiple environments (local, dev, qa, sandbox, production) with different API endpoints. This is crucial for development, testing, and production deployment.
3.  **Analytics Integration:** Many files, especially `ForeignAnalytics.ts`, `Merchant.svelte`, and `Contlo.ts`, are concerned with integrating various analytics platforms (Facebook Pixel, Google Analytics, WebEngage, MoEngage, Snapchat, Contlo, CleverTap, Klaviyo, etc.). There's a strong focus on tracking user actions, cart data, discounts, and payment events.
4.  **Discount and Offer Management:** The discount functionality is complex, involving:
    *   Multiple types of discounts (coupon, automatic, loyalty, gift card, Gyftr, partner acquisition).
    *   Stacking logic for discounts.
    *   Conditional application and display of discounts based on user type, cart state, and custom configurations.
    *   Confetti animations for successful discount applications.
5.  **Checkout Flow and UI Components:** `PaymentOptions.svelte`, `OrderSummary.svelte`, and `App.svelte` demonstrate a detailed checkout flow, including:
    *   Displaying payment methods and associated charges.
    *   Handling COD confirmations.
    *   Dynamically updating order summaries.
    *   Managing popups and bottom sheets for various user interactions (e.g., exit confirmation, free gifts).
6.  **Cookie and Local Storage Management:** The application frequently interacts with browser cookies and local storage to persist user sessions, tracking information (UTM parameters, Shopify session IDs), and temporary data (`kp_email`, `cash_to_prepaid`).
7.  **Debugging and Refinement:** The presence of `console.log` statements, commented-out code (especially different merchant IDs in `merchant.html`), and minor incremental changes in timestamps suggest an active development and debugging process. The `cart_total_price` validation in `Contlo.ts` and the duplicate `logEvent` in `App.svelte` are prime examples.
8.  **Security/Token Handling:** Functions like `XGokwikToken` and `getTokenName` in `EnvironmentService.ts`, along with `jwtTokensArray` and `localStorage.getItem(XGokwikToken())` in `Merchant.svelte`, indicate a system for managing session tokens securely across different environments and storage mechanisms (cookies, local storage).

In summary, the changes reflect ongoing development of a robust e-commerce checkout system with sophisticated discount handling, comprehensive analytics integration, and careful management of client-side state and browser interactions, including specific handling for different deployment environments and mobile user experiences.

## 13:01:16
The provided log details changes across several Svelte and TypeScript files within a `gokwik.pdp` project, primarily related to checkout, payment, and discount functionalities, along with environmental configurations and analytics integration.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
    *   **Key Updates:** This service manages shipping discounts and their application during checkout. It subscribes to numerous stores (`CommonStore`, `OrderStore`, `LoginStore`) to get and update state related to discounts, shipping, cart details, user info, and UI elements.
        *   **Discount & Shipping Logic:** Handles `callShippingDiscountApi` and `processShippingDiscountResponse`. It clears API timers on coupon removal, applies confetti for valid discounts, integrates with Gyftr for reapplication/removal, and manages shipping method selection based on discount responses.
        *   **Gift Cards & Cart Updates:** Includes logic to reapply or remove gift cards if the cart has been modified (`modified_cart`) and updates `store_giftCard` and `store_giftCardTotal`.
        *   **Error Handling:** Manages error messages, specifically excluding UI error messages for UTM auto-application failures.
        *   **Loyalty Integration:** Logs loyalty points applied, including details like provider, redeemed credits, and auto-application status.
        *   **Consistency:** The changes between the two timestamps appear to be identical, suggesting a re-save or re-commit without functional changes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** 13/11/2025, 14:31:15; 15/11/2025, 11:32:02; 15/11/2025, 11:32:38; 17/11/2025, 13:02:34; 17/11/2025, 22:33:16
    *   **Key Updates:** This file defines base URLs for various services (health, address suggestion, core API, experiments, TwidPay, KP, CDN, analytics) based on the `env` variable (environment).
        *   **Environment Configuration:** Contains conditional logic to set different API endpoints for `dev`, `qa`, `sandbox`, `production`, `local`, `hdev`, `ndev`, `qa-rto`, `qaone`, `qatwo`, `dev-core`, `qa-core`, `sandbox-core`, `pci-prod`, and `idev` environments.
        *   **Localhost API URL Changes:** The `api_url` function shows a pattern of commented-out `localhost` and `api.gokwik.co` URLs, with the active `local` URL changing from `https://api.gokwik.co` (13/11/2025) to `https://sandbox.gokwik.co` (15/11/2025) and back to `https://api.gokwik.co` (17/11/2025). This indicates frequent local development testing against different environments.
        *   **Token Generation:** Includes functions `XGokwikToken` and `XKWIKPASSToken` to return environment-specific session tokens.
        *   **Consistency:** Multiple identical changes across various timestamps suggest repeated saving or CI/CD updates. The actual functional changes are limited to the `api_url` for the 'local' environment.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** 13/11/2025, 14:31:36; 15/11/2025, 11:32:20; 17/11/2025, 13:01:29; 17/11/2025, 22:33:43
    *   **Key Updates:** This HTML file acts as a testing ground for the GoKwik SDK, embedded within a merchant page.
        *   **SDK Initialization:** Defines `gokwikSdk` for managing checkout, events, and script loading. It initializes the SDK on `DOMContentLoaded` and via custom `initGKJS` event.
        *   **Cookie Management:** Includes `getCookieGk` and `setCookieGk` functions to manage cookies like `gk_landing_page` and `gk_orig_referrer`.
        *   **Merchant Info Configuration:** Contains a `window.merchantInfo` object with various `mid` (merchant ID) values commented out, showing different test MIDs for `qa`, `neemans`, `bsc`, `sandbox-test`, `plus store`, `prod`, `boat`, `sandbox-plus`, `qa-plus`, `qa-1`, `ww`, `sandbox-auto`, and a currently active `mid` for `local` environment. The active `mid` is frequently updated across timestamps (e.g., 'gh0pf67komht38g' -> 'eey3m1vkrm1rbo7' -> '19g6ilboxukh6' -> '19g6jlssscg1r' -> '19g6im5qdaj7w').
        *   **Analytics Script Loading:** Dynamically loads an `analytics.js` script and a custom analytics script.
        *   **UI Elements:** Includes a "click me" button to trigger `goKwikCheckout` and divs for SDK integration (`gokwik-div`) and a "privy-widget".
        *   **Consistency:** The changes between timestamps are almost exclusively to the `mid` value within `window.merchantInfo`, confirming its use as a configurable testing parameter.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** 13/11/2025, 20:56:52; 13/11/2025, 20:58:06; 13/11/2025, 21:00:07; 13/11/2025, 21:00:59; 13/11/2025, 21:01:56; 13/11/2025, 21:03:33; 13/11/2025, 21:20:47; 13/11/2025, 21:22:28; 13/11/2025, 21:23:51; 15/11/2025, 12:01:15
    *   **Key Updates:** This Svelte component handles the payment options UI and logic during checkout.
        *   **State Management:** Subscribes to numerous stores (`LoginStore`, `OrderStore`, `CommonStore`) to manage payment-related states like total price, payment methods, discounts, COD options, and user preferences.
        *   **Payment Flow:** Initiates `callPaymentMethods` on mount or after discount resolution, processes saved cards, and logs various analytics events (GTM, Shopify, Facebook).
        *   **Conditional UI:** Manages visibility of payment headers, UPI collect options, and limited payment methods based on configuration and state.
        *   **Discount & Loyalty Integration:** Updates `store_onpl` based on TwidPay and COD availability. Handles `applyRecommendedReward` and processes auto-applied offers.
        *   **New Store Import:** On 15/11/2025, 12:01:15, `store_isLoggedInUser` and `store_isCartUpdated` are imported from `CommonStore`, and `AutomaticGiftHeader` and `GiftJourney` components are imported.
        *   **`store_availableOffersCheck`:** Added to imports on 13/11/2025, 21:22:28 and 13/11/2025, 21:23:51.
        *   **Consistency:** Many identical commits, indicating frequent saving. The most significant change is the import of new stores and components. The final changes include logic for recommended options and intent flow for UPI, conditional on screen width.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** 15/11/2025, 11:49:48; 15/11/2025, 11:52:44
    *   **Key Updates:** This Svelte component displays the order summary during checkout.
        *   **Price Calculation:** Dynamically calculates `totalPrice` by subtracting various discounts (coupon, partner acquisition offer, discount-based rewards, Shopify store credit, prepaid discount, gift card, TwidPay, Gyftr) and adding shipping charges and GST.
        *   **Cart Item Handling:** Processes `cartjsObject` to update cart items, including segregating free products (BXGY logic) and adding auto-gifts.
        *   **State Subscriptions:** Subscribes to `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
        *   **Loyalty Calculation:** Includes logic to calculate `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.
        *   **New Order Summary UI:** `showNewOrderSummary` is set to `true` for a predefined set of `currentPage` values, suggesting a new UI/feature rollout.
        *   **Consistency:** The two changes are identical, likely a re-save.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** 17/11/2025, 22:38:42
    *   **Key Updates:** This Svelte component displays promotional text related to loyalty, store credits, and gift cards.
        *   **Dynamic Text:** The `loyaltyDiscountText` is dynamically generated based on the availability of gift cards, loyalty, credits, and Gyftr, and the current page (`$store_page`).
        *   **State Subscriptions:** Subscribes to `store_requestIdObject`, `store_page`, `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit`.
        *   **UI/Logic for Promotions:** Shows a `discount-text-wrapper` if any of these promotional methods are enabled and the current page is less than 3.
        *   **New Variable:** `gyftrEnabled` variable introduced.

*   **`/Users/mayuresh.mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** 17/11/2025, 13:05:00; 17/11/2025, 13:19:38; 17/11/2025, 13:45:19; 17/11/2025, 13:55:05; 17/11/2025, 14:07:01; 17/11/2025, 14:13:04; 17/11/2025, 14:13:49; 17/11/2025, 14:14:00
    *   **Key Updates:** This file integrates with the Contlo analytics SDK.
        *   **Contlo Dummy Object:** An inline `window.contlo` dummy object is defined for local testing/development, logging calls to `init`, `identify`, `track`, and `push`.
        *   **Event Tracking:** Exports `callContlo` function to handle various events: `mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, and `coupon_applied_success_gk`/`coupon_applied_failed_gk`.
        *   **Data Structuring:** The `createBody` function constructs a common payload for Contlo events, including cart details, user information (first name, last name, email, address, city, state, pincode, address type), shipping method, payment method, ABC URL, and UTM parameters.
        *   **`cart_total_price` Logic:** The `createBody` function updated its logic for `cart_total_price`. Initially, it directly used `commonAnalyticsData?.cart_after_discount`. In later versions (from 17/11/2025, 14:07:01), it adds a check (`!isNaN(Number(commonAnalyticsData?.cart_after_discount)) ? commonAnalyticsData?.cart_after_discount : commonAnalyticsData?.cart_total_price`) to ensure `cart_after_discount` is a valid number before using it, falling back to `cart_total_price` if not. This refinement improves robustness for analytics data.
        *   **`contloSendEvent`:** Wraps `window.contlo.sendEvent` in a `try-catch` block to gracefully handle cases where the Contlo SDK might not be loaded, logging a console message instead of crashing.
        *   **Consistency:** Multiple commits with identical code or minor logging changes, again indicating active development and frequent saving. The main functional change is the improved `cart_total_price` calculation.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** 17/11/2025, 12:56:56; 17/11/2025, 13:43:21; 17/11/2025, 13:44:00; 17/11/2025, 13:44:52; 17/11/2025, 14:05:25
    *   **Key Updates:** This file is responsible for integrating with various third-party analytics platforms.
        *   **State Subscriptions:** Subscribes to numerous stores from both `LoginStore` and `OrderStore`, as well as `CommonStore`, to gather comprehensive data for analytics events (e.g., cart details, user info, discount amounts, shipping methods, risk flags, UTM data).
        *   **Pixel/Analytics Configuration:** Dynamically builds a `configObject` based on `store_foreignAnalytics` and `kwikOptimizerPixelIds` to determine which analytics pixels are active.
        *   **Event Handling:** Defines `fbPixelEventsAndKeys` for mapping Facebook pixel events and includes helper functions like `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping`.
        *   **Price Breakup:** Maintains a `priceBreakup` object with details like `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
        *   **Logging `totalValue`:** On 17/11/2025, 13:44:52, a `console.log(res)` was added within the `store_totalPrice.subscribe` block. This was removed in the following commit at 17/11/2025, 14:05:25.
        *   **Consistency:** Repeated commits of mostly identical code, with a brief logging addition and removal. This suggests iterative development with frequent saves.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** 18/11/2025, 12:22:24; 18/11/2025, 12:23:52; 18/11/2025, 12:24:20; 18/11/2025, 12:24:44; 18/11/2025, 12:25:25; 18/11/2025, 12:40:55
    *   **Key Updates:** This is the main application component, orchestrating various parts of the checkout flow.
        *   **State Management:** Imports and subscribes to a vast number of Svelte stores from both `LoginStore`, `CommonStore`, and `OrderStore` to manage the entire application state.
        *   **Navigation & History:** Implements `history.pushState` for navigation control and handles `window.onpopstate` for back button functionality, including custom logic for closing popups/modals and calling analytics beacons.
        *   **Initialization Logic:** On `onMount`, it dispatches a `gokwikLoaded` event, checks the environment, loads cookies (`_shopify_s`, `_scid`, `gk_utm_source`, `_fbp`, `_fbc`, `discount_code`, `gk_landing_page`, `SP_DUID`, `gk_orig_referrer`, `_shopify_y`, `_shopify_sa_t`, `localization`, `kp_user_id`, `KWIKUSERTOKEN`, `kpmclid`, `_ga` cookies). It also handles URL parameters (`mrid`, `gkref`, `so_token`, `gk_token`) for special flows like abandon cart or token-based logins.
        *   **Message Listener:** Sets up a `window.addEventListener('message')` to handle messages from the merchant page, including 'launch' (initializing checkout with merchant info), 'cartOpen' (logging analytics when other checkouts are clicked), and 'checkoutHealth'.
        *   **Truecaller Integration:** Configures Truecaller keys for different environments.
        *   **Cookie Session Token:** A `cookieSessionToken` variable was introduced and assigned `tokenData?.coreToken` when a `gk_token` is present in the URL (17/11/2025, 18:16:05). This appears to be a variable name change from `backupToken` (17/11/2025, 18:14:56).
        *   **Logging `checkout_assets_loaded`:** There are two identical `logEvent` calls for `checkout_assets_loaded` within the `onMount` function.
        *   **Email Handling:** Logic for `kpEmail` is present, ensuring it's not a comma-separated string before setting it to `store_kpEmail`.
        *   **Incognito Check:** Includes logic to check if the browser is in incognito mode due to iframe limitations for `localStorage`.
        *   **Dynamic Discounts:** Subscribes to `store_requestIdObject` to get configurations for `dynamicAutomaticExtraDiscounts` and `dynamicAutomaticOverwriteDiscounts`.
        *   **`store_fullScreenPopUp`:** Added to imports on 18/11/2025, 12:40:55.
        *   **Consistency:** Numerous re-saves of nearly identical code. Key functional changes are limited, primarily token handling, some logging, and store imports.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** 17/11/2025, 23:52:04; 17/11/2025, 23:53:11; 17/11/2025, 23:53:19; 18/11/2025, 00:00:01; 18/11/2025, 00:02:54; 18/11/2025, 00:03:11; 18/11/2025, 00:03:40; 18/11/2025, 00:05:32; 18/11/2025, 00:08:46; 18/11/2025, 00:15:34; 18/11/2025, 00:21:40; 18/11/2025, 00:21:50; 18/11/2025, 00:22:39; 18/11/2025, 00:29:30; 18/11/2025, 12:19:54; 18/11/2025, 12:21:27; 18/11/2025, 12:23:13; 18/11/2025, 12:41:34; 18/11/2025, 12:42:12; 18/11/2025, 12:43:07; 18/11/2025, 12:45:43
    *   **Key Updates:** This Svelte component manages the display and application of discounts and offers.
        *   **Discount Application Logic:** Handles applying and removing coupons, including stacking discounts, credits, gift cards, and partner acquisition offers.
        *   **State Management:** Subscribes to numerous common and order stores to track discount codes, drawer visibility, loyalty points, cart details, offers, and payment information.
        *   **Dynamic Discount Configuration:** Retrieves `disable_discount_with_credits`, `disable_discount_with_giftcard`, `loyaltyApp`, `disable_cod_with_loyalty`, `dynamicAutomaticExtraDiscountList`, `dynamicAutomaticOverwriteDiscountList`, `isExtraAutomaticEnabled`, and `isOverwriteAutomaticenabled` from `store_requestIdObject`.
        *   **Applied Offers Display:** Dynamically constructs `allAppliedOffers` array to display automatic, stacked, coupon, and partner acquisition (Cred) discounts, including their removal logic.
        *   **Offer Filtering:** Filters available coupons based on `viewInListing` flag and screen width.
        *   **`showExperimentalDiscountPopup`:** Added to imports on 17/11/2025, 23:52:04.
        *   **`couponListUpdated`:** Added as a variable on 18/11/2025, 00:00:01.
        *   **Consistency:** This file shows the most frequent, nearly identical commits, suggesting very active, incremental development or continuous saving during a refactoring period for discount logic. The core functionality remains consistent across these many small updates.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
    *   **Timestamps:** 18/11/2025, 14:49:20; 18/11/2025, 14:50:49; 18/11/2025, 14:51:01; 18/11/2025, 14:57:07; 18/11/2025, 14:57:19; 18/11/2025, 14:58:02; 18/11/2025, 14:58:58
    *   **Key Updates:** This file seems to be a client-side integration script for the GoKwik checkout.
        *   **SDK Initialization:** `initKwikCheckout` function loads GoKwik integration and analytics scripts based on environment (sandbox/production).
        *   **Cart Fetching:** `fetchCart` function makes an XMLHttpRequest to a Shopify cart API to get cart details, then initializes the `gokwikSdk` checkout with this information.
        *   **Pixel Integration:** Dynamically creates scripts for Facebook Pixel, Google Analytics, MoEngage, and WebEngage if configured and `blockExternalEvents` is not `true`.
        *   **Listeners:** `initListeners` handles messages from the iframe for checkout health status and Shopify redirects. Also handles `hardwareBackPress` events.
        *   **UTM Parameters and Cookies:** On `DOMContentLoaded`, it parses `storeInfo` and `kp_email` from URL parameters, sets `_shopify_s` cookie for session ID, and sets various UTM-related cookies (`_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`).
        *   **`kpEmail` Parsing:** Updated `kpEmail` parsing logic on 18/11/2025, 14:58:58 to include a `try-catch` block for `atob(kpEmail)` to prevent errors if `kpEmail` is not base64 encoded.
        *   **Consistency:** Numerous identical changes, likely due to re-saves. The `kp_email` parsing improvement is the most notable functional change.

### Timestamps of Significant Changes:

*   **12/11/2025, 21:20:24:** Initial log of `ShippingDiscount.service.ts` showing comprehensive discount/shipping logic.
*   **13/11/2025, 14:31:15:** Initial log of `EnvironmentService.ts` showing varied API endpoints.
*   **13/11/2025, 14:31:36:** Initial log of `merchant.html` showing SDK integration and merchant info setup.
*   **13/11/2025, 20:56:52:** Initial log of `PaymentOptions.svelte` demonstrating complex payment state management.
*   **13/11/2025, 21:22:28 / 21:23:51:** `PaymentOptions.svelte` imports `store_availableOffersCheck`.
*   **15/11/2025, 11:32:02 / 11:32:38:** `EnvironmentService.ts` shows a change in the 'local' environment `api_url` from `api.gokwik.co` to `sandbox.gokwik.co`, then reverted shortly after.
*   **15/11/2025, 11:49:48:** Initial log of `OrderSummary.svelte` with detailed price calculation and cart item handling.
*   **15/11/2025, 12:01:15:** `PaymentOptions.svelte` imports `store_isLoggedInUser`, `store_isCartUpdated`, and new gift components (`AutomaticGiftHeader`, `GiftJourney`).
*   **17/11/2025, 12:56:56:** Initial log of `ForeignAnalytics.ts` with extensive analytics integration logic.
*   **17/11/2025, 13:05:00:** Initial log of `Contlo.ts` showing Contlo SDK integration with dummy object.
*   **17/11/2025, 14:07:01:** `Contlo.ts` updates `createBody` to make `cart_total_price` calculation more robust.
*   **17/11/2025, 18:16:05:** `Merchant.svelte` introduces `cookieSessionToken` to handle `gk_token` more robustly.
*   **17/11/2025, 22:38:42:** `Promotion.svelte` updates `loyaltyDiscountText` logic to incorporate `gyftrEnabled`.
*   **18/11/2025, 00:00:01:** `Discounts.svelte` introduces `couponListUpdated` variable.
*   **18/11/2025, 12:22:24:** Initial log of `App.svelte` showing core application logic and numerous store subscriptions.
*   **18/11/2025, 14:49:20:** Initial log of `kwik-checkout.html` showing client-side GoKwik integration.
*   **18/11/2025, 14:58:58:** `kwik-checkout.html` improves `kpEmail` decoding with a `try-catch` block.

### Patterns and Recurring Elements:

1.  **Svelte Store-Based Architecture:** A strong pattern is the extensive use of Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_requestIdObject`, `store_merchantInfo`) across almost all Svelte components (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, `Promotion.svelte`, `App.svelte`, `Discounts.svelte`). This indicates a highly reactive and centralized state management approach.
2.  **Frequent Saves/Minor Updates:** Many file paths exhibit multiple entries with identical or very slight changes in code over short periods (e.g., `PaymentOptions.svelte`, `Discounts.svelte`, `EnvironmentService.ts`, `merchant.html`, `ForeignAnalytics.ts`, `Contlo.ts`). This suggests an iterative development style, potentially with auto-saving features, or rapid testing/refactoring cycles.
3.  **Analytics Integration:** There is a heavy emphasis on tracking and integrating with various analytics platforms (Facebook, Google Analytics, MoEngage, WebEngage, Contlo, Snapchat, CleverTap, Klaviyo, etc.) as seen in `ForeignAnalytics.ts`, `Merchant.svelte`, `Contlo.ts`, and `kwik-checkout.html`. This indicates a data-driven approach to understanding user behavior and checkout performance.
4.  **Environment-Specific Configurations:** `EnvironmentService.ts` and `merchant.html` consistently show configurations that vary by development environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust deployment pipeline and testing strategy across different stages.
5.  **Discount and Payment Complexity:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files reveal intricate logic for handling various discount types (coupon codes, loyalty, gift cards, automatic discounts, stacked discounts, partner offers like Cred, Gyftr), shipping methods, and payment flows (COD, UPI, card payments, TwidPay, Shopify store credit). This suggests a feature-rich and customizable checkout experience.
6.  **Error Handling and User Experience:** The presence of `snackbar_state`, `store_persistedErrorMessage`, and `manageErrorMessages` (in `ShippingDiscount.service.ts`), along with `ConfirmPopup` in `App.svelte`, indicates a focus on providing clear feedback and graceful error handling to the user.
7.  **Performance and Optimization:** Elements like `createApiResponseQueue` in `ShippingDiscount.service.ts`, `calculateLoadTime` in `PaymentOptions.svelte` (though commented out), and `insertKeyframes` in `Merchant.svelte` suggest attention to performance and smooth user experience.
8.  **Security and Token Management:** The handling of `XGokwikToken`, `XKWIKPASSToken`, `gk_token`, `so_token`, and various cookies across `EnvironmentService.ts`, `Merchant.svelte`, and `App.svelte` points to a system that manages authentication and session tokens for secure transactions.
9.  **Ongoing Development:** The numerous, detailed changes across multiple core components suggest active and continuous development of the GoKwik checkout platform, adding features, improving robustness, and enhancing analytics capabilities.

## 14:01:18
**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
- **Timestamp**: 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
- **Key Changes**:
    - This file heavily relies on Svelte stores (`CommonStore`, `OrderStore`, `LoginStore`) for state management related to shipping, discounts, and user information.
    - It defines `callShippingDiscountApi` and `processShippingDiscountResponse` for handling discount and shipping logic.
    - The `callShippingDiscountApi` function initiates a discount/shipping call, clears a timer if a coupon is removed, and triggers a confetti animation for valid discounts. It also logs loyalty point application events.
    - The `processShippingDiscountResponse` function updates shipping methods, shipping options, and discount responses based on the API call. It also contains logic for re-applying gift cards on cart updates and calling payment methods under specific conditions.
    - Error messages are managed, with exclusions for UTM auto-application failures.
    - Logic for retrying shipping method selection in case of discount-shipping retry scenarios.
- **Pattern/Recurring Elements**:
    - Extensive use of Svelte stores (`store_...`) for reactive data management.
    - Handling of discount application, removal, and re-application logic, often intertwined with shipping options and payment methods.
    - Logging events (GTM, general `logEvent`) at various stages of discount and shipping processing.
    - Conditional logic based on `currentPage` and flags like `isAbandonCart`, `isRedirectionFlowEnabled`, `modified_cart`.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
- **Timestamp**: 13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, 17/11/2025, 13:02:34, 17/11/2025, 22:33:16, 17/11/2025, 23:34:43
- **Key Changes**:
    - This file is dedicated to defining base URLs for various GoKwik services (health, address suggestion, core API, experiment, TwidPay, KP, CDN, analytics) based on the current `env` (environment).
    - It subscribes to `store_merchanturl`, `store_environment`, and `store_cashToPrepaid` to dynamically set `merchantUrl`, `env`, and `cashToPrepaid`.
    - Multiple `api_url` definitions for different environments (dev, qa-rto, qaone, sandbox, production, qa, hdev, ndev, local, qatwo, dev-core, qa-core, sandbox-core, pci-prod, idev). The `local` environment has several commented-out URL options, indicating frequent switching during local development.
    - Functions like `XGokwikToken` and `XKWIKPASSToken` provide environment-specific tokens.
- **Pattern/Recurring Elements**:
    - Heavy use of conditional `if/else if` statements to determine API endpoints based on the `env` variable.
    - Consistent pattern of defining separate base URLs for different services across various environments.
    - The `local` environment often has commented-out alternative URLs, suggesting a development-focused setup.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
- **Timestamp**: 13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, 17/11/2025, 22:33:43
- **Key Changes**:
    - This is an HTML file serving as a "Merchant Page" to simulate integration with the GoKwik SDK.
    - It includes a `gokwikSdk` IIFE (Immediately Invoked Function Expression) which provides methods like `init`, `initCheckout`, `emit`, `on`, and `hideButton`.
    - It initializes the `gokwikSdk` on `DOMContentLoaded` and `initGKJS` custom events.
    - Functions `getCookieGk` and `setCookieGk` are defined for managing `gk_landing_page` and `gk_orig_referrer` cookies.
    - Contains a `window.merchantInfo` object with various configuration parameters, most notably `mid` and `environment`. The `mid` is frequently commented and changed across timestamps, indicating testing different merchant configurations. The `environment` is consistently set to `'local'`.
    - A button `gokwik-button` triggers `goKwikCheckout`, which in turn sends `merchantInfo` via `window.postMessage`.
    - Dynamic script injection for analytics (`analytics-js`) is present.
- **Pattern/Recurring Elements**:
    - Consistent structure for SDK integration and analytics setup.
    - Frequent changes to the `mid` within `window.merchantInfo` for testing purposes.
    - Persistent use of `environment: 'local'` for development.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
- **Timestamp**: 13/11/2025, 20:56:52, 13/11/2025, 20:58:06, 13/11/2025, 21:00:07, 13/11/2025, 21:00:59, 13/11/2025, 21:01:56, 13/11/2025, 21:03:33, 13/11/2025, 21:20:47, 13/11/2025, 21:22:28, 13/11/2025, 21:23:51, 13/11/2025, 21:25:07, 15/11/2025, 12:01:15
- **Key Changes**:
    - This Svelte component manages the payment options screen logic.
    - It imports a large number of stores from both `CommonStore` and `OrderStore` to manage various aspects of checkout (discounts, shipping, payment methods, UI states, user data, etc.).
    - On `onMount`, it initializes payment-related states, logs analytics events (GTM, Shopify), fetches saved cards, and potentially calls payment methods.
    - It subscribes to numerous stores to react to changes in total price, discount status, TwidPay rewards, Shopify store credits, etc.
    - Conditional logic to apply recommended rewards or call payment methods based on `store_placeOrder`, `store_twidPay`, and `store_shopifyStoreCredit` states.
    - Manages COD payment failed/pending states and related error messages.
    - Includes logic for displaying UPI collect, limiting payment options, and integrating with experiment variants for risk-based discounts (`UPI_RTO_EXPERIMENT`).
    - The latest changes on 15/11/2025, 12:01:15, include new imports: `store_isLoggedInUser`, `store_isCartUpdated` from `CommonStore`, and two new components `AutomaticGiftHeader` and `GiftJourney`. This suggests new functionality for handling automatic gifts and gift-related user flows.
- **Pattern/Recurring Elements**:
    - Extensive reliance on Svelte stores for intricate state management.
    - Frequent logging of analytics and GTM events.
    - Complex conditional rendering and logic based on numerous store values (e.g., `$store_twidPay.status`, `$store_page`, `isCodAvailable`).
    - Multiple subscriptions to update local component variables and trigger side effects.
    - Focus on integrating various payment methods, discounts, and loyalty programs.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
- **Timestamp**: 15/11/2025, 11:49:48, 15/11/2025, 11:52:44
- **Key Changes**:
    - This Svelte component displays the order summary, including total price calculation, discounts, and cart item details.
    - It subscribes to `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
    - The `totalPrice` calculation is complex, accounting for various discounts (coupon, loyalty, Shopify store credit, prepaid, TwidPay, Gyftr), shipping charges, COD fees, and GST.
    - `handleCartUpdate` processes `cartjsObject` to update `subTotal`, identify automatic discounts, and segregate free products (BXGY logic).
    - Introduced a `showNewOrderSummary` flag based on `currentPage`.
    - Logic for calculating `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.
- **Pattern/Recurring Elements**:
    - Deep integration with Svelte stores for real-time order summary updates.
    - Complex reactive calculations (`$: totalPrice`) to reflect various pricing components.
    - Event logging for user interaction with the order summary drawer.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
- **Timestamp**: 14/11/2025, 13:55:06, 17/11/2025, 13:00:33, 17/11/2025, 17:36:22, 17/11/2025, 17:38:18, 17/11/2025, 18:14:56, 17/11/2025, 18:16:05, 17/11/2025, 18:16:16, 17/11/2025, 18:25:21, 18/11/2025, 14:25:07, 18/11/2025, 15:10:51, 18/11/2025, 15:14:20
- **Key Changes**:
    - This Svelte component is the main merchant integration point, responsible for loading the GoKwik checkout iframe and managing its lifecycle.
    - `onMount` initializes key components: inserting CSS keyframes, dispatching `gokwikLoaded` event, checking environment (Glance), and parsing URL parameters for checkout initiation (`mrid`, `gkref`).
    - It sets various cookies and local storage items related to Shopify session, UTM parameters, FBPixel, discount codes, and Kwikpass tokens.
    - Handles incoming messages from the iframe (e.g., `merchantInfo`, `cartOpen`, `checkoutHealth`) and dispatches relevant actions.
    - Integrates Truecaller configurations for different environments, including specific keys for `local`, `dev`, `ndev`, `production`, `sandbox`, `qa`, and `qatwo`.
    - Added a `backupToken` variable (17/11, 17:38:18), which was later renamed to `cookieSessionToken` (17/11, 18:14:56) and then used to store `tokenData?.coreToken` in the `try` block for `gk_token` processing. This suggests a focus on robust token handling and fallback mechanisms.
- **Pattern/Recurring Elements**:
    - Frequent updates to cookie and local storage handling, especially for session IDs and analytics parameters (`_shopify_s`, `_fbp`, `_fbc`, `gk_landing_page`, `gk_orig_referrer`).
    - Constant refinement of `truecallerConfig` keys for different environments.
    - Consistent message passing mechanism via `window.postMessage` to communicate with the iframe.
    - Debugging `console.log(error)` for token parsing issues, indicating a focus on error resilience.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
- **Timestamp**: 17/11/2025, 12:56:56, 17/11/2025, 13:43:21, 17/11/2025, 13:44:00, 17/11/2025, 13:44:52, 17/11/2025, 14:05:25
- **Key Changes**:
    - This file manages integration with various third-party analytics platforms (CleverTap, Klaviyo, WebEngage, MoEngage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, GoogleAds).
    - It subscribes to a vast array of Svelte stores (from `LoginStore`, `OrderStore`, `CommonStore`) to collect and prepare data for analytics events.
    - The `priceBreakup` object is used to aggregate price components for analytics reporting.
    - `fbPixelEventsAndKeys` maps internal event names to Facebook pixel event names, including custom events.
    - `marketingData` collects UTM and referrer information from cookies.
    - `adSourceMapping` function processes source values (e.g., UTM parameters) for analytics.
    - There are frequent updates (though content remains largely similar across most timestamps) to ensure all relevant data points are captured from stores and formatted correctly for each analytics platform. The `console.log(res)` on 17/11/2025, 13:44:52 for `store_totalPrice` might indicate a temporary debugging step.
- **Pattern/Recurring Elements**:
    - Extensive use of Svelte stores to centralize data collection for analytics.
    - Repetitive structure of `store_X.subscribe((res) => { ... })` for extracting data from stores.
    - Definition of a `configObject` to selectively enable or disable different analytics pixels.
    - Standardized `createDataObject` and `generateTrackingData` (functions not shown in full but implied) to prepare data consistently for multiple analytics services.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
- **Timestamp**: 17/11/2025, 13:05:00, 17/11/2025, 13:19:38, 17/11/2025, 13:45:19, 17/11/2025, 13:55:05, 17/11/2025, 14:07:01, 17/11/2025, 14:13:04, 17/11/2025, 14:13:49, 17/11/2025, 14:14:00
- **Key Changes**:
    - This file specifically handles Contlo analytics integration.
    - It defines a `contlo` dummy object to log calls to `init`, `identify`, `track`, and `push` to the console if the actual Contlo SDK isn't loaded. This is a robust debugging/fallback mechanism.
    - The `createBody` function aggregates various common analytics data points (`tag`, `promo_code`, `cart_total_price`, `product_id`, `userAddress` details, `marketingData` including UTMs) into a structured object for Contlo events.
    - `callContlo` acts as a dispatcher for different Contlo events (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`/`coupon_applied_failed_gk`).
    - Each `contloX` function constructs event-specific data using `createBody` and calls `contloSendEvent`.
    - **Significant Change (17/11, 14:07:01)**: The `cart_total_price` calculation in `createBody` was modified to explicitly check `!isNaN(Number(commonAnalyticsData?.cart_after_discount))` to ensure it's a valid number before using `cart_after_discount`, falling back to `commonAnalyticsData?.cart_total_price`. This change was refined further on 17/11, 14:13:04 to `!!commonAnalyticsData?.cart_after_discount && !isNaN(discountedAmount) ? discountedAmount : commonAnalyticsData?.cart_total_price`, making the check more explicit for non-null/undefined `cart_after_discount`.
- **Pattern/Recurring Elements**:
    - Consistent structure for handling different Contlo events, each mapping to a specific function (`contloMobile`, `contloPincode`, etc.).
    - Centralized `createBody` function to ensure consistency in data sent to Contlo.
    - The `contloSendEvent` includes a `try-catch` block to gracefully handle cases where the Contlo SDK might not be available, preventing runtime errors.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
- **Timestamp**: 17/11/2025, 22:38:42
- **Key Changes**:
    - This Svelte component displays promotional text related to loyalty points, store credits, or gift cards.
    - It derives `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` from Svelte stores (`store_useStoreCredit`, `store_requestIdObject`, `store_gyftr`, `store_enableGiftCard`).
    - The `loyaltyDiscountText` is dynamically constructed based on which of these features are enabled, indicating what the user can "Login to Redeem" or "Enter OTP to Redeem".
    - It subscribes to `store_requestIdObject` to retrieve custom display names for credits and loyalty.
- **Pattern/Recurring Elements**:
    - Reactive logic (`$: (() => { ... })()`) to update displayed text based on multiple store values.
    - Conditional rendering (`{#if ...}`) to show the promotion wrapper only when applicable.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
- **Timestamp**: 17/11/2025, 23:52:04, 17/11/2025, 23:53:11, 17/11/2025, 23:53:19, 18/11/2025, 00:00:01, 18/11/2025, 00:02:54, 18/11/2025, 00:03:11, 18/11/2025, 00:03:40, 18/11/2025, 00:05:32, 18/11/2025, 00:21:40, 18/11/2025, 00:21:50, 18/11/2025, 00:22:39, 18/11/2025, 00:29:30, 18/11/2025, 12:19:54, 18/11/2025, 12:21:27, 18/11/2025, 12:23:13, 18/11/2025, 12:41:34, 18/11/2025, 12:45:43
- **Key Changes**:
    - This Svelte component manages the display and application of discounts, gift cards, and loyalty programs.
    - It imports a comprehensive set of stores from both `CommonStore` and `OrderStore` to manage discount-related states and user information.
    - `allAppliedOffers` is a reactive array that combines various types of applied discounts: automatic, stacked, manually applied coupons, and partner acquisition offers (Cred). This array is then set to `store_allAppliedDiscounts`.
    - On `onMount`, it subscribes to `store_requestIdObject` to get configuration flags for disabling discounts with credits/gift cards, loyalty app details, and dynamic automatic discount lists (extra/overwrite).
    - Logic for handling `store_reapplyEr` (reapplying credits) and `store_stackedDiscounts` (managing stacked discount configurations and `allowDiscountApplication`).
    - The `store_offers` subscription processes available discounts, filters them for display, and handles partner offers.
- **Pattern/Recurring Elements**:
    - High coupling with Svelte stores for intricate discount, loyalty, and payment interactions.
    - Complex reactive blocks (`$: { ... }`) to dynamically update the list of `allAppliedOffers` based on various store states.
    - Extensive conditional logic to determine discount eligibility, application rules, and UI visibility.
    - Focus on managing multiple types of discounts and promotions (coupons, credits, gift cards, stacked discounts, partner offers, automatic discounts).

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte`**
- **Timestamp**: 18/11/2025, 12:22:24, 18/11/2025, 12:23:52, 18/11/2025, 12:24:20, 18/11/2025, 12:24:44, 18/11/2025, 12:25:25, 18/11/2025, 12:40:55
- **Key Changes**:
    - This is the root Svelte component for the GoKwik PDP (Payment Data Platform).
    - It imports a massive number of Svelte stores from both `LoginStore`, `CommonStore`, and `OrderStore`, indicating it orchestrates almost all state across the application.
    - `onMount` sets up global event listeners, especially for `window.onpopstate` to handle browser back button behavior and `window.addEventListener('message')` to receive messages from the parent merchant page.
    - The `onpopstate` logic is complex, managing navigation, popups, and logging back button clicks.
    - The `message` event listener processes `launch` messages from the parent, extracting and setting numerous initial parameters into various stores (e.g., `sourceValue`, `localStorageObject`, `isGlanceEnvironment`, `shopifySessionId`, `cashToPrepaidFlag`, `isSkipOtp`, `merchantInfo`, `environment`, cookies, tokens).
    - It handles token management (fetching from localStorage, setting cookies).
    - Incorporates debugging logs for `checkout_assets_loaded` events.
    - Dynamically loads AddressListing/Address components based on `getAddressComponent`.
- **Pattern/Recurring Elements**:
    - Centralized state management through an overwhelming number of Svelte store imports.
    - Deep integration with the browser's history API (`window.onpopstate`) and messaging API (`window.postMessage`, `window.addEventListener('message')`) for seamless checkout flow.
    - Extensive initialization logic on `onMount` to configure the application based on merchant and user data.
    - Frequent setting of store values based on incoming data from the parent frame.
    - The two `logEvent({ name: 'checkout_assets_loaded', ... })` calls indicate redundant logging or A/B testing.

**`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
- **Timestamp**: 18/11/2025, 14:49:20, 18/11/2025, 14:50:49, 18/11/2025, 14:51:01, 18/11/2025, 14:57:07, 18/11/2025, 14:57:19, 18/11/2025, 14:58:02, 18/11/2025, 14:58:58
- **Key Changes**:
    - This HTML file is a wrapper for the GoKwik checkout, distinct from `merchant.html`.
    - It contains a `initKwikCheckout` function that dynamically loads the GoKwik integration script (`merchant.integration.js`) and various analytics scripts (Facebook Pixel, Google Analytics, WebEngage, MoEngage) based on `storeInfo`.
    - A `fetchCart` function makes an XHR request to `v1/user/shopify-cart` to get cart details and then initializes the `gokwikSdk` checkout.
    - `createScript`, `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, `createWebEngage` functions are responsible for injecting and initializing the respective external scripts and pixels.
    - `initListeners` sets up `window.onmessage` and `document.addEventListener('message')` to handle checkout health status and hardware back press events.
    - On `DOMContentLoaded`, it parses `storeInfo` and `kp_email` from URL parameters, and sets various cookies (`_shopify_s`, `_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`) based on `storeInfo` and UTM parameters.
    - **Significant Change (18/11, 14:58:58)**: Added a `try-catch` block when decoding `kpEmail` using `atob`, to handle potential errors during base64 decoding and ensure `window.__KP_EMAIL__` is still set even if `atob` fails.
- **Pattern/Recurring Elements**:
    - Consistent dynamic script injection for analytics and core integration.
    - Repeated use of `setCookieGk` for various tracking and session cookies.
    - Focus on robust error handling for `kp_email` decoding.
    - Centralized `initKwikCheckout` function to manage external integrations based on `storeInfo`.

**Overall Patterns and Recurring Elements**:
- **Svelte Store Dependency**: Almost all `.svelte` and `.service.ts` files extensively use Svelte stores (`store_...`) from `CommonStore`, `OrderStore`, and `LoginStore` for reactive state management and data sharing across components and services.
- **Analytics and Event Logging**: There's a strong emphasis on detailed analytics and event logging. Multiple services (`ForeignAnalytics.ts`, `EventService.ts`, `Contlo.ts`) are involved in tracking user interactions, payment steps, discount applications, and checkout health, using various platforms like GTM, Shopify, Facebook, Google Analytics, WebEngage, MoEngage, and Contlo. Events like `payment_step_landed`, `checkout_assets_loaded`, `coupon_applied_success_gk`, `address_added_gk` are frequently logged.
- **Environment-Specific Configurations**: The application frequently adapts its behavior and API endpoints based on the `environment` variable, leading to many `if/else if` blocks for different environments (`dev`, `qa`, `sandbox`, `production`, `local`, etc.). This is evident in `EnvironmentService.ts` and `Merchant.svelte`.
- **Cookie and Local Storage Management**: Consistent handling of cookies (`setCookie`, `getCookie`, `setCookieGk`) and local storage (`localStorage.setItem`, `localStorage.getItem`) for session IDs, tokens, and tracking parameters across `Merchant.svelte` and `kwik-checkout.html`.
- **Discount and Offer Management**: Complex logic for applying, re-applying, and removing various types of discounts, gift cards, and loyalty rewards is distributed across `ShippingDiscount.service.ts` and `Discounts.svelte`. This includes handling stacked discounts, automatic discounts, and partner-specific offers.
- **Modular Component Architecture**: The use of Svelte components (`PaymentOptions.svelte`, `OrderSummary.svelte`, `Discounts.svelte`, `App.svelte`) suggests a modular approach, but the heavy cross-component state management through global stores implies a tightly coupled system.
- **Debugging and Error Handling**: The presence of dummy analytics objects (`window.contlo`), `console.log` statements for errors, and `try-catch` blocks indicate an effort to make the application resilient and debuggable during development.

## 14:53:30
The log details recent development focusing on UI customization, feature enhancements, and infrastructure updates across the checkout dashboard.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (Timestamp: 16/11/2025, 13:10:34)**
    This file was updated to enhance the brand customization page. Key changes include:
    *   Implementation of logo upload functionality with validation for file types (JPEG, PNG, SVG) and size (under 2MB). It uses pre-signed URLs for direct AWS S3 uploads and includes image cleaning.
    *   Integration of a color picker for theme primary color customization, allowing merchants to control the checkout UI's branding.
    *   Dynamic loading of existing merchant logo and primary color settings into the form.
    *   Saving of brand data, including the new logo path and CSS rules, via API calls.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 17/11/2025, 16:22:51)**
    This component received significant updates to its product/collection search capabilities for discount configurations:
    *   It now supports searching and displaying both individual products and collections, with options to hide search inputs or buttons.
    *   Enhanced product management allows for collating multiple variants of a product, managing quantities, and displaying min prices for grouped products.
    *   New features include `isAgentLed` filtering for items, `topUpGift` functionality for setting offered prices on gifts, and collection-specific quantity management with validation.
    *   Incorporates infinite scrolling (`useIntersectionObserver`) for search results and debounced input for efficient searching.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (Timestamp: 17/11/2025, 16:23:04)**
    The order details page was updated to provide a more comprehensive and controlled view of order information:
    *   Improved display of order status, customer information (with masked phone/email), and a detailed price breakup (discounts, taxes, shipping, gift cards, rewards).
    *   Introduced a `mergeRepeatedRefunds` function to consolidate multiple refund attempts into a single view.
    *   Enhanced refund functionality, including calculation of refundable amounts and disabling the refund button based on previous transactions.
    *   Dynamic currency formatting based on order data or merchant settings.
    *   Conditional display of RTO (Return to Origin) actions and scores based on merchant configuration and user permissions.
    *   Logic to disable order editing if specific reward or discount types are applied.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs` (Timestamp: 18/11/2025, 00:45:31)**
    This is an update to the core `index.html` template for the dashboard UI configuration application. Key changes include:
    *   Extensive integration of **New Relic browser monitoring**, with detailed configuration for distributed tracing, privacy, AJAX settings, and advanced features like session replay (including `mask_selector`, `block_selector`, `mask_input_options`).
    *   Conditional integration of **Clarity analytics** based on a `clarityKey`.
    *   Updates to `systemjs-importmap` URLs for various micro-frontend applications (`@gokwik/*`) across different deployment environments (local, dev, qa, sandbox, production).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (Timestamp: 18/11/2025, 00:49:40, 00:50:14, 00:58:39)**
    This file, appearing three times with identical content and close timestamps, indicates continued development on the free gift settings page:
    *   It provides a form-driven interface to create and manage free gift rules, including defining rule names, applicable sales channels, purchase requirements (cart value or quantity), and target products/collections.
    *   Allows configuration of free gift quantity, price, and the method of addition (automatic or customer selection with a limit).
    *   Uses `ProductSearch` to select specific products or collections for rule application.
    *   Displays gift rules in a table with options to toggle their status (enabled/disabled) and perform edit or delete actions.
    *   Includes validation logic for various input fields, such as minimum/maximum values and selection limits.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (Timestamp: 18/11/2025, 23:42:52)**
    A component designed for comprehensive customization of the order confirmation page:
    *   Structures customization options into collapsible panels, covering Brand Logo, Dynamic Banners, Trust Banners, Order Details, Customer Information, and Support & Communication.
    *   Each section offers granular control via switches to enable/disable visibility and various input fields for content, descriptions, and links.
    *   Extensive use of `ColorPickerHelper` for background and text color customization across different sections.
    *   Introduces a **drag-and-drop feature** to reorder the collapsible sections, allowing for dynamic arrangement of the confirmation page layout.

### Timestamps of Significant Changes:

*   **November 16, 2025, 13:10:34**: Focus on **Brand UI Customization**.
*   **November 17, 2025, 16:22:51 to 16:23:04**: Immediate follow-up on **Discount Product Search** and **Order Details** enhancements.
*   **November 18, 2025, 00:45:31 (early morning)**: Core infrastructure update with **New Relic and Clarity integration**, alongside micro-frontend URL management.
*   **November 18, 2025, 00:49:40 to 00:58:39 (early morning)**: Consecutive updates to **Free Gift Settings**.
*   **November 18, 2025, 23:42:52 (late evening)**: Major update to **Order Confirmation Page Customization** with drag-and-drop layout.

### Patterns and Recurring Elements:

*   **UI Customization Focus:** A consistent theme across multiple files (`brandPage.tsx`, `freeGift.tsx`, `collapseFields.tsx`) points to a strong emphasis on providing merchants with detailed control over the look and feel of the checkout and order confirmation pages.
*   **Component Reusability:** The `ProductSearch` component is designed to be versatile, used within discount settings, and `RenderField` and `ColorPickerHelper` are utility components used repeatedly for rendering form items and color choices across different customization forms.
*   **Merchant Configuration Management:** The `useMerchantConfigApi` hook is frequently used for fetching and saving merchant-specific settings, indicating a standardized approach to configuration management.
*   **Form-Driven UI:** Extensive reliance on `gokwik-ui-kit`'s `Form` component and `Form.useWatch` for handling complex form logic, validation, and conditional UI rendering.
*   **Micro-frontend Architecture:** The `index.ejs` clearly demonstrates the use of SystemJS import maps to manage and load various micro-frontend applications, indicating a modular development strategy.
*   **Observability:** The integration of New Relic and Clarity highlights a commitment to monitoring application performance and user behavior for continuous improvement, especially in production environments.
*   **Incremental Development:** The timestamps show a concentrated period of development, with updates across different but related areas of the dashboard (settings, orders, infrastructure).

## 15:00:59
`gokwik.pdp/src/common/services/ShippingDiscount.service.ts` (12/11/2025, 21:20:24 and 15/11/2025, 12:00:15):
This file is a Svelte service responsible for handling shipping and discount logic. Key updates involve:
- Extensive import of Svelte stores (`CommonStore`, `OrderStore`, `LoginStore`) for managing various states (e.g., cart, shipping, discounts, user info).
- Initialization of numerous local variables, many of which subscribe to these stores to reflect global state changes.
- The `callShippingDiscountApi` function initiates discount/shipping calls, clears API timers if a coupon is removed, processes responses, and handles loyalty discounts by logging events and showing confetti for valid discounts.
- The `processShippingDiscountResponse` function parses API responses to update shipping methods, shipping options, and discount information.
- Logic is included for re-applying or removing gift cards, handling cart updates, and invoking payment methods based on the state.
- Error message management is present, specifically excluding UI display for UTM auto-application failures.
- The logic around `currentPage` (page 7 in particular, often referring to the payment/shipping page) and interaction with `gyftr` (a gift card/reward system) indicates a detailed checkout flow.
- A `processDiscountShippingQueue` is used to manage API responses, suggesting a need for ordered processing of async operations.
- Between the two timestamps, there are no significant code changes, only a re-submission of the same content.

`gokwik.pdp/src/common/services/EnvironmentService.ts` (13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, and 17/11/2025, 13:02:34):
This file centralizes API endpoint URLs based on the current environment (dev, qa, sandbox, production, local, etc.).
- It exports variables `merchantUrl`, `env`, and `cashToPrepaid`, which are subscribed from `CommonStore` and `LoginStore`.
- Multiple functions (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`, `XGokwikToken`, `XKWIKPASSToken`) define base URLs for various services.
- A recurring pattern is the use of `if/else if` statements to determine the correct URL based on the `env` variable.
- There are commented-out `url` assignments in the `api_url` and `cdn_path` functions for `local` environment, suggesting frequent local testing and switching between different local development targets.
- Between the first and second timestamp, the `api_url` for `local` environment was changed from `https://api.gokwik.co` to `https://sandbox.gokwik.co`.
- Between the second and third timestamp, there are no significant changes, only a re-submission of the same content.
- Between the third and fourth timestamp, the `api_url` for `local` environment was changed from `https://sandbox.gokwik.co` to `https://api.gokwik.co`. This indicates a specific change in the default local API endpoint.

`gokwik.pdp/public/merchant.html` (13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, and 17/11/2025, 22:33:43):
This HTML file serves as a merchant integration page for the GoKwik SDK.
- It includes a JavaScript SDK (`gokwikSdk`) responsible for initializing the checkout process, managing events, and potentially hiding UI elements.
- Functions for setting and getting cookies (`getCookieGk`, `setCookieGk`) are defined and used to track landing page and referrer information.
- The `window.merchantInfo` object is configured with various IDs (`mid`, `storeId`, `fbpixel`) and an `environment` (typically 'local' in the provided logs), along with a `type`. This object is used to pass merchant-specific information to the GoKwik SDK.
- The file consistently loads `gokwik.js` from `http://localhost:8080/build/gokwik.js` for local development.
- Across multiple timestamps, the `mid` (merchant ID) in `window.merchantInfo` is repeatedly changed and commented out, indicating active development and testing across various merchant configurations. For example, from `'gh0yshvkmca4pw4'` to `'eey3k3mkrg55tcs'` to `'19g6jlssscg1r'` and then to `'19g6im5qdaj7w'`.

`gokwik.pdp/src/Components/place-order/PaymentOptions.svelte` (13/11/2025, 20:56:52, 13/11/2025, 20:58:06, 13/11/2025, 21:00:07, 13/11/2025, 21:00:59, 13/11/2025, 21:01:56, 13/11/2025, 21:03:33, 13/11/2025, 21:20:47, 13/11/2025, 21:23:51, and 15/11/2025, 12:01:15):
This Svelte component manages the payment options screen in the checkout flow.
- It imports a large number of stores from `CommonStore` and `OrderStore` to manage payment-related states, discounts, user information, and UI elements.
- Numerous local variables are declared for pricing, payment methods, discount status, and UI flags.
- The `onMount` lifecycle hook contains logic for initializing payment-related states, fetching saved cards, logging GTM and Shopify analytics events, and handling skipped payment flows.
- It subscribes to many Svelte stores to react to changes in total price, discount status, shipping options, and more.
- The component dynamically updates `isCodAvailable` based on whether a TwidPay reward is applied, indicating interaction between payment methods and rewards.
- Between 13/11/2025, 21:20:47 and 13/11/2025, 21:23:51, `store_availableOffersCheck` was added to the imports from `common/stores/OrderStore`.
- At 15/11/2025, 12:01:15, `store_isLoggedInUser` and `store_isCartUpdated` were added to imports from `common/stores/CommonStore`. Additionally, `AutomaticGiftHeader` and `GiftJourney` components were imported, suggesting the integration of free gift related UI.

`gokwik.pdp/src/Components/place-order/OrderSummary.svelte` (15/11/2025, 11:49:48 and 15/11/2025, 11:52:44):
This Svelte component displays the order summary during checkout.
- It subscribes to several stores (`LoginStore`, `CommonStore`, `OrderStore`) to retrieve and react to changes in cart details, discounts, shipping, and loyalty information.
- Key variables track `totalPrice`, `subTotal`, `couponDiscount`, `prepaidDiscount`, `codCharges`, `giftcardTotal`, `loyaltyDisplayAmount`, and `automaticDiscount`.
- The `totalPrice` is a reactive variable (`$:`) that recalculates based on various discounts, shipping costs, COD charges, gift cards, TwidPay rewards, GST, and Gyftr amounts. This highlights complex pricing logic.
- The `handleCartUpdate` function processes cart items, segregates free products, and calculates the `subTotal` and `automaticDiscount`.
- It also logs GTM and GA4 events related to viewing the order summary, indicating analytics tracking.
- There are no significant code changes between the two timestamps.

`gokwik.pdp/src/merchant/Merchant.svelte` (14/11/2025, 13:55:06, 17/11/2025, 13:00:33, 17/11/2025, 17:36:22, 17/11/2025, 18:14:56, 17/11/2025, 18:16:05, 17/11/2025, 18:16:16, and 18/11/2025, 14:25:07):
This Svelte component acts as the main entry point for the GoKwik merchant integration.
- It imports various analytics services (`CleverTap`, `Klaviyo`, `Wigzo`, `WebEngage`, `Moengage`, `Facebook`, `GAanalytics`, `Growlytics`, `Contlo`, `GA4`, `Netcore`, `Snapchat`, `edgetag`, `CustomerLabs`, `ShopifyAnalytics`, `GoogleAds`) indicating a comprehensive analytics integration.
- It also imports helper functions for cookie management, environment checks, and URL parsing.
- The `onMount` lifecycle hook initializes keyframes for animations, dispatches a 'gokwikLoaded' event, sets up environment and source URLs, and handles various query parameters (`mrid`, `gkref`, `so_token`, `gk_token`).
- It processes messages from the parent window, specifically 'merchantInfo' to launch the app and 'checkoutHealth' to check the checkout status.
- It sets cookies and local storage items related to user sessions, discounts, and analytics.
- A `truecallerConfig` object holds API keys for different environments, suggesting mobile-first authentication.
- A `sessionIDFixMerchants` array is used to exclude certain merchants from a Shopify session ID fix.
- Between 17/11/2025, 17:38:18 and 17/11/2025, 18:14:56, a new variable `cookieSessionToken` was introduced and used to store `tokenData?.coreToken`. This variable was then further modified, storing `tokenData?.coreToken` in `backupToken` initially, then directly into `cookieSessionToken` in subsequent changes.
- Across multiple timestamps, there are minor changes in comments and variable assignments related to `token` and `cookieSessionToken`, indicating debugging or refinement of token handling.

`gokwik.pdp/src/common/services/ForeignAnalytics.ts` (17/11/2025, 12:56:56, 17/11/2025, 13:43:21, 17/11/2025, 13:44:00, 17/11/2025, 13:44:52, and 17/11/2025, 14:05:25):
This file is dedicated to integrating with various foreign analytics platforms.
- It imports numerous Svelte stores to collect a wide range of data points, including discount codes, user types, order details, cart information, shipping methods, and pricing breakdowns.
- It defines many local variables to hold analytics-related data like `cart`, `risk_flag`, `commonAnalyticsData`, `coupon`, `phoneNumber`, `priceBreakup`, etc.
- It subscribes to most of the imported stores to keep its internal data structures (`priceBreakup`, `commonAnalyticsData`, `marketingData`) updated for analytics events.
- It defines `fbPixelEventsAndKeys` for mapping internal events to Facebook Pixel event names, including custom events.
- It processes `store_foreignAnalytics` to dynamically enable/disable various analytics pixels (e.g., `netcore`, `fb`, `customerlabs`).
- The `createDataObject` and `generateTrackingData` functions (not fully shown in the log) are crucial for preparing data for external analytics calls.
- The `adSourceMapping` function parses UTM parameters, indicating a focus on tracking marketing campaign effectiveness.
- Between 17/11/2025, 13:43:21 and 17/11/2025, 13:44:00, there is a minor change to add `console.log(res)` within the `store_totalPrice` subscription, likely for debugging the total value. This line was then removed in the next change, indicating a temporary debug addition.

`gokwik.pdp/src/merchant/Analytics/Contlo.ts` (17/11/2025, 13:05:00, 17/11/2025, 13:19:38, 17/11/2025, 13:45:19, 17/11/2025, 13:55:05, 17/11/2025, 14:07:01, 17/11/2025, 14:13:04, and 17/11/2025, 14:13:49, 17/11/2025, 14:14:00):
This file integrates with the Contlo analytics SDK.
- It defines a dummy `window.contlo` object with `init`, `identify`, `track`, and `push` methods, primarily for logging Contlo-related activities during development without a live SDK.
- The `createBody` function is central, preparing a standardized data object for Contlo events, including `promo_code`, `cart_total_price`, `product_id`, user details, shipping info, and UTM parameters.
- The `callContlo` function acts as a dispatcher for various checkout events (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`, `coupon_applied_failed_gk`).
- The specific event handlers (`contloMobile`, `contloPincode`, etc.) populate the `createBody` data with event-specific details.
- The `contloSendEvent` function wraps the call to the actual `window.contlo.sendEvent`, including a `try-catch` block to handle cases where the SDK is not found.
- At 17/11/2025, 13:19:38, the `window.contlo` dummy object was removed from the top of the file, implying that a real Contlo SDK might be loaded externally or that the dummy was no longer needed for that specific context.
- At 17/11/2025, 13:45:19, `console.log(data)` was added to `contloAddressAdded` for debugging, which was removed at 17/11/2025, 13:55:05.
- At 17/11/2025, 14:07:01, the `cart_total_price` in `createBody` was updated to check if `commonAnalyticsData?.cart_after_discount` is a valid number, and if so, use it; otherwise, fall back to `commonAnalyticsData?.cart_total_price`.
- At 17/11/2025, 14:13:04, the `cart_total_price` logic in `createBody` was further refined to explicitly use a `discountedAmount` variable and check `!!commonAnalyticsData?.cart_after_discount`. The same change was repeated in subsequent timestamps, likely indicating re-saves or minor formatting.

`gokwik.pdp/src/Components/common/Promotion.svelte` (17/11/2025, 22:38:42):
This Svelte component displays promotional text related to loyalty points, store credits, and gift cards.
- It imports `store_requestIdObject` from `CommonStore` and `store_page` from `LoginStore`, along with `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit` from `OrderStore`.
- It defines reactive variables (`loyaltyDisplayName`, `loyaltyDiscountText`, `creditsDisplayName`, `loyaltyEnabled`, `creditsEnabled`, `gyftrEnabled`) that dynamically update based on store values.
- The reactive block (`$:`) calculates `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` and constructs the `redeemableText` and `loyaltyDiscountText` based on which promotions are active and the current page.
- The `onMount` hook subscribes to `store_requestIdObject` to fetch custom display names for credits and loyalty.
- The component conditionally renders the promotional text if any of the promotion types are enabled and the current page is less than 3 (likely login/OTP pages).

`gokwik.pdp/src/App.svelte` (18/11/2025, 12:22:24, 18/11/2025, 12:23:52, 18/11/2025, 12:24:20, 18/11/2025, 12:24:44, and 18/11/2025, 12:25:25):
This is the main application component, orchestrating the entire checkout flow in Svelte.
- It imports a vast number of stores from `LoginStore`, `CommonStore`, and `OrderStore` to manage all aspects of the application state.
- It imports numerous components for different parts of the checkout (Address, Snackbar, Header, MobilePhoneInput, PaymentOptions, OtpInput, CodOrder, QrCode, Footer, OrderSuccessful, etc.).
- The `onMount` hook includes extensive initialization logic:
    - Setting up a `window.onpopstate` handler for back button navigation, with complex logic for different checkout pages and popup states.
    - Subscribing to `store_isLoggedInUser` to potentially show a free gift popup.
    - Subscribing to `store_confirmClose` to manage an exit confirmation popup.
    - Event listener for 'launch' messages to initialize various global stores (`sourceValue`, `localStorageObject`, `shopifySessionId`, `cashToPrepaidFlag`, `isSkipOtp`, `merchanturl`, `merchantInfo`, `environment`, `channelSource`, `channel`, `isHydrogen`, `gaCookies`, `mid`, `kwikKey`, `snapchatAttributes`).
    - Handles token management (reading from localStorage/cookies) and checks for incognito mode.
    - Sets view properties (mobile/desktop) based on parent width.
    - Logs 'checkout_assets_loaded' events with network information.
    - Logic for applying discount codes passed via event data.
- The component dynamically renders different sub-components based on `currentPage`.
- Between the multiple timestamps, there are no significant code changes, only re-saves or minor formatting.

`gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte` (17/11/2025, 23:52:04, 17/11/2025, 23:53:11, 17/11/2025, 23:53:19, 18/11/2025, 00:00:01, 18/11/2025, 00:02:54, 18/11/2025, 00:03:11, 18/11/2025, 00:03:40, 18/11/2025, 00:05:32, 18/11/2025, 00:08:46, 18/11/2025, 00:15:34, 18/11/2025, 00:21:40, 18/11/2025, 00:21:50, 18/11/2025, 00:22:39, 18/11/2025, 00:29:30, 18/11/2025, 12:19:54, 18/11/2025, 12:21:27, 18/11/2025, 12:23:13, 18/11/2025, 12:41:34, 18/11/2025, 12:43:07, and 18/11/2025, 12:45:43):
This Svelte component is dedicated to managing and displaying discounts and offers in the checkout process.
- It imports a wide array of stores from `CommonStore` and `OrderStore` to access and modify discount-related states (e.g., `discountCode`, `offers`, `stackedDiscounts`, `giftCardTotal`).
- It includes logic for applying and removing various types of discounts, including regular coupons, automatic discounts, stacked discounts, partner offers (like CredPay), gift cards, loyalty points, and Gyftr.
- The component maintains several boolean flags to control UI visibility and feature enablement (e.g., `discountCouponApplied`, `creditsApplied`, `showViewOffers`, `showOffersListing`, `disableGiftCards`, `allowDiscountApplication`).
- The reactive block (`$:`) dynamically constructs `allAppliedOffers` based on applied automatic, stacked, coupon-based, and partner acquisition offers, which is then set to `store_allAppliedDiscounts`. This is a central piece of logic for displaying active discounts.
- The `onMount` hook subscribes to `store_requestIdObject` to get configuration flags like `disable_discount_with_credits`, `disable_discount_with_giftcard`, and dynamic automatic discount lists.
- It also handles re-applying credits, processing partner offers, and calculating the length of available coupons.
- It includes conditional rendering for various discount-related UI elements such as `WalletCredits`, `AvailableOffers`, `GiftCard`, `CredPayApplied`, `Gyftr`, `TwidPay`, and `ExperimentCouponPopup`.
- Between the numerous timestamps (all within 17/11/2025 and 18/11/2025), there are no significant code changes observed. The repetitive entries suggest frequent saving or automated commits without substantive functional alterations.

`gokwik.pdp/public/kwik-checkout.html` (18/11/2025, 14:49:20, 18/11/2025, 14:50:49, 18/11/2025, 14:51:01, 18/11/2025, 14:57:07, 18/11/2025, 14:57:19, and 18/11/2025, 14:58:02, 18/11/2025, 14:58:58):
This HTML file is a public-facing checkout page that integrates the GoKwik SDK.
- It defines a `getApiUrl` function to determine API endpoints based on the environment (sandbox or production).
- It includes `setCookieGk` for setting cookies.
- The `fetchCart` function makes an XHR POST request to a Shopify cart API to retrieve cart details, which are then used to initialize the GoKwik SDK. It also sets `merchantInfo.appFlow` to `true` and adds `source`, `platform`, and `tag` attributes to the cart.
- The `initKwikCheckout` function is responsible for dynamically loading GoKwik integration scripts and various third-party analytics pixels (Facebook Pixel, Google Analytics, WebEngage, MoEngage) based on `storeInfo`.
- Functions like `createScript`, `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, and `createWebEngage` dynamically inject the necessary `<script>` tags into the document head.
- `initListeners` sets up a `window.onmessage` handler to react to `checkoutHealth` and `shopifyRedirect` events, triggering a `gk-checkout-disable` custom event if necessary. It also listens for 'hardwareBackPress' messages.
- The `DOMContentLoaded` listener parses `storeInfo` and `kp_email` from URL parameters, sets related cookies, and initializes the `initKwikCheckout` function.
- Between 18/11/2025, 14:57:07 and 18/11/2025, 14:58:02, `window.__KP_EMAIL__ = kpEmail;` was added before `kpEmail = atob(kpEmail);` in the `DOMContentLoaded` listener to ensure `__KP_EMAIL__` is set even if `atob` fails, which indicates a refinement in handling `kp_email` decoding. This was then further refined at 18/11/2025, 14:58:58 to include a `try-catch` block around `atob(kpEmail)` for `window.__KP_EMAIL__` and `localStorage.setItem('kp_email', kpEmail)` and setting `window.__KP_EMAIL__ = kpEmail;` outside the `try` block.

**General Patterns and Recurring Elements:**

1.  **Svelte Store-based State Management:** A pervasive pattern is the extensive use of Svelte stores (`store_...`) from `CommonStore`, `OrderStore`, and `LoginStore` across multiple `.svelte` and `.ts` files. This indicates a highly reactive and centralized state management architecture. Components subscribe to these stores (`.subscribe((res) => (variable = res))`) and use reactive declarations (`$:`) to update UI or logic when store values change.
2.  **API Endpoint Configuration:** `EnvironmentService.ts` consistently defines API URLs based on the `env` variable, demonstrating a robust environment-specific configuration strategy for various services (health, address, core API, experiments, CDN, analytics, etc.). There are frequent minor adjustments to local environment URLs, suggesting active development and testing.
3.  **Analytics Integration:** There's a strong emphasis on integrating with multiple analytics platforms (CleverTap, Klaviyo, WebEngage, Moengage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, edgetag, CustomerLabs, ShopifyAnalytics, GoogleAds). This is evident in `Merchant.svelte` importing all these services and `ForeignAnalytics.ts` acting as a central hub for data preparation and dispatch to these services. The `Contlo.ts` file shows event-specific data structuring and logging.
4.  **Checkout Flow Logic:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files demonstrate intricate logic for managing a multi-step checkout process, including:
    *   Applying/removing discounts (coupons, automatic, stacked, partner-based).
    *   Handling gift cards and loyalty points.
    *   Processing shipping options and methods.
    *   Managing COD (Cash on Delivery) confirmation and charges.
    *   Reacting to cart updates and user interactions.
    *   Conditional UI rendering based on applied offers or payment states.
5.  **Cookie and Local Storage Management:** Both `merchant.html` and `Merchant.svelte` heavily rely on cookies and local storage for persisting session information, user tokens, UTM parameters, and various checkout-related flags. Functions like `getCookieGk`, `setCookieGk`, `setCookie`, `getCookie`, `localStorage.setItem`, `localStorage.getItem` are frequently used.
6.  **URL Parameter Handling:** Query parameters in the URL (`mrid`, `gkref`, `so_token`, `gk_token`, `kp_email`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid`, `utmParams`) are actively parsed and used to initialize the application state and track user journeys.
7.  **Dynamic Script Loading:** `kwik-checkout.html` dynamically loads integration scripts and analytics pixels, allowing for flexible and environment-specific inclusion of external resources.
8.  **Event Logging:** `logEvent` (from `EventService.ts`) and `fireGtmEvent` are widely used across components and services to track user actions and application states for analytics and debugging.
9.  **Debugging Practices:** The presence of `console.log` statements, commented-out code blocks, and temporary variable assignments (`backupToken`) indicates ongoing development, testing, and debugging efforts.
10. **Consistent Timestamp Pattern:** The timestamps indicate work occurring primarily on December 11th, 13th, 14th, 15th, and 17th-18th, 2025, often with multiple changes to the same file within a short period, suggesting focused work sessions on specific components.

## 17:01:08
/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts
The `ShippingDiscount.service.ts` file was modified on `12/11/2025, 21:20:24` and again on `15/11/2025, 12:00:15`. Both updates involved a significant number of Svelte store imports (`CommonStore`, `OrderStore`, `LoginStore`) and service imports (`EventService`, `GiftCard.service`, `Discounts.service`, `Helper.service`, `PaymentOptions.service`, `Gyftr.service`, `MerchantAPI`, `ForeignAnalytics`).
The changes primarily revolve around:
- **State Management**: Subscribing to numerous Svelte stores (e.g., `store_gstInfo`, `store_discountCode`, `store_shippingAsProduct`, `store_page`, `store_giftCardRewards`, `store_addressAdded`, `store_gyftr`, `store_minPrice`, `store_isCartUpdated`, `store_offers`, `store_skipToPayment`, `store_isAbandonCart`, `store_selectedAddress`, `store_shippingOptionsResponse`, `store_autoSelectShippingFlag`, `store_freeShipping`, `store_selectedShippingMethod`, `store_giftCard`, `store_requestIdObject`, `store_discountBasedRewards`, `store_stackedDiscounts`, `store_captureApiTimerId`, `store_windowRedirectionFlow`, `store_discountExperimentFlag`, `store_isSuccessFlowEnabled`, `store_cartjsObject`, `store_merchantInfo`, `store_placeOrder`, `store_bottomSheetState`, `store_utmDiscounts`).
- **Discount and Shipping Logic**: Introduction of `processDiscountShippingQueue` for API call queuing. Logic for applying discounts, handling loyalty points, and showing confetti for valid discounts (especially for `shopify_based_cohort` or `csv_based_cohort` user types, or when `show_discount_confetti` is enabled and `disable_discount_application` is false).
- **Error Handling**: Setting `store_discountCallStatus` to 'started' and handling cases where `response?.statusCode` is not 200. Specific error message for `invalidChannel` discount response.
- **Cart and Gift Card Updates**: Logic to reapply gift cards (`reapplyGiftCards`) and update `store_twidPay` state when the cart is modified (`modified_cart`) or gift cards are present.
- **Shipping Options**: Managing `store_selectedShippingMethod` and `addressListingBottomSheet()` based on shipping options and current page.
- **Redirection Flows**: Handling `isWindowRedirectionFlow` and `isRedirectionFlowEnabled` for page redirections.
- **UTM Discounts**: Special handling for displaying error messages when UTM auto-apply discounts or shipping options calls fail.
- **Date pattern**: The timestamps indicate that changes happened on `12/11/2025` and `15/11/2025`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts
This file was modified several times on `13/11/2025` and `15/11/2025`, and `17/11/2025`. The changes consistently focus on defining and conditionally setting various base URLs and tokens based on the current environment (`env`), which can be 'dev', 'qa', 'sandbox', 'production', 'local', 'hdev', 'ndev', 'idev', 'qa-rto', 'qaone', 'qatwo', or 'pci-prod'.
Key updates include:
- **Environment-based URL Configuration**: Functions like `getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, and `proxy_service_url` all dynamically determine their return URL based on the `env` variable.
- **Local Environment Overrides**: For `env === 'local'`, several URLs are commented out, and specific local or sandbox URLs are often assigned (e.g., `api_url` changes from `https://api.gokwik.co` to `https://sandbox.gokwik.co` in one update, then back to `https://api.gokwik.co` in another, and then again to `https://sandbox.gokwik.co`).
- **Token Management**: The `XGokwikToken` and `XKWIKPASSToken` functions also return environment-specific tokens, like 'SANDBOXKWIKSESSIONTOKEN', 'KWIKSESSIONTOKEN', and 'QAKWIKSESSIONTOKEN'.
- **Date pattern**: The timestamps show continuous updates to environment-specific URL configurations, mainly on `13/11/2025`, `15/11/2025`, and `17/11/2025`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html
This file was modified multiple times on `13/11/2025`, `15/11/2025`, and `17/11/2025`. The core structure remains the same, but the `merchantInfo.mid` configuration within the inline JavaScript is frequently changed.
Key updates include:
- **Gokwik SDK Integration**: An inline JavaScript `gokwikSdk` is defined to handle checkout processes, event subscriptions (`on`, `emit`), and script injection (`init`). It loads `gokwik.js` from `http://localhost:8080/build/gokwik.js`.
- **Cookie Management**: Functions `getCookieGk` and `setCookieGk` are present for managing `gk_landing_page` and `gk_orig_referrer` cookies.
- **Merchant Information Configuration**: The `window.merchantInfo` object, which contains `mid`, `environment`, `type`, `storeId`, and `fbpixel`, is updated across various commits. The `mid` value is commented out and changed multiple times to different IDs (`eey3m1vkrm1rbo7`, `3mt5u7n3w2kzqua196`, `1o0jov7jskptrcc74`, `19g6ilbanckg6`, `eey3k3mkrg55tcs`, `19g6jlssscg1r`, `19g6jm2k24jlo`). The `environment` is consistently set to 'local'.
- **Analytics Integration**: An `analytics-js` script is dynamically created and appended to the head.
- **Event Handling**: `window.onmessage` and `document.onreadystatechange` listeners are configured to interact with the Gokwik SDK.
- **Date pattern**: Consistent updates, mostly to the `mid` within `merchantInfo`, on `13/11/2025`, `15/11/2025`, and `17/11/2025`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte
This Svelte component was modified several times on `13/11/2025` and `15/11/2025`.
Key updates include:
- **Store Imports**: Continuous addition of imports from `CommonStore` and `OrderStore` to manage various aspects of payment options, discounts, and UI states (e.g., `store_availableOffersCheck`, `store_isLoggedInUser`, `store_isCartUpdated`).
- **State Variables**: Initialization of numerous Svelte component state variables for managing payment methods, discount details, COD status, screen width, and experiment variants.
- **Lifecycle Hooks (`onMount`)**: The `onMount` lifecycle hook contains logic to:
    - Set `store_prepaidDiscount` to 0.
    - Subscribe to `store_paymentMethods` to populate `paymentMethods`.
    - Log UPI presence and fetch previously used UPI IDs.
    - Process and set the `latestSavedCard`.
    - Fire GTM and Shopify analytics events on page load.
    - Reset `store_binResponse`, `store_pageName`, `store_paymentAttempts`, `store_cardPaymentFailed`, and `store_disablePaymentLink`.
    - Handle skip-to-payment flow and email mismatch messages.
    - Call `callPaymentMethods` based on `store_placeOrder` and `store_shippingOptionsResponse`.
    - Manage various subscriptions (`store_totalPrice`, `store_discountCallStatus`, `store_twidPay`, `store_shopifyStoreCredit`, `store_moveToAddressListing`, `store_screen_width`, `store_paymentPageText`, `store_preferredPaymentPanel`, `store_allowedPaymentMethods`, `store_codPaymentFailed`, `store_paymentsGeneralConfig`, `store_showLimitedPaymentOptions`, `store_showDiscountBasedOnRisk`, `store_offers`, `store_recommendedOptions`).
    - Fetch experiment variants.
    - Log events related to OFPL and Bajaj Finserv EMI methods.
- **Reactive Statements (`$:`)**: A reactive statement updates `store_onpl.isCodAvailable` based on whether `store_twidPay` has an applied reward.
- **New Imports**: Added imports for `AutomaticGiftHeader.svelte` and `GiftJourney.svelte` in one of the later changes, suggesting new UI components for free gifts.
- **Date pattern**: Multiple, almost identical, saves on `13/11/2025` indicate minor tweaks or frequent saving during development. A more substantial change including new imports is observed on `15/11/2025`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte
This Svelte component was modified twice on `15/11/2025`.
Key updates include:
- **Store Imports**: Expanded imports from `LoginStore`, `CommonStore`, and `OrderStore` for managing cart details, discounts, loyalty, shipping, and payment information.
- **State Variables**: Declaration of numerous state variables related to cart items, discounts, gift cards, loyalty programs, and UI visibility.
- **Function `toggleCartDrawer`**: Implemented to control the visibility of the order summary drawer and log GTM and analytics events.
- **Function `toggleBundleVisibility`**: Added to manage the expanded state of product bundles within the order summary.
- **Subscriptions (`onMount`)**: Subscriptions to various stores are set up to react to changes in `store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`.
- **Function `handleCartUpdate`**: Centralized logic for processing cart updates, including calculating automatic discounts, segregating free products (for BXGY offers), and updating `subTotal`.
- **Reactive Statements (`$:`)**: A complex reactive statement dynamically calculates `totalPrice` based on numerous factors including discounts, shipping, gift cards, COD charges, TwidPay rewards, GST, and Gyftr amounts. It also updates `store_totalPrice`.
- **Loyalty Display Logic**: Updates to how `loyaltyDisplayAmount` is calculated based on `earnedLoyaltyDetails?.on_field`.
- **Date pattern**: Both changes occurred on `15/11/2025` within a short time frame, suggesting iterative development on the order summary logic.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts
This file was modified several times on `17/11/2025`.
Key updates include:
- **Store Subscriptions**: Extensive subscriptions to both `LoginStore` and `OrderStore` to gather a wide array of data for analytics events. This includes discount codes, user types, cart details, shipping methods, payment methods, request IDs, merchant info, prices, cookie information, and more.
- **Analytics Configuration (`configObject`)**: The `configObject` is populated based on `store_foreignAnalytics` to enable/disable specific analytics pixels (e.g., `ga4`, `netcore`, `fb`, `customerlabs`). It also checks `kwikOptimizerPixelIds` to enable custom Facebook pixel events.
- **Price Breakup Object**: A `priceBreakup` object is initialized and updated through various store subscriptions to track `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
- **Marketing Data**: The `marketingData` object is populated with `Landing Page`, `Origin Referrer`, and various UTM parameters (`Utm Source`, `Utm Medium`, `Utm Campaign`, `Utm Term`, `Utm Content`) from `store_shopifyCookieInfo` and `store_sourceValue`.
- **Helper Functions**: `checkSnapchatPixel`, `prefilledAddress`, `getDecodedURIComponent`, and `adSourceMapping` are utility functions to assist in data preparation for analytics.
- **Date pattern**: All changes occurred on `17/11/2025`, with minor adjustments indicating ongoing development and refinement of analytics data collection and processing. The `console.log(res)` in `store_totalPrice.subscribe` on `17/11/2025, 13:55:47` suggests debugging efforts.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte
This Svelte component was modified several times from `14/11/2025` to `19/11/2025`.
Key updates include:
- **Core SDK Integration**: It serves as the main integration point, importing numerous analytics services (`CleverTap`, `Klaviyo`, `Wigzo`, `WebEngage`, `Moengage`, `Facebook`, `GAAnalytics`, `Growlytics`, `Contlo`, `GA4`, `Netcore`, `Snapchat`, `edgetag`, `CustomerLabs`, `ShopifyAnalytics`, `GoogleAds`).
- **Helper Service Imports**: Imports helper functions for cookie management, environment checks, URL manipulation, and more (`checkIfAndroid`, `setCookie`, `getCookie`, `deleteCookie`, `checkIfGlanceEnvironment`, `checkMerchantHealth`, `getPath`, `checkIfEmailBuggy`, `getIframeUrl`, `decryptEmail`, `isBase64`, `getGkCookieArray`, `isWhatsAppWebView`).
- **State Variables**: Declaration of extensive state variables for merchant details (`mid`, `url`, `environment`, `merchantInfo`), cart information (`cartObject`, `cartError`), user session details (`token`, `sessionId`, `shopifySessionId`, `kwikpass_user_token`), analytics attributes (`snapchatAttributes`, `fbExternalId`, `kpFbCliId`, `gaCookies`), and UI flags (`showModal`, `removeLoadingScreen`, `isAbandonCart`, `cashToPrepaidFlag`). A `backupToken` variable was introduced on `17/11/2025, 18:14:56` and subsequently `cookieSessionToken` was introduced on `17/11/2025, 18:14:56` and refined in later commits.
- **Truecaller Integration**: Configuration for Truecaller (`truecallerConfig`) based on environment.
- **CSS Injection**: `insertKeyframes` function dynamically injects CSS styles.
- **Session ID Fix for Merchants**: `sessionIDFixMerchants` array is used to handle specific merchant IDs for `shopifySessionId` logic.
- **Lifecycle Hooks (`onMount`)**: The `onMount` hook performs several critical actions:
    - Inserts keyframes and dispatches `gokwikLoaded` event.
    - Checks `isGlanceEnvironment` and sets `url`, `sourceUrl`, `environment`.
    - Adds prefetch tags and checks for iOS Safari.
    - Parses URL parameters (`mrid`, `gkref`, `src`, `ch`, `kwik`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid`, `so_token`) to populate various state variables and cookies.
    - Extracts `jwtTokensArray` and adds `message` event listeners.
    - Handles `merchantInfo` messages, setting cookies and launching the app.
    - Manages `gk_token` for coreToken and local storage.
    - Handles `cartOpen` and `checkoutHealth` messages.
    - Checks for Android and retrieves available UPI apps.
    - Configures Cash to Prepaid options.
- **Cookie and Local Storage Management**: Functions `setCookiesOnCheckoutLoad`, `getKpParamForFb`, `getGaCookies`, and `setCashToPrepaidConfigs` are crucial for persistence and data transfer.
- **Date pattern**: Frequent, almost daily, updates from `14/11/2025` to `19/11/2025`, suggesting active development and debugging. Specifically, the introduction of `backupToken` and `cookieSessionToken` variables suggests efforts to refine token handling and persistence.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts
This file was modified several times on `17/11/2025`.
Key updates include:
- **Contlo SDK Emulation**: The file starts with a dummy `window.contlo` object to log calls to `init`, `identify`, `track`, and `push`, indicating that the Contlo SDK is integrated but might not always be present at runtime.
- **Data Structuring (`createBody`)**: The `createBody` function is central, assembling a comprehensive data object for Contlo events. This object includes `tag`, `promo_code`, `cart_total_price`, `product_id`, user details (first name, last name, email, address, city, state, pincode, address type), `shipping_method`, `abc_url`, and marketing data (landing page, origin referrer, UTM parameters).
- **Cart Total Price Handling**: On `17/11/2025, 14:07:01`, the `cart_total_price` logic was updated to check if `commonAnalyticsData?.cart_after_discount` is a valid number before using it, falling back to `commonAnalyticsData?.cart_total_price`. This was further refined on `17/11/2025, 14:13:04` to explicitly parse `discountedAmount` to a number and check `!!commonAnalyticsData?.cart_after_discount`.
- **Event Dispatching (`callContlo`)**: The `callContlo` function acts as a dispatcher, calling specific Contlo helper functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) based on the `eventName`.
- **Specific Event Handlers**: Each `contloX` function (e.g., `contloMobile`, `contloPincode`) constructs event-specific data and calls `contloSendEvent`.
- **Safe Event Sending (`contloSendEvent`)**: The `contloSendEvent` function includes a `try-catch` block to handle cases where the `window.contlo.sendEvent` method might not be available, logging a message instead.
- **Date pattern**: Multiple modifications on `17/11/2025` suggest ongoing development and refinement of Contlo analytics event data.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html
This HTML file for `kwik-checkout` was modified several times on `18/11/2025`.
Key updates include:
- **Dynamic Script Loading**: The `initKwikCheckout` function is responsible for loading various integration and pixel scripts (`gokwikIntegration`, `analyticsJs`, `FbPixel`, `GoogleAnalytics`, `MoEngage`, `WebEngage`) based on `storeInfo` (merchant details) and environment (`production` or `sandbox`).
- **Cart Fetching Logic**: The `fetchCart` function makes an XMLHttpRequest to a Shopify cart API to retrieve cart data. This data is then used to initialize the `gokwikSdk`. The endpoint `'/v1/user/shopify-cart'` is used.
- **Inline Analytics Pixel Setup**: Functions like `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, and `createWebEngage` dynamically inject the necessary JavaScript for these analytics services.
- **Event Listeners**: `initListeners` sets up `window.onmessage` and `document.addEventListener('message')` to handle events like `checkoutHealth`, `shopifyRedirect`, and `hardwareBackPress`.
- **DOMContentLoaded Handler**: This block parses URL parameters (`storeInfo`, `kp_email`) and sets various cookies (`_shopify_s`, `gk_landing_page`, `gk_orig_referrer`, `_shopify_sa_p`) based on UTM parameters from the `storeInfo`.
- **KpEmail Handling**: Specifically on `18/11/2025, 14:58:58`, a `try-catch` block was added around `atob(kpEmail)` indicating a potential issue with base64 decoding of `kp_email`. If decoding fails, the raw `kpEmail` is still used and stored.
- **Date pattern**: Multiple, minor changes occurred on `18/11/2025`, suggesting a focused debugging or refinement session on this integration file.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte
This Svelte component was modified on `17/11/2025, 22:38:42`.
Key updates include:
- **State Variables**: Initialization of `loyaltyDisplayName`, `loyaltyDiscountText`, `creditsDisplayName`, `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled`.
- **Reactive Logic (`$:`)**: A complex reactive block dynamically determines the `redeemableText` based on the enabled status of `store_useStoreCredit` (loyalty), `store_requestIdObject?.store_credits` (credits), `store_enableGiftCard` (gift cards), and `store_gyftr?.status` (Gyftr). It also sets `loyaltyDiscountText` based on the `currentPage`.
- **Lifecycle Hook (`onMount`)**: Subscribes to `store_requestIdObject` to dynamically update `creditsDisplayName` and `loyaltyDisplayName` from custom configurations.
- **Conditional Rendering (`#if`)**: The component conditionally renders a `div` containing `loyaltyDiscountText` only if gift cards, loyalty, credits, or Gyftr are enabled, the page is less than 3, and `loyaltyDiscountText` is not empty.
- **Debugging Information**: Includes `JSON.stringify` calls for debugging the state of `store_enableGiftCard`, `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled`.
- **Styling**: Basic SCSS styling for `.discount-text-wrapper` is provided.
- **Date pattern**: A single change on `17/11/2025` suggests a specific feature or bug fix related to displaying promotional text.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte
This Svelte component was heavily modified multiple times from `17/11/2025` to `18/11/2025`.
Key updates include:
- **Extensive Store Imports**: Imports from `CommonStore` and `OrderStore` were continuously updated to manage various discount-related flags, data, and UI states. New imports such as `store_showHidePaymentOffers` and `store_exitPopupFlow` were added.
- **State Variables**: Numerous state variables are declared to control the display and behavior of discounts, including `couponField`, `discountInput`, `discountCouponApplied`, `recommendedCouponCode`, `earnedLoyaltyDetails`, `discountDrawer`, `creditsApplied`, `storeCreditAvailable`, `cartAutoDiscount`, `applicableCredits`, `showViewOffers`, `showOffersListing`, `discountWhitelisted`, `showGiftCardInput`, `boatUi`, `newOfferCount`, `showNewDiscount`, `promotionalDiscountValid`, `totalSavedAmount`, `cashbackData`, `disable_discount_with_credits`, `disable_discount_with_giftcard`, `disable_cod_with_loyalty`, `disableGiftCards`, `loyaltyApp`, `discountTitle`, `partnerAcquisitionOffer`, `showCredInOffers`, `shouldApplyCredOffer`, `appliedAutomaticDiscounts`, `appliedAutomaticDiscountsWithAmount`, `stackedDiscountConfig`, `allowDiscountApplication`, `availableCouponsLength`, `oneClickCoupon`, `shopifyAvailableOffers`, `filterDiscountOffers`, `dynamicAutomaticExtraDiscountList`, `dynamicAutomaticOverwriteDiscountList`, `isLoyaltySectionVisible`, `isSpecialOffersVisible`, `discountCoupon`, `isOverwriteAutomaticenabled`, `isApplicableDiscountPresent`, `isExtraAutomaticEnabled`, `allAppliedOffers`, `couponListUpdated`, `availableAutoOffers`, `loyaltyDisplayName`, `showShimmer`, `bestDiscount`, and `hasShownPopup`.
- **Reactive Statements (`$:`)**:
    - `loyaltyDisplayName` is reactively updated from `store_requestIdObject`.
    - `isPromotionalDiscount()` function is called reactively.
    - The `allAppliedOffers` array is dynamically constructed based on `appliedAutomaticDiscounts`, `stackedDiscountConfig`, `discountCouponApplied`, `couponField`, `creditsApplied`, `disable_discount_with_credits`, and `store_partnerAcquisitionOffer`. This array is then set to `store_allAppliedDiscounts`.
- **Lifecycle Hook (`onMount`)**:
    - Subscribes to `store_requestIdObject` to retrieve custom config for discount behaviors (e.g., `disable_discount_with_credits`, `loyalty_app_v2`, `dynamic_automatic_extra_discounts`, `enable_extra_automatic_discounts`).
    - Subscribes to `store_reapplyEr` to reapply credits.
    - Subscribes to `store_stackedDiscounts` to manage stacking behavior and `allowDiscountApplication` based on the number of clubbed discounts.
    - Subscribes to `store_offers` to process available discounts, filter them for display, and handle partner offers.
- **Unsubscribe Variables**: A long list of `unsubscribe` variables (`unsubscribeDiscountDrawer`, `unsubscribePage`, etc.) are declared, indicating cleanup logic for store subscriptions (though `onDestroy` hook content is not provided).
- **Date pattern**: Very frequent modifications on `17/11/2025` and `18/11/2025`, often with minimal content changes, suggest an active and iterative development or debugging process on this complex component, likely related to discount and offer management. The changes reflect continuous adjustments to how discounts are applied, stacked, and displayed in the UI.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte
This Svelte application's main component was modified several times on `18/11/2025`.
Key updates include:
- **Extensive Store Imports**: A very large number of Svelte stores from both `LoginStore` and `CommonStore` are imported, reflecting the central role of this component in managing global application state.
- **Service Imports**: Imports many services (`EnvironmentService`, `EventService`, `MerchantAPI`, `ForeignAnalytics`, `Helper.service`, `Login.service`, `Discounts.service`).
- **Component Imports**: Imports numerous Svelte components (`Address`, `Snackbar`, `Header`, `MobilePhoneInput`, `PaymentOptions`, `OtpInput`, `ConfirmPopup`, `AddressListing`, `OrderPage`, `LoadingScreen`, `CodOrder`, `QrCode`, `Footer`, `OrderSuccessful`, `PaymentFailedUpi`, `CardPaymentScreen`, `BottomSheet`, `ErrorPage`, `FullScreenPopUp`, `WalletBnplPayments`, `AdoncError`, `CardEmi`, `NetBanking`, `GokwikBnpl`, `CredPromotion`, `AutomationData`, `OtpBnpl`, `TwidBankPayment`, `FirstPageLazyLoad`, `IframeComponent`, `KpEmailPopup`, `CapturePaymentSuccess`, `OrderSummary`).
- **State Variables**: Declaration of numerous state variables (`currentPage`, `orderType`, `abcError`, `loaderArray`, `primaryColor`, `isAbandonCart`, `confirmExit`, `cartObject`, `enableExtraAutomaticDiscounts`, `dynamicAutomaticExtraDiscounts`, `mobileView`, `desktopView`, `isSkipOtp`, `discountAnimation`, `cashToPrepaid`, `soToken`, `isPartnerAcquisionViewOfferApplied`, `discountBody`, `enableOverwriteAutomaticDiscounts`, `dynamicAutomaticOverwriteDiscounts`, `token`, `kwikpassToken`, `parentWidth`, `kpEmail`, `isCookieDiscountApplicable`, `isTwidAvailable`, `allAddress`, `isEmailFromKpEditable`, `redirectionFlowInfo`, `checkoutAnywhereDiscountCode`, `utmHeadlessParams`, `isNotIncognito`).
- **Lifecycle Hook (`onMount`)**: This is a very large and critical `onMount` block:
    - Manages browser history state for back button navigation.
    - Implements logic for `window.onpopstate` to handle navigation, popups, and confirmations (`store_confirmClose`, `store_popupState`, `store_bottomSheetState`).
    - Subscribes to `store_isLoggedInUser` to potentially open a free gift popup.
    - Subscribes to `store_confirmClose` to show an exit confirmation popup.
    - Calls `getAddressComponent` to dynamically load address components.
    - Handles `message` events from the window, specifically 'launch' events which initialize a vast amount of application state from `gokwikEvent.data` (source, local storage, environment flags, session IDs, merchant info, channel info, analytics cookies).
    - Manages token and `kwikpassToken` persistence in local storage and cookies, with a `try-catch` block for incognito mode detection.
    - Sets numerous common and order-specific store values based on `gokwikEvent.data`.
    - Includes `logEvent` calls for `checkout_assets_loaded` and `gift_auto_popup_shown`.
- **Styling Imports**: Imports `PaymentOptions.scss` and `global.scss`.
- **Date pattern**: Multiple, very similar commits on `18/11/2025` indicate an active and iterative development or debugging process. The `logEvent` calls for `checkout_assets_loaded` appearing twice in the same `onMount` block in several commits might suggest a temporary duplication during development or a specific logging requirement.

**Recurring Elements and Patterns:**
1.  **Svelte Stores**: A consistent pattern across Svelte components (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, `Discounts.svelte`, `App.svelte`) is the extensive use of Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_requestIdObject`, `store_discountCode`, `store_totalPrice`, `store_merchantInfo`) for centralized state management and reactive data flow. Components subscribe to these stores (`.subscribe((res) => ...)`), and update them (`.set(...)`, `.update(...)`).
2.  **Lifecycle Hooks (`onMount`)**: The `onMount` lifecycle hook is heavily utilized in Svelte components to perform initial setup, subscribe to stores, fetch data, and set up event listeners. This indicates a pattern of initializing component state and behavior when it's first mounted to the DOM.
3.  **Analytics Integration**: Many files, especially `Merchant.svelte` and `ForeignAnalytics.ts`, are deeply concerned with analytics tracking. There's a recurring pattern of integrating and dispatching events to various analytics platforms (CleverTap, Klaviyo, WebEngage, Moengage, Facebook, Google Analytics, GA4, Snapchat, Contlo, Netcore, CustomerLabs, ShopifyAnalytics, GoogleAds). Data for these events is often gathered from multiple Svelte stores and prepared in a `commonAnalyticsData` object.
4.  **Environment-Specific Configuration**: The `EnvironmentService.ts` file clearly demonstrates a pattern of configuring URLs and tokens dynamically based on the deployment environment (dev, qa, sandbox, production, local, etc.). This is a critical pattern for managing different backend endpoints and API keys across various stages of development and deployment.
5.  **Cookie and Local Storage Management**: Functions for `setCookie`, `getCookie`, `localStorage.setItem`, and `localStorage.getItem` are frequently used in `Merchant.svelte` and `ForeignAnalytics.ts` to persist user data, session information, and tracking IDs, often with environment-specific naming conventions for tokens.
6.  **Discount and Offer Management**: A significant portion of the code in `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` deals with applying, removing, stacking, and displaying various types of discounts, gift cards, loyalty points, and promotional offers. There's complex logic to calculate `totalPrice` based on these factors.
7.  **Error Handling and Fallbacks**: Basic error handling is present (e.g., `try-catch` blocks, checking `statusCode`, setting error messages). There's also logic for redirection and fallback mechanisms in case of checkout failures or unavailable app integrations.
8.  **Frequent Iteration on `merchant.html` and `EnvironmentService.ts`**: The `merchant.html` often sees updates to the `mid` (merchant ID) within `window.merchantInfo`, and `EnvironmentService.ts` frequently has its environment-specific URLs adjusted. This suggests active development, testing, and switching between different merchant configurations and environments.
9.  **Debugging Logs**: Presence of `console.log` statements in various files (e.g., `merchant.html`, `ForeignAnalytics.ts`, `Contlo.ts`) indicates active debugging during development.
10. **Timestamps Pattern**: The timestamps for `PaymentOptions.svelte`, `Discounts.svelte`, `ForeignAnalytics.ts`, `Merchant.svelte`, `EnvironmentService.ts`, and `merchant.html` show multiple, closely spaced modifications, especially on `13/11/2025`, `17/11/2025`, and `18/11/2025`. This is characteristic of a developer actively working on these files, making small adjustments and saving frequently.

## 18:01:25
/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts
* **Timestamp**: 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
* **Summary**: This file, responsible for shipping and discount logic, underwent significant refactoring and state management updates. It imports numerous stores from `CommonStore` and `OrderStore` to manage various checkout states like discounts, shipping options, gift cards, loyalty rewards, and UI elements.
    * **Key Changes**:
        * Extensive store subscriptions (`store_gstInfo`, `store_discountCode`, `store_shippingOptionsResponse`, `store_requestIdObject`, etc.) are established to reactively update local variables.
        * `callShippingDiscountApi` and `processShippingDiscountResponse` functions handle the core logic of applying/removing discounts and processing API responses.
        * Introduced a `createApiResponseQueue` to manage asynchronous API calls for discounts.
        * Added logic for displaying confetti animation upon successful discount application for specific user cohorts or when `show_discount_confetti` is enabled.
        * Implemented conditional logic to remove or reapply "gyftr" discounts based on the current page and `placeOrder` status.
        * Added logging for "loyalty_points_applied" event with details like provider, redeemed credits, and auto-application status.
        * Included handling for `invalidChannel` error messages for discounts.
        * Refined gift card handling on cart updates, reapplying existing gift cards if `modified_cart` is true.
        * Updated logic for displaying loaders and managing `skipToPayment` and `bottomSheetState` based on API responses.
        * Introduced logic to manage error messages, specifically excluding UI error messages for "utm auto application" failures.
        * Added a `discount_shipping_retry` mechanism with a timeout for setting the selected shipping method.
    * **Pattern**: Heavy reliance on Svelte stores for reactive state management across different parts of the application (common, order, login). Asynchronous operations for discounts are queued and processed. Event logging (GTM, custom events) is prominent, especially for discount and loyalty interactions.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html
* **Timestamp**: 13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, 17/11/2025, 22:33:43
* **Summary**: This file represents the merchant's checkout page, embedding the GoKwik SDK.
    * **Key Changes**:
        * The `gokwikSdk` IIFE (Immediately Invoked Function Expression) is responsible for initializing the GoKwik checkout, handling messages from the modal, and managing UI elements like hiding buttons.
        * `init` function conditionally loads the `gokwik.js` script and removes specific CSS classes if elements are disabled. It also supports loading multiple scripts if `params` are provided.
        * `hideButton` uses `setInterval` to continuously check for and hide `.gokwik-container` elements.
        * Functions `getCookieGk` and `setCookieGk` are defined for managing custom GoKwik cookies (`gk_landing_page`, `gk_orig_referrer`).
        * The `window.merchantInfo` object, crucial for configuring the GoKwik SDK, is updated across several commits. The `mid` (merchant ID) is frequently changed or commented out to test different merchant configurations (e.g., `qa`, `sandbox-test`, `prod`, `plus store`, `sandbox-auto`). The `environment` is consistently set to 'local' for development.
        * An `analytics-js` script is conditionally created and appended to the head, suggesting a custom analytics integration.
        * Event listeners are in place for 'Gokwik ready!' and `merchantInfo` messages from the iframe to trigger `launchApp`.
    * **Pattern**: Frequent updates to `window.merchantInfo.mid` for various testing scenarios, indicating active development and testing across different merchant environments. Consistent use of cookie management for tracking landing page and referrer information. The `gokwikSdk` acts as the primary interface for integrating GoKwik checkout.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte
* **Timestamp**: 13/11/2025, 20:56:52 to 13/11/2025, 21:25:07 and 15/11/2025, 12:01:15
* **Summary**: This Svelte component manages the payment options screen during checkout.
    * **Key Changes**:
        * **Extensive Store Imports**: Imports a very large number of Svelte stores from both `CommonStore` and `OrderStore`, indicating a highly reactive and interconnected state management system. These stores cover everything from discount codes, payment status, UI states (bottom sheets, loaders), user information, cart details, experimental flags, and various payment-specific configurations.
        * **Initialization Logic (`onMount`)**:
            * Sets `store_prepaidDiscount` to 0.
            * Subscribes to `store_paymentMethods` to update local `paymentMethods` array.
            * Logs UPI presence and fetches previously used UPI IDs.
            * Processes all saved cards and sets the `latestSavedCard`.
            * Fires GTM event (`payment_step_landed`) and Shopify analytics event (`shopifyPaymentStepReached`).
            * Resets various error and loader states (`store_adoncLoader`, `store_binResponse`, `store_cardPaymentFailed`).
            * Logs events for "payment_step_landed" and "email_mismatch_message_shown" based on `skipToPayment` and `kpEmail` states.
            * Calls `callPaymentMethods` conditionally based on `store_placeOrder` and TwidPay status.
            * Subscribes to numerous stores to update local component state (e.g., `totalPrice`, `discountCallStatus`, `twidPay`, `shopifyStoreCredit`, `moveToAddressListing`, `screen_width`, `paymentPageText`, `preferredPaymentPanel`, `allowedPaymentMethods`, `codPaymentFailed`, `paymentsGeneralConfig`, `showLimitedPaymentOptions`, `showDiscountBasedOnRisk`, `offers`, `recommendedOptions`).
        * **Reactive Statements (`$:` block)**: Updates `store_onpl`'s `isCodAvailable` based on whether a TwidPay reward is applied.
        * **New Imports**: Added `AutomaticGiftHeader` and `GiftJourney` components, indicating new features related to free gifts.
        * **New Store Subscriptions**: Subscribed to `store_isLoggedInUser` and `store_isCartUpdated` in the latest commit (15/11/2025, 12:01:15).
        * **Removed `calculateLoadTime` import**: This was removed in the 15/11/2025, 12:01:15 commit.
        * **`store_availableOffersCheck` import**: Added in the 13/11/2025, 21:22:28 commit.
    * **Pattern**: Very high dependency on Svelte stores for dynamic UI updates and data flow. Extensive event logging for analytics. Conditional logic for displaying UI elements and triggering API calls based on various state variables. Frequent addition of new stores and components, suggesting ongoing feature development and refinement of payment flows.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte
* **Timestamp**: 14/11/2025, 13:55:06 to 19/11/2025, 15:54:13
* **Summary**: This Svelte component acts as the main entry point for the merchant-side integration of the GoKwik checkout, handling initialization, cookie management, analytics integrations, and communication with the GoKwik iframe.
    * **Key Changes**:
        * **Environment-specific Truecaller Config**: The `truecallerConfig` object holds API keys specific to different environments (local, dev, production, sandbox, qa, qatwo), indicating a robust multi-environment setup for Truecaller integration.
        * **Cookie Management (`setCookiesOnCheckoutLoad`)**: This function is central to extracting various tracking and session-related cookies (Shopify session ID, Snapchat, Facebook, UTM parameters, Kwikpass user ID) from the browser. This data is then used for analytics and checkout flow personalization.
        * **Token Handling**: Logic to retrieve and set GoKwik session tokens (`XGokwikToken`) from localStorage or cookies is present, including a `backupToken` variable added in one commit (17/11/2025, 18:16:05) and renamed to `cookieSessionToken` in subsequent commits (17/11/2025, 18:14:56 onwards), suggesting refinement in how session tokens are managed.
        * **Launch Flow (`launchApp`)**: The component listens for 'launch' messages from its parent (likely the merchant's website) to initialize the GoKwik application with provided merchant information, user data, and tracking parameters.
        * **Cash-to-Prepaid Configuration**: `setCashToPrepaidConfigs` handles specific logic for cash-to-prepaid flows, including UI modifications.
        * **Analytics Integrations**: Imports and calls functions for various analytics platforms (CleverTap, Klaviyo, Wigzo, WebEngage, Moengage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, Edgetag, CustomerLabs, ShopifyAnalytics, GoogleAds), indicating comprehensive tracking.
        * **Session ID Fix Merchants**: An array `sessionIDFixMerchants` is used to apply specific session ID handling for certain merchant IDs.
        * **Query Parameter Handling**: Extracts `mrid`, `gkref`, `src`, `ch`, `kwik`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid` from URL query parameters.
        * **`kpEmail` Handling**: Added specific logic to set `kpEmail` from URL params, decode it, and store it in localStorage. A temporary `window.__KP_EMAIL___` variable was also added in one commit (18/11/2025, 14:50:49), later corrected to `window.__KP_EMAIL__` in 18/11/2025, 14:51:01.
    * **Pattern**: Heavy emphasis on data collection (cookies, URL parameters) for analytics and checkout personalization. Robust handling of session tokens and multi-environment configurations. Continuous refinement of cookie and URL parameter parsing logic.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts
* **Timestamp**: 13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, 17/11/2025, 13:02:34, 17/11/2025, 22:33:16, 17/11/2025, 23:34:43
* **Summary**: This service file provides environment-specific URLs for various GoKwik APIs and resources.
    * **Key Changes**:
        * **Consistent Structure**: Maintains a consistent structure across all commits, defining `merchantUrl`, `env`, and `cashToPrepaid` variables, and functions (`getHealthServiceBaseUrl`, `getAddressSuggestionBaseUrl`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, `proxy_service_url`, `XGokwikToken`, `XKWIKPASSToken`) that return environment-specific URLs or tokens.
        * **`local` Environment Updates**: The `api_url` function's `local` environment URL is frequently commented out and changed across commits, reflecting ongoing local development and testing (e.g., from `http://localhost:3000` to various `gokwik.co` or `gokwik.in` URLs, settling on `https://api.gokwik.co` in later commits). Similarly, `cdn_path` for 'local' is consistently `http://localhost:8080`.
        * **API Endpoint Consistency**: Most API endpoints (health, address suggestion, experiment, twidpay, kp, analytics, proxy) maintain consistent patterns for `dev`, `qa`, `sandbox`, and `production` environments across the updates, typically pointing to `api-gw-v4.dev.gokwik.io/sandbox`, `api-gw.gokwik.io`, `gkx.gokwik.co`, or `dev-core-api.dev.gokwik.in` based on the environment.
        * **Token Logic**: `XGokwikToken` and `XKWIKPASSToken` functions return different session token names based on the environment (SANDBOX, KWIK, QA).
        * **`getCredUrl`**: Differentiates between production and staging Cred URLs.
    * **Pattern**: Repeated adjustments to local development URLs within `api_url` highlight an iterative local testing process. The overall structure for environment-based URL resolution remains stable, showing a clear strategy for managing API endpoints across different deployment stages.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte
* **Timestamp**: 15/11/2025, 11:49:48 and 15/11/2025, 11:52:44
* **Summary**: This Svelte component is responsible for displaying the order summary and calculating the total price, incorporating various discounts, charges, and rewards.
    * **Key Changes**:
        * **Comprehensive Price Calculation**: The `$:` reactive statement for `totalPrice` includes a wide array of factors: `subTotal`, `couponDiscount`, `partnerAcquisitionOffer`, `discountBasedRewards`, `shopifyStoreCredit`, `prepaidDiscount`, `shippingInfo`, `giftcardTotal`, `codCharges`, `twidPay` rewards, `gstInfo`, and `gyftr` amounts. This demonstrates a complex and detailed price aggregation logic.
        * **Subscription Management**: Subscribes to numerous stores (`store_page`, `store_order_summary_drawer`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountBasedRewards`, `store_requestIdObject`, `store_phoneNo`, `store_cartjsObject`, `store_onpl`, `store_discountAmount`, `store_giftCardTotal`, `store_shopifyStoreCredit`, `store_mrpDiscountData`, `store_lineItemEdd`, `store_earnedLoyaltyDetails`, `store_priceBreakUp`) to reactively update local variables and recalculate the total.
        * **`handleCartUpdate` function**: Processes cart data, calculates `automaticDiscount`, segregates free products (BXGY logic), and updates `subTotal` based on prepaid freebie amounts.
        * **`toggleCartDrawer`**: Handles opening/closing the order summary drawer and logs relevant GTM and analytics events.
        * **Loyalty Display Amount Calculation**: Logic for `loyaltyDisplayAmount` is based on `priceBreakUpData` and `earnedLoyaltyDetails` rules, specifically for `on_field === 'to_pay'`.
        * **New Order Summary Display**: `showNewOrderSummary` flag is set to true for a list of specific `currentPage` values, indicating a conditional UI update.
    * **Pattern**: Heavy reliance on Svelte stores for reactive updates. Complex arithmetic logic for `totalPrice` that accounts for a multitude of discount and charge types. Extensive event logging for user interactions with the order summary.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts
* **Timestamp**: 17/11/2025, 12:56:56 to 17/11/2025, 14:05:25
* **Summary**: This file centralizes the logic for integrating various third-party analytics platforms into the GoKwik checkout flow.
    * **Key Changes**:
        * **Extensive Store Imports**: Imports numerous stores from `LoginStore`, `OrderStore`, and `CommonStore` to gather a wide range of data points (cart details, user info, discount amounts, shipping methods, merchant info, tracking IDs) relevant for analytics.
        * **Analytics Configuration**: `configObject` is dynamically built based on `store_foreignAnalytics` and `kwikOptimizerPixelIds`, enabling/disabling specific analytics platforms and custom Facebook pixel events.
        * **Data Object Creation (`createDataObject`, `generateTrackingData`)**: These (implied or partially shown) functions are responsible for compiling a comprehensive `commonAnalyticsData` object, including detailed product information, pricing, UTM parameters, and user data.
        * **Price Breakup**: A `priceBreakup` object tracks `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`. The `getPriceBreakup` function computes the `gift_card_and_reward` sum.
        * **Cookie and Local Storage Data**: Subscribes to `store_shopifyCookieInfo` and `store_sourceValue` to capture marketing data like 'Landing Page', 'Origin Referrer', and UTM parameters. It also uses `localStorageObject` for GoKwik tokens.
        * **`adSourceMapping`**: Function to parse and categorize ad source information from UTM parameters.
        * **`checkSnapchatPixel` and `prefilledAddress`**: Utility functions to check pixel configurations and address prefilling status for specific analytics events.
        * **Log `totalValue`**: A `console.log(res)` was added in the `store_totalPrice` subscription on 17/11/2025, 13:44:52, indicating a debugging step that was removed in the last commit for this file (17/11/2025, 14:05:25).
    * **Pattern**: A highly modular approach to analytics integration, driven by Svelte stores. A central `configObject` allows flexible enabling/disabling of different analytics platforms. Detailed data collection from various parts of the checkout flow to provide rich context for events. Consistent use of cookie and local storage data for tracking.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts
* **Timestamp**: 17/11/2025, 13:05:00 to 17/11/2025, 14:14:00
* **Summary**: This file integrates Contlo analytics tracking into the application.
    * **Key Changes**:
        * **Dummy Contlo Object**: Initially, a dummy `window.contlo` object is defined for logging `init`, `identify`, `track`, and `push` calls to the console, useful for development without a live Contlo SDK. This dummy object was removed in the commit on 17/11/2025, 13:19:38, suggesting a transition to a live SDK or a more concise implementation.
        * **`createBody` Function**: Generates a standardized data payload for Contlo events, including `tag: 'GoKwik'`, `promo_code`, `cart_total_price`, `product_id`, user address details, shipping method, and UTM parameters.
            * **`cart_total_price` handling**: Modified on 17/11/2025, 14:07:01, and further refined on 17/11/2025, 14:13:04 (and subsequent identical commits) to ensure `cart_total_price` is correctly assigned from `commonAnalyticsData?.cart_after_discount` if it's a valid number, otherwise falling back to `commonAnalyticsData?.cart_total_price`. This indicates a fix for potentially incorrect or missing discounted price data.
        * **`callContlo` Function**: Acts as a dispatcher, taking an `eventName` and `data` and routing it to specific Contlo event functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`).
        * **Specific Event Functions**: Each `contloXxx` function constructs a specific data payload for its event using `createBody` and then calls `contloSendEvent`.
        * **`contloSendEvent`**: A wrapper function that attempts to call `window.contlo.sendEvent` with event name, email, phone number, and properties, including a `try-catch` block to log an error if the Contlo SDK is not found.
        * **Console Logs**: Multiple `console.log(dataObj)` statements were present (e.g., 17/11/2025, 13:45:19) and later removed/streamlined (17/11/2025, 14:07:01 onwards).
    * **Pattern**: Standardization of event data payloads using `createBody`. A clear mapping from generic event names to specific Contlo event functions. Robust error handling for cases where the Contlo SDK might not be loaded. Continuous refinement of data fields, specifically for financial values like `cart_total_price`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte
* **Timestamp**: 17/11/2025, 22:38:42
* **Summary**: This Svelte component displays promotional text related to loyalty points, store credits, gift cards, and Gyftr offers.
    * **Key Changes**:
        * **Dynamic Text Generation**: The `loyaltyDiscountText` reactive variable dynamically constructs a message based on the availability of `store_enableGiftCard`, `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` flags.
        * **Conditional Display**: The promotional text is only displayed if any of the promotion types (gift card, loyalty, credits, gyftr) are enabled and the current page is before page 3.
        * **Store Subscriptions**: Subscribes to `store_requestIdObject`, `store_page`, `store_enableGiftCard`, `store_gyftr`, and `store_useStoreCredit` to reactively update the state of various promotions.
        * **Custom Display Names**: Allows `creditsDisplayName` and `loyaltyDisplayName` to be configured via `store_requestIdObject?.custom_config`.
        * **Debugging Output**: Includes `JSON.stringify` debug outputs for various flags (`$store_enableGiftCard`, `loyaltyEnabled`, `creditsEnabled`, `gyftrEnabled`), which are likely for development purposes.
    * **Pattern**: Reactive UI updates based on multiple boolean flags from Svelte stores. Conditional rendering of promotional messages.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte
* **Timestamp**: 17/11/2025, 23:52:04 to 18/11/2025, 12:45:43
* **Summary**: This Svelte component manages the display and application of various discounts, offers, and loyalty programs during the checkout process.
    * **Key Changes**:
        * **Extensive Store Imports**: Similar to `PaymentOptions.svelte`, this file imports a large number of Svelte stores to manage a complex state related to cart, discounts, offers, loyalty, gift cards, and UI elements. New imports include `store_experimentalDiscountPopup`.
        * **Applied Offers Logic**: The reactive `$:` block for `allAppliedOffers` dynamically constructs a list of all active discounts, including automatic discounts, stacked discounts, applied coupon codes, and partner acquisition offers (e.g., Cred). Each applied offer is defined with properties like `code`, `amountSaved`, `isAutomatic`, `isRemovable`, and an `onRemove` function for user interaction. `store_allAppliedDiscounts` is then updated.
        * **Discount Configuration from `requestIdObject`**: On mount, subscribes to `store_requestIdObject` to fetch configurations for `disable_discount_with_credits`, `disable_discount_with_giftcard`, `loyaltyApp`, `disable_cod_with_loyalty`, `dynamicAutomaticExtraDiscountList`, `dynamicAutomaticOverwriteDiscountList`, and flags for enabling extra/overwrite automatic discounts.
        * **Reapply Credits Logic**: Subscribes to `store_reapplyEr` to trigger `removeCredits` and `getStoreCredits` when a reapply event is signaled.
        * **Stacked Discounts Handling**: Subscribes to `store_stackedDiscounts` to update `stackedDiscountConfig`. It also includes complex logic to determine `allowDiscountApplication` based on the number of clubbed discounts (configurable via `no_of_discounts_clubbed` in `requestIdObject`) and `cartAutoDiscount`.
        * **Offers Processing**: Subscribes to `store_offers` to filter and process available discounts, setting `showOffersListing` and `availableCoupons`. It also includes logic for `processPartnerOffers`.
        * **New Components**: Imports `ExperimentCouponPopup`, suggesting A/B testing or experimental UI for coupons.
        * **Loyalty Display Name**: Dynamically sets `loyaltyDisplayName` from `store_requestIdObject?.custom_config`.
        * **Removed Comments**: Multiple commented-out lines like `// paytmCashbackFlag: boolean = false, CHECKOUT-6182` and `// $: if (couponField?.toLowerCase().indexOf('paytm') === 0 && boatUi) paytmCashbackFlag = true; // else paytmCashbackFlag = false;` are present, indicating a removed or temporarily disabled feature for Paytm cashback.
    * **Pattern**: Highly dynamic and reactive discount application/management. Strong emphasis on configuration via `requestIdObject` for feature flags and behavior. Complex logic for combining and validating different types of discounts. Extensive use of Svelte stores for state management and UI updates.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/App.svelte
* **Timestamp**: 18/11/2025, 12:22:24 to 18/11/2025, 12:40:55
* **Summary**: This is the main Svelte application component, responsible for the overall checkout flow, state management, and interaction with the merchant's page.
    * **Key Changes**:
        * **Comprehensive Store Imports**: Imports an enormous number of Svelte stores from both `LoginStore` and `CommonStore`, covering almost every aspect of the checkout state, including user login, cart, merchant info, UI states, payment details, experiments, and analytics. This highlights its role as the central orchestrator.
        * **History API Management**: Implements `history.pushState` and `window.onpopstate` to manage navigation within the checkout flow. It contains complex conditional logic for handling back button presses, closing popups/bottom sheets, and confirming exit, especially when `cashToPrepaid` is active or specific page states are met.
        * **Gift Auto-Popup**: Logic to show a "gift auto popup" when a user is logged in, selection gifts are available, and the `auto_open_freebie_popup` custom config is enabled. An event `gift_auto_popup_shown` is logged.
        * **Confirm Exit Popup**: Displays a `ConfirmPopup` component when `confirmExit` is true, handling the closure and logging an `exit_coupon_popup_closed` event if the exit popup flow is enabled.
        * **`AppMessageEvent` Listener**: Listens for 'launch' messages from the parent window (merchant page) to initialize numerous stores with data like `sourceValue`, `localStorageObject`, `isGlanceEnvironment`, `shopifySessionId`, `cashToPrepaidFlag`, `isSkipOtp`, `merchantInfo`, `environment`, `channelSource`, `channel`, `isHydrogen`, `gaCookies`, `mid`, `kwikKey`, `snapchatAttributes`, and `kpEmail`.
        * **Token and Cookie Handling**: Manages `XGokwikToken` and `XKWIKPASSToken` from localStorage and cookies, including handling potential issues with incognito mode (`isNotIncognito`).
        * **`checkout_assets_loaded` Event**: Logs this event twice, possibly for different stages of asset loading or for redundancy.
        * **Discount Code from Event Data**: Checks `gokwikEvent?.data?.discountCode` to set `isCookieDiscountApplicable`.
        * **New `logEvent` Data**: In the commit 18/11/2025, 12:22:24, the `checkout_assets_loaded` event logs `user_network: navigator?.connection?.effectiveType ?? 'not_suppoted'`, indicating a focus on network performance tracking.
    * **Pattern**: Acts as the central hub, initializing global state, managing user navigation, and orchestrating interactions with external systems via message passing. Extremely high number of Svelte store imports suggests a very complex and tightly integrated state across the entire application. Extensive event logging and analytics setup.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/kwik-checkout.html
* **Timestamp**: 18/11/2025, 14:49:20 to 18/11/2025, 14:58:58
* **Summary**: This HTML file likely serves as the entry point for the GoKwik checkout iframe, responsible for loading the GoKwik integration script and various analytics pixels.
    * **Key Changes**:
        * **`getApiUrl` Function**: Provides environment-specific base URLs for GoKwik APIs, currently supporting `sandbox` and `production`.
        * **`setCookieGk`**: A utility function to set cookies with an expiration in days.
        * **`fetchCart` Function**: Makes an XMLHttpRequest to `getApiUrl(...) + '/v1/user/shopify-cart'` to fetch cart details based on `merchantInfo.mid` and `cart_token`. It then updates `merchantInfo.appCart` and sets `merchantInfo.appFlow = true`. After fetching, it attempts to initialize the `gokwikSdk` checkout.
        * **`initKwikCheckout` Function**:
            * Sets `window.merchantInfo` from `storeInfo` provided as a base64 encoded URL parameter.
            * Dynamically loads `gokwikIntegration` and `analyticsJs` scripts from either sandbox or production CDN URLs based on `storeInfo.environment`.
            * Conditionally loads various third-party analytics pixels (Facebook, Google Analytics, WebEngage, MoEngage) if `blockExternalEvents` is false in `storeInfo`.
        * **`createScript`, `createFbPixel`, `createGoogleAnalytics`, `createMoEngage`, `createWebEngage`**: Helper functions to dynamically create and inject script tags for the GoKwik integration and external analytics services. These functions handle asynchronous loading and initialization of the respective SDKs.
        * **`initListeners`**: Sets up `window.onmessage` and `document.addEventListener('message')` to handle messages from the GoKwik iframe (e.g., `checkoutHealth`, `shopifyRedirect`, `hardwareBackPress`).
        * **`DOMContentLoaded` Listener**: Parses URL parameters (`storeInfo`, `kp_email`), decodes base64 data, sets `kp_email` in localStorage and `window.__KP_EMAIL__`, and sets various GoKwik-specific cookies (`_shopify_s`, `_shopify_sa_p`, `gk_landing_page`, `gk_orig_referrer`) if `utmParams` are present in `storeInfo`. A `try-catch` block was added for `kpEmail` decoding to handle potential errors in the 18/11/2025, 14:58:58 commit.
    * **Pattern**: Dynamic script loading for the core application and analytics tools based on environment and merchant configuration. Extensive use of URL parameters and cookies for initial configuration and tracking. Strong emphasis on integrating various analytics providers. The file acts as a bootstrap for the GoKwik checkout experience within an iframe context.

## 19:14:49
The provided code change log primarily focuses on updates to a checkout system, specifically in the areas of discount handling, payment options, analytics integration, and environment configuration.

**File-Specific Updates:**

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** 12/11/2025, 21:20:24 and 15/11/2025, 12:00:15
    *   This Svelte service file handles the logic for applying and processing shipping discounts.
    *   Numerous Svelte stores from `CommonStore` and `OrderStore` are imported and subscribed to, managing states like `gstInfo`, `discountCode`, `shippingAsProduct`, `currentPage`, `giftCardRewards`, `skipToPayment`, `isAbandonCart`, `selectedAddress`, `shippingMethods`, `autoSelectShipping`, `freeShipping`, `giftCardData`, `selectedShippingMethod`, `discountBasedRewards`, `stackedDiscounts`, `isWindowRedirectionFlow`, `subTotal`, `availableOffersShown`, `merchantInfo`, `show_discount_confetti`, `disable_discount_application`, `isPlaceOrderButtonVisible`, `captureApiTimerId`, `bottomSheetState`, `modified_cart`, `isRedirectionFlowEnabled`, `utmDiscounts`, `freeGift`, `gyftr`, and `billingAmount`.
    *   The `callShippingDiscountApi` function is responsible for making discount and shipping API calls, clearing timers, and handling responses, including confetti animation for valid discounts. It also logs loyalty point application events.
    *   The `processShippingDiscountResponse` function updates shipping methods, shipping options, and discount responses. It contains logic for re-applying gift cards on cart updates, calling payment methods in specific scenarios, and managing error messages.
    *   Introduced `processDiscountShippingQueue` to handle API responses sequentially.
    *   Added logic to re-apply/remove Gyftr based on discount application and page context.
    *   Includes specific handling for UTM auto-application failure messages.
    *   Introduced logic for `discount_shipping_retry` in certain conditions, potentially to re-select a shipping method after a delay.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamps:** 13/11/2025, 14:31:15, 15/11/2025, 11:32:02, 15/11/2025, 11:32:38, 17/11/2025, 13:02:34, 17/11/2025, 22:33:16, 17/11/2025, 23:34:43
    *   This file centralizes API endpoint URLs based on the environment (dev, qa, sandbox, production, local, etc.).
    *   Exports `merchantUrl`, `env`, and `cashToPrepaid` variables, subscribed from Svelte stores.
    *   Provides functions to retrieve base URLs for `HealthService`, `AddressSuggestion`, `api_url`, `getCredUrl`, `experiment_url`, `twidpay_api`, `kp_api`, `cdn_path`, `analytics_api`, `analytics_api_v2`, `merchant_url`, `merchant_url_api`, and `proxy_service_url`.
    *   Defines `XGokwikToken` and `XKWIKPASSToken` based on the current environment.
    *   **Recurring elements:** This file repeatedly defines URL endpoints for various services across different environments (dev, qa, sandbox, production, local). There are multiple revisions where the `api_url` function's `local` environment URL is commented out and changed, suggesting ongoing development and testing in local/development environments. For example, `api_url` for 'local' was 'https://api.gokwik.co' (13/11) then changed to 'https://sandbox.gokwik.co' (15/11) and back to 'https://api.gokwik.co' (17/11). This indicates frequent adjustments to local development configurations.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamps:** 13/11/2025, 14:31:36, 15/11/2025, 11:32:20, 17/11/2025, 13:01:29, 17/11/2025, 22:33:43
    *   This HTML file serves as a merchant's page integrating the Gokwik SDK.
    *   It contains JavaScript logic for initializing `gokwikSdk`, processing payments (`initCheckout`), and handling custom events.
    *   Includes cookie management (`getCookieGk`, `setCookieGk`) for tracking landing page and referrer.
    *   The `window.merchantInfo` object, which configures the Gokwik checkout, is present and shows frequent changes to the `mid` (merchant ID) for testing different merchant setups across multiple environments (qa, sandbox, production, local, plus store, etc.). The `environment` is consistently set to 'local' in the provided snippets. This pattern of changing `mid` values is indicative of continuous testing against various merchant configurations.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps:** 13/11/2025, 20:56:52, 13/11/2025, 20:58:06, 13/11/2025, 21:00:07, 13/11/2025, 21:00:59, 13/11/2025, 21:01:56, 13/11/2025, 21:03:33, 13/11/2025, 21:20:47, 13/11/2025, 21:22:28, 13/11/2025, 21:23:51, 13/11/2025, 21:25:07, 15/11/2025, 12:01:15
    *   This Svelte component handles the display and logic for various payment options.
    *   Imports numerous Svelte stores related to common UI states (`store_disableClick`, `store_bottomSheetState`, `store_loader`, `store_screen_width`), login (`store_confirmClose`, `store_discountCode`, `store_page`), and order details (`store_totalPrice`, `store_codCharges`, `store_twidPay`, `store_giftCard`).
    *   Initializes many local variables related to payment methods, COD status, discounts, and UI display.
    *   The `onMount` lifecycle hook includes extensive logic for analytics tracking (GTM, Shopify, Facebook), fetching payment methods, processing saved cards, and subscribing to various store updates.
    *   There's a consistent pattern of subscribing to a wide array of Svelte stores (e.g., `store_twidPay`, `store_shopifyStoreCredit`, `store_discountCallStatus`, `store_codPaymentFailed`, `store_offers`) to react to changes in the checkout state and update UI or re-evaluate payment options.
    *   A reactive statement (`$:`) updates `store_onpl.isCodAvailable` based on `store_twidPay`'s applied reward.
    *   The latest change (15/11, 12:01:15) introduces imports for `store_isLoggedInUser`, `store_isCartUpdated` from `CommonStore`, and two new components `AutomaticGiftHeader` and `GiftJourney`, suggesting a new feature related to automatic free gifts in the payment flow.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamps:** 15/11/2025, 11:49:48, 15/11/2025, 11:52:44
    *   This Svelte component displays the order summary, including discounts, shipping, and taxes.
    *   Subscribes to numerous stores (`store_page`, `store_cartjsObject`, `store_prepaidDiscount`, `store_codCharges`, `store_selectedShippingMethod`, `store_discountAmount`, `store_giftCardTotal`, `store_mrpDiscountData`, `store_earnedLoyaltyDetails`, `store_onpl`, `store_priceBreakUp`) to dynamically calculate and display the total price.
    *   The `totalPrice` reactive calculation is complex, factoring in various discounts (coupon, loyalty, Shopify credits, prepaid, Gyftr), shipping costs, and COD charges.
    *   The `handleCartUpdate` function processes cart items, identifies free products, and updates the subtotal and automatic discount.
    *   The primary change between the two timestamps in this file is the modification to how `loyaltyDisplayAmount` is calculated within the `unsubPriceBreakup` subscription, changing the base for calculation based on `earnedLoyaltyDetails?.on_field`.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte`**
    *   **Timestamp:** 17/11/2025, 22:38:42
    *   This Svelte component displays promotional text related to loyalty points, store credits, and gift cards.
    *   It uses reactive statements (`$:`) to update `loyaltyEnabled`, `creditsEnabled`, and `gyftrEnabled` based on store values, and then constructs `redeemableText` and `loyaltyDiscountText` dynamically.
    *   The styling is basic, using a yellow background and dark brown text for the discount wrapper.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamps:** 14/11/2025, 13:55:06, 17/11/2025, 13:00:33, 17/11/2025, 17:36:22, 17/11/2025, 17:38:18, 17/11/2025, 18:14:56, 17/11/2025, 18:16:05, 17/11/2025, 18:16:16, 18/11/2025, 14:25:07, 18/11/2025, 15:10:51, 18/11/2025, 15:14:20, 19/11/2025, 15:54:13
    *   This Svelte component is the main entry point for the merchant-side integration of the Gokwik checkout.
    *   Manages the display of an iframe, loads external analytics scripts (CleverTap, Klaviyo, WebEngage, Moengage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, GoogleAds), and handles communication between the merchant page and the iframe.
    *   Initializes various state variables related to merchant info, cart, tokens, cookies, and UI flags.
    *   The `onMount` hook sets up event listeners, inserts CSS keyframes, checks the environment, and processes URL parameters (e.g., `mrid`, `gkref`, `so_token`, `gk_token`).
    *   A significant pattern is the constant updates to the `truecallerConfig` keys for different environments and the `sessionIDFixMerchants` array, indicating continuous adjustments for various merchant integrations and environment-specific configurations.
    *   Added a `cookieSessionToken` variable and logic to store `coreToken` from `gk_token` query parameter, ensuring robust token handling.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamps:** 17/11/2025, 13:05:00, 17/11/2025, 13:19:38, 17/11/2025, 13:45:19, 17/11/2025, 14:07:01, 17/11/2025, 14:13:04, 17/11/2025, 14:13:49, 17/11/2025, 14:14:00, 17/11/2025, 13:55:05
    *   This file integrates with the Contlo analytics platform.
    *   It defines a `createBody` function to standardize data sent to Contlo, including `tag`, `promo_code`, `cart_total_price`, `product_id`, user address details, shipping method, and UTM parameters.
    *   The `callContlo` function acts as a dispatcher, calling specific handlers (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) based on the event name.
    *   **Recurring elements:** This file repeatedly refines the `createBody` function's `cart_total_price` logic, primarily to ensure it correctly handles cases where `commonAnalyticsData?.cart_after_discount` might be undefined or non-numeric (e.g., `!isNaN(Number(commonAnalyticsData?.cart_after_discount)) ? discountedAmount : commonAnalyticsData?.cart_total_price`). This suggests ongoing efforts to improve data robustness for analytics. A `console.log(dataObj)` or `console.log(data)` statement is also frequently added and removed or kept in the `contloAddressAdded` function for debugging purposes.
    *   The `contloSendEvent` function wraps the `window.contlo.sendEvent` call in a `try-catch` block, indicating a focus on graceful error handling if the Contlo SDK is not loaded.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamps:** 17/11/2025, 12:56:56, 17/11/2025, 13:43:21, 17/11/2025, 13:44:00, 17/11/2025, 13:44:52, 17/11/2025, 14:05:25, 17/11/2025, 13:55:47
    *   This file manages various foreign analytics integrations.
    *   Imports numerous Svelte stores from `LoginStore`, `OrderStore`, and `CommonStore` to gather data for analytics.
    *   Defines a wide range of variables to store data such as cart details, user information, pricing, discounts, and tracking parameters.
    *   The `fbPixelEventsAndKeys` object maps checkout events to Facebook Pixel event names, including several custom events.
    *   Subscribes to many Svelte stores to update local variables (`cart`, `discountAmount`, `pageNumber`, `isPpcod`, `codCharges`, `finalPayablePrice`, `totalValue`, `gyftrAmount`, `marketingData`, `source`, `fbExternalId`).
    *   The `configObject` is dynamically populated based on `store_foreignAnalytics` and `kwikOptimizerPixelIds`, allowing for flexible pixel configuration.
    *   The `priceBreakup` object is calculated and updated with various components like `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
    *   **Recurring elements:** This file shows frequent updates (several within minutes) where a `console.log(res)` is temporarily added to the `store_totalPrice.subscribe` block. This debugging pattern indicates active development and verification of the `totalValue` calculation and how it's reflected for analytics.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/App.svelte`**
    *   **Timestamps:** 18/11/2025, 12:22:24, 18/11/2025, 12:23:52, 18/11/2025, 12:24:20, 18/11/2025, 12:24:44, 18/11/2025, 12:25:25, 18/11/2025, 12:40:55
    *   This is the main application component, likely responsible for orchestrating different checkout steps and overall UI.
    *   Extensive imports from `LoginStore`, `CommonStore`, and `OrderStore` indicate a highly state-driven application architecture (Svelte stores).
    *   Manages navigation logic, including handling browser history (`window.onpopstate`) and exit confirmations.
    *   Sets up message listeners for communication with an external context (e.g., iframe parent).
    *   The `onMount` hook performs critical initialization: setting store values from `gokwikEvent.data` (which likely comes from a parent page), handling cookies and local storage for tokens and user data, and logging events.
    *   There's a repeated `logEvent` call for `checkout_assets_loaded` (18/11, 12:22:24 and subsequent changes), suggesting double-checking event logging or a temporary copy-paste.
    *   The `token` and `kwikpassToken` handling includes checks for `localStorage` and `cookies`, and fallbacks to `gokwikEvent.data.token` if not found.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte`**
    *   **Timestamps:** 17/11/2025, 23:52:04, 17/11/2025, 23:53:11, 17/11/2025, 23:53:19, 18/11/2025, 00:00:01, 18/11/2025, 00:02:54, 18/11/2025, 00:03:11, 18/11/2025, 00:03:40, 18/11/2025, 00:05:32, 18/11/2025, 00:08:46, 18/11/2025, 00:15:34, 18/11/2025, 00:21:40, 18/11/2025, 00:21:50, 18/11/2025, 00:22:39, 18/11/2025, 00:29:30, 18/11/2025, 12:19:54, 18/11/2025, 12:21:27, 18/11/2025, 12:23:13, 18/11/2025, 12:41:34, 18/11/2025, 12:43:07, 18/11/2025, 12:45:43
    *   This Svelte component is dedicated to managing discounts and offers.
    *   It imports a very large number of Svelte stores (from `CommonStore`, `LoginStore`, `OrderStore`) to manage every conceivable aspect of discount, cart, user, and UI state.
    *   Features include handling manual coupon application, automatic discounts, stacked discounts, gift cards, loyalty rewards, and partner acquisition offers (e.g., CredPay).
    *   It manages the display of available offers, determines discount eligibility, and handles the application/removal of various discount types.
    *   A prominent reactive block (`$:`) calculates `allAppliedOffers` based on various conditions, including automatic discounts, stacked discounts, manual coupons, and partner offers. This block is updated in almost every log entry for this file, indicating very active and iterative development on the discount calculation and display logic. The changes primarily involve refining the conditions under which discounts are considered applied, stackable, and removable.
    *   The `onMount` hook subscribes to various stores, particularly `store_requestIdObject`, `store_reapplyEr`, `store_stackedDiscounts`, and `store_offers`, to react to changes in system configuration, reapplication requests, and available offers.
    *   **Recurring elements:** The repeated changes to the `allAppliedOffers` reactive block highlight continuous refinement of discount logic. Minor whitespace and formatting changes are also frequent, suggesting code review and style consistency efforts.

*   **`/Users/mayuresh.ad/Documents/pdp/gokwik.pdp/public/kwik-checkout.html`**
    *   **Timestamps:** 18/11/2025, 14:49:20, 18/11/2025, 14:50:49, 18/11/2025, 14:51:01, 18/11/2025, 14:57:07, 18/11/2025, 14:57:19, 18/11/2025, 14:58:02, 18/11/2025, 14:58:58
    *   This HTML file is another entry point for a "kwik-checkout", distinct from `merchant.html`.
    *   It includes JavaScript for fetching cart details (`fetchCart`), initializing external analytics scripts (FB Pixel, Google Analytics, MoEngage, WebEngage), and handling post-messages.
    *   The `initKwikCheckout` function loads integration and analytics scripts based on the environment.
    *   **Recurring elements:** Multiple minor revisions to the `kpEmail` handling in the `DOMContentLoaded` listener, specifically related to `localStorage.setItem('kp_email', kpEmail)` and `window.__KP_EMAIL__ = kpEmail`, and also a `try-catch` block around `atob(kpEmail)`. This suggests an ongoing effort to ensure `kpEmail` is correctly processed and stored, especially when encoded. Changes also include minor adjustments to the `utmParams` handling and cookie setting logic.

**Overall Patterns and Recurring Elements:**

1.  **Svelte Store Reliance:** A strong pattern across `.svelte` files is the heavy use of Svelte stores (`store_...`) for state management. Components subscribe to numerous stores to reactively update their logic and UI, indicating a centralized and reactive data flow.
2.  **Environment-Specific Configurations:** The `EnvironmentService.ts` and `merchant.html` files show constant adjustments to API URLs and merchant configurations based on the deployment environment (local, dev, qa, sandbox, production). This is typical for applications that need to adapt to different backend services and testing setups.
3.  **Analytics Integration:** Multiple files (`Merchant.svelte`, `ForeignAnalytics.ts`, `Contlo.ts`) are deeply involved in integrating various analytics platforms (Facebook Pixel, Google Analytics, MoEngage, WebEngage, Contlo, etc.). This suggests a strong focus on tracking user behavior and campaign performance.
4.  **Discount and Payment Complexity:** The `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Discounts.svelte` files demonstrate a highly complex and interconnected system for handling discounts (manual, automatic, stacked, loyalty, gift cards, partner offers) and various payment methods (UPI, cards, COD, BNPL). The frequent updates to these files suggest continuous feature development and refinement in this critical area.
5.  **Debugging and Refinement:** Temporary `console.log` statements (e.g., in `ForeignAnalytics.ts`, `Contlo.ts`) and repeated minor adjustments (e.g., to the `allAppliedOffers` logic in `Discounts.svelte` or `kpEmail` handling in `kwik-checkout.html`) indicate an active development process with iterative debugging and code refinement.
6.  **Cookie and Local Storage Management:** There's a consistent emphasis on reading from and writing to cookies and local storage to persist session information, user tokens, and tracking parameters across different parts of the application and environments.
7.  **Future Dates:** All timestamps are in late 2025, indicating either future-dated development or a system clock discrepancy. Assuming these represent actual development times, it points to ongoing work.

## 19:53:11
The provided code changes primarily affect the UI components and configuration of a "Gokwik Dashboard" application, specifically focusing on checkout customization, discount management, and order details.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file manages the "Brand" customization page within the checkout dashboard.
    *   It includes functionalities for uploading and displaying a merchant's logo, validating image types and sizes (JPEG, PNG, SVG, under 2MB), and picking a primary theme color.
    *   API calls are made to `downloadLogo` and `presingedLogoUrl` for image handling, and `updateMerchant` for saving changes.
    *   It integrates Redux for state management (merchant details, logo data, brand data) and `useMerchantConfigApi` for configuration persistence.
    *   A significant change involves using `cleanImageWithCanvas` for image processing before upload.
    *   The form (`Form.useForm()`) now watches `brand_data` for changes, triggering an update to the Redux store (`updateBrandData`) and enabling/disabling the "Save Changes" button (`setIsVisible`).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51)
    *   This component provides a generic search interface for products or collections, likely used in discount or free gift configurations.
    *   It features infinite scrolling for search results using `useIntersectionObserver`.
    *   It handles adding and removing selected items, with logic for collating product variants and managing quantities.
    *   New logic was added for `handleGiftPrice` to update the `offered_price` for gift items and `handleQuantityChange` to manage collection quantities, including a minimum purchase quantity validation.
    *   An `isAgentLed` prop is introduced to filter products based on tags (excluding items with 'no-agent' tag).
    *   The component supports hiding the search input or button, and customizes product display for collated products or single variants.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file displays the detailed view of an order.
    *   It includes functions to format currency (`formatCurrency`, `formatAmountWithCurrency`) using the order's or merchant's currency symbol.
    *   A new function `mergeRepeatedRefunds` is introduced to consolidate multiple refund attempts into a single entry with an `attempts` count and standardized `status` (Completed, Failed, Initiated).
    *   The logic for calculating `totalRefundAbleAmount` and `refundBtnState` (disabled, status, refundable amount) has been refined, considering various transaction statuses, store credits, and COD orders.
    *   It now also sets a `disableEdit` flag and `title` message based on whether Twid rewards or Loyalty Points are applied, or if certain GWP discounts are active.
    *   Customer contact information (phone, email) is masked, and buttons to view them can be toggled.
    *   The `order_failure_reason` is determined using `findOrderFailureReason`.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Timestamp: 18/11/2025, 00:45:31)
    *   This is the main HTML template for the Gokwik Dashboard.
    *   It defines meta tags for content security policy (CSP) and includes `regenerator-runtime` for async/await support in older browsers.
    *   It configures `single-spa` for micro-frontend architecture, defining import maps for various `@gokwik` applications (configuration, utilities, dashboard, checkout, payment, kwikpass, rto, kwikship, ellora, checkout-platform, shopify-app, kwikcomm) based on the `deployedEnv` (local, dev, qa, sandbox, production).
    *   For the `production` environment, it conditionally includes Clarity and New Relic analytics scripts if `clarityKey` is present. The New Relic script is quite extensive, suggesting robust performance monitoring and error tracking setup.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Timestamps: 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, 18/11/2025, 00:58:39)
    *   These three entries show minor changes to the `freeGift.tsx` file, suggesting quick iterations or minor formatting/re-saves. The content appears identical across these three timestamps.
    *   This component manages "Free Gift Settings" for merchants.
    *   It uses a form to define free gift rules, including rule name, sales channels (App, Web, Agent led), purchase requirements (cart value, quantity), applicability (all products, specific products/collections), free gift product selection, quantity, price, and addition method (auto/selection).
    *   `ProductSearch` is integrated to select specific products or collections for gift applicability.
    *   Breadcrumbs are updated to reflect the current page.
    *   The UI displays a table of existing free gift rules, with options to enable/disable (using a `Switch`), edit, or delete them.
    *   Validation is in place for minimum/maximum values, required fields, and selection limits for free gift products.
    *   An `isChanged` state is used to track modifications, likely to enable a "Save" button.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component renders customizable fields for the order confirmation page using collapsible sections.
    *   It allows merchants to customize various elements:
        *   **Brand Logo:** Enabled/disabled, managed by `LogoPage`.
        *   **Dynamic Banners:** Enabled/disabled, with options for an announcement banner (handled by `RenderEditorFunction`).
        *   **Trust Banner:** Enabled/disabled, managed by `TrustBadgeForm`.
        *   **Order Details:** Displays order status, EDD, confirmation message, and billing summary, with customizable background and text colors.
        *   **Customer Information:** Displays delivery/billing address and contact information, with customizable background and text colors.
        *   **Support & Communication:** Configures heading, description, button text, and button link for support details, with customizable background and text colors.
    *   The component allows drag-and-drop reordering of these collapsible sections, indicating a flexible UI customization feature.
    *   `ColorPickerHelper` is used to allow color customization for various sections.

### Patterns and Recurring Elements:

1.  **Gokwik-UI-Kit Usage:** All UI-related files heavily utilize the `gokwik-ui-kit` for components like `Button`, `Form`, `Input`, `Card`, `Col`, `Row`, `Upload`, `Switch`, `Table`, `Dropdown`, `Tooltip`, `message`, `Drawer`, etc. This indicates a consistent design system across the dashboard.
2.  **`useMerchantConfigApi` Hook:** This custom hook (from `@library/utilities/hooks/useMerchantConfig`) is used in `BrandPage.tsx` and `FreeGift.tsx` for fetching and saving merchant-specific configurations. This suggests a standardized approach to managing and persisting merchant settings across different features.
3.  **Redux Integration:** `useAppDispatch` and `useSelector` are widely used (`BrandPage.tsx`, `ProductSearch.tsx`, `OrderDetails.tsx`) for managing global state like merchant details, user configuration, and dispatching actions.
4.  **API Call Utility:** `makeAPICall` (from `@gokwik/utilities`) is consistently used for interacting with backend services.
5.  **Form Management with Ant Design:** `Form.useForm()` and `Form.useWatch()` are central to handling form states, validations, and real-time updates across multiple components (`BrandPage.tsx`, `FreeGift.tsx`, `CollapseFields.tsx`).
6.  **Breadcrumbs:** `updateBreadcrumbs` from `@gokwik/utilities` is used to maintain consistent navigation paths, particularly evident in `FreeGift.tsx` and `OrderDetails.tsx`.
7.  **Image Handling:** Common patterns for image upload, validation, and display are seen in `BrandPage.tsx` (logo) and `FreeGift.tsx` (product/gift images), often involving `ShopifyProductPlaceholderImage` or `noImage` for placeholders.
8.  **Environmental Configuration:** The `index.ejs` file shows a clear pattern of dynamically loading micro-frontend applications and their respective URLs based on the deployment environment (local, dev, qa, sandbox, production). This is typical for a scalable application architecture.
9.  **Date Formatting and Utility Helpers:** `formatAmount`, `setCurrencySymbol`, `getBase64`, `deepEqualAndDiff`, `renderFormItem` are examples of helper functions used across different files, promoting code reusability and consistency.
10. **Consistent Timestamp Pattern:** Most changes occur on the 16th, 17th, and 18th of November, 2025, suggesting a concentrated period of development or a release cycle. The `freeGift.tsx` file having three identical entries on 18/11/2025 points to minor saving operations or quick, iterative changes without functional impact.