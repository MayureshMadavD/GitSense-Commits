# Activity Summary for 21/11/2025

## 12:05:28
### File-Specific Summaries:

**1. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (16/11/2025, 13:10:34)**
This file defines the `BrandPage` component, which allows merchants to customize their checkout UI's branding. Key functionalities include:
- **Logo Upload:** Merchants can upload their brand logo. The component handles image validation (type, size), cleaning with canvas, generating a unique path, getting a pre-signed S3 URL, and uploading the image to AWS S3. It then updates the form with the logo URL and dispatches an action to update logo data in the Redux store.
- **Primary Color Selection:** A `ColorPicketComponent` is used for selecting the primary theme color for the checkout UI, which is then saved as part of the merchant's custom configuration.
- **Form Management:** Uses Ant Design's `Form` for managing brand data, including logo and primary color. Changes to form values trigger a state update (`isVisible`) to enable/disable the "Save Changes" button.
- **API Integration:** Interacts with `APIEndPoints` for downloading existing logos, getting pre-signed URLs for uploads, and updating merchant configurations.
- **State Management:** Utilizes Redux (`useSelector`, `useAppDispatch`) to fetch merchant details and dispatch updates.

**2. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (17/11/2025, 16:22:51 & 21/11/2025, 11:48:56)**
This `ProductSearch` component facilitates searching and selecting products or collections, primarily used for discount and free gift configurations.
- **Core Functionality:** Allows searching for Shopify products or collections, displaying results in a modal, and adding/removing selected items. It supports features like infinite scrolling (`useIntersectionObserver`), debounced search, and handling product variants.
- **Dynamic Search Types:** Can search for either 'products' or 'collections' based on `searchType` prop.
- **Product Aggregation:** When `collateProducts` is true, it groups product variants under their parent product for display and selection.
- **Quantity Management:** Supports displaying and modifying quantities for selected items, with specific logic for collection quantities and minimum purchase requirements.
- **Agent-Led Filtering:** Includes logic to filter products based on `no-agent` tags when `isAgentLed` is true.
- **Top-Up Gift Price:** Introduces a `topUpGift` prop to allow setting an `offered_price` for freebie products.
- **Recent Update (21/11/2025, 11:48:56):** Added a `DeleteOutlined` icon for removing items from the search result in the modal (though the provided code snippet for this specific update doesn't fully show its context within the modal's item rendering). A `btnSearch` prop was added to allow a button to trigger the search modal directly. The logic for displaying selected variants (`product?.variants?.length && ...`) was also slightly refined.

**3. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (17/11/2025, 16:23:04)**
This file defines the `OrderDetails` page for viewing and managing individual orders.
- **Order Data Display:** Fetches and displays comprehensive order information, including line items, payment details, refunds, and price breakdowns (discounts, taxes, shipping, gift cards, rewards).
- **Refund Management:** Implements logic for merging repeated refund attempts and calculating refundable amounts. It also controls the state and display of a "Refund" button and a `RefundDrawer`.
- **Currency Formatting:** Includes custom `formatCurrency` and `formatAmountWithCurrency` helpers to ensure amounts are displayed with the correct currency symbol, dynamically retrieved from order data or merchant details.
- **Conditional Actions:** Dynamically enables/disables order editing based on applied rewards, GWP discounts, or loyalty points. RTO actions are conditionally displayed based on merchant configuration.
- **Breadcrumbs & Navigation:** Manages breadcrumbs for the page and handles navigation for order not found scenarios.
- **Sensitive Data Masking:** Masks customer phone numbers and emails (`billing_phone_mask`, `billing_email_mask`).

**4. `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs` (18/11/2025, 00:45:31 & 20/11/2025, 18:37:48)**
This is the main EJS template file for the Single-SPA dashboard application.
- **Microfrontend Configuration:** Defines SystemJS import maps to load various Gokwik microfrontends (e.g., `@gokwik/configuration`, `@gokwik/checkout`, `@gokwik/payment`) based on the `deployedEnv` (local, dev, qa, sandbox, production).
- **Dependency Management:** Includes CDN links for `react`, `react-dom`, and `single-spa`.
- **Security Policies:** Sets a `Content-Security-Policy` for the application, allowing resources from self, HTTPS, and localhost.
- **New Relic Integration:** Includes a New Relic browser agent script for performance monitoring, with environment-specific configuration details (accountID, agentID, licenseKey).
- **Clarity Integration:** Conditionally includes a Microsoft Clarity tracking script based on `clarityKey` for production environments.
- **Timestamp 20/11/2025, 18:37:48:** The primary change is the update of `@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, and `@gokwik/shopify-app` URLs in the `isLocal` environment to point to `https://qa-dashboard.dev.gokwik.in/` instead of `https://sandbox-dashboard.dev.gokwik.in/` or `//localhost:XXXX`. This indicates a shift in the local development environment's dependency resolution to QA-deployed versions of other microfrontends.

**5. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (18/11/2025, 00:49:40, 18/11/2025, 00:50:14, & 18/11/2025, 00:58:39)**
This `FreeGift` component allows merchants to configure free gift rules.
- **Rule Management:** Provides a form to create and edit free gift rules, including name, sales channels, purchase type (cart value/quantity), min/max value, applicability (all products, specific products, specific collections), free gift product selection, quantity, price, and application method (auto/selection).
- **Product/Collection Search Integration:** Uses `ProductSearch` component for selecting specific products or collections that trigger the free gift or are offered as free gifts.
- **Dynamic Form Fields:** Fields are conditionally rendered or disabled based on other form values (e.g., `selection_limit` visibility based on `application_method`).
- **Table Display:** Rules are listed in a table, allowing enabling/disabling via a `Switch`, and editing/deleting via a `Dropdown` menu.
- **State Management:** Manages state for `newRules` (drawer visibility), `newGift` (list of gift rules), `editRuleId`, and `isChanged` (to enable/disable Save button).
- **Breadcrumbs:** Updates breadcrumbs to reflect the current page.
- **No significant code changes between the three timestamps for this file; likely just minor formatting or save operations.**

**6. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (18/11/2025, 23:42:52)**
This component, `CustomizeUiFields`, is responsible for rendering collapsible customization sections for the order confirmation page.
- **Collapsible Sections:** Organizes various UI customization options into `Collapse` panels: Brand Logo, Dynamic Banners, Trust Banner, Order Details, Customer Information, and Support & Communication.
- **Dynamic Field Rendering:** Uses a `RenderField` utility and custom render functions (`RenderEditorFunction`, `ColorPickerHelper`) to display different types of form inputs (switch, text input, color picker).
- **Drag-and-Drop Reordering:** Implements drag-and-drop functionality for reordering the collapsible sections, allowing merchants to customize the layout of the order confirmation page.
- **Conditional Visibility:** Many fields are conditionally hidden based on the `enabled` state of their parent section.
- **Prop-Based Form Interaction:** Receives `form` and `setButtonState` props to interact with the parent form and trigger save button state changes.

**7. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx` (19/11/2025, 21:10:01, 19/11/2025, 21:11:54, 19/11/2025, 21:12:22, & 19/11/2025, 21:12:29)**
This `OrderConfirmationPage` component provides the interface for merchants to customize their post-purchase experience.
- **Main Layout:** Uses a two-column layout (`Row`, `Col`) with customization forms on the left and a live preview on the right.
- **Form Management:** Utilizes Ant Design's `Form` with `initialValuesForThankYouPageForm` and `onValuesChange` to track changes and enable the "Save Changes" button.
- **Customizable Sections:** Integrates `MainSection` (which likely includes `CustomizeUiFields`) to manage various customizable elements of the confirmation page.
- **Form Submission Logic:** `handleFormSubmit` validates form fields, specifically excluding certain fields from validation if they are dynamically controlled, and logs the form data.
- **Informational Alerts:** Includes an `Alert` component to inform users about redirecting from Shopify's page.
- **InfoComponent:** Provides a link to a wiki page for more information on customizing the UI.
- **Timestamp 19/11/2025, 21:11:54, 19/11/2025, 21:12:22, & 19/19/2025, 21:12:29:** The `flex` property of the `Col` components was adjusted (from `1 1 200px` to `1 1 300px` and back to `1 1 200px`, then to `1 1 300px` again, while the right column's `flex` also fluctuated between `0 1 500px` and `0 1 300px`). These changes indicate minor adjustments to the responsive layout or column widths for the customization and preview sections.

**8. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx` (20/11/2025, 18:44:34, 20/11/2025, 18:44:55, 20/11/2025, 18:49:44, & 20/11/2025, 18:49:50)**
This `processProductBasedShippingData` component is a helper/renderer for configuring product-based shipping rules.
- **Rule Definition:** Allows defining shipping rules based on specific products or collections, including rule name, price, mapping to an existing shipping ID, calculation method (override/add-on), price multiplier, and combination with weight-based shipping.
- **Product/Collection Selection:** Integrates `ProductSearch` to add products or collections to the shipping rule. It includes validation to prevent adding similar product variants or collections multiple times.
- **Data Mapping:** `dataMapperForItems` transforms selected products/collections into a format suitable for display in the table.
- **Dynamic Options:** `selectedOptions` memoizes a list of available shipping IDs for mapping, filtering out already used ones.
- **Form Structure:** Defines a `fields` array for dynamically rendering form items using `RenderField`.
- **Table Display:** Displays selected items (products/collections) in a table, allowing removal.
- **Keypress Validation (20/11/2025, 18:49:44 & 20/11/2025, 18:49:50):** A `onKeyPress` validator was added to the 'Rule price' `inputNumber` field to restrict input to only numbers and decimal points (`/[0-9.]$/.test(event.key)`). This prevents invalid characters in the price field. The change between `18:49:44` and `18:49:50` seems to be an exact duplicate, indicating a re-save or minor, non-functional change.

**9. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (21/11/2025, 11:50:18 & 21/11/2025, 11:51:40)**
This file provides a collection of utility helper functions.
- **Filtering & Formatting:** `getDynamicSearchFilters`, `formatDateString`, `setCurrencySymbol`, `formatAmount` for data manipulation and display. `formatAmount` handles number formatting with a global currency symbol and optional notation.
- **Comparison & Validation:** `shopifyAppCheckoutEnabledStatus` (checks last login date), `deepCompare` (for object comparison), `uploadCohortCsv` (validates and processes CSV files for phone numbers or emails).
- **Date & Time Helpers:** `debounce`, `disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`, `disabledDate`, `disabledTime` for handling dates and times, often used in date pickers.
- **String Manipulation:** `capitalizeFirstLetter`.
- **Table Data Processing:** `extractTitlesAndDataIndexes` (for table columns), `sortDataByKey`, `extractUniqueCKeysForAntColumn`.
- **Array Comparison:** `compareAndCaptureArrayFields` for identifying added/removed items in arrays.
- **Range Validation:** `areBothRangesMoreThanOneDay`.
- **No significant code changes between the two timestamps for this file; likely just minor formatting or save operations.**

### Overall Patterns and Recurring Elements:

1.  **React and Ant Design:** The codebase heavily relies on React for UI development and `gokwik-ui-kit` (which seems to be an Ant Design wrapper/extension) for components like `Form`, `Button`, `Card`, `Table`, `Input`, `Switch`, `Dropdown`, `message`, `Tooltip`, `Alert`, `Col`, `Row`, `Collapse`, etc.
2.  **Modular Architecture:** Components are organized by functionality (e.g., `BrandPage`, `ProductSearch`, `OrderDetails`, `FreeGift`, `OrderConfirmationPage`) and reusable utilities (`helper.ts`, `shippingBasedData.tsx`).
3.  **Form Management:** Consistent use of `Form.useForm()` and `Form.useWatch()` for managing form state, validations, and reacting to value changes. `RenderField` is a common utility for rendering various form input types.
4.  **API Interaction:** Frequent use of `makeAPICall` (and `makeAWSPutCall`) with `APIEndPoints` for fetching and updating data, suggesting a centralized API utility.
5.  **State Management (Redux):** `useAppDispatch` and `useSelector` indicate the use of Redux (or a similar state management library) for global state management (e.g., `getMerchantDetails`, `updatedLogoData`).
6.  **Customization Focus:** Many components, especially `BrandPage` and `OrderConfirmationPage`, are geared towards allowing merchants to customize various aspects of the checkout and post-purchase UI. This often involves color pickers, image uploads, and conditional display of UI elements.
7.  **Data Fetching & Loading States:** Common use of `useState` for `loading` flags and `useEffect` for data fetching, indicating asynchronous operations.
8.  **User Experience Features:** Includes features like debounced search, infinite scrolling, client-side validation, and informative error/success messages (`message.error`, `message.success`).
9.  **Date and Time Handling:** `dayjs` library is consistently used for date and time manipulations, including formatting, comparisons, and disabling dates in pickers.
10. **Microfrontend Integration:** The `index.ejs` file shows a clear pattern of configuring and loading multiple microfrontends using SystemJS import maps, with distinct configurations for different deployment environments (local, dev, qa, sandbox, production). This is crucial for a large, modular application.
11. **Environment Configuration:** The `.env` files (though excluded from detailed summary for security reasons) are used to manage environment-specific API URLs, indicating a standard practice for managing configurations across different deployments.
12. **Layout and Responsiveness:** Frequent use of `Row`, `Col`, and `flex` properties for layout, suggesting attention to responsive design.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34:** Initial implementation or major update of `BrandPage` focusing on logo and primary color customization, including AWS S3 integration.
*   **17/11/2025, 16:22:51:** Update to `ProductSearch` indicating ongoing development of discount/free gift product selection capabilities.
*   **17/11/2025, 16:23:04:** Update to `OrderDetails` for refined order data display, refund logic, and currency formatting.
*   **18/11/2025, 00:45:31:** Update to `index.ejs` for microfrontend configuration, security policies, and New Relic/Clarity integration.
*   **18/11/2025, 23:42:52:** Major update to `collapseFields.tsx`, introducing drag-and-drop reordering for customizable sections of the order confirmation page.
*   **19/11/2025, 21:10:01 - 21:12:29:** A series of minor layout adjustments to `OrderConfirmationPage`, suggesting fine-tuning of the UI and responsiveness.
*   **20/11/2025, 18:37:48:** Significant change in `index.ejs` to adjust local development dependencies to QA environment URLs.
*   **20/11/2025, 18:49:44:** Addition of input validation for numeric fields in `shippingBasedData.tsx` to improve data quality.
*   **21/11/2025, 11:48:56:** Update to `ProductSearch` adding new features (`btnSearch`, `topUpGift`) and minor refinements to existing logic.

## 13:05:26
The provided logs track changes across several JavaScript/TypeScript files within a `checkout-dashboard-ui` project and an EJS template in a `dashboard-ui-configuration` project. The changes primarily focus on UI customization, discount management, order details, and environmental configuration.

### File-Specific Updates:

1.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file manages the "Brand" customization page, allowing merchants to upload their logo and select a primary theme color.
    *   Key functionalities include:
        *   **Image Upload:** Handles logo uploads with validation for file type (JPEG, PNG, SVG) and size (under 2MB). It uses `cleanImageWithCanvas`, `makeAPICall` for presigned URLs, and `makeAWSPutCall` for AWS S3 uploads.
        *   **Color Picker Integration:** Incorporates a `ColorPicketComponent` for selecting the primary theme color.
        *   **Form Management:** Uses Ant Design's `Form` for data handling, `Form.useWatch` to monitor changes, and `saveConfig` from `useMerchantConfigApi` to persist settings.
        *   **State Management:** Utilizes `useState` for UI visibility (`isVisible`) and `useEffect` hooks to fetch merchant details and custom configuration on component mount, and to dispatch brand data updates.
        *   **Save Logic:** The `onFinish` handler updates the merchant's logo via API calls and saves other custom configurations.

2.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
    *   **Timestamp: 17/11/2025, 16:22:51**
        *   This component provides a modal for searching and selecting Shopify products or collections, used in discount and free gift configurations.
        *   It supports searching by product or collection, handling pagination (`useIntersectionObserver` for infinite scroll), and debouncing search input.
        *   **Functionality:** Displays selected items, allows adding/removing, handles quantity adjustments for products (specifically for gift/top-up scenarios), and supports collating product variants.
        *   Includes filtering for "Agent led" products (items without a 'no-agent' tag).
        *   **Props:** `searchType`, `hideSearch`, `hideButton`, `buttonText`, `items`, `onAdd`, `onRemove`, `collateProducts`, `showQuantity`, `alloweditemscount`, `hideSearchInput`, `isAgentLed`, `topUpGift`, `collectionSpecificData`.
    *   **Timestamp: 21/11/2025, 11:48:56**
        *   Added a `DeleteOutlined` icon to the component imports.
        *   Introduced a new prop `btnSearch` to control the visibility of a "Select \[products/collections]" button, providing an alternative way to open the search modal.
        *   Adjusted the display logic for `product?.variants?.length` to prevent showing "0 variants selected" when there are no variants.
        *   Modified `handleQuantityChange` to conditionally update the quantity based on `collectionSpecificData?.collectionMinimumPurchangeQuantity`.

3.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file displays detailed information about a specific order.
    *   **Key features:**
        *   Fetches and displays order data, including price breakups, transactions, and refunds.
        *   Handles currency formatting using a global `currentCurrencySymbol`.
        *   **Refund Management:** Implements `mergeRepeatedRefunds` to consolidate refund attempts and calculates refundable amounts, impacting the refund button's state (`refundBtnState`).
        *   **Order Editing Logic:** Sets `disableEdit` and `title` based on whether rewards, GWP discounts, or loyalty points are applied to the order.
        *   **Customer Information:** Masks customer phone number and email initially, with buttons to reveal them.
        *   **UI Components:** Uses `Tabs`, `Table`, `Tag`, `Tooltip`, `Popover`, and various icons from `gokwik-ui-kit` to present information.
        *   **Breadcrumbs:** Updates breadcrumbs for navigation context.

4.  **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
    *   **Timestamp: 18/11/2025, 00:45:31**
        *   The Single-SPA import map configuration for the `gokwik` applications is updated.
        *   For `isLocal` environment, `@gokwik/checkout` is set to `//localhost:9002/gokwik-checkout.js`.
        *   For `deployedEnv==='dev'`, `@gokwik/kwikcomm` is added with a URL `https://dev-dashboard.dev.gokwik.in/kwikcomm/gokwik-kwikcomm.js`.
        *   For `deployedEnv==='qa'`, `@gokwik/kwikcomm` is added with a URL `https://qa-dashboard.dev.gokwik.in/kwikcomm/gokwik-kwikcomm.js`.
        *   New Relic and Clarity (Microsoft) analytics scripts are included for the `production` environment, using templated `clarityKey` for Clarity.
    *   **Timestamp: 20/11/2025, 18:37:48**
        *   Minor change in the `isLocal` environment configuration: `@gokwik/utilities` and `@gokwik/dashboard` URLs are updated from `sandbox-dashboard.dev.gokwik.in` to `qa-dashboard.dev.gokwik.in`. The `@gokwik/checkout` URL remains localhost.
    *   **Timestamp: 21/11/2025, 12:27:47**
        *   Reverted the change from 20/11/2025. In the `isLocal` environment, `@gokwik/utilities` and `@gokwik/dashboard` URLs are changed back from `qa-dashboard.dev.gokwik.in` to `sandbox-dashboard.dev.gokwik.in`.

5.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`**
    *   **Timestamp: 18/11/2025, 00:49:40**
        *   Manages the "Free Gift Settings" page, allowing the configuration of automatic free gift rules.
        *   **Form Structure:** Uses an Ant Design form (`Form.useForm`) with fields for rule name, sales channels (App, Web, Agent led), purchase requirements (Cart value, Quantity), applicable products/collections, free gift quantity/price, and application method (Auto/Selection).
        *   **Dynamic Fields:** The `hideControlInput` property is used to conditionally hide fields based on `giftApplicableOn` and `applicationMethod`.
        *   **Product/Collection Search:** Integrates `ProductSearch` component for selecting specific free gift products or applicable products/collections.
        *   **Rule Management:** Allows adding new rules, editing existing ones (`handleEdit`), and deleting rules (`handleDelete`).
        *   **Status Toggle:** A `Switch` component in the table allows enabling/disabling individual gift rules.
        *   **Breadcrumbs:** Updates breadcrumbs to reflect navigation.
    *   **Timestamp: 18/11/2025, 00:50:14** and **18/11/2025, 00:58:39**
        *   No observable code changes in the provided snippets. These seem to be consecutive saves without functional changes.

6.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component renders a collapsible UI for customizing various sections of the order confirmation page.
    *   **Collapsible Sections:** Contains `Collapse` items for "Brand Logo Customization" (using `LogoPage`), "Dynamic Banners" (using `RenderEditorFunction`), "TrustBanner" (using `TrustBadgeForm`), "Order Details", "Customer Information", and "Support & Communication".
    *   **Dynamic Form Fields:** Each section contains `RenderField` components for common input types (switch, input) and `ColorPickerHelper` for background and text color customization.
    *   **Drag-and-Drop Reordering:** Implements drag-and-drop functionality for reordering the collapsible sections, indicating a dynamic layout capability for the order confirmation page.

7.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx`**
    *   **Timestamp: 19/11/2025, 21:10:01**
        *   This page allows customization of the order confirmation page, featuring a form section and a preview section.
        *   **Enable/Disable Feature:** Includes a switch to enable/disable the custom order confirmation page, with an `Alert` explaining its impact (redirecting from Shopify's page).
        *   **Form Submission:** `handleFormSubmit` validates form fields, specifically excluding `trust_text` and `trust_tag` from validation.
        *   **Layout:** Uses `Row` and `Col` for a responsive two-column layout, with one column for the form (`MainSection`) and another for the `OrderConfirmationPreview`.
        *   Initial values for the form are loaded from `initialValuesForThankYouPageForm`.
        *   **State:** `changed` state tracks form modifications to enable/disable the "Save Changes" button.
    *   **Timestamp: 19/11/2025, 21:11:54**, **19/11/2025, 21:12:22**, **19/11/2025, 21:12:29**
        *   These entries show changes in the `flex` property of the `Col` components, specifically adjusting the width of the form and preview sections.
        *   The form column `flex` property was changed from `'1 1 200px'` to `'1 1 300px'` and back, and the preview column `flex` from `'0 1 500px'` to `'0 1 300px'` and back to `'0 1 500px'`. This indicates UI layout adjustments for better display of the form and preview.

8.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`**
    *   **Timestamp: 20/11/2025, 18:44:34**
        *   This component (`processProductBasedShippingData` function) handles the configuration of product-based shipping rules within a modal or drawer.
        *   **Data Mapping:** Maps raw shipping data into a table format, extracting rule details like name, price, mapped shipping ID, calculation method, price multiplier, and weight combination.
        *   **Product/Collection Selection:** Integrates the `ProductSearch` component to add specific products or collections to a shipping rule. It includes logic to prevent adding duplicate product variants or collections.
        *   **Form Fields:** Defines fields for rule name, price, mapping to an existing shipping ID, calculation method (override/add), price multiplier, and combining with weight-based shipping.
        *   **Item Display:** Uses a `Table` to display selected products/collections (`itemsData`) with images, titles, variant counts, and a delete button.
        *   **State Management:** Uses `useState` for `itemsData` (selected products/collections) and `previousShippingData`. `useMemo` optimizes `selectedOptions` for shipping IDs.
    *   **Timestamp: 20/11/2025, 18:44:55**
        *   The `price` field type in `fields` was changed from `'inputNumber'` to `'input'`. This is a minor type change for the form input.
    *   **Timestamp: 20/11/2025, 18:49:44** and **20/11/2025, 18:49:50**
        *   Added an `onKeyPress` event handler to the `price` input field, restricting input to only numbers and decimal points (`/[0-9.]$/.test(event.key)`). This ensures that only valid numeric input can be entered for the shipping rule price. No other functional changes in the provided snippets for these two timestamps.

9.  **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`**
    *   **Timestamp: 21/11/2025, 11:50:18** and **21/11/2025, 11:51:40**
        *   No observable code changes in the provided snippets. These seem to be consecutive saves without functional changes. This file contains various utility functions for formatting dates, currency, numbers, managing search filters, handling file uploads (CSV cohorts), and array comparisons.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34:** Brand customization page logic (logo upload, color picker, API integration).
*   **17/11/2025, 16:22:51:** Initial version of the product/collection search component with core functionalities.
*   **17/11/2025, 16:23:04:** Order details page logic, including refund processing, currency formatting, and dynamic editability.
*   **18/11/2025, 00:45:31:** Update to `index.ejs` adding `kwikcomm` for dev/qa environments and New Relic/Clarity for production.
*   **18/11/2025, 00:49:40:** Free gift settings page implementation with rule management and product/collection selection.
*   **18/11/2025, 23:42:52:** Order confirmation page UI customization with collapsible sections and drag-and-drop reordering.
*   **19/11/2025, 21:10:01 - 21:12:29:** Minor UI layout adjustments (flex widths) on the order confirmation page.
*   **20/11/2025, 18:37:37:** Environment variable changes, enabling QA environment API URLs and commenting out sandbox.
*   **20/11/2025, 18:37:48:** `index.ejs` change to point `@gokwik/utilities` and `@gokwik/dashboard` to QA in `isLocal` env.
*   **20/11/2025, 18:49:44:** Added input validation (numbers and decimals only) for shipping rule prices.
*   **21/11/2025, 11:48:56:** Enhancements to product search component (`btnSearch` prop, quantity update logic).
*   **21/11/2025, 12:27:36:** Environment variable changes, enabling sandbox environment API URLs and commenting out QA.
*   **21/11/2025, 12:27:47:** `index.ejs` change to point `@gokwik/utilities` and `@gokwik/dashboard` back to sandbox in `isLocal` env.

### Patterns or Recurring Elements:

*   **Ant Design (gokwik-ui-kit):** Extensive use of `Form`, `Button`, `Card`, `Row`, `Col`, `Input`, `InputNumber`, `Switch`, `Table`, `Dropdown`, `message`, `Tooltip`, `Alert`, etc., from `gokwik-ui-kit` (presumably an Ant Design-based library) for building UI components and forms.
*   **Form Management:** Consistent use of `Form.useForm()` and `Form.useWatch()` for managing form state and reacting to value changes.
*   **Merchant Configuration:** Frequent interaction with `useMerchantConfigApi` hook (from `@library/utilities/hooks/useMerchantConfig`) and `makeAPICall` for fetching and saving merchant-specific configurations.
*   **Product/Collection Search:** The `ProductSearch` component (from `@library/components/discounts/productSearch`) is reused across different settings pages (e.g., Free Gift, Shipping) for selecting items.
*   **Utility Helpers:** Reliance on `@library/utilities/helpers/helper.ts` for common tasks like `formatAmount`, `setCurrencySymbol`, and form rendering (`RenderField`).
*   **API Endpoints:** API calls are consistently made using `makeAPICall` and `APIEndPoints` from `@library/utilities/constants/apiEndpoints`.
*   **Breadcrumb Updates:** The `updateBreadcrumbs` utility function from `@gokwik/utilities` is used to maintain navigation context across pages.
*   **Environment Configuration:** The `.env` file and `index.ejs` frequently change to point to different API gateways (dev, qa, sandbox) and import map URLs based on the `deployedEnv` or `isLocal` variables, indicating active development and deployment processes across multiple environments.
*   **UI Customization:** A strong theme of customizable UI elements is present, from brand logos and colors to dynamic banners and order confirmation page layouts. This suggests a product heavily focused on white-labeling or extensive merchant-specific branding.

## 14:05:57
**File-Specific Updates & Significant Timestamps:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (16/11/2025, 13:10:34)**:
    *   This component has been updated to provide robust brand UI customization, specifically for logo management and theme coloring.
    *   It includes asynchronous logic for checking logo presence, fetching pre-signed URLs for AWS S3 uploads, and converting images to base64 for preview.
    *   Client-side validation for logo file types (JPEG, PNG, SVG) and size (< 2MB) is implemented.
    *   The page integrates a `ColorPickerComponent` for setting the primary theme color and saves configuration changes via a merchant API hook.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (17/11/2025, 16:22:51 & 21/11/2025, 11:48:56)**:
    *   This `ProductSearch` component has received significant enhancements for searching and selecting products or collections.
    *   It now features debounced search and infinite scrolling for improved performance in modals.
    *   Specific logic for handling "top-up gifts" and setting `offered_price` has been added.
    *   A new `btnSearch` prop was introduced (on 21/11/2025) to display a dedicated button for initiating product/collection selection, improving UI flexibility.
    *   It filters results based on an `isAgentLed` prop, excluding items tagged 'no-agent'.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (17/11/2025, 16:23:04)**:
    *   The order details page was updated to provide a more comprehensive view and management capabilities.
    *   Key changes include enhanced refund processing logic, which merges multiple refund attempts and dynamically calculates refundable amounts.
    *   Dynamic currency symbol handling (`setCurrencySymbol`, `formatAmountWithCurrency`) has been implemented for global currency support.
    *   Order editability is now conditionally disabled based on specific applied discounts (e.g., Twid rewards, Loyalty Points, GWP discounts).
    *   It also features detailed price breakdown calculations and conditional visibility for RTO (Return to Origin) actions and scores based on merchant configurations.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (18/11/2025, 00:49:40 - 00:58:39)**:
    *   This component enables merchants to create and manage free gift rules with a detailed form.
    *   The form fields exhibit conditional rendering based on selected options like `applicationMethod` and `giftApplicableOn`.
    *   It integrates the `ProductSearch` component for selecting specific free gift products or collections, including validation to prevent duplicate additions.
    *   Sales channel options dynamically adjust; specifically, `shopify_agent` is disabled if the application method is not 'auto'.
    *   *Note*: Multiple timestamps within a short period suggest frequent saving during development, with the code content being identical across these entries.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (18/11/2025, 23:42:52)**:
    *   This new component provides a highly configurable interface for customizing the order confirmation page.
    *   It organizes customization settings (Brand Logo, Dynamic Banners, Trust Banner, Order Details, Customer Information, Support & Communication) into collapsible panels.
    *   Each section offers granular control over text content, colors (via `ColorPickerHelper`), and can be enabled or disabled with a toggle switch.
    *   A drag-and-drop feature is implemented, allowing users to reorder the display sequence of these sections.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx` (19/11/2025, 21:10:01 - 21:12:29)**:
    *   This is the main page for configuring the custom order confirmation page, featuring a primary toggle to enable or disable the custom experience.
    *   The UI is structured in a two-column layout, with one column for form-based settings and another for a live preview (`OrderConfirmationPreview`).
    *   Form submission includes a validation mechanism that can exclude specific fields from required checks.
    *   *Note*: Several timestamps within a short timeframe show minor adjustments to the `flex` properties of the layout columns, indicating iterative UI refinement. The final configuration for the settings column is `flex='1 1 300px'` and for the preview column `flex='0 1 500px'`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx` (20/11/2025, 18:44:34 - 18:49:50)**:
    *   Updates to the component managing product-based shipping rules.
    *   It facilitates the definition of rule name, price, and mapping to existing shipping IDs, along with configurable calculation methods and price multipliers.
    *   The `ProductSearch` component is integrated for selecting specific products or collections to apply rules to, preventing duplicate entries.
    *   A notable change at `20/11/2025, 18:49:44` involved changing the 'Rule price' input field from `inputNumber` to `input` with a custom `onKeyPress` handler to enforce strict numerical and decimal point input.
    *   *Note*: Similar to `freeGift.tsx`, multiple timestamps indicate frequent saves with minor or no functional changes, except for the mentioned price input refinement.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (21/11/2025, 11:50:18 - 11:51:40)**:
    *   This core utility file contains a broad range of helper functions for common tasks, including date and currency formatting, deep object comparison, debouncing, date/time picker disabling logic, string capitalization, table data extraction and sorting, and CSV cohort upload validation.
    *   *Note*: The code content is identical across these two timestamps, suggesting a file save without actual functional modifications.

**Patterns and Recurring Elements:**

1.  **Form-Driven Development**: A strong pattern of using Ant Design `Form` for configuring features (branding, free gifts, order confirmation, shipping rules) is evident, implying a standardized approach to UI and data management across the dashboard.
2.  **Modular and Reusable Components**: Components like `ProductSearch`, `RenderField`, `InfoComponent`, and `ColorPickerHelper` are frequently reused, showcasing a modular architecture that promotes consistency and maintainability.
3.  **API and State Management**: Consistent use of `makeAPICall`, `makeAWSPutCall`, custom API hooks (`useMerchantConfigApi`), and Redux (`useAppDispatch`, `useSelector`) for handling data fetching, saving, and global state across the application.
4.  **UI Customization Focus**: Many changes are directed towards giving merchants more control over the appearance and functionality of the checkout and post-purchase experience (e.g., logo, theme colors, banners, order details sections).
5.  **Environment Configuration and Micro-frontends**: The repeated updates to `dashboard-ui-configuration/src/index.ejs` and `.env` files highlight an active development workflow involving switching between different environments (dev, qa, sandbox). The `index.ejs` file specifically shows dynamic loading of micro-frontend modules (e.g., `@gokwik/utilities`, `@gokwik/dashboard`) from various URLs, indicating a micro-frontend architecture where components can be sourced from different deployment targets, even locally.
6.  **Iterative Refinement and Frequent Saves**: The presence of multiple identical timestamps for several files, often within minutes, suggests a development pattern of frequent saves, minor UI adjustments, or quick reverts, reflecting an agile development process.

## 15:05:24
The provided log details changes across several files within the `checkout-dashboard-ui` and `dashboard-ui-configuration` projects.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34)
    *   This file, responsible for the brand customization page, includes functionality for uploading a merchant logo and setting primary UI colors.
    *   It uses `Form.useWatch` to track changes in `brand_data` for logo images and `cssRules` for primary color.
    *   `useEffect` hooks fetch existing logo URLs and configuration details.
    *   `validateUpload` ensures image files are JPEG, PNG, or SVG and less than 2MB.
    *   `handleUpload` processes the uploaded image, cleans it with canvas, gets a presigned URL from AWS, and updates the form and Redux store.
    *   `onFinish` handles saving changes, including updating the merchant logo via API and saving configuration.
    *   The UI allows users to upload a logo and pick a primary theme color, with an `InfoComponent` linking to relevant documentation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51 and 21/11/2025, 11:48:56)
    *   This component provides a reusable product/collection search functionality, likely for discount or gift configurations.
    *   It manages state for loading, search text, modal visibility, results, and pagination.
    *   `fetchData` asynchronously retrieves Shopify collections or products.
    *   `parseResponse` processes the API response, handling product variants and collections, and filtering items based on `isAgentLed` flag (removing items with 'no-agent' tag).
    *   Includes `useEffect` for debounced search and modal state management.
    *   The component supports adding/removing selected items, handling quantities, and includes specific logic for "top-up gift" pricing.
    *   **Significant Change on 21/11/2025:** Added `DeleteOutlined` import, a new `btnSearch` prop for displaying a dedicated "Select products/collections" button, and refined the display logic for `product?.variants?.length` in the UI to prevent displaying "0 variants selected" when there are no variants.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04)
    *   This file manages the order details page.
    *   It fetches and displays comprehensive order data, including price breakdowns, refunds, and customer information.
    *   Introduces `formatAmountWithCurrency` to format amounts with the correct currency symbol, overriding the default `formatAmount`.
    *   `mergeRepeatedRefunds` is a new helper function to consolidate multiple refund attempts for a single `gokwik_rid` into a `MergedRepeatedRefund` object, showing attempts and a more generalized status (Completed, Failed, Initiated).
    *   The component determines refund button state (`disabled`, `refundStatus`, `refundableAmount`) based on transactions and existing refunds.
    *   Adds logic for `setEditTitle` to display specific messages and disable editing if Twid rewards, GWP discounts, or loyalty points are applied.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Timestamps: 18/11/2025, 00:49:40, 00:50:14, 00:58:39)
    *   This component manages the Free Gift Settings page, allowing merchants to configure free gift rules.
    *   It uses `Form.useWatch` to monitor various aspects of the `auto_gift_rules_config`.
    *   Includes `useEffect` to update breadcrumbs.
    *   Defines a comprehensive `fields` array for rendering different form inputs (input, checkbox, radio, inputNumber, search, switch) for rule creation.
    *   The `columns` array defines the structure of the rules table, including status switches and dropdown actions for edit/delete.
    *   `handleEdit` and `handleDelete` functions manage rule modification and removal.
    *   `handleAddFreeGiftProduct` and `handleAddApplicableOnItems` functions handle adding products/collections to gift rules, including validation for duplicate items.
    *   **Pattern:** Multiple timestamps within a short period (00:49:40 to 00:58:39) indicate rapid iterative development or small adjustments to the same component, suggesting active work on the Free Gift feature. The code remains largely identical across these three timestamps, indicating minor or non-substantive changes, possibly formatting or very small logic tweaks not captured in the diff provided.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52)
    *   This component renders collapsible sections for customizing the order confirmation UI.
    *   It defines fields for "Order Details," "Customer Information," and "Support & Communication" with switches to enable/disable sections, input fields for text, and `ColorPickerHelper` components for background/text colors.
    *   Each section in the `Collapse` component (`items`) also includes an `extra` `Switch` for toggling its overall enabled state.
    *   Introduces drag-and-drop functionality for reordering collapse items, allowing users to customize the layout of the order confirmation page.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx`** (Timestamps: 19/11/2025, 21:10:01, 21:11:54, 21:12:22, 21:12:29)
    *   This page allows customization of the order confirmation page, featuring a form section and a preview section.
    *   It includes a global switch to enable/disable the custom order confirmation page and an alert about redirecting from Shopify.
    *   `handleFormSubmit` includes validation logic that specifically excludes certain fields (`trust_text`, `trust_tag`) from required validation.
    *   **Pattern:** Multiple timestamps (21:10:01 to 21:12:29) for this file within a very short timeframe show repeated minor adjustments. The diffs primarily indicate changes to the `flex` property of the `Col` components, specifically adjusting `flex='1 1 200px'` to `flex='1 1 300px'` and back, suggesting UI layout or responsiveness adjustments being tested or refined.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`** (Timestamps: 20/11/2025, 18:44:34, 18:44:55, 18:49:44, 18:49:50)
    *   This component manages product-based shipping rules, allowing creation and mapping to existing shipping IDs.
    *   It processes `product_based_rules` from `shipping` data to generate `tableData`.
    *   Includes `dataMapperForItems` to format product/collection data for display.
    *   `selectedOptions` memoizes available shipping IDs for mapping, filtering out already used ones.
    *   `itemColumnData` defines the columns for displaying selected products/collections, including an image, title, variant count, type, and a delete button.
    *   The `fields` array defines the form for creating shipping rules, including rule name, price, shipping ID, calculation method (override/add), price multiplier, and combination with weight-based shipping.
    *   Integrates `ProductSearch` for adding specific products or collections to the rules.
    *   **Significant Change on 20/11/2025, 18:49:44:** Added an `onKeyPress` event handler to the `Rule price` input field to restrict input to only numbers and periods (`.`), improving data validation for numerical fields.
    *   **Pattern:** Similar to `freeGift.tsx` and `orderConfirmation/index.tsx`, multiple timestamps within minutes (18:44:34 to 18:49:50) indicate focused work or minor, iterative changes to the file.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`** (Timestamps: 21/11/2025, 11:50:18, 11:51:40)
    *   This utility file contains various helper functions.
    *   Functions include `getDynamicSearchFilters`, `formatDateString`, `setCurrencySymbol`, `formatAmount`, `shopifyAppCheckoutEnabledStatus`, `deepCompare`, `debounce`, `disabledBeforeDate`, `disabledBeforeTime`, `capitalizeFirstLetter`, `formatNumber`, `extractTitlesAndDataIndexes`, `sortDataByKey`, `uploadCohortCsv`, `getFutureDateString`, `compareAndCaptureArrayFields`, `areBothRangesMoreThanOneDay`, `extractUniqueCKeysForAntColumn`, `disabledDate`, and `disabledTime`.
    *   **No significant changes noted between the two timestamps on 21/11/2025.** This suggests minor, non-functional changes or no actual code modifications.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Timestamps: 18/11/2025, 00:45:31, 20/11/2025, 18:37:48, 21/11/2025, 12:27:47)
    *   This is the main EJS template file for the dashboard-ui-configuration.
    *   It defines the HTML structure, meta tags (including Content Security Policy), and imports for `single-spa` and shared dependencies.
    *   It uses conditional logic (`<% if (isLocal) %>`, `<% else if (deployedEnv==='dev' ) %>`, etc.) to load different module import maps based on the deployment environment (local, dev, qa, sandbox, production).
    *   **Significant Change on 20/11/2025:** The `isLocal` block's `@gokwik/utilities` and `@gokwik/dashboard` URLs were changed from `sandbox-dashboard.dev.gokwik.in` to `qa-dashboard.dev.gokwik.in`. This indicates a change in the local development environment's dependency resolution, pointing to QA environment assets instead of sandbox for these specific modules.
    *   **Significant Change on 21/11/2025:** The `isLocal` block's `@gokwik/utilities` and `@gokwik/dashboard` URLs were reverted from `qa-dashboard.dev.gokwik.in` back to `sandbox-dashboard.dev.gokwik.in`. This reversal suggests testing or a change in local development strategy regarding which environment's assets to consume.

**General Patterns and Recurring Elements:**

*   **React Component Development:** The majority of changes are in React/TypeScript files (`.tsx`), indicating active development of UI features.
*   **Form Management:** The use of `Form.useForm()` and `Form.useWatch()` from `gokwik-ui-kit` (presumably an internal UI library) is consistent across several UI components for managing form state and reacting to value changes.
*   **API Interactions:** Many components interact with backend APIs via `makeAPICall` or `useMerchantConfigApi` (a custom hook), demonstrating a data-driven approach.
*   **Customization Features:** There's a strong focus on merchant-facing customization, evident in `brandPage.tsx` for branding, `freeGift.tsx` for free gift rules, and `orderConfirmation/index.tsx` and `collapseFields.tsx` for post-purchase page customization.
*   **UI/UX Refinements:** Minor adjustments to UI elements like `flex` properties and input validation (`onKeyPress` for number inputs) suggest continuous iteration on user experience.
*   **Breadcrumbs:** The `updateBreadcrumbs` utility is consistently used to manage navigation paths within the dashboard.
*   **Environment Configuration:** The `index.ejs` file shows a clear pattern of configuring module imports based on the `deployedEnv` variable, allowing for environment-specific dependency loading. The repeated changes to the `isLocal` block in `index.ejs` for `utilities` and `dashboard` URLs specifically indicate ongoing adjustments to local development setups or testing against different backend environments.
*   **Date Formatting and Utilities:** The `helper.ts` file consolidates common utility functions, including date manipulation, number formatting, and array comparison.