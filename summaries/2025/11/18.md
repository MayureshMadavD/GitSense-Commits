# Activity Summary for 18/11/2025

## 00:30:43
/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts
- **Timestamp**: 12/11/2025, 21:20:24, and 15/11/2025, 12:00:15.
- **Key Changes**:
  - This file is a Svelte service responsible for handling shipping discounts and offer applications.
  - It imports numerous stores from `CommonStore` and `OrderStore` to manage state related to cart, shipping, discounts, loyalty, and payment.
  - It also imports external services for event logging, gift card management, and discount handling.
  - The `callShippingDiscountApi` function initiates a discount/shipping API call and processes its response, including applying confetti for successful coupon applications and handling Gyftr rewards.
  - The `processShippingDiscountResponse` function updates shipping methods, shipping options, and discount responses based on the API data. It also includes logic for re-applying gift cards if the cart has been modified.
  - There's logic for managing error messages, especially for UTM auto-application failures, and handling discount/shipping retry scenarios.
  - The updates on `15/11/2025, 12:00:15` appear to be identical to the previous version, suggesting no functional change in the provided snippets for this timestamp, or possibly a re-save.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts
- **Timestamp**: Multiple updates between 13/11/2025, 14:31:15 and 17/11/2025, 23:34:43.
- **Key Changes**:
  - This file defines various base URLs for different services (health, address suggestion, API, experiment, TwidPay, KP, CDN, analytics v1/v2, merchant URL, proxy service) based on the current environment (dev, qa, sandbox, production, local, etc.).
  - It subscribes to `store_merchanturl`, `store_environment`, and `store_cashToPrepaid` to dynamically set `merchantUrl`, `env`, and `cashToPrepaid` variables.
  - The URL definitions show a clear pattern of switching between `dev.gokwik.io`, `gokwik.co`, `gokwik.in` domains based on the environment variable `env`.
  - The `api_url()` function explicitly comments out several local URLs and settles on `https://api.gokwik.co` for the 'local' environment in the last few updates, indicating a preference for a production-like endpoint even during local development.
  - The `XGokwikToken` and `XKWIKPASSToken` functions return different static tokens based on the environment.
  - Most updates to this file involve slight modifications or reordering of the URL assignments within the functions, especially for the `api_url` function's `local` environment setting. For example, on `15/11/2025, 11:32:02`, `api_url` for `local` is set to `https://sandbox.gokwik.co`, and then on `17/11/2025, 13:02:34` and later, it's changed to `https://api.gokwik.co`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html
- **Timestamp**: Multiple updates between 13/11/2025, 14:31:36 and 17/11/2025, 23:35:35.
- **Key Changes**:
  - This is an HTML file representing a merchant page, likely for testing or integration of the Gokwik checkout SDK.
  - It includes an inline JavaScript SDK (`gokwikSdk`) responsible for initializing the checkout process, handling events, and hiding buttons.
  - It sets cookies (`gk_landing_page`, `gk_orig_referrer`) to track user's initial page and referrer.
  - The `window.merchantInfo` object contains configuration details such as `mid`, `environment`, `type`, `storeId`, and `fbpixel`.
  - The `mid` value within `window.merchantInfo` is frequently changed across different timestamps, often cycling through various IDs, suggesting testing with different merchant configurations or environments. For instance, it changes from `'gh0yshvkmca4pw4'` to `'eey3k3mkrg55tcs'`, then to `'19g6jlssscg1r'`, and finally to `'19g6im5qdaj7w'`.
  - The overall structure and functionality remain consistent, with changes primarily in the `mid` configuration.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte
- **Timestamp**: Multiple updates between 13/11/2025, 20:56:52 and 15/11/2025, 12:01:15.
- **Key Changes**:
  - This Svelte component manages the payment options screen.
  - It imports a large number of stores from both `LoginStore` and `OrderStore` to manage payment-related state (total price, COD charges, discounts, selected payment methods, experiment flags, etc.).
  - It uses various services for analytics, payment processing, and helper functions.
  - The `onMount` lifecycle hook initiates several actions: setting `prepaidDiscount` to 0, subscribing to `paymentMethods`, logging UPI presence, processing saved cards, firing GTM events, setting page name, and calling payment methods.
  - There are numerous subscriptions to Svelte stores to reactively update component state based on changes in the application's overall state.
  - The component renders various payment-related sub-components like `ErrorMessage`, `PaymentButton`, `CodConfirmationBox`, `PaymentHeader`, `PspOrderButtons`, `UpiCollect`, etc.
  - The changes across the various timestamps for this file (e.g., 13/11/2025 20:56:52 to 21:25:07) appear almost entirely identical in the provided snippets, primarily due to the extensive list of imports and initial variable declarations that remain stable. The only notable change is the addition of `store_availableOffersCheck` to the OrderStore imports on `13/11/2025, 21:22:28`. On `15/11/2025, 12:01:15`, `store_isLoggedInUser` and `store_isCartUpdated` are added to CommonStore imports, and `AutomaticGiftHeader` and `GiftJourney` components are imported.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte
- **Timestamp**: 15/11/2025, 11:49:48 and 15/11/2025, 11:52:44.
- **Key Changes**:
  - This Svelte component displays the order summary, including calculations for total price, discounts, shipping, and loyalty.
  - It subscribes to numerous stores from `CommonStore` and `OrderStore` to get the latest cart data, discounts, shipping info, and other price-related details.
  - The core logic involves calculating `totalPrice` reactively based on `subTotal`, `couponDiscount`, `partnerAcquisitionOffer`, `discountBasedRewards`, `shopifyStoreCredit`, `prepaidDiscount`, `shippingInfo`, `giftcardTotal`, `codCharges`, `twidPay`, `gstInfo`, and `gyftr`.
  - The `handleCartUpdate` function is crucial for processing `cartjsObject`, segregating free products (BXGY logic), and updating `subTotal`.
  - Changes between the two timestamps appear identical, suggesting a re-save without functional modifications in the provided snippets.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts
- **Timestamp**: Multiple updates between 17/11/2025, 13:05:00 and 17/11/2025, 14:14:00.
- **Key Changes**:
  - This file defines the integration with the Contlo analytics SDK.
  - It provides dummy `window.contlo` methods (`init`, `identify`, `track`, `push`) for logging to the console, indicating a development or testing setup.
  - The `createBody` function constructs a standardized payload for Contlo events, including product IDs, promo codes, cart total, and various UTM/marketing data.
  - The `callContlo` function acts as a dispatcher, mapping internal event names (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`, `coupon_applied_failed_gk`) to specific Contlo event handlers.
  - Individual functions like `contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, and `contloDiscountEvent` prepare data for different event types and call `contloSendEvent`.
  - The `contloSendEvent` function wraps the actual `window.contlo.sendEvent` call in a try-catch block, logging a console message if the SDK is not found.
  - The change on `17/11/2025, 14:07:01` modifies the `cart_total_price` in `createBody` to explicitly handle cases where `commonAnalyticsData?.cart_after_discount` might be non-numeric, using `commonAnalyticsData?.cart_total_price` as a fallback. Subsequent changes (`17/11/2025, 14:13:04`, `17/11/2025, 14:13:49`, `17/11/2025, 14:14:00`) further refine this logic by checking if `cart_after_discount` is present and a valid number before using it, else falling back to `cart_total_price`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts
- **Timestamp**: Multiple updates between 17/11/2025, 12:56:56 and 17/11/2025, 14:05:25.
- **Key Changes**:
  - This file is a central service for integrating various third-party analytics platforms (CleverTap, Klaviyo, WebEngage, Moengage, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, Google Ads).
  - It imports numerous stores to gather comprehensive data about the user's cart, address, discounts, payment, and marketing attribution.
  - It maintains a `configObject` to enable or disable different analytics pixels and events.
  - A `priceBreakup` object tracks various financial components of the order (subtotal, discount, shipping, COD, gift card, tax).
  - The `adSourceMapping` function processes UTM parameters from the source URL.
  - The `store_cartjsObject` subscription triggers `createDataObject` and `generateTrackingData` to prepare data for analytics events.
  - The `store_totalPrice` subscription updates `totalValue`, `priceBreakup.order_total`, and `gaTotalAmount`, and also calls `generateTrackingData`.
  - The change on `17/11/2025, 13:44:52` introduces a `console.log(res)` within the `store_totalPrice` subscription, likely for debugging purposes, which is then removed in the next update on `17/11/2025, 14:05:25`.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/common/Promotion.svelte
- **Timestamp**: 17/11/2025, 22:38:42.
- **Key Changes**:
  - This Svelte component displays promotional text related to loyalty points, store credits, or gift cards.
  - It conditionally renders a message based on the availability of `enableGiftCard`, `loyaltyEnabled`, `creditsEnabled`, or `gyftrEnabled` and the current page.
  - It dynamically constructs `redeemableText` and `loyaltyDiscountText` using `loyaltyDisplayName` and `creditsDisplayName` which are configured from `store_requestIdObject?.custom_config`.
  - The `onMount` hook subscribes to `store_requestIdObject` to fetch custom display names for credits and loyalty.
  - The component also contains `JSON.stringify` calls for debugging purposes for the enabled states of gift cards, loyalty, credits, and Gyftr.

/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/Discounts/Discounts.svelte
- **Timestamp**: Multiple updates between 17/11/2025, 23:52:04 and 18/11/2025, 00:29:30.
- **Key Changes**:
  - This Svelte component manages discount application and display within the checkout flow.
  - It imports a very large number of stores from both `CommonStore` and `OrderStore`, indicating a high degree of integration with the application's state.
  - It handles various discount types: automatic, stacked, one-click, gift cards, loyalty, and partner offers (e.g., CredPay, Gyftr).
  - The `allAppliedOffers` reactive statement aggregates all active discounts for display, including automatic, stacked, and partner acquisition offers.
  - The `onMount` hook subscribes to `store_requestIdObject` to retrieve configurations for disabling discounts based on credits/gift cards, loyalty app details, and dynamic automatic discount lists.
  - It also subscribes to `store_reapplyEr`, `store_stackedDiscounts`, and `store_offers` to reactively manage applied discounts, stacking logic, and available offers.
  - Functions like `removeCredits`, `getStoreCredits`, `removeCoupon`, `processPartnerOffers`, `calculateAvailableCouponsLength` are central to its functionality.
  - The `showViewOffers` and `showOffersListing` variables control the visibility of the offers section.
  - The updates across the various timestamps (e.g., 17/11/2025 23:52:04 to 18/11/2025 00:29:30) appear almost identical, again indicating re-saves or minor non-functional changes not discernible from the provided snippets. The extensive import list and reactive logic are consistent.

**Recurring Patterns and General Observations**:

1.  **Svelte Components and Stores**: Many files (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, `Discounts.svelte`, `Promotion.svelte`, `Merchant.svelte`) extensively use Svelte's reactive store pattern (`store_...`) from `CommonStore`, `OrderStore`, and `LoginStore` to manage application state across different components and services. This suggests a highly reactive and modular architecture.
2.  **Analytics Integration**: There's a strong emphasis on analytics. `ForeignAnalytics.ts` is a central hub for integrating various third-party analytics (Facebook, GA, Snapchat, Contlo, etc.), and `Contlo.ts` specifically details the Contlo integration. Events related to user actions (mobile added, pincode entered, payment method selected, payment completed, address added, coupon applied) are consistently tracked.
3.  **Environment-Specific Configuration**: The `EnvironmentService.ts` and `merchant.html` files show a clear pattern of configuring URLs and tokens based on the deployment environment (local, dev, qa, sandbox, production). This is crucial for managing different API endpoints and behaviors in various stages of development and production.
4.  **Checkout Flow Logic**: The services and components are deeply involved in a complex checkout flow, managing aspects like:
    *   **Discounts and Offers**: Applying/removing coupons, handling stacked discounts, gift cards, loyalty points, and partner acquisition offers.
    *   **Shipping**: Setting shipping methods and options.
    *   **Payment**: Calling payment methods, handling COD confirmations, and displaying payment options.
    *   **Cart Management**: Updating cart object, segregating free products, and re-applying discounts/gift cards on cart updates.
5.  **Debugging/Development Practices**:
    *   Presence of `console.log` statements in various files (`merchant.html`, `EnvironmentService.ts`, `Contlo.ts`, `ForeignAnalytics.ts`, `Promotion.svelte`) indicates active debugging during development.
    *   The `// @ts-nocheck` comment in Svelte files suggests an intentional bypass of TypeScript checks for those components, possibly due to complex dynamic typing or ongoing refactoring.
    *   Dummy implementations for external SDKs (e.g., `window.contlo` in `Contlo.ts`) are used, which is a common practice for development when the actual SDK might not be loaded or for local testing.
    *   Commented-out code (especially in `EnvironmentService.ts` for local URLs and `PaymentOptions.svelte` for `getPreviouslyUsedUpiId`/`processAllCards`) suggests iterative development and testing.
6.  **Code Duplication (in snippets)**: Several log entries for the same file (`PaymentOptions.svelte`, `Discounts.svelte`, `EnvironmentService.ts`, `ForeignAnalytics.ts`, `Contlo.ts`) show almost identical code content across consecutive timestamps. This suggests either frequent saves without functional changes, or minor changes not captured in the provided diffs that are too subtle to notice across the large code blocks.

Overall, the logs depict a development environment focused on refining the checkout experience, with a heavy emphasis on state management, discount logic, payment processing, and comprehensive analytics tracking, all configurable across different deployment environments.

## 01:11:19
The provided logs indicate recent development activity across several UI components and configuration files within a `checkout-dashboard-ui` and `dashboard-ui-configuration` project, all dated around mid-November 2025.

Here's a breakdown of the key information:

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`**
*   **Timestamp:** 16/11/2025, 13:10:34
*   **Summary:** This file defines the `BrandPage` component, a UI for customizing a merchant's brand elements like logo and primary color on the checkout dashboard.
    *   It uses Ant Design's `Form` for managing state and `Upload` for handling logo images.
    *   Logo upload functionality includes validation for file type (JPG, PNG, SVG) and size (under 2MB), image cleaning via canvas, generation of pre-signed AWS S3 URLs, and uploading the image to AWS.
    *   It integrates with `useMerchantConfigApi` to fetch and save custom UI configurations, specifically updating `cssRules.primaryColor` and the logo path.
    *   The component fetches the existing merchant logo URL on initial load.
    *   A "Save Changes" button is enabled/disabled based on form modifications.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
*   **Timestamp:** 17/11/2025, 16:22:51
*   **Summary:** This component, `ProductSearch`, provides a versatile interface for searching and selecting products or collections, likely for discount or free gift rule configurations.
    *   It supports searching for either products or collections.
    *   Includes features for infinite scrolling using `useIntersectionObserver` to load more results as the user scrolls.
    *   Offers options for collating product variants, showing quantities, and managing selection limits.
    *   It incorporates a debounced search input for performance.
    *   Specific logic is present for handling "Agent Led" products by filtering items based on tags and for managing "Top-Up Gift" pricing.
    *   Includes quantity change handling for collections with validation against a minimum purchase quantity.

**File: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`**
*   **Timestamp:** 17/11/2025, 16:23:04
*   **Summary:** This file implements the `OrderDetails` page, which displays comprehensive information about a specific order.
    *   It fetches detailed order data, including price breakups, transactions, and refunds.
    *   A significant function `mergeRepeatedRefunds` is introduced to consolidate multiple refund attempts for a single refund ID into a unified `MergedRepeatedRefund` object, reflecting the overall status and number of attempts.
    *   The page dynamically calculates and displays various financial breakups: total discounts, tax, shipping/COD charges, and gift card/rewards totals.
    *   Currency symbols are dynamically set based on order data or merchant configuration.
    *   Order editing capabilities are conditionally disabled with specific titles if Twid rewards, GWP discounts, or loyalty points are applied.
    *   It determines the state of the refund button (disabled, status, refundable amount) based on transaction status and existing refunds.
    *   Customer phone and email are masked by default, with an option to view.
    *   Order failure reasons are also determined and displayed.

**File: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
*   **Timestamp:** 18/11/2025, 00:45:31
*   **Summary:** This is the main HTML template for a Single-SPA micro-frontend application.
    *   It sets up Content Security Policy (CSP) and includes `regenerator-runtime` for wider browser compatibility.
    *   It uses SystemJS import maps to dynamically load various `@gokwik` applications (e.g., `@gokwik/configuration`, `@gokwik/checkout`, `@gokwik/payment`) based on the deployment environment (`isLocal`, `dev`, `qa`, `sandbox`, `production`). This allows for flexible and environment-specific loading of micro-frontends.
    *   For the production environment, it includes New Relic and Microsoft Clarity tracking scripts for performance monitoring and analytics.

**Files: `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (three entries)**
*   **Timestamps:** 18/11/2025, 00:49:40; 18/11/2025, 00:50:14; 18/11/2025, 00:58:39
*   **Summary:** This file defines the `FreeGift` page, used for managing automatic free gift rules for merchants. The content across all three entries is identical, suggesting multiple saves without functional changes or very rapid, minor, non-functional edits.
    *   It provides a form for creating and editing free gift rules, including fields for rule name, sales channels (App, Web, Agent-led), purchase requirements (cart value, quantity), applicability (all products, specific products/collections), free gift product selection, quantity/price, and application method (auto, selection).
    *   It utilizes the `ProductSearch` component for selecting specific products or collections to be part of the free gift rule.
    *   Rules can be enabled/disabled via a `Switch` component.
    *   A table displays existing free gift rules with options to edit or delete them using a `Dropdown`.
    *   It integrates `useMerchantConfigApi` to persist these free gift rules (`free_gift_config`, `auto_gift_rules_config`).

**Patterns and Recurring Elements:**
*   **GoKwik UI Kit and Utilities:** Consistent use of `gokwik-ui-kit` for UI components (Button, Form, Card, Table, Input, Dropdown, etc.) and `@gokwik/utilities` for common functions like API calls (`makeAPICall`, `makeAWSPutCall`), breadcrumb updates (`updateBreadcrumbs`), and image handling (`cleanImageWithCanvas`).
*   **React Hooks:** Heavy reliance on React Hooks (`useEffect`, `useState`, `useMemo`, `useRef`, `Form.useForm`, `Form.useWatch`) for state management and lifecycle in functional components.
*   **Merchant Configuration:** The `useMerchantConfigApi` hook is a central point for managing merchant-specific settings across different features (BrandPage, FreeGift), indicating a modular and API-driven configuration system.
*   **Redux for Global State:** Redux (`useSelector`, `useAppDispatch`) is used for accessing global merchant details and user configurations.
*   **Micro-frontend Architecture:** The `index.ejs` file clearly demonstrates a Single-SPA micro-frontend setup, allowing different parts of the dashboard to be loaded independently based on the environment.
*   **API Endpoint Consistency:** `APIEndPoints` are used to centralize and manage API URLs.
*   **Data Masking:** Seen in the `OrderDetails` for sensitive customer information (phone, email).
*   **Breadcrumb Navigation:** `updateBreadcrumbs` is consistently used across pages to maintain navigation context within the dashboard.