# Activity Summary for 22/11/2025

## 17:10:05
The following is a summary of the code changes:

### File-specific Updates:

**1. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`**
*   **Timestamp:** 16/11/2025, 13:10:34
*   **Key Changes:**
    *   This file manages the UI for customizing brand elements (logo, primary color) on the checkout page.
    *   It imports several components from `gokwik-ui-kit` (Button, Upload, Form, ColorPicker, Card, Alert) and custom components for color picking and info.
    *   Redux selectors (`getMerchantDetails`, `updatedLogoData`, `updateBrandData`) and utility functions (`makeAPICall`, `makeAWSPutCall`, `cleanImageWithCanvas`, `getBase64`) are used for data management and image handling.
    *   `useEffect` hooks are used to fetch merchant logo and custom configuration on component mount or config changes.
    *   `validateUpload` function enforces image type (jpeg, png, svg) and size (under 2MB) constraints for logo uploads.
    *   `handleUpload` uses `cleanImageWithCanvas` to process images before uploading to AWS S3 via a presigned URL, and updates the form with the new logo URL.
    *   The `onFinish` handler saves brand data, including the logo path and `cssRules.primaryColor`, to the merchant configuration via an API call and updates Redux state.
    *   The UI displays forms for logo upload (with a preview) and a color picker for the primary theme color. It also includes an `InfoComponent` linking to documentation.

**2. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
*   **Timestamp:** 17/11/2025, 16:22:51
*   **Key Changes:**
    *   This component provides a search and selection interface for Shopify products or collections, typically used for discount configurations or free gifts.
    *   It uses `useState` for loading, search text, modal visibility, results, and pagination. `useRef` and `useIntersectionObserver` are used for infinite scrolling.
    *   `fetchShopifyCollectionsOrProducts` API call is made to retrieve items.
    *   `parseResponse` handles mapping and aggregating product variants if `collateProducts` is enabled.
    *   `useEffect` hooks manage debounced search on `searchedText` and reset state on modal close.
    *   `onConfirm` maps selected items to a specific format for `onAdd` callback.
    *   A new `topUpGift` prop is introduced, which when true, displays an `InputNumber` for 'Freebie Price' for selected products.
    *   The `handleQuantityChange` function is added to manage collection quantities with a minimum purchase quantity validation.
    *   `handleCloseAllInput` resets collection quantities.
    *   The JSX was cut off, but the existing part shows product/collection display with images, names, variant info, and remove/quantity controls.

**3. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`**
*   **Timestamp:** 17/11/2025, 16:23:04
*   **Key Changes:**
    *   This page displays detailed information about a specific order.
    *   It imports various UI components from `gokwik-ui-kit` and utilities for API calls, breadcrumbs, permissions, and currency formatting.
    *   State variables manage order data, refund drawer visibility, customer contact details, and refund button state.
    *   `getCurrency` and `formatAmountWithCurrency` (a custom formatter) ensure correct currency display based on order data or merchant details.
    *   `mergeRepeatedRefunds` is a helper to combine multiple refund attempts for a single refund ID and determine its final status.
    *   `fetchOrderDetails` makes an API call to retrieve order information, processes refunds, calculates total refundable amount, and sets various order-related states, including price breakup and customer details.
    *   Logic is present to disable order editing based on applied rewards, GWP discounts, or loyalty points.
    *   New constants `RTO_FAKE_ORDER_REASONS` and `DASHBOARD_INTERNAL_TEAM` are imported.
    *   Price breakup calculations are extensive, including various discount types, taxes, shipping, and gift cards/rewards.

**4. `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
*   **Timestamps:** 18/11/2025, 00:45:31; 20/11/2025, 18:37:48; 21/11/2025, 12:27:47
*   **Key Changes:**
    *   This EJS template is for the main dashboard UI configuration, setting up a single-spa application.
    *   It includes meta tags for character set, viewport, CSP, and `importmap-type`.
    *   It preloads `regenerator-runtime` and `single-spa`.
    *   The core of the changes across timestamps involves updating the `systemjs-importmap` for different deployment environments (`isLocal`, `dev`, `qa`, `sandbox`, `production`).
    *   **18/11/2025, 00:45:31:** The `sandbox` environment is configured to load `@gokwik/utilities`, `@gokwik/dashboard`, and `@gokwik/checkout` from `sandbox-dashboard.dev.gokwik.in`. Other modules (`payment`, `kwikpass`, `rto`, `kwikship`, `ellora`, `checkout-platform`, `shopify-app`) are loaded from `qa-dashboard.dev.gokwik.in`. A `@gokwik/kwikcomm` module is added to `dev` and `qa` environments.
    *   **20/11/2025, 18:37:48:** The `isLocal` environment's `@gokwik/utilities` and `@gokwik/dashboard` now point to `qa-dashboard.dev.gokwik.in`, changing from `sandbox-dashboard.dev.gokwik.in`. Other modules remain the same as the previous `qa` configuration.
    *   **21/11/2025, 12:27:47:** The `isLocal` environment's `@gokwik/utilities` and `@gokwik/dashboard` are reverted back to `https://sandbox-dashboard.dev.gokwik.in/` from `https://qa-dashboard.dev.gokwik.in/`.

**5. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`**
*   **Timestamps:** 18/11/2025, 00:49:40; 18/11/2025, 00:50:14; 18/11/2025, 00:58:39
*   **Key Changes:**
    *   This file manages the UI for configuring "Free Gift" rules, including rule name, sales channels, purchase requirements, applicable products/collections, free gift quantity/price, and application method.
    *   It uses `ProductSearch` for selecting products/collections, and `Form`, `Table`, `Drawer`, `Switch`, `Dropdown` from `gokwik-ui-kit`.
    *   `useMerchantConfigApi` hook is used for fetching and saving merchant configuration related to free gifts.
    *   The `fields` array defines the structure of the form, including validation rules (e.g., max value cannot be less than min value).
    *   The `columns` array defines the table structure for displaying configured free gift rules, with options to edit or delete rules via a `Dropdown`.
    *   `handleAddFreeGiftProduct` and `handleRemoveFreeGiftProduct` manage the `free_product` field.
    *   `handleEdit` function populates the form with existing rule data for editing.
    *   **No significant functional code changes are apparent between the three timestamps for this file, indicating minor reformatting or whitespace changes.** The code content for all three entries is identical.

**6. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`**
*   **Timestamp:** 18/11/2025, 23:42:52
*   **Key Changes:**
    *   This component defines collapsible sections for customizing the order confirmation UI.
    *   It imports `Card`, `Col`, `Collapse`, `Form`, `HolderOutlined`, `Row`, `Switch` from `gokwik-ui-kit` and custom components like `LogoPage`, `TrustBadgeForm`, `ColorPickerHelper`.
    *   `Form.useWatch` is used to react to changes in the `customize` form data.
    *   Fields are categorized into `orderDetailFields`, `customerInformationFields`, and `supportDetailFields`, each containing switches to enable/disable sections, input fields for text, and `ColorPickerHelper` for background/text colors.
    *   The `items` array structures the `Collapse` component, with each item representing a customization section (Brand Logo, Dynamic Banners, Trust Banner, Order Details, Customer Information, Support & Communication).
    *   Each collapse panel includes an `extra` prop with a `Switch` to toggle the enabled state of the respective section.
    *   Drag-and-drop reordering functionality for the collapse items has been implemented using `onDragStart`, `onDragOver`, and `onDrop` event handlers, allowing users to rearrange the order of UI customization sections.

**7. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx`**
*   **Timestamps:** 19/11/2025, 21:10:01; 19/11/2025, 21:11:54; 19/11/2025, 21:12:22; 19/11/2025, 21:12:29
*   **Key Changes:**
    *   This page provides the main interface for customizing the order confirmation page.
    *   It uses `InfoComponent`, `MainSection`, `RenderField`, `Alert`, `Button`, `Card`, `Col`, `Form`, `message`, `Row` from `gokwik-ui-kit` and custom components.
    *   A `useState` hook `changed` tracks form modifications to enable/disable the "Save Changes" button.
    *   `handleFormSubmit` is responsible for validating form fields, specifically excluding `trust_text` and `trust_tag` from validation if they are part of `appearance.trust_banner_data`.
    *   The layout is a two-column structure: one for the customization form (`MainSection`) and one for a `OrderConfirmationPreview`.
    *   The form includes a switch to enable/disable the custom order confirmation page and an `Alert` providing information about redirecting customers.
    *   **The primary change across the timestamps for this file is in the `flex` property of the `Col` components, adjusting the layout width.**
        *   **19/11/2025, 21:10:01:** `Col flex='1 1 200px'` for the form and `Col flex='0 1 500px'` for the preview.
        *   **19/11/2025, 21:11:54:** `Col flex='1 1 300px'` for the form and `Col flex='0 1 300px'` for the preview, making them more balanced.
        *   **19/11/2025, 21:12:22:** Reverted to `Col flex='1 1 200px'` for the form and `Col flex='0 1 500px'` for the preview.
        *   **19/11/2025, 21:12:29:** Reverted to `Col flex='1 1 300px'` for the form and `Col flex='0 1 500px'` for the preview.

**8. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`**
*   **Timestamps:** 20/11/2025, 18:44:34; 20/11/2025, 18:44:55; 20/11/2025, 18:49:44; 20/11/2025, 18:49:50
*   **Key Changes:**
    *   This component handles the creation and management of product-based shipping rules.
    *   It uses `Button`, `Dropdown`, `Table`, `message` from `gokwik-ui-kit` and `ProductSearch` for selecting products/collections.
    *   `tableData` processes existing shipping rules to display them.
    *   `dataMapperForItems` converts product/collection data into a format suitable for display in the table.
    *   `selectedOptions` memoizes a list of available shipping IDs, ensuring that only unused IDs can be mapped to new product-based rules.
    *   The `itemColumnData` defines the columns for a table that displays selected products/collections, including an image, title, variant count, type, and a delete button.
    *   The `fields` array defines the form structure for creating a new shipping rule, including rule name, price, mapping to a shipping ID, calculation method, price multiplier, and weight-based shipping combination.
    *   `ProductSearch` components allow adding products (with variant collation) or collections to the rule. Validation prevents adding duplicate products/collections.
    *   **The key change across these timestamps is related to the `price` input field validation.**
        *   **20/11/2025, 18:44:34:** `type: 'inputNumber'` for 'Rule price'.
        *   **20/11/2025, 18:44:55:** `type: 'input'` for 'Rule price' with `type: 'number'` in `inputProps`, which might allow non-numeric input.
        *   **20/11/2025, 18:49:44 & 20/11/2025, 18:49:50:** The `price` input field is now `type: 'input'` with `inputProps: { type: 'number', onKeyPress: (event) => { if (!/[0-9.]$/.test(event.key)) { event.preventDefault() } }, }`. This explicitly adds `onKeyPress` validation to ensure only numbers and a single decimal point are entered, fixing potential issues from the prior change.

**9. `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`**
*   **Timestamps:** 21/11/2025, 11:50:18; 21/11/2025, 11:51:40
*   **Key Changes:**
    *   This file provides a collection of utility functions.
    *   It includes functions for dynamic search filters, date formatting, currency handling (`setCurrencySymbol`, `formatAmount`), Shopify app checkout status, deep object comparison, debouncing, date/time disabling for `dayjs`, capitalizing strings, number formatting, extracting table titles/data indexes, sorting data, uploading CSVs for cohorts, getting future dates, comparing array fields, and checking date range validity.
    *   **No functional changes are observed between the two timestamps. The code content is identical.**

### Patterns and Recurring Elements:

*   **UI Component Library Usage:** Heavy reliance on `gokwik-ui-kit` components (`Button`, `Form`, `Card`, `Switch`, `Table`, `Input`, `message`, `Tooltip`, `Alert`, `Col`, `Row`, `Dropdown`, `Collapse`) across multiple files, indicating a consistent UI framework.
*   **Form Management:** Extensive use of Ant Design's `Form` component (`Form.useForm()`, `Form.useWatch()`, `form.setFieldValue()`, `form.validateFields()`) for data input, validation, and state management.
*   **Merchant Configuration:** Many components (`brandPage.tsx`, `freeGift.tsx`, `orderConfirmation/index.tsx`) interact with a `useMerchantConfigApi` hook (or similar patterns) to fetch and save `merchant_config` or `custom_config` data, highlighting a centralized configuration approach for the dashboard.
*   **Redux for State Management:** `useAppDispatch` and `useSelector` (e.g., `getMerchantDetails`) are used to manage global application state, particularly user and customization data.
*   **API Interactions:** Frequent use of `makeAPICall` and `makeAWSPutCall` with `APIEndPoints` for fetching and updating data.
*   **Timestamp Consistency:** All logs are dated in November 2025, suggesting recent development activity within a short period.
*   **Product/Collection Search:** The `ProductSearch` component is reused in `freeGift.tsx` and `shippingBasedData.tsx` to select products or collections, indicating a modular approach to common UI elements.
*   **Currency Formatting:** The `formatAmount` and `setCurrencySymbol` utilities in `helper.ts` are designed to handle global currency symbols consistently, and this is explicitly used in `order-details/index.tsx`.
*   **Minor Refactoring/Layout Tweaks:** Several files, especially `orderConfirmation/index.tsx`, show multiple commits within minutes or seconds, often with very minimal or no functional changes, suggesting iterative adjustments to layout (`Col flex` values) or saving of work in progress. `freeGift.tsx` and `helper.ts` also show identical code across some timestamps, pointing to minor, non-functional changes or re-saves.
*   **Environment Configuration (`.env`):** Changes in `.env` indicate switching between `sandbox` and `qa` environments for `REACT_APP_BASE_URL` and `REACT_APP_BULK_DISCOUNT_URL`. The `dashboard-ui-configuration/src/index.ejs` file reflects these environment changes by dynamically loading different script URLs based on `deployedEnv`.