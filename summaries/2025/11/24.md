# Activity Summary for 24/11/2025

## 10:34:18
The provided log details changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`. This file appears to contain utility functions for making API calls (`makeAPICall`) and logging user events (`logUserEvent`).

**File-specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`**:
    *   **Initial State (22/11/2025, 17:38:55)**: The `makeAPICall` function includes error handling for `401` (Unauthorized) status codes. Upon receiving a `401`, it navigates to the `/login` page after clearing the `localStorage` token, and returns `{ ...error, error: true }`. The file also defines an `EventsInterface` and the `logUserEvent` function, which captures user and merchant details, generates a session ID, and parses user agent strings.
    *   **First Change (22/11/2025, 17:39:07)**: A modification was made within the `makeAPICall` function's `catch` block for `401` errors. The error return statement was changed from `{ ...error, error: true }` to `{ error: true, message: error?.response?.data?.message || error.message }`. This suggests an intent to provide a more specific error message to the caller.
    *   **Second Change (22/11/2025, 17:39:40)**: This entry shows a reversion of the previous change. The error return statement for `401` errors in `makeAPICall` was changed back to its original form: `{ ...error, error: true }`.

**Timestamps of Significant Changes:**

*   **22/11/2025, 17:39:07**: A focused update to the `makeAPICall` function's error handling for 401 responses.
*   **22/11/2025, 17:39:40**: A rapid subsequent change, reverting the modification made just 33 seconds prior.

**Patterns or Recurring Elements in the Content:**

*   **API Call Management**: The file consistently features the `makeAPICall` function, which handles various aspects of API requests, including loader management, user role-based restrictions, dynamic headers (e.g., `merchant-mid`), cookie handling, and specific logic for single and multiple file uploads.
*   **Security Headers**: The Axios instance within `makeAPICall` consistently sets several security-related HTTP headers like `X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, and `Content-Security-Policy`.
*   **Unauthorized Error Handling (401)**: A core pattern is the specific handling of `401` HTTP responses, which involves clearing the user's token, redirecting to the login page (with path preservation), and returning an error object. The rapid changes within this specific block indicate an iterative or reconsidered approach to how 401 errors are reported back.
*   **User Event Logging**: The `logUserEvent` function is consistently present, demonstrating a structured approach to capturing user interactions, session information, merchant data, and parsing user agent details to understand the operating system, device, and browser.
*   **Dashboard-specific Utilities**: Imports like `dashboardStore` and `navigateToUrl` suggest that these utilities are part of a larger dashboard application environment, likely a micro-frontend setup due to `single-spa`.
*   **Short Iterations**: The timestamps show very quick, almost immediate, changes and reversions, particularly for the `makeAPICall` function's error handling. This could indicate active debugging, rapid testing, or a quick decision to revert a recent change.

## 10:34:51
The provided log details code changes across various UI components and configuration files, primarily within the `checkout-dashboard-ui` and `dashboard-ui-configuration` projects. The changes span from November 16, 2025, to November 21, 2025.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (Timestamp: 16/11/2025, 13:10:34)**
    *   This file, representing a "Brand Page" for UI customization, was significantly updated.
    *   It now includes functionality for uploading a brand logo, handling image clean-up, obtaining presigned AWS URLs for uploads, and displaying a logo preview.
    *   The component uses `Form` and `Upload` from `gokwik-ui-kit`, `useEffect` for data fetching and form updates, and integrates `makeAPICall`, `makeAWSPutCall`, `cleanImageWithCanvas`, and `getBase64` utilities.
    *   It allows customization of the primary color via a `ColorPicketComponent` and manages saving brand configuration via `useMerchantConfigApi`.
    *   A new `InfoComponent` was added for descriptive text and a link to a Confluence page.
    *   The "Save Changes" button is disabled until form values change (`isVisible` state).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (Timestamp: 17/11/2025, 16:22:51 and 21/11/2025, 11:48:56)**
    *   This component facilitates searching and selecting products or collections for discount rules.
    *   **17/11/2025, 16:22:51**: The component was updated to handle product and collection searching from Shopify. It includes pagination via `useIntersectionObserver`, debounced search input, and logic for collating product variants. It also supports quantity management for collections and special handling for "agent-led" items (filtering out `no-agent` tagged products). A `topUpGift` prop was added to allow setting an `offered_price`.
    *   **21/11/2025, 11:48:56**: Minor updates were made, primarily adding a `DeleteOutlined` icon import and a `btnSearch` prop. The display logic for `variants selected` and `quantity` was refined for collated products. The `handleQuantityChange` function was also adjusted to pass `quantity` only if `collectionMinimumPurchangeQuantity` is enabled.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (Timestamp: 17/11/2025, 16:23:04)**
    *   This file focuses on displaying order details.
    *   Key updates include a custom `formatAmountWithCurrency` function to ensure correct currency symbol display, separate from the `formatAmount` utility.
    *   A `statusMappingForColors` and `statusMappingForTag` were introduced for visual representation of order statuses.
    *   A `mergeRepeatedRefunds` utility function was added to aggregate multiple refund attempts for a single `gokwik_rid` into a `MergedRepeatedRefund` object.
    *   The `fetchOrderDetails` logic was enhanced to determine and set `totalRefundAbleAmount` and `refundBtnState`, considering various transaction statuses and auto-refunds. It also now sets the global `currentCurrencySymbol` based on order data or merchant details.
    *   Price breakup calculations were expanded to include various discount types, taxes, shipping, and gift/reward amounts.
    *   Logic for displaying `order_failure_reason` and handling "fake order reasons" was added, along with conditional disabling of the "Edit Order" button based on applied rewards, GWP discounts, or loyalty points.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs` (Timestamp: 18/11/2025, 00:45:31, 20/11/2025, 18:37:48, and 21/11/2025, 12:27:47)**
    *   This EJS template is responsible for configuring the single-spa application's import maps for different deployment environments (local, dev, qa, sandbox, production).
    *   **18/11/2025, 00:45:31**: The `sandbox` configuration was uncommented, explicitly setting `REACT_APP_BASE_URL` and `REACT_APP_BULK_DISCOUNT_URL` to sandbox endpoints.
    *   **20/11/2025, 18:37:48**: The `qa` environment configuration was uncommented, activating the `qa` endpoints for base and bulk discount URLs. The `sandbox` environment was commented out. For `isLocal`, the `utilities`, `dashboard`, `payment`, `kwikpass`, `rto`, `kwikship`, `ellora`, `checkout-platform`, and `shopify-app` imports were updated to point to `qa-dashboard.dev.gokwik.in` instead of `sandbox-dashboard.dev.gokwik.in` for some, while `@gokwik/checkout` remained `//localhost:9002`.
    *   **21/11/2025, 12:27:47**: The `sandbox` configuration was re-enabled, while `qa` was commented out. The `isLocal` environment reverted to using `sandbox-dashboard.dev.gokwik.in` for the majority of `@gokwik` module imports, aligning with the `sandbox` environment. This shows a back-and-forth toggling between `qa` and `sandbox` environments for local development and base URL configurations.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (Timestamp: 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, and 18/11/2025, 00:58:39)**
    *   This component manages "Free Gift Settings." The content across these three timestamps is identical, indicating no functional changes were introduced during this period, but possibly multiple saves or rebuilds.
    *   It uses `ProductSearch` for selecting products/collections for free gifts and `useMerchantConfigApi` to manage rules.
    *   The form includes various fields for defining free gift rules (name, sales channels, purchase type, min/max value, applicable products/collections, free gift quantity/price, application method, selection limit).
    *   It renders a table to display existing free gift rules with options to enable/disable, edit, or delete them.
    *   The `handleEdit` function adjusts `sales_channels` if the application method is not 'auto'.
    *   The `handleAddFreeGiftProduct` and `handleAddApplicableOnItems` functions manage the selected products/collections, preventing duplicate entries.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (Timestamp: 18/11/2025, 23:42:52)**
    *   This component provides collapsible sections for customizing the order confirmation UI.
    *   It defines fields for "Order Details," "Customer Information," and "Support & Communication," each with switches to enable/disable sections, input fields for text, and `ColorPickerHelper` for background and text colors.
    *   It incorporates `LogoPage`, `RenderEditorFunction` (for dynamic banners), and `TrustBadgeForm` components.
    *   The entire collapse structure is made draggable, allowing users to reorder the sections by drag-and-drop, which updates the form's `customize` field value.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx` (Timestamp: 19/11/2025, 21:10:01, 19/11/2025, 21:11:54, 19/11/2025, 21:12:22, and 19/11/2025, 21:12:29)**
    *   This page manages settings for the Order Confirmation Page, including a preview.
    *   **19/11/2025, 21:10:01**: Initial layout for the order confirmation page settings, with sections for enabling the custom page and including `MainSection` and `OrderConfirmationPreview` components. It includes a `handleFormSubmit` function that validates fields while excluding specific "trust banner data" fields. The main content column `flex` property is `1 1 200px` and the preview column `flex` is `0 1 500px`.
    *   **19/11/2025, 21:11:54**: The `flex` properties for the main content column and preview column were adjusted to `1 1 300px` and `0 1 300px` respectively, likely to balance the layout.
    *   **19/11/2025, 21:12:22**: The `flex` properties were reverted to the initial `1 1 200px` for the main content and `0 1 500px` for the preview.
    *   **19/11/2025, 21:12:29**: The `flex` properties were again adjusted to `1 1 300px` for the main content and `0 1 500px` for the preview, indicating an iterative refinement of the UI layout. The functionality remained consistent across these changes.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx` (Timestamp: 20/11/2025, 18:44:34, 20/11/2025, 18:44:55, 20/11/2025, 18:49:44, and 20/11/2025, 18:49:50)**
    *   This component manages product-based shipping rules.
    *   **20/11/2025, 18:44:34**: The `Rule price` input field was set to `type: 'inputNumber'`. Logic to prevent adding duplicate product variants or collections was implemented in `onAdd` handlers for `ProductSearch`.
    *   **20/11/2025, 18:44:55**: The `Rule price` input field's `type` was changed back to `input`, but `inputProps` retained `type: 'number'`, and no `onKeyPress` validation was added yet.
    *   **20/11/2025, 18:49:44**: The `Rule price` input field (`type: 'input'`) was updated to include an `onKeyPress` event handler in its `inputProps` to restrict input to only numbers and periods, ensuring valid price format.
    *   **20/11/2025, 18:49:50**: No functional changes, similar to the `freeGift.tsx` entries, suggesting a save or formatting operation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamp: 21/11/2025, 11:50:18 and 21/11/2025, 11:51:40)**
    *   This file contains various utility helper functions. The content across these two timestamps is identical, indicating no functional changes were introduced.
    *   It defines helpers for dynamic search filters, date formatting, currency formatting (`setCurrencySymbol`, `formatAmount`), checking Shopify app checkout status, deep object comparison (`deepCompare`), debouncing, disabling dates/times, capitalizing strings, number formatting, extracting table column titles/data indexes, sorting data, uploading CSVs for cohorts (with phone/email validation), getting future dates, comparing array fields, and validating date ranges.

### Timestamps of Significant Changes:

*   **16/11/2025, 13:10:34**: Major feature implementation for Brand Page UI customization, including logo upload and color picking.
*   **17/11/2025, 16:22:51**: Significant update to `ProductSearch` component, adding advanced search features, variant collation, and specific item handling.
*   **17/11/2025, 16:23:04**: Extensive updates to Order Details page, focusing on currency formatting, refund logic, status mapping, and dynamic content based on order data.
*   **18/11/2025, 23:42:52**: Introduction of draggable and customizable sections for the order confirmation page.
*   **19/11/2025, 21:10:01 - 21:12:29**: Iterative layout adjustments for the Order Confirmation Page, focusing on column `flex` properties.
*   **20/11/2025, 18:44:34 - 18:49:44**: Refinements in `shippingBasedData.tsx`, particularly regarding `Rule price` input type and validation, and adding duplicate item prevention in `ProductSearch` handlers.
*   **20/11/2025, 18:37:48 & 21/11/2025, 12:27:47**: Frequent toggling of base URLs and module imports between `qa` and `sandbox` environments in `index.ejs`, reflecting environment switching or testing.

### Patterns or Recurring Elements:

*   **`gokwik-ui-kit` Usage**: Many components heavily rely on `gokwik-ui-kit` for UI elements like `Button`, `Form`, `Card`, `Input`, `Table`, `Switch`, `Dropdown`, `message`, `Tooltip`, etc., indicating a standardized UI library across the dashboard.
*   **Form Management with Ant Design (Form.useForm(), Form.useWatch(), Form.setFieldValue())**: All UI components dealing with settings or input forms leverage Ant Design's `Form` API for state management, validation, and data binding.
*   **`useMerchantConfigApi` Hook**: This custom hook (`@library/utilities/hooks/useMerchantConfig`) is consistently used across settings pages (`BrandPage`, `FreeGift`) to fetch and save merchant-specific configurations, suggesting a centralized mechanism for managing dynamic settings.
*   **`makeAPICall` and `makeAWSPutCall`**: These utility functions (`@gokwik/utilities`) are frequently used for interacting with backend APIs and AWS services (e.g., logo uploads), indicating a standard approach for network requests.
*   **Breadcrumbs (`updateBreadcrumbs`)**: The `updateBreadcrumbs` utility is called in `useEffect` hooks in multiple pages (`BrandPage`, `FreeGift`) to maintain navigation context within the application.
*   **Environment Configuration (index.ejs and .env)**: There's a clear pattern of managing API base URLs and module imports for different deployment environments (`dev`, `qa`, `sandbox`, `production`) using conditional logic in `index.ejs` and `.env` files. The frequent changes in `index.ejs` specifically show a recurring task of switching or testing different deployment environments.
*   **Placeholder Images**: `ShopifyProductPlaceholderImage` and `ShopifyCollectionPlaceholderImage` are used consistently to display default images when actual product/collection images are not available, improving UI robustness.
*   **Currency Formatting**: The `setCurrencySymbol` and `formatAmount` utilities are used to ensure consistent currency display, with `formatAmountWithCurrency` providing a more explicit localized formatting when needed.
*   **Input Validation**: Forms often include `rules` for required fields and custom validators (e.g., `max_value` validation, CSV content validation), demonstrating attention to data integrity.

## 11:34:19
The file `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts` serves as a core utility for handling API calls and logging user events within the dashboard UI.

**File-Specific Updates:**

*   **`makeAPICall` Function:** This asynchronous function is responsible for making API requests using Axios, supporting various HTTP methods, file uploads (single and multiple), and dynamic configuration.
    *   It implements robust security headers like `X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, and `Content-Security-Policy`.
    *   It restricts 'internal users' from performing non-'get' operations on a predefined list of URLs.
    *   It manages loading states using `loaderEvent` and handles specific error cases, notably unauthorized (401) responses.
    *   For 401 errors, it clears the local storage token, saves the current path for redirection, and navigates to the `/login` page under certain conditions, ensuring session management.
*   **`logUserEvent` Function:** This function is designed to log detailed user events.
    *   It collects extensive user-specific and context-specific data, including `tracking_id`, `request_id`, `email`, `session_id` (generated using `nanoid` and stored in cookies if not present), `merchant_id`, `merchant_name`, `username`, `role`, and `timestamp`.
    *   It dynamically determines the `landing_page` based on the current window location.
    *   It includes a `parseUserAgent` helper function to extract operating system, device, OS version, browser, browser version, and webview status from the `navigator.userAgent` string.

**Timestamps of Significant Changes:**

*   **22/11/2025, 17:38:55**: The `makeAPICall` function's error handling for 401 status codes initially returned `{ ...error, error: true }` after performing token removal and navigation.
*   **22/11/2025, 17:39:07**: A change was introduced to the `makeAPICall` function's 401 error handling. The return statement was modified from `{ ...error, error: true }` to `{ error: true, message: error?.response?.data?.message || error.message }`, aiming to provide a more specific error message from the API response.
*   **22/11/2025, 17:39:40**: The change made at 17:39:07 was reverted. The 401 error handling in `makeAPICall` was restored to its original state, returning `{ ...error, error: true }`.

**Patterns or Recurring Elements:**

*   **Centralized API Communication:** The `makeAPICall` function acts as a single point of entry for all API interactions, ensuring consistent headers, error handling, and loading state management across the application.
*   **User and Merchant Context:** Both `makeAPICall` and `logUserEvent` frequently access `dashboardStore.getState().userData.user_details` and `dashboardStore.getState().userData.merchant_details` to retrieve user and merchant-specific data, indicating a strong reliance on a global state management system.
*   **Environment-Specific Configuration:** The use of `process.env.REACT_APP_BASE_URL` and conditional security headers based on `process.env.NODE_ENV !== 'development'` highlights the application's adaptability to different deployment environments.
*   **Session and Cookie Management:** The functions utilize `localStorage`, `sessionStorage`, and custom cookie utilities (`getCookie`, `setCookie`) for managing user tokens, merchant IDs, redirection paths, and session IDs.
*   **Rapid Iteration and Reversion:** The sequence of changes to the 401 error handling in `makeAPICall` (changed and then immediately reverted within a minute) suggests a quick experimentation or a rollback of a recently introduced code change.
*   **Detailed Event Logging:** The `logUserEvent` function demonstrates a comprehensive approach to collecting user behavior and device information, crucial for analytics and debugging.

## 11:34:47
The changes primarily involve UI components, form handling, and configuration management within a React application, likely a "Gokwik Dashboard" related to e-commerce checkout processes. There are also updates to environment configurations and a core utility file.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`**
    *   **Timestamp:** 16/11/2025, 13:10:34
    *   **Summary:** This file defines the `BrandPage` component for customizing UI elements like the brand logo and primary color in a checkout dashboard. It uses React hooks (`useEffect`, `useState`, `useMemo`) and Gokwik UI Kit components (Button, Upload, Form, Card, ColorPicker, Alert). Key functionalities include fetching and uploading merchant logos (with validation for file type and size), handling logo image paths for AWS S3, and integrating a color picker for theme customization. The `onFinish` function saves configuration changes, including logo data and CSS rules (specifically `primaryColor`). Breadcrumbs are updated, and UI visibility is managed based on form changes.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
    *   **Timestamps:** 17/11/2025, 16:22:51 and 21/11/2025, 11:48:56
    *   **Summary:** This `ProductSearch` component is used for searching and selecting products or collections, likely for discount or free gift configurations. It manages search state, pagination (with infinite scroll using `useIntersectionObserver`), and a modal for selection. It handles adding and removing items, quantity changes, and specific logic for "top-up gifts" or "agent-led" scenarios.
    *   **Key changes between timestamps:** The later version (21/11/2025) introduces a new prop `btnSearch` to control the display of a "Select \[products/collections]" button explicitly, and adds `DeleteOutlined` to the imports, though not visibly used in the provided snippet. The display logic for `product.variants?.length` in the UI rendering section was also refined.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`**
    *   **Timestamp:** 17/11/2025, 16:23:04
    *   **Summary:** This component displays detailed information for a specific order. It fetches order data, including price breakups, transactions, and refunds. It dynamically calculates refundable amounts and manages the state of a refund button. The component also handles displaying customer contact information (masked initially) and logic for RTO (Return To Origin) actions. Currency formatting is centralized using `setCurrencySymbol` and `formatAmountWithCurrency`. Order editability is determined by applied rewards or loyalty points.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`**
    *   **Timestamps:** 18/11/2025, 00:49:40, 18/11/2025, 00:50:14, and 18/11/2025, 00:58:39
    *   **Summary:** This component allows merchants to configure free gift rules. It uses a form to define rules based on purchase type (cart value, quantity), applicability (all products, specific products/collections), and gift addition method (auto or selection). It integrates `ProductSearch` for selecting free products and collections. The component displays configured rules in a table with options to enable/disable, edit, or delete them. Breadcrumbs are updated on mount.
    *   **Note:** The code content for these three timestamps is identical, suggesting either no functional changes or minor, non-code-altering edits (e.g., whitespace, comments, or timestamp-only updates).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`**
    *   **Timestamp:** 18/11/2025, 23:42:52
    *   **Summary:** This component provides a collapsible interface for customizing various sections of the order confirmation page. It includes fields for brand logo, dynamic banners, trust banners, order details (status, EDD, confirmation message, colors), customer information (delivery/billing address, contact), and support/communication details. Each section has a toggle switch to enable/disable it, and many include color picker options for styling. The component also supports draggable reordering of these customization sections.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx`**
    *   **Timestamps:** 19/11/2025, 21:10:01, 19/11/2025, 21:11:54, 19/11/2025, 21:12:22, and 19/11/2025, 21:12:29
    *   **Summary:** This is the main page for configuring the custom order confirmation page. It features a two-column layout: one for form-based settings (`MainSection`) and another for a live preview (`OrderConfirmationPreview`). It includes a switch to enable/disable the custom page and an info alert. The `handleFormSubmit` function validates and logs form data.
    *   **Key changes between timestamps:** The `flex` property of the left column (`Col`) for form settings was adjusted between `1 1 200px` and `1 1 300px`, indicating minor layout adjustments for responsiveness or display preference. The preview column (`Col`) `flex` property also shifted from `0 1 500px` to `0 1 300px` and back to `0 1 500px`. The code content otherwise remains identical for these multiple timestamps.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`**
    *   **Timestamps:** 20/11/2025, 18:44:34, 20/11/2025, 18:44:55, 20/11/2025, 18:49:44, and 20/11/2025, 18:49:50
    *   **Summary:** This component `processProductBasedShippingData` handles the creation and management of product-based shipping rules. It allows mapping rules to existing shipping IDs, defining calculation methods (override or add onto base shipping), and configuring price multipliers and weight-based combinations. It uses `ProductSearch` to add specific products or collections to the rules. A table displays the selected items, and a `DeleteFilled` button allows removal.
    *   **Key changes between timestamps:** The 20/11/2025, 18:49:44 update (and subsequently 18:49:50) changed the `type` for the "Rule price" field from `inputNumber` to `input` and added an `onKeyPress` validator to only allow numeric input (`/[0-9.]$/`). This suggests a refinement in how price inputs are handled to ensure valid number formats. The rest of the content is identical.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`**
    *   **Timestamps:** 21/11/2025, 11:50:18 and 21/11/2025, 11:51:40
    *   **Summary:** This utility file contains a collection of helper functions. Key functions include `getDynamicSearchFilters` for generating dynamic filter options, `formatDateString`, `setCurrencySymbol` and `formatAmount` for currency handling, `shopifyAppCheckoutEnabledStatus` for checking login dates, `deepCompare` for object comparison, `debounce`, `disabledBeforeDate`/`disabledBeforeTime` for date/time pickers, `capitalizeFirstLetter`, `formatNumber`, `extractTitlesAndDataIndexes` for table columns, `sortDataByKey`, `uploadCohortCsv` for CSV processing (validating phone/email format), `getFutureDateString`, `compareAndCaptureArrayFields` for array differences, `areBothRangesMoreThanOneDay`, and `extractUniqueCKeysForAntColumn`.
    *   **Note:** The code content for these two timestamps is identical, suggesting no functional changes.

### Patterns and Recurring Elements:

1.  **Gokwik UI Kit Usage:** All UI-related files (`brandPage.tsx`, `productSearch.tsx`, `orderDetails/index.tsx`, `freeGift.tsx`, `collapseFields.tsx`, `orderConfirmation/index.tsx`, `shippingBasedData.tsx`) heavily rely on components from `@gokwik-ui-kit` (Button, Form, Card, Input, Table, Switch, Dropdown, message, etc.), indicating a consistent design system.
2.  **Form Management with Ant Design (Form.useForm, Form.useWatch, Form.setFieldValue):** The application extensively uses Ant Design's form capabilities for state management, field validation, and data binding. `Form.useWatch` is frequently employed to react to changes in form values.
3.  **API Calls and Data Fetching:** `makeAPICall` and `useMerchantConfigApi` (a custom hook) are common for interacting with backend services and managing merchant-specific configurations. There's also interaction with AWS S3 for image uploads.
4.  **Redux Integration:** `useAppDispatch` and `useSelector` indicate the use of Redux for global state management, particularly for user details (`@store/user`) and UI customization (`@store/customize-ui`).
5.  **Timestamp Frequency:** Several files, especially `freeGift.tsx`, `orderConfirmation/index.tsx`, `shippingBasedData.tsx`, and `helper.ts`, show multiple identical or near-identical commits within a very short timeframe (minutes or seconds). This could suggest rapid saves during development, automated formatting/linting, or minor non-functional changes not reflected in the provided code snippets (like comment updates, whitespace changes, or re-running tests).
6.  **Environment Configuration (`.env`):** The `.env` file updates consistently involve commenting/uncommenting `REACT_APP_BASE_URL` and `REACT_APP_BULK_DISCOUNT_URL` for different environments (dev, qa, sandbox, prod). This is a standard practice for managing environment-specific API endpoints. The changes show a shift from `sandbox` to `qa` (20/11) and then back to `sandbox` (21/11).
7.  **Microfrontend Architecture (`index.ejs`):** The `index.ejs` file demonstrates a single-spa microfrontend setup, where different parts of the dashboard (e.g., `@gokwik/configuration`, `@gokwik/utilities`, `@gokwik/checkout`) are loaded as separate JavaScript bundles based on the `deployedEnv` (local, dev, qa, sandbox, production). The external URLs for these microfrontends are updated, often aligning with the `.env` changes (e.g., switching between `sandbox-dashboard.dev.gokwik.in` and `qa-dashboard.dev.gokwik.in` for the various microservices).
8.  **UI Customization and Configuration:** A significant portion of the changes revolves around allowing merchants to customize various aspects of the checkout UI and order confirmation pages, including logos, colors, banners, and the display of order/customer details.
9.  **Product/Collection Selection Logic:** Components like `ProductSearch` and `shippingBasedData.tsx` include complex logic for selecting products/collections, handling variants, quantities, and preventing duplicate selections, indicating a focus on granular control for merchants.
10. **Error Handling and Validation:** Forms include rules for required fields and custom validators (e.g., maximum value less than minimum value, validating CSV content). `message.error` is used for user feedback on validation failures or API errors.

## 12:34:18
The provided log details changes exclusively within the file `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

**File-Specific Updates in `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`:**

The core updates revolve around the `makeAPICall` asynchronous function, specifically how it handles `401 Unauthorized` errors within its `catch` block.

*   **Initial State (Timestamp: 22/11/2025, 17:38:55):**
    When an API call results in a `401` status code, the function catches the error and returns an object `{ ...error, error: true }`. This structure includes the full error object along with a boolean `error` flag.

*   **First Modification (Timestamp: 22/11/2025, 17:39:07):**
    This update changed the error handling for `401` status codes. Instead of returning the entire error object, it was modified to return `{ error: true, message: error?.response?.data?.message || error.message }`. This aimed to provide a more specific and extracted error message to the caller, prioritizing `error?.response?.data?.message` if available, otherwise falling back to `error.message`.

*   **Subsequent Revert (Timestamp: 22/11/2025, 17:39:40):**
    Shortly after the modification, the change introduced at 17:39:07 was reverted. The error handling for `401` status codes was restored to its original implementation, returning `{ ...error, error: true }`, which means the full error object is passed back along with the `error: true` flag.

**Patterns and Recurring Elements:**

*   **Focus on API Error Handling:** All recorded changes are concentrated on refining, and subsequently reverting, the error handling mechanism for `401 Unauthorized` responses within the `makeAPICall` function.
*   **Rapid Iteration and Revert:** The changes occurred in quick succession (within a minute for the modification and subsequent revert), indicating immediate adjustments or testing related to the error response structure.
*   **Consistent File Content (Outside of Error Handling):** The rest of the `makeAPICall` function, including its initial internal user check, Axios instance creation, loader events, file upload logic, and general API request configuration, remained unchanged across all entries. Similarly, the `logUserEvent` function and its helper functions (`getFixedParams`, `parseUserAgent`) also remained consistent, though the `parseUserAgent` function appears truncated in all provided logs.

## 12:35:08
The code changes primarily focus on the Gokwik dashboard UI, affecting checkout customization, discount management, order details, and shipping settings. A recurring pattern involves using `gokwik-ui-kit` components for UI, `Form.useForm()` for state management, and `useMerchantConfigApi` for configuration persistence across different settings pages. API calls via `makeAPICall` and `makeAWSPutCall` are common for data interaction.

Here's a breakdown of key updates:

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (Timestamp: 16/11/2025, 13:10:34)**
    *   This component manages brand customization for the checkout UI, allowing merchants to upload a logo and define a primary theme color.
    *   Key functionalities include fetching merchant details, validating logo uploads (file type and size), cleaning images with `cleanImageWithCanvas`, retrieving presigned URLs from the backend, uploading images to AWS S3, and updating brand data in Redux and the merchant configuration.
    *   The UI provides a logo upload area with a preview and a color picker component, along with a "Save Changes" button.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
    *   **First change (Timestamp: 17/11/2025, 16:22:51):** This component enables searching and selecting Shopify products or collections, used in various discount or free gift configurations. It includes functionality for fetching data with pagination, debounced search, parsing responses to handle variants and collections, and managing selected items. It supports displaying quantities and collating product variants.
    *   **Second change (Timestamp: 21/11/2025, 11:48:56):**
        *   Introduced new props `btnSearch` and `topUpGift`.
        *   The `handleQuantityChange` logic was refined to conditionally update quantity based on `collectionSpecificData.collectionMinimumPurchangeQuantity`.
        *   A new UI element was added to render a "Select Products/Collections" button when `btnSearch` is true.
        *   Adjusted how variant counts are displayed, showing `"${product?.variants?.length} variants selected"` only if `product.variants` exist.
        *   Added a "Freebie Price" input for `topUpGift` functionality.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (Timestamp: 17/11/2025, 16:23:04)**
    *   This page displays detailed order information, including transactions, refunds, and price breakdowns.
    *   It fetches order data, merges repeated refunds for a cleaner view, calculates total refundable amounts, and dynamically sets the currency symbol.
    *   The component also determines if an order can be edited based on applied rewards or loyalty points.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
    *   **First change (Timestamp: 18/11/2025, 00:45:31):** This is the main HTML template, configuring a Single-SPA microfrontend architecture. It defines shared dependencies (React, React-DOM, single-spa) and environment-specific import maps for various `@gokwik` applications (e.g., configuration, utilities, checkout, payment). It also includes analytics scripts for `Clarity` and `New Relic` for production environments.
    *   **Second change (Timestamp: 20/11/2025, 18:37:48):** The `isLocal` environment's import map was updated. Several `@gokwik` microfrontends (utilities, dashboard, payment, kwikpass, rto, kwikship, ellora, checkout-platform, shopify-app) are now configured to load from `https://qa-dashboard.dev.gokwik.in/` instead of `https://sandbox-dashboard.dev.gokwik.in/` or local URLs.
    *   **Third change (Timestamp: 21/11/2025, 12:27:47):** Further adjustments to the `isLocal` environment's import map. `@gokwik/utilities` and `@gokwik/dashboard` were changed back to `https://sandbox-dashboard.dev.gokwik.in/`, while other `@gokwik` microfrontends remained pointing to `https://qa-dashboard.dev.gokwik.in/`. This indicates a mixed-environment setup for local development.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (Timestamps: 18/11/2025, 00:49:40; 18/11/2025, 00:50:14; 18/11/2025, 00:58:39)**
    *   These three entries show minor or no functional changes, likely representing saves or reformatting.
    *   The component manages the creation and editing of free gift rules for merchants. It includes a form to define rule name, sales channels, purchase requirements (cart value or quantity), applicable products/collections, free gift quantity and price, and the method of gift addition (auto or selection).
    *   The `ProductSearch` component is integrated for selecting free gift products or specific collections/products for rule applicability.
    *   A table displays existing rules with options to edit, delete, and toggle their enabled status.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (Timestamp: 18/11/2025, 23:42:52)**
    *   This component provides collapsible sections for customizing different parts of the order confirmation page, such as Brand Logo, Dynamic Banners, Trust Banner, Order Details, Customer Information, and Support & Communication.
    *   Each section includes form fields (switches, inputs, custom renderers for color pickers and rich text editors) to control visibility and content.
    *   It also features drag-and-drop functionality for reordering the collapsible items on the page.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx` (Timestamps: 19/11/2025, 21:10:01; 19/11/2025, 21:11:54; 19/11/2025, 21:12:22; 19/11/2025, 21:12:29)**
    *   These four entries for the order confirmation page show repeated minor adjustments to the `flex` property of the `Col` components, affecting the layout split between the form and the preview section. No significant functional changes were introduced in these specific revisions.
    *   The component allows enabling a custom order confirmation page, with fields for activation and an alert for Shopify customization redirection. It integrates `MainSection` (likely containing `collapseFields`) for detailed customization and displays a live `OrderConfirmationPreview`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`**
    *   **First two changes (Timestamps: 20/11/2025, 18:44:34; 20/11/2025, 18:44:55):** Component for defining product-based shipping rules. It uses `ProductSearch` to add products/collections to rules and displays them in a table. Form fields allow configuring rule name, price, shipping ID mapping, calculation method, price multiplier, and weight-based combination.
    *   **Last two changes (Timestamps: 20/11/2025, 18:49:44; 20/11/2025, 18:49:50):** A minor, identical update was introduced: the `onKeyPress` handler for the 'Rule price' input field was added to restrict input to only numeric digits and periods.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (Timestamps: 21/11/2025, 11:50:18; 21/11/2025, 11:51:40)**
    *   These two entries are identical, showing no discernible changes.
    *   This file contains a collection of utility functions, including:
        *   `getDynamicSearchFilters` for dynamic filter options.
        *   `formatDateString` and `formatAmount` (with custom currency symbol and `T` to `K` notation replacement).
        *   `shopifyAppCheckoutEnabledStatus` for checking recent login.
        *   `deepCompare` for object comparison.
        *   `debounce` utility for function calls.
        *   Date/time helpers (`disabledBeforeDate`, `disabledBeforeTime`, `getFutureDateString`).
        *   String formatting (`capitalizeFirstLetter`, `formatNumber`).
        *   Table data helpers (`extractTitlesAndDataIndexes`, `sortDataByKey`, `extractUniqueCKeysForAntColumn`).
        *   `uploadCohortCsv` for CSV file validation (phone numbers or emails) and processing.
        *   `compareAndCaptureArrayFields` for identifying added/removed items in arrays.
        *   `areBothRangesMoreThanOneDay` for date range validation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shipping-component/shippingBasedMethods.tsx` (Timestamp: 24/11/2025, 12:31:55)**
    *   This component manages advanced shipping method configurations.
    *   It includes state for various UI elements like switches (for COD fee, shipping tags, EDD tags), modals, and selections for customer segments.
    *   Functionality includes fetching customer segments, handling cohort CSV uploads (with validation for phone numbers or emails) and downloads, and fetching pincode lists.
    *   Form fields allow setting shipping name (with validation for length and uniqueness), price, minimum and maximum order values, each with numeric input restrictions.
    *   An `Upload` component is used for pincode CSVs, with custom `itemRender` for display and removal.

**Patterns and Recurring Elements:**

*   **Consistent UI Framework:** Extensive use of `gokwik-ui-kit` components across all `.tsx` files, indicating a unified design system.
*   **Form-centric Interactions:** `Form.useForm()` and `Form.useWatch()` are frequently employed for managing complex form states and real-time validation in settings pages.
*   **Configuration Management:** The `useMerchantConfigApi` hook is a recurring pattern for loading, saving, and managing merchant-specific configurations, centralizing configuration logic.
*   **Microfrontend Architecture:** The `index.ejs` changes highlight an active microfrontend development environment, with frequent updates to local import maps to integrate different `@gokwik` services (e.g., `checkout`, `payment`, `dashboard`) from various staging environments (sandbox, QA).
*   **Data Handling and Validation:** Many components include client-side validation for form inputs (e.g., required fields, numeric formats, value ranges, unique names) and specific data handling for uploads (e.g., CSV content validation for phone/email).
*   **Reusable Components:** `ProductSearch` is a key reusable component for selecting products/collections in different contexts (discounts, free gifts, shipping rules). `RenderField` is used to dynamically render form fields.
*   **Timestamps:** There are several instances of multiple, closely spaced timestamps for the same file, often indicating minor changes, formatting adjustments, or frequent saves during active development rather than distinct feature implementations. This is particularly noticeable in `freeGift.tsx`, `orderConfirmation/index.tsx`, `shippingBasedData.tsx`, and `helper.ts`.

## 13:34:15
The provided log details changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

All changes occurred on 22/11/2025, within a minute, specifically to the `makeAPICall` function's error handling for HTTP 401 (unauthorized) status codes:

*   **17:38:55:** The `makeAPICall` function's `catch` block for a 401 error returned `{ ...error, error: true }`.
*   **17:39:07:** This return statement was modified to provide a more specific error message: `{ error: true, message: error?.response?.data?.message || error.message }`. This change aimed to extract and return a user-friendly message from the API response or the generic error.
*   **17:39:40:** The change made at 17:39:07 was reverted. The return statement for 401 errors was changed back to its original form: `{ ...error, error: true }`.

The key pattern observed is a brief attempt to refine the error message returned for unauthorized API calls, followed by an immediate reversion to the previous error handling mechanism.

## 13:34:58
The following is a summary of the code changes:

**File-specific updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`** (Timestamp: 16/11/2025, 13:10:34):
    *   **Functionality:** This file handles brand customization for the checkout UI, specifically logo uploads and primary color selection.
    *   **Key changes:**
        *   Introduces `makeAWSPutCall` for uploading images to AWS.
        *   Adds `cleanImageWithCanvas` for image processing before upload.
        *   Includes a `validateUpload` function to enforce file type (`.jpg,.jpeg,.png,.svg`) and size (under 2MB) restrictions for logos.
        *   Updated the `onFinish` handler to dispatch `updatedLogoData` and handle saving custom configurations, including CSS rules for `primaryColor` and setting `offers_fixed_positions` to `false`.
        *   UI updates: Enhanced the logo upload section with a clearer description and added a `ColorPicketComponent` for theme color selection.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`** (Timestamp: 17/11/2025, 16:22:51 and 21/11/2025, 11:48:56):
    *   **Functionality:** A reusable component for searching and selecting products or collections, likely for discount or gift configurations.
    *   **Key changes:**
        *   **17/11/2025:** Added `topUpGift` prop and `handleGiftPrice` function to manage offered prices for gift items. Minor styling adjustments to product display (`div` class changes).
        *   **21/11/2025:** Added a `btnSearch` prop to allow a dedicated "Select [products/collections]" button, improving UX. Also introduced `DeleteOutlined` import. Logic for displaying variants in the UI was refined to handle cases where there are no selected variants more gracefully (`product?.variants?.length && ...`). The `handleQuantityChange` function was updated to support `collectionMinimumPurchangeQuantity`.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx`** (Timestamp: 17/11/2025, 16:23:04):
    *   **Functionality:** Displays detailed information for an order.
    *   **Key changes:**
        *   **Currency Formatting:** Implemented a `formatAmountWithCurrency` helper to ensure amounts are displayed with the correct currency symbol based on `orderData` or `merchantDetails`.
        *   **Refunds Logic:** Enhanced `mergeRepeatedRefunds` to consolidate multiple refund attempts for a single `gokwik_rid` and correctly determine the final status ('Completed', 'Failed', 'Initiated').
        *   **Dynamic Refund Button State:** Logic was added to calculate `refundableAmount` and `refundBtnState` (disabled status, refund status) based on transaction and merged refund data, especially considering `timeout` transactions from 'ybl' and `is_auto_refund`.
        *   **Price Breakup Calculation:** The `total_discount` calculation was significantly expanded to include a wider range of discount types (ABCDiscount, C2PDiscount, paymentOffer, loyaltyPoints, prepaidDiscount, postEditOrderDiscount, agentDiscount, shopifyDiscounts, automaticDiscounts, customDiscount). Similar expansions for `tax`, `shipping_and_cod_charges`, and `gift_card_and_rewards`.
        *   **Order Edit Title Logic:** The `setEditTitle` function now dynamically sets the `title` and `disableEdit` state based on whether Twid rewards, GWP discounts, or loyalty points are applied to the order.

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`** (Multiple timestamps: 18/11/2025, 00:45:31; 20/11/2025, 18:37:48; 21/11/2025, 12:27:47; 24/11/2025, 12:17:06; 24/11/2025, 12:17:41):
    *   **Functionality:** This is the main HTML template for the dashboard UI, configuring single-spa imports and New Relic monitoring.
    *   **Key changes (consistent across all timestamps):**
        *   The New Relic loader script (`nr-loader-spa-1.256.0.min.js`) is present across all logged changes for this file, indicating continuous monitoring.
        *   `systemjs-importmap` configurations are used to dynamically load `@gokwik` modules based on the `deployedEnv` (isLocal, dev, qa, sandbox, production).
        *   Specific URLs for `@gokwik/utilities`, `@gokwik/dashboard`, `@gokwik/checkout`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, `@gokwik/shopify-app` are updated based on the environment.
        *   The `dev` and `qa` environments gained an import for `@gokwik/kwikcomm` in the 18/11/2025 and 20/11/2025 updates, which was not present in the earlier sandbox configuration.
        *   The `isLocal` environment's `@gokwik/utilities` and `@gokwik/dashboard` imports changed from `//localhost:9000` to `https://sandbox-dashboard.dev.gokwik.in` in the 21/11/2025 and 24/11/2025 updates.
        *   The `isLocal` environment also saw its `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, and `@gokwik/shopify-app` imports shift from `https://dev-dashboard.dev.gokwik.in` or `https://qa-dashboard.dev.gokwik.in` to `https://qa-dashboard.dev.gokwik.in` or `https://sandbox-dashboard.dev.gokwik.in` over the various timestamps.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx`** (Multiple timestamps: 18/11/2025, 00:49:40; 18/11/2025, 00:50:14; 18/11/2025, 00:58:39):
    *   **Functionality:** Manages the configuration of automatic free gift rules for merchants.
    *   **Key changes (consistent across all timestamps):**
        *   No functional code changes are observed across these three consecutive timestamps. The code content is identical, suggesting that these might be mere saves without functional alterations or very minor non-functional changes (e.g., whitespace) not captured in this log format.
        *   The component allows defining free gift rules based on various conditions (cart value, quantity, applicable products/collections).
        *   Features include rule naming, sales channel applicability (app, web, agent-led), purchase type, min/max values, free gift product selection, quantity, price, and application method (auto/selection).
        *   Includes a table to display existing rules with status toggle and edit/delete actions.
        *   Handles adding and removing products/collections for "specific products" or "specific collections" rules.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx`** (Timestamp: 18/11/2025, 23:42:52):
    *   **Functionality:** Renders collapsible sections for customizing various elements of the order confirmation page.
    *   **Key changes:**
        *   Introduced new collapsible sections for "Order Details," "Customer Information," and "Support & Communication."
        *   Each new section includes various configurable fields, such as enable/disable switches, input fields for text (e.g., confirmation message, heading, description, button text, button link), and `ColorPickerHelper` components for background and text colors.
        *   Implemented drag-and-drop functionality for reordering these collapsible items, persisting the order to the form's `customize` field.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx`** (Multiple timestamps: 19/11/2025, 21:10:01; 19/11/2025, 21:11:54; 19/11/2025, 21:12:22; 19/11/2025, 21:12:29):
    *   **Functionality:** The main page for configuring the custom order confirmation page, including a preview.
    *   **Key changes:**
        *   **19/11/2025, 21:10:01:** Initial commit of this component. Sets up the basic layout with a left panel for form fields and a right panel for the preview. Includes a switch to enable/disable the custom confirmation page and an `Alert` for important information.
        *   **19/11/2025, 21:11:54:** Modified the `flex` property of the left `Col` from `1 1 200px` to `1 1 300px` and the right `Col` from `0 1 500px` to `0 1 300px`, adjusting the width distribution between the settings form and the preview panel.
        *   **19/11/2025, 21:12:22:** Reverted the `flex` property of the left `Col` back to `1 1 200px` and the right `Col` back to `0 1 500px`.
        *   **19/11/2025, 21:12:29:** Reverted the `flex` property of the left `Col` back to `1 1 300px` and the right `Col` to `0 1 500px`. This suggests some experimentation with the layout of the settings and preview panels.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx`** (Multiple timestamps: 20/11/2025, 18:44:34; 20/11/2025, 18:44:55; 20/11/2025, 18:49:44; 20/11/2025, 18:49:50):
    *   **Functionality:** Manages product-based shipping rules within the checkout dashboard.
    *   **Key changes:**
        *   **20/11/2025, 18:44:55:** The `price` field type was changed from `inputNumber` to `input` in the `fields` array for `product_based_rules`, `price`.
        *   **20/11/2025, 18:49:44:** Added an `onKeyPress` event handler to the `price` input field to only allow numeric input (`/[0-9.]$/.test(event.key)`). This was also applied to `min` and `max` order value input fields.
        *   **20/11/2025, 18:49:50:** No functional code changes are observed. The content is identical to the previous timestamp, likely a non-functional save.
        *   The component processes product-based shipping rules, displays them in a table, and allows adding/removing products/collections to these rules. It also includes configuration for shipping calculation methods, price multipliers, and combining with weight-based shipping.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts`** (Multiple timestamps: 21/11/2025, 11:50:18; 21/11/2025, 11:51:40):
    *   **Functionality:** A collection of utility helper functions for various dashboard operations.
    *   **Key changes (consistent across both timestamps):**
        *   No functional code changes are observed across these two consecutive timestamps. The code content is identical, suggesting that these might be mere saves without functional alterations or very minor non-functional changes (e.g., whitespace) not captured in this log format.
        *   Includes functions for dynamic search filters, date formatting, currency formatting (`formatAmount`, `setCurrencySymbol`), Shopify app checkout status, deep object comparison, debouncing, date/time disabling, string capitalization, number formatting, extracting table column titles, sorting data, uploading cohort CSV files with validation (phone numbers/emails), getting future dates, comparing array fields, and checking date ranges.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shipping-component/shippingBasedMethods.tsx`** (Multiple timestamps: 24/11/2025, 12:31:55; 24/11/2025, 12:36:01):
    *   **Functionality:** Configures various shipping methods and rules within the settings, including advanced conditions and CSV uploads for pincodes/cohorts.
    *   **Key changes (consistent across both timestamps):**
        *   No functional code changes are observed across these two consecutive timestamps. The code content is identical, suggesting that these might be mere saves without functional alterations or very minor non-functional changes (e.g., whitespace) not captured in this log format.
        *   Manages shipping methods with fields for name, price, min/max order value, and advanced conditions.
        *   Includes functionality to fetch customer segments.
        *   Provides CSV upload for pincodes with validation (6-digit numbers, single/horizontal/vertical formats).
        *   Allows downloading cohort CSV files.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/validations.ts`** (Multiple timestamps: 24/11/2025, 12:45:40; 24/11/2025, 12:47:57; 24/11/2025, 12:48:27; 24/11/2025, 12:48:53; 24/11/2025, 12:50:15):
    *   **Functionality:** Contains validation functions for various discount types and shipping rules.
    *   **Key changes (consistent across all timestamps):**
        *   No functional code changes are observed across these five consecutive timestamps. The code content is identical, suggesting that these might be mere saves without functional alterations or very minor non-functional changes (e.g., whitespace) not captured in this log format.
        *   Includes validation for:
            *   `validateTieredDiscount`: Checks for unique codes, valid limits, overlaps, and freebie product consistency.
            *   `validateDynamicDiscount`: Validates code, type, value, percentage limits, item volume, and order value range overlaps.
            *   `validateBuyXatYDiscount`: Ensures unique codes, match types, product quantity, and capped values.
            *   `validateDiscountCapping`: Checks match type, code/regex presence, and capping limit.
            *   `validateGWP`: Validates eligibility rule match type and discount code.

**Timestamps of significant changes:**

*   **16/11/2025, 13:10:34:** Major update to `brandPage.tsx` focusing on logo upload and color customization, including AWS integration and image processing.
*   **17/11/2025, 16:22:51:** Introduction of `topUpGift` and related logic in `productSearch.tsx`.
*   **17/11/2025, 16:23:04:** Significant enhancements to `order-details/index.tsx` for currency formatting, refund processing, price breakup calculations, and dynamic order edit functionality.
*   **18/11/2025, 23:42:52:** New UI customization sections and drag-and-drop feature introduced in `collapseFields.tsx`.
*   **19/11/2025, 21:10:01 - 21:12:29:** Multiple small UI layout adjustments in `orderConfirmation/index.tsx`, indicating active development and fine-tuning of the page structure.
*   **20/11/2025, 18:44:55:** Change of `price` field type from `inputNumber` to `input` in `shippingBasedData.tsx`.
*   **20/11/2025, 18:49:44:** Input validation added to `price`, `min`, and `max` fields in `shippingBasedData.tsx` to enforce numeric-only input.
*   **21/11/2025, 11:48:56:** Addition of `btnSearch` and refinement of variant display logic in `productSearch.tsx`.

**Patterns or recurring elements:**

*   **Gokwik UI Kit:** Consistently uses `gokwik-ui-kit` components (Button, Col, Row, Form, Card, Input, Table, Switch, Dropdown, Tooltip, message, Alert, etc.) across the `checkout-dashboard-ui` project, indicating a standardized UI library.
*   **State Management:** Frequent use of React `useState`, `useEffect`, and `useMemo` hooks for local component state, side effects, and memoization. Redux `useAppDispatch` and `useSelector` are common for global state (e.g., `merchant_details`, `user_details`).
*   **API Calls:** `makeAPICall` from `@gokwik/utilities` is a standard pattern for interacting with backend services, often using `process.env.REACT_APP_BASE_URL + APIEndPoints`. `makeAWSPutCall` is used for direct AWS S3 uploads.
*   **Form Management:** Ant Design's `Form` component with `Form.useForm()` and `Form.useWatch()` is extensively used for form handling, validation, and reactive updates.
*   **Custom Form Fields:** The `RenderField` component and `type: 'custom'` are used to encapsulate complex or reusable form input logic (e.g., `ColorPickerHelper`, `ProductSearch`, `PincodeRenderer`).
*   **Breadcrumbs:** `updateBreadcrumbs` from `@gokwik/utilities` is used to manage navigation paths within the application.
*   **Constants:** References to `@library/utilities/constants/constants` are frequent for placeholder images (`ShopifyProductPlaceholderImage`), API endpoints, and various configuration values.
*   **Helper Functions:** `@library/utilities/helpers/helper.ts` and `@library/utilities/helpers/validations.ts` are central, providing reusable logic for data manipulation, formatting, and complex validation rules (e.g., `deepCompare`, `formatAmount`, `rangesOverlap`).
*   **File Naming and Structure:** A consistent pattern of `[feature]Page.tsx` for main pages and `[feature]Component.tsx` for reusable components. `utilities/helpers` for shared logic.
*   **Environment Configuration:** The `index.ejs` file demonstrates a pattern of dynamically loading `@gokwik` modules and setting API base URLs based on the `deployedEnv` (local, dev, qa, sandbox, production).
*   **Repetitive Saves/No-Change Commits:** Several files show consecutive timestamps with identical code content, which could indicate frequent, minor saves, or automated reformatting without functional changes being logged. This is particularly noticeable in `freeGift.tsx`, `orderConfirmation/index.tsx`, `shippingBasedData.tsx`, `helper.ts`, and `validations.ts`.

## 14:34:23
The provided log details changes to a single file, `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`, across three timestamps on 22/11/2025. This file serves as a central utility for making API calls and logging user events within a dashboard application.

**File-Specific Updates for `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`:**

*   **Core Functionality (present across all entries):**
    *   **`makeAPICall` function:** This asynchronous function is designed for handling various API requests (GET, POST, PUT, PATCH, DELETE) using Axios. It incorporates a comprehensive `APIRequestConfig` interface for flexible configuration, including payload, parameters, headers, response type, loader control, and cookie handling.
        *   It includes robust security headers like `X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, and `Content-Security-Policy`. For production environments, `Strict-Transport-Security` is also added.
        *   Internal user access control is implemented, preventing non-GET operations on a predefined list of sensitive internal URLs.
        *   File uploads are explicitly handled for both single and multiple files, supporting custom field names.
        *   Error handling specifically addresses 401 (unauthorized) responses, leading to the removal of the local storage token and redirection to the `/login` page, while whitelisting certain authentication-related paths from redirection.
        *   Loading states are managed via `loaderEvent` calls, incrementing before a call and decrementing after.
    *   **`logUserEvent` function:** This function is responsible for logging user interactions and events.
        *   It defines an `EventsInterface` for structured event data.
        *   A `getFixedParams` helper function gathers common parameters such as `tracking_id`, user email, a generated `session_id` (persisted via cookies), merchant ID and name, username, role, and the current `landing_page` derived from `window.location.pathname`.
        *   A `parseUserAgent` function is partially defined, aiming to extract details like operating system, device, browser, and their versions from the `navigator.userAgent` string.

*   **Timestamp-Specific Changes:**
    *   **22/11/2025, 17:38:55:** This entry represents the initial or a baseline version of the file, containing the full implementations of `makeAPICall` and `logUserEvent`, with the `makeAPICall`'s 401 error block returning `{ ...error, error: true }`.
    *   **22/11/2025, 17:39:07:** A minor but significant change was introduced within the `makeAPICall`'s 401 error handling. The return statement was updated from `{ ...error, error: true }` to `{ error: true, message: error?.response?.data?.message || error.message }`. This modification explicitly extracts and returns a more specific error message from the API response (`error?.response?.data?.message`) if available, falling back to the generic `error.message`.
    *   **22/11/2025, 17:39:40:** This entry shows a revert of the change made at 17:39:07. The `makeAPICall`'s 401 error handling was changed back to its original state, returning `{ ...error, error: true }`, effectively undoing the previous update.

**Patterns and Recurring Elements:**

*   **Centralized Utilities:** The file `common.ts` clearly serves as a repository for shared utility functions related to network communication and analytics, emphasizing a modular approach to common tasks.
*   **Dashboard State Integration:** Both `makeAPICall` and `logUserEvent` extensively interact with `dashboardStore.getState().userData` to retrieve user and merchant-specific information, indicating a centralized state management system.
*   **Security and Authorization:** There's a strong emphasis on security, from robust HTTP headers in API requests to specific authorization checks for internal users and detailed handling of 401 unauthorized errors, including token invalidation and redirection.
*   **Cookie and Session Management:** The application uses `localStorage`, `sessionStorage`, and browser cookies (`getCookie`, `setCookie`) for persistent data storage, such as user tokens, merchant IDs, tracking IDs, and session IDs.
*   **Loader Management:** The `loaderEvent` utility is consistently used around `makeAPICall` to provide visual feedback during network operations.
*   **Iterative Small Changes:** The timestamps show very quick, subsequent modifications (within seconds to a minute) to the same file, suggesting rapid iterations or minor adjustments, followed by a potential quick revert.

## 14:35:25
The provided logs detail several significant updates across different functional areas of the checkout dashboard UI, primarily focusing on customization, order management, and various configuration settings.

### File-Specific Updates:

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` (16/11/2025, 13:10:34)**: This file received a substantial update to the Brand Page UI. Key changes include enhanced image upload functionality, integrating `cleanImageWithCanvas` and AWS S3 presigned URL logic for logo uploads. It also introduced a `Form.useWatch` to dynamically enable/disable the "Save Changes" button based on form modifications and added a `ColorPicker` for theme customization.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx` (17/11/2025, 16:22:51 & 21/11/2025, 11:48:56)**: The `ProductSearch` component was updated to support "top-up gifts" with an input for "Freebie Price." A new prop `btnSearch` was added to enable an alternative "Select products/collections" button for opening the search modal. Logic for handling collection-specific quantities was also refined.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx` (17/11/2025, 16:23:04)**: This file saw extensive changes to the order details page. Updates include a `mergeRepeatedRefunds` function for consolidating refund attempts and normalizing statuses, an enhanced currency formatting helper (`formatAmountWithCurrency`), and dynamic logic to determine if an order can be edited based on applied rewards or discounts. It also expanded price breakup calculations to include various discount and charge types.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx` (18/11/2025, 00:49:40, 00:50:14, 00:58:39)**: The Free Gift settings page was significantly updated, enabling the creation and management of free gift rules. The form now supports various conditions such as sales channels, purchase type (cart value/quantity), min/max values, applicability (all/specific products/collections), and application methods (auto/selection). It also includes features for editing, deleting, and enabling/disabling rules. The latter two timestamps show no functional changes, indicating minor saves.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx` (18/11/2025, 23:42:52)**: A new component was added to allow customization of elements on the order confirmation page. It provides collapsible sections for "Brand Logo Customization," "Dynamic Banners," "TrustBanner," "Order Details," "Customer Information," and "Support & Communication," each with its own switch to enable/disable. The component also supports drag-and-drop reordering of these sections.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx` (19/11/2025, 21:10:01, 21:11:54, 21:12:22, 21:12:29)**: This page, responsible for the custom order confirmation page settings, received multiple minor UI layout adjustments, primarily altering the flex proportions between the form controls and the preview section. The `handleFormSubmit` function was updated to exclude specific fields (e.g., trust banner text/tag) from validation.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx` (20/11/2025, 18:44:34, 18:44:55, 18:49:44, 18:49:50)**: This component, likely a utility for processing/rendering shipping data, was introduced or heavily revised. It handles product-based shipping rules, including mapping data for display, managing selected products/collections, and defining form inputs for rule name, price, order value ranges, and calculation methods. A significant feature is the robust CSV upload mechanism for pincodes, including validation for file type and content format. The subsequent timestamps show minor refinements, such as explicitly adding `onKeyPress` validation for number inputs.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts` (21/11/2025, 11:50:18 & 11:51:40)**: This helper file contains a broad range of utility functions for filtering, date formatting, currency handling, deep object comparison, debouncing, date/time disabling, string capitalization, number formatting, table column extraction, data sorting, and CSV uploads for cohorts (phone numbers/emails). The second timestamp shows no functional changes.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/validations.ts` (24/11/2025, 12:45:40 - 14:06:48)**: This file was significantly updated with comprehensive validation logic for various discount types. A notable addition is the check for `differentFreebieForSameRange` within `validateTieredDiscount` to prevent conflicting freebie products for overlapping tiers. Other validations ensure unique codes, valid limits, and correct discount values across tiered, dynamic, Buy X at Y, discount capping, and GWP (Gift With Purchase) discounts. Multiple entries for this file show no functional differences, indicating repeated saves during a validation logic update.

### Timestamps of Significant Changes:

*   **16/11/2025 (mid-day):** Major UI/logic refactor for the Brand Page.
*   **17/11/2025 (mid-afternoon):** `ProductSearch` feature addition for top-up gifts and significant enhancements to the Order Details page.
*   **18/11/2025 (early morning):** Introduction of the Free Gift settings page with detailed rule configuration.
*   **18/11/2025 (late evening):** New component for customizable Order Confirmation Page sections.
*   **19/11/2025 (late evening):** Repeated, minor UI layout adjustments on the Order Confirmation Page.
*   **20/11/2025 (late afternoon):** Introduction of advanced shipping method configuration, including extensive CSV upload features.
*   **21/11/2025 (late morning):** Further refinements to `ProductSearch` and updates to the `helper.ts` utility file.
*   **24/11/2025 (mid-day to early afternoon):** Extensive updates to the central validation utility, particularly for discount rules.

### Patterns and Recurring Elements:

*   **Form-Driven UI:** Almost all new or updated components (`BrandPage`, `FreeGift`, `OrderConfirmationPage`, `ShippingMethodConfig`) are heavily reliant on `gokwik-ui-kit`'s `Form` component and `Form.useWatch` for managing user input and state reactivity.
*   **Centralized Utility Functions:** The `helper.ts` and `validations.ts` files serve as centralized repositories for common logic, demonstrating a pattern of extracting reusable code for formatting, validation, and data manipulation.
*   **API Interaction Standardization:** `makeAPICall` and `makeAWSPutCall` are consistently used for network requests, often involving presigned URLs for file uploads, indicating a standardized approach to API communication.
*   **Environment Configuration Cycles:** The `.env` files and `index.ejs` show a recurring pattern of switching between `sandbox`, `dev`, and `qa` environment configurations for API endpoints and micro-frontend imports. This suggests frequent environment switching during development and testing phases.
*   **Component Reusability:** Components like `ProductSearch` are reused across different settings pages, optimizing development and maintaining consistency.
*   **Breadcrumb Navigation:** The `updateBreadcrumbs` utility is used to define navigation paths across different configuration pages.

## 15:34:23
The logs primarily detail changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

The changes occurred in rapid succession on **22/11/2025**, at **17:38:55**, **17:39:07**, and **17:39:40**.

**File-Specific Updates for `src/services/common.ts`:**

The `common.ts` file contains two main asynchronous functions: `makeAPICall` and `logUserEvent`.

1.  **`makeAPICall` Function:**
    *   This function serves as a central utility for making API requests using Axios.
    *   It defines an `APIRequestConfig` interface, supporting various HTTP methods, payloads, parameters, headers, and specific flags like `isUpload`, `skipLoader`, `skipMode`, `responseType`, `skipCookies`, and `fieldNames` for multi-file uploads.
    *   **Internal User Restriction:** It includes logic to prevent "internal users" from performing non-GET operations on a predefined list of sensitive URLs (e.g., `/api/reports`, `/events`, `/team/switch-merchant`).
    *   **Axios Configuration:** It sets up an Axios instance with a base URL from `process.env.REACT_APP_BASE_URL` and applies a suite of security headers (`X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, `Content-Security-Policy`). In non-development environments, `Strict-Transport-Security` is also added. It manages `withCredentials` and `responseType` dynamically.
    *   **Loader Management:** It integrates `loaderEvent` to manage UI loading states before and after API calls.
    *   **Dynamic Parameters:** It adds a `mode` parameter to requests if the user is not an internal user and `skipMode` is not set.
    *   **File Uploads:** It includes robust handling for file uploads, supporting both single files (`file`) and multiple files (`files` with optional `fieldNames`) using `FormData` and `multipart/form-data`.
    *   **Error Handling (401 Unauthorized):** It specifically handles `401 Unauthorized` errors. If such an error occurs:
        *   It prevents redirection for specific login/signup related paths (`/signup`, `/login`, etc.) and paths starting with `/existing-merchant/login` or `/invitation/`.
        *   For other paths, it stores the current `window.location.pathname` in `sessionStorage` as `redirectTo`.
        *   It removes `token` from `localStorage`.
        *   It navigates the user to `/login` using `single-spa`'s `navigateToUrl`, again with specific path exclusions.
        *   It logs the error to the console.

2.  **`logUserEvent` Function:**
    *   This function is designed to log user events, taking an `EventsInterface` configuration.
    *   It extracts user and merchant details from `dashboardStore`.
    *   **`getFixedParams`:** A helper function collects common event parameters, including `tracking_id`, `request_id`, `email`, and generates a `session_id` (if not present) using `nanoid` and stores it in a cookie for 365 days. It also captures merchant and user names/roles and calculates the `landing_page` from the URL. A `timestamp` is added using `new Date().toISOString()`.
    *   **`parseUserAgent`:** Another helper function attempts to parse the `navigator.userAgent` string to extract details like `os`, `device`, `os_version`, `browser`, `browser_version`, and whether it's a webview (`is_wv`). The browser version extraction regex is partially shown.

**Patterns and Recurring Elements:**

*   **Consistent Structure:** All logs show the same overall code structure for both `makeAPICall` and `logUserEvent`, including their respective helper functions and interfaces.
*   **Security Headers:** A recurring pattern in `makeAPICall` is the inclusion of several HTTP security headers, demonstrating a focus on application security.
*   **Environment Variable Usage:** The use of `process.env.REACT_APP_BASE_URL` and `process.env.NODE_ENV` indicates dynamic configuration based on the deployment environment.
*   **State Management:** Both functions interact with `dashboardStore` to retrieve user and merchant data, implying a centralized state management system.
*   **Cookie and Local Storage:** Extensive use of `sessionStorage`, `localStorage`, and `cookies` for session management, tracking IDs, user email, and user session IDs.
*   **Minor Reversion:** The most significant pattern in the timestamps is a quick change and reversion.
    *   At **17:38:55**, the `makeAPICall` function's 401 error handling returned `{ ...error, error: true }`.
    *   At **17:39:07**, this was changed to explicitly return `{ error: true, message: error?.response?.data?.message || error.message }`, providing a more structured error message.
    *   However, by **17:39:40**, the code reverted to the original `return { ...error, error: true }` format. This suggests a brief, possibly experimental, modification that was quickly undone or overwritten during a series of saves.

## 15:35:17
The code changes primarily focus on refining UI components, enhancing form validations, and managing configurations within a React application, likely a dashboard for GoKwik. Significant updates span from brand page customization to managing discount rules and shipping settings.

**File-Specific Updates:**

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx (16/11/2025, 13:10:34)**:
    *   Initializes a `BrandPage` component for customizing checkout UI elements such as logo and primary color.
    *   Implements logo upload functionality, including validation (file type, size), image cleaning with canvas, generation of presigned AWS S3 URLs, and uploading the image to S3.
    *   Integrates with a form (`Form.useForm`, `Form.useWatch`) for managing brand data and `cssRules`, specifically for `primaryColor`.
    *   Uses `useEffect` hooks to fetch existing logo URL on component mount and dispatch brand data updates on form value changes.
    *   Makes API calls for `downloadLogo`, `presingedLogoUrl`, and `updateMerchant` for persistent storage of brand assets and configuration.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx (17/11/2025, 16:22:51 & 21/11/2025, 11:48:56)**:
    *   **Initial (17/11/2025, 16:22:51)**: Introduces a `ProductSearch` component for dynamic searching and selection of Shopify products or collections. It supports features like infinite scrolling (`useIntersectionObserver`), collating product variants, and applying specific filters (e.g., for agent-led scenarios). It manages local state for search results, selected items, and pagination within a modal.
    *   **Update (21/11/2025, 11:48:56)**:
        *   Added a new prop `btnSearch` to conditionally render a dedicated "Select products/collections" button, offering an alternative to the search input for initiating the modal.
        *   Improved the `handleQuantityChange` logic to conditionally update the quantity for collections, specifically when `collectionMinimumPurchangeQuantity` is active.
        *   Refined the display of collated products to show "X variants selected" only if variants exist.
        *   Imported `DeleteOutlined` icon for potential future use or consistency.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/orders/order-details/index.tsx (17/11/2025, 16:23:04)**:
    *   This component displays detailed order information, including pricing, refunds, customer contact, and order status.
    *   It implements a `mergeRepeatedRefunds` helper to consolidate refund attempts and assign statuses (Completed, Failed, Initiated).
    *   Calculates the `total_discount`, `tax`, `shipping_and_cod_charges`, and `gift_card_and_rewards` based on order price breakdowns.
    *   Dynamically sets the currency symbol using `setCurrencySymbol`.
    *   Includes logic to determine order failure reasons and manage refund button states (disabled/enabled, refundable amount).
    *   Features UI elements from `gokwik-ui-kit` like `Table`, `Tabs`, `Tag`, `Tooltip`, and `Popover` for a rich user experience.

*   **/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs (18/11/2025, 00:45:31; 20/11/2025, 18:37:48; 21/11/2025, 12:27:47; 24/11/2025, 12:17:06; 24/11/2025, 12:17:41)**:
    *   This EJS template is responsible for loading the GoKwik dashboard micro-frontends.
    *   **Recurring Pattern**: The URLs for `@gokwik/utilities` and `@gokwik/dashboard` within the `isLocal` environment configuration are frequently toggled between `sandbox-dashboard.dev.gokwik.in` and `qa-dashboard.dev.gokwik.in`. This indicates a pattern of switching local development dependencies between sandbox and QA environments.
    *   Other modules like `@gokwik/checkout`, `@gokwik/payment`, `@gokwik/kwikpass`, `@gokwik/rto`, `@gokwik/kwikship`, `@gokwik/ellora`, `@gokwik/checkout-platform`, and `@gokwik/shopify-app` are also dynamically loaded based on the `deployedEnv`.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/free-gift/freeGift.tsx (18/11/2025, 00:49:40, 00:50:14, 00:58:39)**:
    *   Manages free gift rules through a form-based interface.
    *   Allows defining rules based on sales channels (app, web, agent-led), purchase requirements (cart value, quantity), and applicability (all products, specific products, specific collections).
    *   Integrates `ProductSearch` for selecting free gift products or collections.
    *   Displays configured rules in a table with options to enable/disable (Switch), edit, and delete.
    *   `updateBreadcrumbs` is used to maintain navigation context.
    *   **Pattern**: Multiple timestamps without functional code changes suggest re-saves or minor non-functional edits.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/orderConfirmationPage/collapseFields.tsx (18/11/2025, 23:42:52)**:
    *   Introduces `CustomizeUiFields` to configure various sections of the order confirmation page using collapsible panels.
    *   Sections include Brand Logo, Dynamic Banners, Trust Banner, Order Details, Customer Information, and Support & Communication.
    *   Each section allows enabling/disabling via a `Switch` and configuring specific fields (e.g., text, colors) using `RenderField`, `LogoPage`, `TrustBadgeForm`, and `ColorPickerHelper`.
    *   Supports drag-and-drop reordering of collapse items for layout customization.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/orderConfirmation/index.tsx (19/11/2025, 21:10:01; 21:11:54; 21:12:22; 21:12:29)**:
    *   **Initial (19/11/2025, 21:10:01)**: Sets up the main `OrderConfirmationPage` for customizing post-purchase experiences. It includes a toggle for enabling custom confirmation pages, a `MainSection` for core configurations, and a `OrderConfirmationPreview` component. Form submission logic includes validation and exclusion of specific fields from validation.
    *   **Updates (19/11/2025, 21:11:54; 21:12:22; 21:12:29)**:
        *   **Pattern**: Frequent, rapid changes to the `flex` property of the `Col` component, specifically `flex='1 1 200px'` and `flex='1 1 300px'`. This indicates ongoing layout adjustments for the settings and preview panels, likely to optimize the visual balance and user experience.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/shipping/shippingBasedData.tsx (20/11/2025, 18:44:34; 18:44:55; 18:49:44; 18:49:50)**:
    *   **Initial (20/11/2025, 18:44:34)**: Implements `processProductBasedShippingData` for managing product-based shipping rules. It processes shipping configurations, maps product/collection data for display, and provides a form for adding/editing rules (name, price, shipping ID, calculation method, multipliers). Integrates `ProductSearch` for adding items and includes custom logic for managing item data and `variant_ids`/`collection_ids`.
    *   **Update (20/11/2025, 18:44:55)**: Changed the `price` input type from `inputNumber` to a generic `input`.
    *   **Update (20/11/2025, 18:49:44)**: Added `onKeyPress` validation to the `price` input field, restricting it to numeric and dot characters, and explicitly initialized `previousShippingData` fields to `null`.
    *   **Pattern**: Multiple timestamps show a quick iteration on input field types and validation for the "Rule price" field, demonstrating a focus on data integrity for shipping configurations.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/helper.ts (21/11/2025, 11:50:18 & 11:51:40)**:
    *   **Initial (21/11/2025, 11:50:18)**: A comprehensive helper file containing utilities for dynamic search filters, date formatting, currency display (`setCurrencySymbol`, `formatAmount`), object comparison (`deepCompare`), function debouncing, date picker disabling logic, string manipulation, table data extraction/sorting, and CSV upload for cohorts.
    *   **Pattern**: Timestamp (11:51:40) without functional change indicates a re-save or minor non-functional adjustment.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shipping-component/shippingBasedMethods.tsx (24/11/2025, 12:31:55 & 12:36:01)**:
    *   **Initial (24/11/2025, 12:31:55)**: Manages various shipping methods and advanced conditions. Features form fields for shipping name, price, order value ranges, and advanced settings, including customer segments and pincode uploads. Utilizes API calls for fetching customer segments, getting presigned URLs, and uploading/downloading CSV files (for cohorts/pincodes). Includes basic range overlap checking (`rangesOverlap`).
    *   **Update (24/11/2025, 12:36:01)**: Enhanced `beforeUpload` logic for CSV files to include more robust checks for CSV content format (single value, horizontal, vertical), improving the validation of uploaded pincode/cohort data.

*   **/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/validations.ts (24/11/2025, 12:45:40 - 15:24:12)**:
    *   **Initial (24/11/2025, 12:45:40)**: Centralizes validation functions for different discount types (`TieredDiscount`, `DynamicDiscount`, `BuyXatYDiscount`, `DiscountCapping`, `GWP`). A core `rangesOverlap` function is used across multiple validations to check for conflicting ranges. Each validation function returns a message and status.
    *   **Update (24/11/2025, 14:06:48)**: Imported the `Weight_based_Shipping_Rates` interface, signaling an upcoming or new validation for weight-based shipping.
    *   **Update (24/11/2025, 15:16:08)**: Introduced the `validateWeightRangeDifference` function, indicating the implementation of validation logic specific to weight-based shipping ranges.
    *   **Update (24/11/2025, 15:23:42)**: Modified `validateWeightRangeDifference` to accept an `isEditEnabled` parameter, allowing the validation to adapt based on whether a shipping rule is being created or edited.
    *   **Pattern**: Numerous consecutive timestamps without functional changes to the validation logic (e.g., 12:47:57, 12:48:27, 12:48:53, etc.) followed by a functional change. This suggests a pattern of frequent saves during development, with significant functional additions (like weight-based shipping validation) being grouped together in the later timestamps.

**General Patterns and Recurring Elements:**

*   **UI Kit Usage**: Consistent use of `gokwik-ui-kit` components (`Button`, `Form`, `Input`, `Card`, `Table`, `Dropdown`, `Switch`, `Tooltip`, `message`, `Alert`, `Modal`, `Upload`, `Select`, `Radio`) across various pages and components.
*   **Form Management**: Heavy reliance on Ant Design's `Form` API (`Form.useForm`, `Form.useWatch`, `form.setFieldValue`, `form.getFieldsValue`) for handling user input and state.
*   **Configuration Management**: Frequent use of `useMerchantConfigApi` hook (from `@library/utilities/hooks/useMerchantConfig`) to fetch and save merchant-specific configurations.
*   **API Interactions**: Extensive use of `makeAPICall` and `makeAWSPutCall` (from `@gokwik/utilities`) for interacting with backend services, including data retrieval, updates, and file uploads. `process.env.REACT_APP_BASE_URL` is consistently used for API endpoint construction.
*   **Redux Integration**: `useAppDispatch` and `useSelector` are used for Redux state management, accessing merchant and user details.
*   **Validation Logic**: A dedicated `validations.ts` file centralizes business logic for validating various configuration fields, often involving checks for overlaps, uniqueness, and required values.
*   **Helper Utilities**: A `helper.ts` file provides general-purpose utility functions, including formatting, comparison, and CSV handling.
*   **Breadcrumbs**: Consistent updates to breadcrumbs using `updateBreadcrumbs` (from `@gokwik/utilities`) to maintain navigation context.
*   **Environment Configuration**: The `index.ejs` file shows dynamic loading of micro-frontends based on deployment environment, and `.env` files are used for environment-specific API base URLs. The frequent toggling of `isLocal` dependencies between sandbox and QA suggests a dynamic or evolving local development setup.

## 16:34:19
The provided log details changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`**
    *   This file contains two main asynchronous functions: `makeAPICall` for handling general API requests, including file uploads, and `logUserEvent` for logging user interactions and details like user agent parsing.
    *   It defines an `APIRequestConfig` interface for consistent API call parameters and `EventsInterface` for user event logging.
    *   The `makeAPICall` function includes logic for:
        *   Restricting "internal user" POST operations to a predefined set of URLs.
        *   Setting up Axios instances with security headers (`X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, `Content-Security-Policy`, `Strict-Transport-Security`).
        *   Handling loading states using `loaderEvent`.
        *   Processing single and multiple file uploads using `FormData`.
        *   Redirecting to the login page and clearing local storage token upon receiving a 401 Unauthorized status code, with exclusions for specific public routes.
    *   The `logUserEvent` function gathers extensive user and merchant data, generates a session ID using `nanoid` if not present, and parses user agent strings to extract OS, device, browser, and their versions.

**Timestamps of Significant Changes:**

*   **22/11/2025, 17:39:07**: A significant update occurred in the `makeAPICall` function. Specifically, within the `catch (error)` block for handling a 401 Unauthorized status code, the error return structure was refined. Previously, it returned `{ ...error, error: true }`. This was changed to `{ error: true, message: error?.response?.data?.message || error.message }`. This modification ensures a more standardized and explicit error message is returned, improving the consistency of error handling.
*   The entries at 22/11/2025, 17:38:55 and 22/11/2025, 17:39:40 represent the state of the file just before and just after this specific error handling refinement, respectively. The code content between 17:39:07 and 17:39:40 appears identical, suggesting the latter timestamp might be a subsequent save without further code changes.

**Patterns or Recurring Elements:**

*   **Rapid Iteration:** All changes occurred within a span of seconds on the same file, suggesting a focused development session involving minor adjustments or saves.
*   **Robust Error Handling and Security:** The `makeAPICall` function consistently includes comprehensive error handling (especially for 401 Unauthorized errors) and implements various security headers to enhance application security.
*   **User and Merchant Context:** Both `makeAPICall` and `logUserEvent` frequently access `dashboardStore` to retrieve `userData` and `merchantData`, indicating a strong reliance on a centralized state management system for user and merchant-specific information.
*   **Cookie Management:** The use of `getCookie` and `setCookie` from `gokwik-utilities` and `nanoid` for generating session IDs indicates a pattern of managing user sessions and tracking via cookies.
*   **Loader and Timer Events:** The consistent use of `loaderEvent` at the start and end of `makeAPICall` (and `timerEvent` for timeout handling) highlights a pattern of providing UI feedback during asynchronous operations.