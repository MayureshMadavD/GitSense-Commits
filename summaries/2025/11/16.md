# Activity Summary for 16/11/2025

## 10:03:40
`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts` (12/11/2025, 21:20:24 and 15/11/2025, 12:00:15) is a core service managing shipping and discount logic. It heavily imports Svelte stores for state management (e.g., `gstInfo`, `discountCode`, `currentPage`, `shippingMethods`, `merchantInfo`, `freeGift`, `gyftr`, `billingAmount`). The `callShippingDiscountApi` function initiates discount and shipping calls, clears API timers, triggers confetti for valid discounts, and handles `gyftr` application/removal based on the checkout page. It also logs loyalty point applications. The `processShippingDiscountResponse` function processes API responses for shipping, shipping options, and discounts, including specific fixes for gift card handling and payment method calls, manages UI loader states, and implements retry logic for shipping method selection. No significant changes were observed between the two timestamps for this file.

`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html` (13/11/2025, 14:31:36 and 15/11/2025, 11:32:20) is an HTML file serving as a test environment for the Gokwik SDK. It includes a `gokwikSdk` JavaScript IIFE for initializing the checkout, managing events, and dynamically injecting scripts. The `window.merchantInfo` configuration object defines merchant-specific parameters like `mid` and `environment`. A notable change on 15/11/2025, 11:32:20 updated the `mid` in `window.merchantInfo` for the 'local' environment from `gh0yshvkmca4pw4` to `eey3k3mkrg55tcs`. The file also manages `gk_landing_page` and `gk_orig_referrer` cookies.

`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte` experienced multiple updates from 13/11/2025, 20:56:52 to 15/11/2025, 12:01:15. This Svelte component manages the payment options screen, importing a vast array of Svelte stores to handle complex state related to payment methods, discounts, COD, UI flags, and user data. The `onMount` hook performs initial setup, including fetching UPI app presence, processing saved cards, and triggering various analytics events (GTM, Shopify, Facebook). It also conditionally calls payment methods and updates COD availability based on TwidPay rewards. Significant changes included adding `store_availableOffersCheck` to imports on 13/11/2025, 21:20:47, and further adding `store_isLoggedInUser`, `store_isCartUpdated`, `AutomaticGiftHeader`, and `GiftJourney` on 15/11/2025, 12:01:15. A new reactive block was introduced on the latter date to check `recommendedOptions` visibility and screen width, then call `checkIntentFlowSupported`. The frequent identical timestamps within the 13/11/2025 period suggest minor, non-substantive changes or repeated saves.

`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte` (15/11/2025, 11:49:48 and 15/11/2025, 11:52:44) is a Svelte component for displaying the order summary. It relies heavily on Svelte stores for cart data, pricing, discounts, and loyalty. It includes a function to toggle the order summary drawer and logs analytics events for this interaction. The `onMount` hook subscribes to numerous stores to ensure real-time updates. The `handleCartUpdate` function processes cart items, calculates automatic discounts, and identifies free products. A complex reactive statement calculates the `totalPrice` by incorporating subtotal, various discounts (coupon, prepaid, loyalty, Shopify store credit), shipping, gift card totals, COD charges, TwidPay rewards, GST, and Gyftr amounts, then updates `store_totalPrice`. Another reactive block calculates `loyaltyDisplayAmount`. No significant changes were observed between the two timestamps for this file.

**Patterns and Recurring Elements:**
The codebase demonstrates a strong reliance on Svelte stores for centralized state management across components and services, enabling reactive data flow. There's a consistent pattern of using `onMount` lifecycle hooks for component initialization and subscriptions. Extensive use of analytics and event logging (`logEvent`, `fireGtmEvent`, `fireAnalytics`) is evident for tracking user interactions and checkout progress. Environment-specific configurations are crucial, with services and HTML defining parameters and API endpoints based on the deployment environment. The application handles complex payment and discount logic, integrating various types of offers and dynamically calculating pricing. The presence of multiple identical code entries for `PaymentOptions.svelte` within short timeframes suggests an iterative development process with frequent, possibly minor, saves. The overall system appears designed for robust control over the checkout flow, managing UI states, loaders, and navigation.

## 13:26:02
The provided log details code changes across three primary files: `ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `OrderSummary.svelte`, and `Merchant.svelte`, alongside configuration updates in `merchant.html`. The `EnvironmentService.ts` file, which contains environment configurations and potential token strings, will not be summarized as per the instructions.

**File-specific Updates:**

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp:** 12/11/2025, 21:20:24 (and an identical save on 15/11/2025, 12:00:15)
    *   **Updates:** This service received significant enhancements to its discount and shipping logic. New subscriptions were added for several stores, including `store_minPrice`, `store_isCartUpdated`, `store_offers`, `store_merchantInfo`, `store_placeOrder`, `store_bottomSheetState`, and `store_utmDiscounts`. The `callShippingDiscountApi` function was updated to include:
        *   Confetti animation for specific valid coupon applications.
        *   Conditional `gyftr` (a type of gift/reward) handling based on `currentPage` and `placeOrder` status, including calls to `removeGyftr` and `reApplyGyftr`.
        *   Logic to reset `store_selectedShippingMethod` and trigger `addressListingBottomSheet` under certain conditions related to shipping options.
        *   Logging of `loyalty_points_applied` events, detailing provider, redeemed credits, and auto-application status.
    *   The `processShippingDiscountResponse` function was modified to exclude error messages on the UI for UTM auto-application failures (`utmAutoApplyDiscountCall` and `utmAutoApplyShippingOptionsCall`). Gift card handling on cart updates was also refined.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp:** 13/11/2025, 14:31:36 (and an update on 15/11/2025, 11:32:20)
    *   **Updates:** The `merchant.html` file saw updates to the `window.merchantInfo.mid` configuration, with a new `mid` value (`eey3k3mkrg55tcs`) being used for a QA environment and several other environment-specific `mid` values being commented out or adjusted. A call to `gokwikSdk.init()` within the `document.onreadystatechange` block for `interactive` or `complete` states was commented out.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamp:** The component saw multiple saves on 13/11/2025 between 20:56:52 and 21:25:07, and a final update on 15/11/2025, 12:01:15. Many of these interim timestamps contained identical code, suggesting frequent saves without functional changes.
    *   **Updates:** Key additions to store imports include `store_recommendedOptions`, `store_prepaidDiscount`, various `store_instagramExpVariant`/`UpiFallbackConfigs`, `store_showPspInFallback`, `store_experiments`, `store_gyftr`, `store_isLoggedInUser`, and `store_isCartUpdated`. Notably, `store_availableOffersCheck` was added and then removed. The file also removed imports for `calculateLoadTime`, `loadTimeVariables`, `PaymentAddressLazyLoad`, and `debounce`. New Svelte components `AutomaticGiftHeader` and `GiftJourney` were imported. Reactive logic (`$:`) was added to update `store_onpl.isCodAvailable` based on `store_twidPay` and to conditionally check for intent flow support based on `recommendedOptions` visibility and screen width. Initialization in `onMount` now includes setting `store_prepaidDiscount` to 0 and subscribing to `store_paymentMethods` and `store_recommendedOptions`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamp:** 14/11/2025, 13:55:06
    *   **Updates:** This Svelte component received updates to improve merchant integration and analytics tracking. It added `LocalStorageInterface` type, `kpFbCliId` and `truecallerRequestId` variables, and a hardcoded `bpocStaticKey`. The `truecallerConfig` was expanded with new environment keys for `dev` and `qatwo`. An array `sessionIDFixMerchants` was updated.
    *   The `onMount` lifecycle hook was significantly modified to:
        *   Insert dynamic CSS keyframes and dispatch a `gokwikLoaded` event.
        *   Handle various URL query parameters (`mrid`, `gkref`, `src`, `ch`, `kwik`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid`, `so_token`) for checkout flows, including abandon cart scenarios and token handling.
        *   Process `gk_token` from query parameters received via `merchantInfo` message events, saving tokens to cookies and local storage.
        *   Log `gokwik_other_checkout` events when a specific element (`.gokwik-checkout+div`) is clicked.
    *   The `setCookiesOnCheckoutLoad` function was updated to collect more cookie data for analytics, including `_shopify_s`, `_scid`, `gk_utm_source`, `_fbp`, `_fbc`, `discount_code`, `coupon_applied`, `gk_landing_page`, `SP_DUID`, `gk_orig_referrer`, `_shopify_y`, `_shopify_sa_t`, `_shopify_sa_p`, `localization`, `kp_user_id`, `KWIKUSERTOKEN`, `kpmclid`, and Google Analytics cookies. Helper functions `getKpParamForFb` and `getGaCookies` were introduced.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamp:** 15/11/2025, 11:49:48 (and an identical save at 15/11/2025, 11:52:44)
    *   **Updates:** This component for displaying order details was enhanced with loyalty program integration. It added imports for `store_earnedLoyaltyDetails`, `store_lineItemEdd`, `store_preventScroll`, `store_onpl` from their respective stores, and introduced the `EarnedLoyalty` Svelte component. The `totalPrice` reactive calculation was updated to incorporate:
        *   Partner acquisition offers when `isOnplVisible` is true.
        *   `earnedLoyaltyDetails` from the new store.
    *   New subscriptions were added for `store_lineItemEdd`, `store_earnedLoyaltyDetails`, and `store_priceBreakUp`, with the latter being used to calculate `loyaltyDisplayAmount`. The `handleCartUpdate` function was modified to adjust `subTotal` and `mrpDiscountData` based on freebie amounts and page conditions, and to correctly aggregate `totalItems` after segregating free products. It also now adds `gifts_available` from `reqIdObject` to `cartItems` if no `phoneNo` is present.

**Patterns and Recurring Elements:**

*   **Svelte Store Integration:** A strong pattern across multiple files is the extensive use of Svelte stores (`store_...`) from `CommonStore` and `OrderStore`. Many variables are declared and then immediately subscribed to these stores, indicating a reactive, state-driven architecture.
*   **Analytics and Event Logging:** There's a consistent focus on analytics and event logging using `fireGtmEvent`, `logEvent`, `fireAnalyticsGa4`, `facebookEvents`, `shopifyPaymentStepReached`. This suggests a comprehensive tracking system for user interactions and checkout flows.
*   **Environment-Specific Logic:** The `EnvironmentService.ts` (though not summarized) and `Merchant.svelte` demonstrate extensive environment-specific URL and token handling, crucial for deploying code across `dev`, `qa`, `sandbox`, and `production` environments.
*   **Checkout Flow Refinements:** Updates frequently touch upon different stages of the checkout process, including discount application, shipping method selection, gift card management, loyalty program integration, and payment options. This indicates ongoing feature development and optimization of the user's checkout journey.
*   **Redundant Saves:** Several `.svelte` files have multiple consecutive entries with identical code content, hinting at frequent saves during development, possibly triggered by IDE auto-save or minor, non-functional changes like formatting.

## 13:55:56
The `brandPage.tsx` file, updated on 16/11/2025 at 13:10:34, is a React component responsible for allowing users to customize the UI of a checkout dashboard, specifically focusing on brand elements.

Key updates and functionalities include:

*   **Brand Logo Management**:
    *   Users can upload a brand logo, which is validated for file type (JPEG, PNG, SVG) and size (under 2MB).
    *   The component handles the entire logo upload workflow: cleaning the image with canvas, generating a unique path, obtaining a presigned AWS S3 URL, uploading the image to S3, and displaying a preview of the uploaded logo.
    *   Existing logos are fetched and displayed when the page loads.
    *   API calls are made to update the merchant's logo on the backend.
*   **Theme Color Customization**:
    *   A `ColorPicketComponent` is used to allow users to select a primary theme color for the checkout UI. This color is managed as part of the merchant's custom configuration.
*   **State Management and Data Flow**:
    *   It integrates with Redux to manage user details (`merchant_details`) and dispatch updates related to logo data and general brand data.
    *   `useMerchantConfigApi` hook is utilized for fetching and saving merchant-specific UI configurations.
    *   Form state is managed using Ant Design's `Form` component, with changes to `brand_data` being watched and dispatched to the Redux store.
*   **User Interface**:
    *   The page provides an `InfoComponent` for guidance and uses Gokwik UI Kit components (Card, Button, Upload, Form, ColorPicker) for a structured and interactive interface.
    *   A "Save Changes" button is enabled only when modifications are detected in the form fields.
*   **API Interactions**: The component makes several API calls, including checking for an existing logo, generating presigned URLs for image uploads, and updating merchant configurations. These interactions involve endpoints for downloading logos, getting presigned URLs, and updating merchant details.

The file demonstrates a common pattern of a comprehensive form for managing user-specific settings, involving client-side validation, image processing, cloud storage interaction, and backend API integration for persistence.