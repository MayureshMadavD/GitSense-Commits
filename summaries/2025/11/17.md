# Activity Summary for 17/11/2025

## 11:13:19
The `ShippingDiscount.service.ts` file, last updated on 12/11/2025 at 21:20:24, is central to managing discounts and shipping options. Key updates include the clearing of the `captureApiTimerId` when discount coupons are removed, and a `confetti` animation being triggered for specific valid coupon code applications. The service now incorporates logic for `gyftr` (gift-as-a-product) to be removed or reapplied based on discount responses and the current checkout page. It also introduces logging for `loyalty_points_applied` events, tracking provider, redeemed credits, and auto-application status. A significant update involves a fix for `CHECKOUT-15842` to reapply gift cards if the cart has been modified, and a fix for `CHECKOUT-12982` to trigger payment method calls under specific conditions. Error messages are now managed more granularly, excluding failures related to UTM auto-application. The file also contains retry logic for shipping discounts.

The `PaymentOptions.svelte` file saw several updates between 13/11/2025, 20:56:52 and 13/11/2025, 21:25:07. This component orchestrates the payment selection UI, extensively importing and subscribing to numerous Svelte stores for common, order, and login-related states. During `onMount`, it initializes prepaid discount, fetches payment methods and previously used UPI IDs, processes saved cards, and sets the latest saved card. It dispatches GTM and Shopify analytics events on payment step landing. The component also handles various UI states, such as resetting loader, BIN response, and payment attempt states. Event logging for `prefilled_skip_to_pay` and `email_mismatch_message_shown` indicates detailed user journey tracking. Conditional `callPaymentMethods` execution is implemented based on the presence of `store_placeOrder` or `twidPay` status. It dynamically hides or shows UI elements related to payment panels based on allowed payment methods. A minor change on 13/11/2025, 21:22:28 added `store_availableOffersCheck` to its imports. A more substantial change on 15/11/2025, 12:01:15 included adding `store_isLoggedInUser` and `store_isCartUpdated` imports, removing `calculateLoadTime`, `loadTimeVariables`, `PaymentAddressLazyLoad`, `SharePaymentLink`, `fetchShopifyCredits` imports, and integrating `AutomaticGiftHeader` and `GiftJourney` components, indicating a restructuring of how free gifts are presented within the payment options.

The `OrderSummary.svelte` file underwent changes between 15/11/2025, 11:49:48 and 15/11/2025, 11:52:44. This component focuses on displaying a detailed breakdown of the order. It imports Svelte lifecycle hooks, various stores, and utility functions. It exports `hideDiscountTab` and `componentData`. The component manages states for cart updates, gift additions, and order summary drawer visibility. A complex reactive block (`$:` statement) calculates the `totalPrice` by aggregating subtotal, various discounts (coupon, partner acquisition, discount-based rewards, Shopify store credit, prepaid), shipping, gift cards, COD charges, TwidPay rewards, GST, and Gyftr. The `handleCartUpdate` function, called on mount and on cart changes, processes the `cartjsObject` to extract and categorize items, including handling "buy X get Y" free products and gifts from `requestIdObject`, and calculating `automaticDiscount` and `totalItems`. It also now calculates and updates `loyaltyDisplayAmount` based on `earnedLoyaltyDetails` and `priceBreakUpData`.

A recurring pattern across these files is the heavy reliance on Svelte stores for managing and reacting to global application state, which is central to the UI's reactivity and data flow. All components demonstrate extensive event logging using services like GTM, GA4, Shopify Analytics, and Facebook, highlighting a strong focus on tracking user interactions and checkout performance. The presence of specific fixes (e.g., CHECKOUT-15842, CHECKOUT-12982) indicates ongoing refinement and maintenance. Furthermore, several experiment-related store imports suggest a culture of A/B testing and feature toggling to optimize the user experience. The asynchronous nature of many operations (e.g., API calls) is also a common theme, reflecting the dynamic, data-driven nature of the checkout process.

## 12:03:55
The file `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` was updated on **16/11/2025, 13:10:34**.

This file defines the `BrandPage` component, a UI for customizing a merchant's brand appearance on a checkout dashboard. Key functionalities include:
*   **Brand Logo Management**:
    *   Allows users to upload a brand logo with validation for file type (JPEG, PNG, SVG) and size (max 2MB).
    *   Utilizes client-side image cleaning (`cleanImageWithCanvas`).
    *   Handles image uploads to AWS S3 using pre-signed URLs obtained via an internal API (`presingedLogoUrl`).
    *   Fetches existing logos and displays a preview or a `noImage` placeholder.
    *   Updates the merchant's logo details via an API endpoint (`updateMerchant`).
*   **Theme Color Customization**:
    *   Integrates a `ColorPicketComponent` to allow users to select a primary theme color for the checkout UI.
    *   Saves the selected color as part of `cssRules` within the merchant's `custom_config`.
*   **State and Configuration Management**:
    *   Leverages React hooks (`useEffect`, `useState`) and Redux (`useSelector`, `useAppDispatch`) for state management, including fetching merchant details and dispatching logo data updates.
    *   Uses a `useMerchantConfigApi` hook to fetch and save merchant-specific custom configurations.
    *   Employs `gokwik-ui-kit` components (Form, Upload, Button, Card, ColorPicker) for building the user interface.
*   **Form Handling**:
    *   Uses Ant Design's `Form` component for managing form fields and submission.
    *   The "Save Changes" button is enabled/disabled based on form value changes.
*   **API Interactions**: Makes various API calls using `makeAPICall` and `makeAWSPutCall` to interact with backend services for logo download, pre-signed URL generation, logo upload, and merchant configuration updates.

Overall, the component provides a comprehensive interface for merchants to control the branding (logo and primary theme color) of their GoKwik checkout UI, involving image processing, cloud storage interactions, and dynamic UI updates.

## 12:13:15
The code changes primarily involve updates to frontend Svelte components and environment configurations, focusing on checkout flow, payment options, and order summary. Several files were saved multiple times in quick succession without apparent functional changes.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp: 12/11/2025, 21:20:24 & 15/11/2025, 12:00:15**
    *   This service handles the core logic for applying and processing shipping discounts. It manages numerous Svelte stores related to cart state, discounts, shipping methods, gift cards, and user information. Key functions `callShippingDiscountApi` and `processShippingDiscountResponse` were defined. Noteworthy features include confetti animation for successful discount application, integration with Gyftr (reapplying/removing), and logic for updating shipping methods and handling errors. The content appears identical across both timestamps, suggesting a re-save without functional changes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamp: 13/11/2025, 14:31:15**
    *   This file defines environment-specific base URLs for various services such as health checks, address suggestions, core APIs, Cred, experiment endpoints, TwidPay, KP (Kwikpass), CDN paths, and analytics. It uses a central `env` variable to switch between 'dev', 'qa', 'sandbox', 'production', and 'local' environments.
    *   **Timestamp: 15/11/2025, 11:32:02 & 15/11/2025, 11:32:38**
    *   A specific change was made within the `api_url` function for the 'local' environment, uncommenting `url = 'https://sandbox.gokwik.co';` while several other local URLs remained commented out. This indicates a shift in the targeted backend for local development.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp: 13/11/2025, 14:31:36**
    *   This HTML file outlines a merchant test page. It includes an inline Gokwik SDK for initializing checkout, handling events, and managing button visibility. It defines `window.merchantInfo` with a hardcoded `mid` and `environment: 'local'`, along with `storeId` and `fbpixel`.
    *   **Timestamp: 15/11/2025, 11:32:20**
    *   The hardcoded `mid` in `window.merchantInfo` was updated from `'gh0yshvkmca4pw4'` to `'eey3k3mkrg55tcs'`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps: 13/11/2025, 20:56:52, 20:58:06, 21:00:07, 21:00:59, 21:01:56, 21:03:33, 21:20:47, 21:23:51**
    *   This Svelte component is central to managing payment options in the checkout flow. It imports a large number of state management stores and services, handling everything from COD confirmation, card payments, UPI options, TwidPay, and Shopify store credits to discount application and analytics logging. The content across these eight consecutive timestamps appears identical, indicating a series of saves without functional code changes.
    *   **Timestamp: 15/11/2025, 12:01:15**
    *   Imports were updated, specifically adding `store_isLoggedInUser` and `store_isCartUpdated` from `CommonStore`. The `calculateLoadTime` utility was removed from `Helper.service` imports. Two new Svelte components, `AutomaticGiftHeader` and `GiftJourney`, were imported, suggesting the integration of new features related to automatic gifts.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamp: 14/11/2025, 13:55:06**
    *   This component integrates the Gokwik checkout iframe into merchant websites. It manages calls to various analytics platforms (CleverTap, Klaviyo, WebEngage, Facebook, GA, etc.), handles cookies for tracking and user identification, and processes URL parameters for checkout initiation. It dynamically inserts CSS keyframes for animations and includes `truecallerConfig` which maps environment names to Truecaller application keys.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamp: 15/11/2025, 11:49:48 & 15/11/2025, 11:52:44**
    *   This Svelte component is responsible for displaying the order summary and calculating the total price. It subscribes to numerous stores to factor in various discounts, shipping costs, gift cards, COD charges, loyalty rewards, and tax information. It also handles cart updates, including identifying free products and gifts. The content across these two timestamps appears identical, suggesting a re-save without functional changes.

**Patterns and Recurring Elements:**

*   **Frequent Svelte Component Saves:** Multiple Svelte components (`PaymentOptions.svelte`, `OrderSummary.svelte`, `ShippingDiscount.service.ts`) were saved in quick succession without apparent code changes, particularly on 13/11/2025. This suggests iterative development or frequent auto-saves.
*   **Environment-Specific Configuration:** The `EnvironmentService.ts` file is a central point for managing different API endpoints and configurations based on the `env` variable. This pattern is essential for deploying the application across various development, testing, and production environments.
*   **Checkout Flow and Payment Management:** The core focus of the changes revolves around enhancing the checkout experience, specifically in payment options (`PaymentOptions.svelte`) and order summary (`OrderSummary.svelte`), and how discounts are applied (`ShippingDiscount.service.ts`).
*   **Analytics Integration:** The `Merchant.svelte` file shows a strong emphasis on integrating various third-party analytics services, indicating a data-driven approach to understanding user behavior.
*   **Gift and Discount Handling:** Logic for applying, reapplying, and removing various types of discounts, gift cards, and free gifts is a recurring theme across `ShippingDiscount.service.ts` and `OrderSummary.svelte`, and new gift-related components were added to `PaymentOptions.svelte`.

## 13:03:56
The file `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` was updated on 16/11/2025, 13:10:34. This update primarily focuses on enhancing the brand customization page within a checkout dashboard UI.

**Key changes and features include:**

*   **Logo Customization:** The page now supports uploading a brand logo with validation for image types (JPEG, PNG, SVG) and size (under 2MB).
    *   It integrates with AWS S3 for logo storage, generating presigned URLs for secure uploads.
    *   Existing logos can be fetched and displayed, and new uploads trigger an image cleaning process (`cleanImageWithCanvas`) before storage.
    *   The logo URL is updated in the Redux store (`updatedLogoData`) and reflected in the UI.
*   **Theme Color Customization:** Merchants can now control the primary theme color of the checkout UI using a `ColorPicketComponent`. This color is saved as part of the `cssRules` in the custom configuration.
*   **Form Management:** The page utilizes Ant Design's `Form` component for managing both logo and color settings.
    *   Changes to form values (`onValuesChange`) automatically enable/disable a "Save Changes" button.
    *   The `onFinish` handler manages saving updates, which involves separate API calls for the logo (updating `merchant_details`) and the overall custom configuration (`saveConfig`).
*   **State and API Integration:**
    *   Redux is used for managing global state, including `merchant_details` and dispatching updates.
    *   The component heavily relies on `makeAPICall` for various backend interactions (downloading, presigning URLs, updating merchant data) and `makeAWSPutCall` for direct AWS S3 uploads.
    *   A `useMerchantConfigApi` hook is employed for fetching and saving merchant-specific UI configurations.
*   **UI Components:** The page makes extensive use of components from `gokwik-ui-kit` (Button, Upload, Card, ColorPicker, Row, Col) for a consistent user interface. `InfoComponent` is also used to provide context and documentation links.

**Patterns and Recurring Elements:**

*   **API Interactions:** There's a consistent pattern of using `makeAPICall` with `process.env.REACT_APP_BASE_URL` and specific `APIEndPoints` for various data operations.
*   **Form Handling:** `Form.useForm()` and `Form.useWatch()` are frequently used to manage form state and react to input changes.
*   **Redux Integration:** `useSelector` and `useAppDispatch` are common for interacting with the Redux store, reflecting a centralized state management approach.
*   **`useEffect` Hooks:** Multiple `useEffect` hooks are used for side effects, such as initializing form fields from fetched data (`merchant_details`, `config`) and dispatching updates based on form value changes.
*   **Error Handling:** `try...catch` blocks are present around API calls, typically logging errors or gracefully handling failures by returning empty strings or nulls.

## 14:03:58
The provided log entry details changes to the `BrandPage.tsx` file, located at `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx`, with a timestamp of `16/11/2025, 13:10:34`.

**File-Specific Updates:**

This file represents a React component designed for customizing a checkout UI's brand elements, specifically allowing users to upload a brand logo and set a primary theme color.

*   **Logo Upload Functionality:**
    *   Introduces an `Upload` component from `gokwik-ui-kit` for handling logo uploads.
    *   Includes `validateUpload` logic to enforce image file types (`.jpg`, `.jpeg`, `.png`, `.svg`) and a size limit of 2MB.
    *   The `handleUpload` function processes uploaded files by cleaning them using `cleanImageWithCanvas`, generating a unique path for storage (`merchant/{m_id}/logo{timestamp}.{extension}`), fetching a presigned URL via `fetchUploadedLogoURL`, and then performing an AWS PUT call using `makeAWSPutCall` to store the image. A base64 representation is used for immediate preview.
    *   The `isLogoPresentForCurrentMerchant` function is used to check for and retrieve an existing logo URL, displaying it in the form.
    *   Updates to the merchant's logo are made via an API call (`APIEndPoints.updateMerchant`).
*   **Theme Color Customization:**
    *   Integrates a `ColorPicketComponent` to allow users to select a `primaryColor` which is applied to the checkout theme. This color is managed within the form's `cssRules`.
*   **Form Management:**
    *   Utilizes Ant Design's `Form` component (`gokwik-ui-kit` variant) for managing form state, including `Form.useForm()` and `Form.useWatch()`.
    *   The `onFinish` handler collects form data, handles logo updates, and saves the custom configuration using a `saveConfig` utility.
    *   A "Save Changes" button is conditionally enabled/disabled based on form value changes, providing immediate feedback on unsaved modifications.
*   **Data Integration:**
    *   Leverages Redux (`useSelector`, `useAppDispatch`) to fetch `merchant_details` and update logo data (`updatedLogoData`, `updateBrandData`) globally.
    *   Uses a custom hook `useMerchantConfigApi` to fetch and persist merchant-specific custom configurations.
*   **User Guidance:** Includes an `InfoComponent` linking to an Atlassian Wiki page for documentation on the "Brand Section," indicating an effort to provide comprehensive user support.

**Patterns or Recurring Elements:**

*   **Consistent UI Library Usage:** The component heavily relies on `gokwik-ui-kit` for all its user interface elements (Buttons, Forms, Cards, Uploads, etc.), indicating a standardized design system across the application.
*   **API Abstraction and Centralization:** Repeated use of `makeAPICall`, `makeAWSPutCall`, and `APIEndPoints` suggests a centralized utility for making API requests and managing endpoint URLs.
*   **Custom Hooks for Business Logic:** The presence of `useMerchantConfigApi` indicates a pattern of encapsulating complex data fetching and saving logic within custom React hooks for reusability and cleaner component code.
*   **Redux for Global State:** Redux is consistently used for managing global application state, particularly merchant-specific data and customization preferences, ensuring data consistency across different parts of the dashboard.
*   **Form-Driven Interactions:** The component is built around a robust form, which is a common pattern for data input and configuration in dashboard applications.
*   **Image Handling Utilities:** Utilities like `cleanImageWithCanvas` and `getBase64` are utilized for common image manipulation tasks, indicating a shared set of tools for image processing.

## 14:13:39
The provided log details changes across several Svelte application files, primarily focusing on checkout functionality, analytics integration, and environment configuration.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp: 12/11/2025, 21:20:24 & 15/11/2025, 12:00:15**
        This service manages shipping and discount logic. It imports numerous Svelte stores and services for state management and external API calls. Key functions `callShippingDiscountApi` and `processShippingDiscountResponse` handle the core logic. `callShippingDiscountApi` initiates discount/shipping calls, triggers confetti animations for specific discount types, manages Gyftr application/removal, and logs loyalty point events. `processShippingDiscountResponse` sets shipping and discount data, includes fixes for handling gift cards on cart updates (CHECKOUT-15842) and calling payment methods under certain conditions (CHECKOUT-12982), manages UI loaders, and handles error messages, particularly excluding those for UTM auto-application failures. The code content was identical between these two timestamps, suggesting a re-save or minor non-functional change.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp: 13/11/2025, 14:31:36**
        This HTML file defines a basic merchant page with a "click me" button to initiate the GoKwik checkout. It includes a JavaScript `gokwikSdk` that dynamically loads the `gokwik.js` script and provides methods for interacting with the checkout. It also includes functions for cookie management (`gk_landing_page`, `gk_orig_referrer`) and an embedded `window.merchantInfo` object for local development, specifying `environment: 'local'`, a `storeId`, and `fbpixel`.
    *   **Timestamp: 15/11/2025, 11:32:20**
        A minor change occurred, updating the `mid` value within the `window.merchantInfo` configuration from `'19g6ilvc699a0'` to `'eey3k3mkrg55tcs'`.
    *   **Timestamp: 17/11/2025, 13:01:29**
        Another minor change, updating the `mid` value in `window.merchantInfo` from `'eey3k3mkrg55tcs'` to `'19g6jlssscg1r'`. Both later changes indicate frequent adjustments to merchant IDs for testing or development.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamp: 13/11/2025, 20:56:52 - 21:25:07**
        Throughout this series of identical changes within the same day, this Svelte component for payment options was likely saved multiple times without functional code modifications. It involves extensive imports of Svelte stores related to login, order, and common application state. It declares numerous variables for payment methods, COD details, UI states, and analytics. The `onMount` lifecycle hook orchestrates many initializations and subscriptions, including processing saved cards, triggering analytics events, handling skip-to-payment scenarios, and reacting to changes in discounts, TwidPay, and Shopify store credits. A reactive block (`$:`) updates COD availability based on TwidPay.
    *   **Timestamp: 15/11/2025, 12:01:15**
        This update introduced new imports: `store_isLoggedInUser` and `store_isCartUpdated` from `CommonStore`, `store_availableOffersCheck` from `OrderStore`, and two new components `AutomaticGiftHeader` and `GiftJourney`. This suggests new features related to automatic gifts or offers were being integrated, requiring additional state and UI components.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamp: 15/11/2025, 11:49:48 & 15/11/2025, 11:52:44**
        Similar to `PaymentOptions.svelte`, this component shows identical code across two timestamps, indicating a re-save. This file is responsible for displaying the order summary. It imports stores for login, common, and order data, along with several child components. It manages the visibility of the order summary drawer (`toggleCartDrawer`), calculates the `totalPrice` reactively based on numerous factors like subtotal, various discounts (coupon, prepaid, loyalty, Shopify store credit, Gyftr), shipping charges, COD fees, and taxes. The `handleCartUpdate` function processes cart items, identifies automatic discounts, and segregates free products.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamp: 14/11/2025, 13:55:06 & 17/11/2025, 13:00:33**
        This Svelte component is responsible for the overall merchant integration and checkout initiation. It imports numerous analytics services (CleverTap, Klaviyo, WebEngage, Facebook, GAanalytics, Contlo, GA4, etc.), helper functions, and environment-specific configurations. The `onMount` hook sets up environment variables, retrieves various tracking IDs and marketing data from cookies and URL parameters, checks for available UPI apps, and manages cash-to-prepaid configurations. It also handles message passing for `merchantInfo`, `cartOpen`, and `checkoutHealth` events. The code content was identical between these two timestamps, suggesting a re-save or minor non-functional change.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamp: 17/11/2025, 13:05:00**
        This file defines integration with the Contlo analytics platform. It sets up a dummy `window.contlo` object for console logging events, and includes `createBody` to standardize data payloads with cart, user, marketing, and UTM information. The `callContlo` function dispatches various event types (`mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, `coupon_applied_success_gk`, `coupon_applied_failed_gk`) to specific handlers which then construct and attempt to send the event data via `window.contlo.sendEvent`, with a console fallback if the SDK is not present.
    *   **Timestamp: 17/11/2025, 13:19:38 & 17/11/2025, 13:45:19 & 17/11/2025, 13:55:05**
        Multiple saves with minor changes. The change at 13:45:19 added a `console.log(data)` statement in the `contloAddressAdded` function, which was then changed to `console.log(dataObj)` at 13:55:05.
    *   **Timestamp: 17/11/2025, 14:07:01**
        The `createBody` function was updated to robustly handle the `cart_total_price` by checking if `commonAnalyticsData?.cart_after_discount` is a valid number before using it, falling back to `commonAnalyticsData?.cart_total_price` otherwise. This improves data reliability for Contlo events.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamp: 17/11/2025, 12:56:56 - 14:05:25**
        This service centralizes the logic for integrating with various foreign analytics platforms. It imports a wide array of Svelte stores to collect comprehensive data about the cart, user, marketing, and checkout flow. It maintains an `fbPixelEventsAndKeys` mapping and uses a `configObject` to enable or disable specific analytics pixels and events. It subscribes to nearly all relevant stores to generate common analytics data (`commonAnalyticsData`) and prepare data for different tracking events. Helper functions for Snapchat pixel checks, prefilled address status, URL decoding, and ad source mapping are also present. All timestamps in this range show identical code content, indicating multiple re-saves without functional changes.

**Patterns and Recurring Elements:**

*   **Svelte Store Reliance:** A dominant pattern is the extensive use of Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_totalPrice`, `store_discountAmount`) for managing and sharing application state across components and services. Variables are declared and then updated via subscriptions to these stores.
*   **Analytics-Driven Development:** There is a significant focus on integrating and logging data for various analytics platforms (GTM, Shopify, CleverTap, Contlo, Facebook, GA4, etc.). Events are tracked at granular steps of the checkout process (mobile added, pincode added, payment method selected, discounts applied, address added, payment completed). This indicates a strong emphasis on user behavior tracking and conversion optimization.
*   **Checkout Flow Complexity:** The codebase reflects a complex checkout process involving multiple stages, discounts, loyalty programs, shipping options, and payment methods. The logic handles conditional flows, error management, and dynamic UI updates.
*   **Environment Specificity:** API endpoints and certain configurations (like Truecaller keys or merchant IDs in `merchant.html`) are frequently defined and updated based on the development environment (`local`, `dev`, `qa`, `sandbox`, `production`), highlighting a robust multi-environment deployment strategy.
*   **Frequent Re-saving:** Many files exhibit multiple timestamps with identical code, suggesting either automated formatting/linting on save or a developer habit of frequent saving during development without functional changes.
*   **Fixes/Enhancements (CHECKOUT-XXXX):** Explicit comments like "fix for CHECKOUT-15842" indicate a structured approach to bug fixing and feature development, likely using an issue tracking system.

## 15:04:06
This log details changes to the `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` file, last modified on `16/11/2025, 13:10:34`.

This React component, `BrandPage.tsx`, is responsible for enabling merchants to customize the branding of their GoKwik checkout UI.

Key functionalities and updates include:

*   **Brand Customization:** The page allows users to upload a brand logo and select a primary theme color for the checkout UI.
*   **Logo Management:**
    *   **Upload Functionality:** Utilizes an `Upload` component with strict validation for image types (JPEG, PNG, SVG) and size (max 2MB).
    *   **Image Processing:** Integrates `cleanImageWithCanvas` for client-side image processing before upload.
    *   **Cloud Storage Integration:** Generates unique paths for logos (e.g., `merchant/{m_id}/logo{timestamp}.{extension}`), obtains presigned URLs from a backend (`APIEndPoints.presingedLogoUrl`), and uploads the cleaned image directly to AWS S3 using `makeAWSPutCall`.
    *   **Display:** Fetches and displays the current logo, falling back to a `noImage` placeholder if none is present. `getBase64` is used for previewing the uploaded image.
*   **Theme Color Selection:** Features a `ColorPickerComponent` to allow users to set the primary color for their checkout theme, with the selected color being part of the `cssRules` configuration.
*   **Form Handling & Data Persistence:**
    *   Leverages Ant Design's `Form` for managing input fields.
    *   Uses a `useMerchantConfigApi` hook to fetch and save merchant-specific custom UI configurations.
    *   The `onFinish` handler dispatches updates to the backend for the logo (`APIEndPoints.updateMerchant`) and saves the entire `custom_config` (including logo path and primary color) via `saveConfig`.
    *   Changes to form values (`brandData`) are dispatched to a Redux store (`updateBrandData`) to keep the application state synchronized.
*   **State Management:** Extensively uses `useState`, `useEffect`, `useMemo`, and Redux selectors (`useSelector`, `useAppDispatch`) to manage component state, merchant details, and configuration data.
*   **API Interactions:** Centralizes API calls using `makeAPICall` for various operations like downloading logo URLs, generating presigned upload URLs, and updating merchant data. It relies on `APIEndPoints` constants for endpoint definitions.
*   **User Feedback:** Provides error messages for invalid uploads and uses an `isVisible` state to enable/disable the "Save Changes" button based on form modifications.
*   **UI Components:** Consistently uses components from `gokwik-ui-kit` (e.g., `Button`, `Card`, `Row`, `Col`, `InfoComponent`) for a cohesive user interface.

The recurring pattern observed is the robust handling of image uploads, involving validation, client-side processing, secure cloud storage interaction via presigned URLs, and integration with both local component state and a global Redux store for data management.

## 15:13:21
The provided logs detail several code changes across different files within the `gokwik.pdp` project, primarily focusing on discount logic, payment options, analytics integration, and environment configuration.

### File-Specific Updates:

1.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp: 12/11/2025, 21:20:24**
        *   This extensive update refactors and expands the `ShippingDiscount.service.ts` file.
        *   It introduces numerous Svelte stores (e.g., `store_codOtpRequired`, `store_fullScreenPopUp`, `store_discountExperimentFlag`, `store_utmDiscounts`, `store_minPrice`, `store_isSuccessFlowEnabled`, `store_bottomSheetState`, `store_gyftr`) for managing shared state related to shipping, discounts, and payment flow.
        *   New constants are defined by subscribing to these stores.
        *   A `processDiscountShippingQueue` is introduced to manage API responses.
        *   The `callShippingDiscountApi` function is updated to handle discount application (including confetti animation for successful applications for specific user types or if `show_discount_confetti` is true and `disable_discount_application` is false), loyalty discounts, and interactions with Gyftr (reapplying or removing based on discount and page state). It also includes logic for setting shipping methods and options.
        *   The `processShippingDiscountResponse` function is enhanced to manage shipping information, discount responses, gift card reapplication on cart updates, and error messages (with a special exclusion for UTM auto-application failures). It also updates the UI state for loaders and bottom sheets based on the response.
    *   **Timestamp: 15/11/2025, 12:00:15**
        *   This change is identical to the one on 12/11/2025, 21:20:24, indicating either a re-commit of the same changes or a file restoration/revert to this specific state. No functional difference is observed.

2.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamp: 13/11/2025, 14:31:15**
        *   This file primarily defines environment-specific base URLs for various services (health, address suggestion, API, Cred, experiments, TwidPay, KP, CDN, analytics).
        *   It uses `env` variable (subscribed from `store_environment`) to dynamically set URLs for `dev`, `qa`, `sandbox`, `production`, `local`, `hdev`, `ndev`, `qa-rto`, `qaone`, `qatwo`, `dev-core`, `qa-core`, `sandbox-core`, `pci-prod`, and `idev` environments.
        *   Comments show some `local` environment URLs were previously commented out, indicating flexibility in local development setup.
        *   It also defines `XGokwikToken` and `XKWIKPASSToken` based on the environment.
    *   **Timestamp: 15/11/2025, 11:32:02**
        *   The `api_url` function's `local` environment URL has been changed. Previously, it had several commented-out options, with `https://api.gokwik.co` active. This update makes `https://sandbox.gokwik.co` the active URL for the `local` environment, while others remain commented.
    *   **Timestamp: 15/11/2025, 11:32:38**
        *   This change is identical to the one on 15/11/2025, 11:32:02. No functional difference.
    *   **Timestamp: 17/11/2025, 13:02:34**
        *   The `api_url` function's `local` environment URL has been updated again. It was `https://sandbox.gokwik.co` and is now changed back to `https://api.gokwik.co`.

3.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp: 13/11/2025, 14:31:36**
        *   This HTML file serves as a merchant integration page, demonstrating how the `gokwikSdk` is initialized and interacts with the checkout flow.
        *   It defines a `gokwikSdk` object with `init`, `initCheckout`, `emit`, `on`, and `hideButton` methods.
        *   The `init` function dynamically loads `gokwik.js`.
        *   It includes logic to set `gk_landing_page` and `gk_orig_referrer` cookies.
        *   The `window.merchantInfo` object provides configuration (e.g., `mid`, `environment`, `storeId`, `fbpixel`). The `mid` (merchant ID) is commented out with various examples, but `gh0yshvkmca4pw4` is set for the button and then overridden in `window.merchantInfo` with `eey3k3mkrg55tcs` (a `qa` mid is commented). The `environment` is set to `'local'`.
    *   **Timestamp: 15/11/2025, 11:32:20**
        *   The `mid` in `window.merchantInfo` is changed from a commented `qa mid:'eey3k3mkrg55tcs'` to be the active `mid:'eey3k3mkrg55tcs'`, with `gh0yshvkmca4pw4` still on the button but no longer the active `mid` in the `merchantInfo` object. Other commented-out `mid` values remain unchanged.
    *   **Timestamp: 17/11/2025, 13:01:29**
        *   The `mid` in `window.merchantInfo` is changed from `'eey3k3mkrg55tcs'` to `'19g6jlssscg1r'`.

4.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamp: 13/11/2025, 20:56:52**, **20:58:06**, **21:00:07**, **21:00:59**, **21:01:56**, **21:03:33**, **21:20:47**, **21:22:28**, **21:23:51**
        *   These timestamps show many minor changes on the same day for `PaymentOptions.svelte`. All these entries are identical in content except for the addition of `store_availableOffersCheck` in the last three timestamps within the `OrderStore` import list.
        *   The file manages payment options display and logic, integrating with various Svelte stores for state management (e.g., `store_skipToPayment`, `store_loader`, `store_twidPay`, `store_shopifyStoreCredit`, `store_offers`).
        *   It includes a reactive statement (`$:` block) to update `store_onpl`'s `isCodAvailable` based on `store_twidPay`'s applied reward.
        *   `onMount` hook performs several initializations: setting `prepaidDiscount` to 0, subscribing to `paymentMethods`, logging UPI presence, processing saved cards, firing GTM events, setting page name, and resetting payment-related error states.
        *   It orchestrates calls to `callPaymentMethods` based on `store_placeOrder` and `store_twidPay` states.
        *   It handles subscriptions for various stores to update local component state (e.g., `totalPrice`, `codChargesText`, `discountTitle`).
        *   It includes logic to hide PSP panels based on allowed payment methods and logs events for Bajaj EMI methods.
        *   The file shows a pattern of managing offers and recommended payment options through subscriptions and reordering.
        *   **Specific addition in the later timestamps (21:20:47, 21:22:28, 21:23:51):** `store_availableOffersCheck` is added to the import list from `common/stores/OrderStore`.
    *   **Timestamp: 15/11/2025, 12:01:15**
        *   This update adds `store_isLoggedInUser` and `store_isCartUpdated` to the import list from `common/stores/CommonStore`.
        *   It also introduces two new Svelte components: `AutomaticGiftHeader.svelte` and `GiftJourney.svelte`, and imports them. This suggests new UI elements related to automatic gift handling are being integrated into the payment options page.
        *   The `calculateLoadTime` helper service import is removed.

5.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamp: 14/11/2025, 13:55:06**
        *   This Svelte component is the main merchant integration point, embedding the GoKwik iframe.
        *   It initializes analytics services (CleverTap, Klaviyo, Wigzo, WebEngage, Moengage, Facebook, GAAnalytics, Growlytics, Contlo, GA4, Netcore, Snapchat, edgetag, CustomerLabs, ShopifyAnalytics, GoogleAds).
        *   It manages cookies and query parameters to retrieve session IDs, campaign data (`mrid`, `gkref`, `src`, `ch`, `kwik`, `ScCid`, `isSameWindowRedirection`, `isSuccess`, `gokwikOid`, `so_token`).
        *   It handles messaging between the parent window and the GoKwik iframe, specifically for `merchantInfo`, `cartOpen`, and `checkoutHealth` events.
        *   It includes logic for Truecaller integration, determining the environment, and setting cash-to-prepaid configurations.
        *   The `truecallerConfig` object contains environment-specific keys for Truecaller.
        *   A list of `sessionIDFixMerchants` is present, likely for specific merchant IDs that require special handling of Shopify session cookies.
    *   **Timestamp: 17/11/2025, 13:00:33**
        *   This change is identical to the one on 14/11/2025, 13:55:06. No functional difference.

6.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamp: 15/11/2025, 11:49:48**, **11:52:44**
        *   These two timestamps are identical.
        *   This Svelte component is responsible for displaying the order summary.
        *   It imports numerous Svelte stores from both `LoginStore` and `CommonStore` to gather data like `orderType`, `cartjsObject`, `discountBasedRewards`, `selectedShippingMethod`, `totalPrice`, `gstInfo`, `gyftr`, `shopifyStoreCredit`, `earnedLoyaltyDetails`, and `priceBreakUp`.
        *   It defines reactive variables for `totalPrice`, `subTotal`, `couponDiscount`, `prepaidDiscount`, `codCharges`, `shippingInfo`, `giftcardTotal`, `automaticDiscount`, `loyaltyDisplayAmount`, and other price breakdown elements.
        *   The `totalPrice` calculation is complex, considering various discounts (coupon, partner acquisition offer, discount-based rewards, Shopify store credit, prepaid discount, gift card, TwidPay reward, Gyftr), shipping charges, COD charges, and GST.
        *   The `onMount` hook subscribes to several stores and calls `handleCartUpdate` on cart changes.
        *   `handleCartUpdate` processes cart items, identifies free products (for BXGY deals, prepaid discounts, auto gifts), and updates `subTotal` and `automaticDiscount`.
        *   It calculates `totalItems` in the cart.
        *   It includes logic for displaying a new order summary for specific page numbers.
        *   It also calculates `loyaltyDisplayAmount` based on `priceBreakUpData` and `earnedLoyaltyDetails`.

7.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ForeignAnalytics.ts`**
    *   **Timestamp: 17/11/2025, 12:56:56**, **13:43:21**, **13:44:00**, **13:44:52**, **14:05:25**
        *   These timestamps show several identical updates.
        *   This service handles integration with various foreign analytics platforms (CleverTap, Klaviyo, Moengage, WebEngage, Wigzo, Facebook, GA, Growlytics, Contlo, GA4, Netcore, Snapchat, EdgeTag, CustomerLabs, ShopifyAnalytics, GoogleAds).
        *   It consolidates data from numerous Svelte stores related to user information, cart details, discounts, shipping, and payment.
        *   It defines a `priceBreakup` object to track `line_items_subtotal`, `order_total`, `total_discount`, `shipping_charges`, `cod_fee`, `gift_card_and_reward`, and `tax`.
        *   It includes `fbPixelEventsAndKeys` for mapping checkout events to Facebook pixel custom events.
        *   The `adSourceMapping` function is used to parse UTM parameters from the source string.
        *   `generateTrackingData` and `createDataObject` functions are central to preparing data for different analytics platforms.
        *   It also handles `kwikOptimizerPixelIds` for enabling custom Facebook pixel events.
        *   The multiple identical entries suggest a period of rapid development, saving, or an automated process.

8.  **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Analytics/Contlo.ts`**
    *   **Timestamp: 17/11/2025, 13:05:00**
        *   This file integrates Contlo analytics. It defines a dummy `window.contlo` object for development/testing purposes, logging calls to `init`, `identify`, `track`, and `push`.
        *   The `createBody` function compiles analytics data from `commonAnalyticsData` (including product IDs, promo code, cart total, marketing data like UTMs) and other event-specific data.
        *   `callContlo` acts as a dispatcher for different Contlo events: `mobileAddedGK`, `pinCode`, `paymentMethod`, `paymentCompleted`, `userAddress`, and `coupon_applied_success_gk`/`coupon_applied_failed_gk`.
        *   Separate functions (`contloMobile`, `contloPincode`, `contloPaymentMethod`, `contloPaymentCompleted`, `contloAddressAdded`, `contloDiscountEvent`) prepare specific data payloads for each event.
        *   `contloSendEvent` attempts to call `window.contlo.sendEvent`, with a fallback `console.log` if the SDK is not found.
        *   A notable detail is `cart_total_price` in `createBody` uses `commonAnalyticsData?.cart_after_discount`.
    *   **Timestamp: 17/11/2025, 13:19:38**
        *   This change removes the dummy `window.contlo` object definition from the top of the file. This implies that the actual Contlo SDK is expected to be loaded externally, and the `try-catch` block in `contloSendEvent` will now handle cases where `window.contlo` is genuinely absent. No other functional changes.
    *   **Timestamp: 17/11/2025, 13:45:19**
        *   Adds a `console.log(data)` statement inside the `contloAddressAdded` function, likely for debugging purposes.
    *   **Timestamp: 17/11/2025, 13:55:05**
        *   Removes the `console.log(data)` statement from `contloAddressAdded`, reverting it to the previous state. This suggests the debugging step was temporary.
    *   **Timestamp: 17/11/2025, 14:07:01**
        *   Modifies the `cart_total_price` calculation within the `createBody` function. It now includes a check to ensure `commonAnalyticsData?.cart_after_discount` is a valid number before using it, otherwise falling back to `commonAnalyticsData?.cart_total_price`. This adds robustness to the data being sent to Contlo.
    *   **Timestamp: 17/11/2025, 14:13:04**
        *   Further refines the `cart_total_price` calculation in `createBody`. It now explicitly stores `Number(commonAnalyticsData?.cart_after_discount)` into a `discountedAmount` variable and uses `!!commonAnalyticsData?.cart_after_discount && !isNaN(discountedAmount) ? discountedAmount : commonAnalyticsData?.cart_total_price`. This is a more explicit and robust check for the validity of `cart_after_discount`.
    *   **Timestamp: 17/11/2025, 14:13:49**, **14:14:00**
        *   These two changes are identical to the one on 17/11/2025, 14:13:04. No functional difference.

### Timestamps of Significant Changes:

*   **12/11/2025, 21:20:24:** Major refactor and expansion of shipping/discount logic in `ShippingDiscount.service.ts`, introducing a queue for API responses and complex discount/gift card handling.
*   **13/11/2025, 14:31:15:** Comprehensive environment configuration in `EnvironmentService.ts`.
*   **13/11/2025, 14:31:36:** Initial version of `merchant.html` showing SDK integration and merchant configuration.
*   **13/11/2025, 20:56:52 - 21:23:51:** Consecutive, minor updates to `PaymentOptions.svelte`, mostly related to store imports, with `store_availableOffersCheck` added in later revisions.
*   **14/11/2025, 13:55:06:** `Merchant.svelte` shows full analytics integration and core SDK launch logic.
*   **15/11/2025, 11:32:02:** `EnvironmentService.ts` changes the local environment API URL from production to sandbox.
*   **15/11/2025, 11:32:20:** `merchant.html` updates the active `mid` in `window.merchantInfo`.
*   **15/11/2025, 11:49:48:** `OrderSummary.svelte` introduces a complex `totalPrice` calculation and extensive cart item processing, including free products and loyalty.
*   **15/11/2025, 12:01:15:** `PaymentOptions.svelte` integrates `store_isLoggedInUser`, `store_isCartUpdated`, and new components for `AutomaticGiftHeader` and `GiftJourney`, suggesting new features for gift handling.
*   **17/11/2025, 12:56:56:** `ForeignAnalytics.ts` demonstrates detailed analytics event tracking and data consolidation. This file sees multiple identical commits afterward.
*   **17/11/2025, 13:02:34:** `EnvironmentService.ts` reverts the `local` environment API URL back to `https://api.gokwik.co`.
*   **17/11/2025, 13:19:38:** `Contlo.ts` removes the dummy Contlo SDK, indicating reliance on an external SDK load.
*   **17/11/2025, 14:07:01 & 14:13:04:** `Contlo.ts` introduces more robust error handling for `cart_total_price` data type.

### Patterns or Recurring Elements:

*   **Svelte Store Usage:** A prominent pattern across `.ts` and `.svelte` files is the heavy reliance on Svelte stores (e.g., `store_page`, `store_cartjsObject`, `store_totalPrice`, `store_merchantInfo`) for managing global state and reactive data flow. Subscriptions to these stores are frequently used to update local component variables.
*   **Environment Configuration:** The `EnvironmentService.ts` and `merchant.html` files show a clear pattern of defining and switching URLs/keys based on the `env` variable (local, dev, qa, sandbox, production, etc.). This modular approach allows for easy deployment across different environments. Frequent changes in `EnvironmentService.ts` for the `local` environment's API URL suggest ongoing local development and testing with different backend setups.
*   **Analytics Integration:** Many files (`ShippingDiscount.service.ts`, `PaymentOptions.svelte`, `Merchant.svelte`, `ForeignAnalytics.ts`, `Contlo.ts`) demonstrate extensive integration with various analytics platforms (GTM, Shopify Analytics, Facebook, Google Ads, Contlo, etc.). Events are logged at different stages of the checkout process (payment step landed, discount applied, address added, mobile added). `ForeignAnalytics.ts` acts as a central hub for dispatching these events.
*   **Checkout Flow Logic:** There's a consistent focus on the checkout flow, including managing shipping options, applying discounts (manual and automatic), handling gift cards, and processing various payment methods (COD, UPI, TwidPay, Shopify Store Credit). Conditional logic based on page numbers (`currentPage`), user state (`isAbandonCart`), and merchant configurations (`skipToPayment`, `disable_discount_application`) is prevalent.
*   **Minor, Repetitive Updates:** Several files, especially `PaymentOptions.svelte` and `ForeignAnalytics.ts`, show sequences of nearly identical commits within a short timeframe (e.g., minutes). This could indicate frequent saving during development, automated formatting, or minor adjustments that didn't warrant distinct log messages. The addition of `store_availableOffersCheck` and removal of `console.log(data)` in `Contlo.ts` are examples of small, targeted changes.
*   **Robustness and Error Handling:** `Contlo.ts` demonstrates an evolution in robustness with improved checks for numeric values for `cart_total_price`, and `ShippingDiscount.service.ts` includes specific error message management and conditional handling for discount application failures.
*   **Dynamic UI/UX elements:** The mention of `confetti` for successful discounts, `bottomSheetState` for pop-ups, and `AutomaticGiftHeader`/`GiftJourney` components indicates a dynamic and interactive user experience.