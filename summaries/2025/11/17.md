# Activity Summary for 17/11/2025

## 11:13:19
The `ShippingDiscount.service.ts` file, last updated on 12/11/2025 at 21:20:24, is central to managing discounts and shipping options. Key updates include the clearing of the `captureApiTimerId` when discount coupons are removed, and a `confetti` animation being triggered for specific valid coupon code applications. The service now incorporates logic for `gyftr` (gift-as-a-product) to be removed or reapplied based on discount responses and the current checkout page. It also introduces logging for `loyalty_points_applied` events, tracking provider, redeemed credits, and auto-application status. A significant update involves a fix for `CHECKOUT-15842` to reapply gift cards if the cart has been modified, and a fix for `CHECKOUT-12982` to trigger payment method calls under specific conditions. Error messages are now managed more granularly, excluding failures related to UTM auto-application. The file also contains retry logic for shipping discounts.

The `PaymentOptions.svelte` file saw several updates between 13/11/2025, 20:56:52 and 13/11/2025, 21:25:07. This component orchestrates the payment selection UI, extensively importing and subscribing to numerous Svelte stores for common, order, and login-related states. During `onMount`, it initializes prepaid discount, fetches payment methods and previously used UPI IDs, processes saved cards, and sets the latest saved card. It dispatches GTM and Shopify analytics events on payment step landing. The component also handles various UI states, such as resetting loader, BIN response, and payment attempt states. Event logging for `prefilled_skip_to_pay` and `email_mismatch_message_shown` indicates detailed user journey tracking. Conditional `callPaymentMethods` execution is implemented based on the presence of `store_placeOrder` or `twidPay` status. It dynamically hides or shows UI elements related to payment panels based on allowed payment methods. A minor change on 13/11/2025, 21:22:28 added `store_availableOffersCheck` to its imports. A more substantial change on 15/11/2025, 12:01:15 included adding `store_isLoggedInUser` and `store_isCartUpdated` imports, removing `calculateLoadTime`, `loadTimeVariables`, `PaymentAddressLazyLoad`, `SharePaymentLink`, `fetchShopifyCredits` imports, and integrating `AutomaticGiftHeader` and `GiftJourney` components, indicating a restructuring of how free gifts are presented within the payment options.

The `OrderSummary.svelte` file underwent changes between 15/11/2025, 11:49:48 and 15/11/2025, 11:52:44. This component focuses on displaying a detailed breakdown of the order. It imports Svelte lifecycle hooks, various stores, and utility functions. It exports `hideDiscountTab` and `componentData`. The component manages states for cart updates, gift additions, and order summary drawer visibility. A complex reactive block (`$:` statement) calculates the `totalPrice` by aggregating subtotal, various discounts (coupon, partner acquisition, discount-based rewards, Shopify store credit, prepaid), shipping, gift cards, COD charges, TwidPay rewards, GST, and Gyftr. The `handleCartUpdate` function, called on mount and on cart changes, processes the `cartjsObject` to extract and categorize items, including handling "buy X get Y" free products and gifts from `requestIdObject`, and calculating `automaticDiscount` and `totalItems`. It also now calculates and updates `loyaltyDisplayAmount` based on `earnedLoyaltyDetails` and `priceBreakUpData`.

A recurring pattern across these files is the heavy reliance on Svelte stores for managing and reacting to global application state, which is central to the UI's reactivity and data flow. All components demonstrate extensive event logging using services like GTM, GA4, Shopify Analytics, and Facebook, highlighting a strong focus on tracking user interactions and checkout performance. The presence of specific fixes (e.g., CHECKOUT-15842, CHECKOUT-12982) indicates ongoing refinement and maintenance. Furthermore, several experiment-related store imports suggest a culture of A/B testing and feature toggling to optimize the user experience. The asynchronous nature of many operations (e.g., API calls) is also a common theme, reflecting the dynamic, data-driven nature of the checkout process.

## 12:03:55
The file `/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/customizeUI/brandPage.tsx` was updated on **16/11/2025, 13:10:34**.

This file defines the `BrandPage` component, a UI for customizing a merchant's brand appearance on a checkout dashboard. Key functionalities include:
*   **Brand Logo Management**:
    *   Allows users to upload a brand logo with validation for file type (JPEG, PNG, SVG) and size (max 2MB).
    *   Utilizes client-side image cleaning (`cleanImageWithCanvas`).
    *   Handles image uploads to AWS S3 using pre-signed URLs obtained via an internal API (`presingedLogoUrl`).
    *   Fetches existing logos and displays a preview or a `noImage` placeholder.
    *   Updates the merchant's logo details via an API endpoint (`updateMerchant`).
*   **Theme Color Customization**:
    *   Integrates a `ColorPicketComponent` to allow users to select a primary theme color for the checkout UI.
    *   Saves the selected color as part of `cssRules` within the merchant's `custom_config`.
*   **State and Configuration Management**:
    *   Leverages React hooks (`useEffect`, `useState`) and Redux (`useSelector`, `useAppDispatch`) for state management, including fetching merchant details and dispatching logo data updates.
    *   Uses a `useMerchantConfigApi` hook to fetch and save merchant-specific custom configurations.
    *   Employs `gokwik-ui-kit` components (Form, Upload, Button, Card, ColorPicker) for building the user interface.
*   **Form Handling**:
    *   Uses Ant Design's `Form` component for managing form fields and submission.
    *   The "Save Changes" button is enabled/disabled based on form value changes.
*   **API Interactions**: Makes various API calls using `makeAPICall` and `makeAWSPutCall` to interact with backend services for logo download, pre-signed URL generation, logo upload, and merchant configuration updates.

Overall, the component provides a comprehensive interface for merchants to control the branding (logo and primary theme color) of their GoKwik checkout UI, involving image processing, cloud storage interactions, and dynamic UI updates.

## 12:13:15
The code changes primarily involve updates to frontend Svelte components and environment configurations, focusing on checkout flow, payment options, and order summary. Several files were saved multiple times in quick succession without apparent functional changes.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/ShippingDiscount.service.ts`**
    *   **Timestamp: 12/11/2025, 21:20:24 & 15/11/2025, 12:00:15**
    *   This service handles the core logic for applying and processing shipping discounts. It manages numerous Svelte stores related to cart state, discounts, shipping methods, gift cards, and user information. Key functions `callShippingDiscountApi` and `processShippingDiscountResponse` were defined. Noteworthy features include confetti animation for successful discount application, integration with Gyftr (reapplying/removing), and logic for updating shipping methods and handling errors. The content appears identical across both timestamps, suggesting a re-save without functional changes.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/common/services/EnvironmentService.ts`**
    *   **Timestamp: 13/11/2025, 14:31:15**
    *   This file defines environment-specific base URLs for various services such as health checks, address suggestions, core APIs, Cred, experiment endpoints, TwidPay, KP (Kwikpass), CDN paths, and analytics. It uses a central `env` variable to switch between 'dev', 'qa', 'sandbox', 'production', and 'local' environments.
    *   **Timestamp: 15/11/2025, 11:32:02 & 15/11/2025, 11:32:38**
    *   A specific change was made within the `api_url` function for the 'local' environment, uncommenting `url = 'https://sandbox.gokwik.co';` while several other local URLs remained commented out. This indicates a shift in the targeted backend for local development.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/public/merchant.html`**
    *   **Timestamp: 13/11/2025, 14:31:36**
    *   This HTML file outlines a merchant test page. It includes an inline Gokwik SDK for initializing checkout, handling events, and managing button visibility. It defines `window.merchantInfo` with a hardcoded `mid` and `environment: 'local'`, along with `storeId` and `fbpixel`.
    *   **Timestamp: 15/11/2025, 11:32:20**
    *   The hardcoded `mid` in `window.merchantInfo` was updated from `'gh0yshvkmca4pw4'` to `'eey3k3mkrg55tcs'`.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/PaymentOptions.svelte`**
    *   **Timestamps: 13/11/2025, 20:56:52, 20:58:06, 21:00:07, 21:00:59, 21:01:56, 21:03:33, 21:20:47, 21:23:51**
    *   This Svelte component is central to managing payment options in the checkout flow. It imports a large number of state management stores and services, handling everything from COD confirmation, card payments, UPI options, TwidPay, and Shopify store credits to discount application and analytics logging. The content across these eight consecutive timestamps appears identical, indicating a series of saves without functional code changes.
    *   **Timestamp: 15/11/2025, 12:01:15**
    *   Imports were updated, specifically adding `store_isLoggedInUser` and `store_isCartUpdated` from `CommonStore`. The `calculateLoadTime` utility was removed from `Helper.service` imports. Two new Svelte components, `AutomaticGiftHeader` and `GiftJourney`, were imported, suggesting the integration of new features related to automatic gifts.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/merchant/Merchant.svelte`**
    *   **Timestamp: 14/11/2025, 13:55:06**
    *   This component integrates the Gokwik checkout iframe into merchant websites. It manages calls to various analytics platforms (CleverTap, Klaviyo, WebEngage, Facebook, GA, etc.), handles cookies for tracking and user identification, and processes URL parameters for checkout initiation. It dynamically inserts CSS keyframes for animations and includes `truecallerConfig` which maps environment names to Truecaller application keys.

*   **`/Users/mayuresh.madav/Documents/pdp/gokwik.pdp/src/Components/place-order/OrderSummary.svelte`**
    *   **Timestamp: 15/11/2025, 11:49:48 & 15/11/2025, 11:52:44**
    *   This Svelte component is responsible for displaying the order summary and calculating the total price. It subscribes to numerous stores to factor in various discounts, shipping costs, gift cards, COD charges, loyalty rewards, and tax information. It also handles cart updates, including identifying free products and gifts. The content across these two timestamps appears identical, suggesting a re-save without functional changes.

**Patterns and Recurring Elements:**

*   **Frequent Svelte Component Saves:** Multiple Svelte components (`PaymentOptions.svelte`, `OrderSummary.svelte`, `ShippingDiscount.service.ts`) were saved in quick succession without apparent code changes, particularly on 13/11/2025. This suggests iterative development or frequent auto-saves.
*   **Environment-Specific Configuration:** The `EnvironmentService.ts` file is a central point for managing different API endpoints and configurations based on the `env` variable. This pattern is essential for deploying the application across various development, testing, and production environments.
*   **Checkout Flow and Payment Management:** The core focus of the changes revolves around enhancing the checkout experience, specifically in payment options (`PaymentOptions.svelte`) and order summary (`OrderSummary.svelte`), and how discounts are applied (`ShippingDiscount.service.ts`).
*   **Analytics Integration:** The `Merchant.svelte` file shows a strong emphasis on integrating various third-party analytics services, indicating a data-driven approach to understanding user behavior.
*   **Gift and Discount Handling:** Logic for applying, reapplying, and removing various types of discounts, gift cards, and free gifts is a recurring theme across `ShippingDiscount.service.ts` and `OrderSummary.svelte`, and new gift-related components were added to `PaymentOptions.svelte`.