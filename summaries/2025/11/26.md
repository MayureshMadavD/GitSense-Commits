# Activity Summary for 26/11/2025

## 11:03:11
The provided log details changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`**: This file contains utility functions `makeAPICall` and `logUserEvent`.
    *   **`makeAPICall` function**: This function handles API requests using Axios, incorporating features such as:
        *   Security headers (`X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, `Content-Security-Policy`, `Strict-Transport-Security`).
        *   Conditional `withCredentials` based on `skipCookies`.
        *   Loader management (`loaderEvent`).
        *   Special handling for internal users, preventing non-GET operations on specific URLs.
        *   Support for single and multiple file uploads with custom field names.
        *   Robust error handling, particularly for 401 Unauthorized responses, which clears `localStorage` tokens and redirects users to the login page, while preserving the original URL if necessary.
    *   **`logUserEvent` function**: This function is designed to log user interaction events. It includes logic to:
        *   Gather user data (email, name, role) and merchant data (ID, name).
        *   Generate a unique `userSessionId` using `nanoid` and store it in a cookie if one doesn't exist.
        *   Determine the `landing_page` from the `window.location.pathname`.
        *   Parse the `userAgentString` to extract details about the operating system, device, OS version, browser, browser version, and detect if it's a webview (`is_wv`).

**Timestamps of Significant Changes:**

All changes occurred on **22/11/2025** within a short span of time, focusing on the error handling within the `makeAPICall` function's `catch` block.

*   **17:38:55**: The initial state of the `catch` block for 401 errors in `makeAPICall` returned `{ ...error, error: true }`.
*   **17:39:07**: This timestamp marks a modification to the 401 error handling. The return statement was updated to explicitly provide an error message: `{ error: true, message: error?.response?.data?.message || error.message }`. This aimed to give more user-friendly or specific error feedback.
*   **17:39:40**: The code was reverted to its state at 17:38:55. The `catch` block for 401 errors once again returned `{ ...error, error: true }`, undoing the change made moments before.

**Patterns or Recurring Elements:**

*   **Rapid Iteration/Reversion**: The timestamps indicate a very quick change and subsequent reversion of the error handling logic, suggesting either testing, a temporary bug fix, or a change of mind regarding the desired error structure for 401 responses.
*   **Comprehensive Utility Design**: The `common.ts` file acts as a central place for critical dashboard functionalities, handling both network communication (`makeAPICall`) and analytics/tracking (`logUserEvent`).
*   **Security Best Practices**: The `makeAPICall` function includes several standard security headers, demonstrating an emphasis on protecting against common web vulnerabilities.
*   **User/Merchant Context**: Both functions extensively leverage `dashboardStore` to access `userData` and `merchantData`, ensuring that API calls and event logs are made within the appropriate user and merchant context.
*   **Cookie Management**: The use of `getCookie` and `setCookie` for `userSessionId` indicates reliance on client-side cookies for session tracking.

## 11:52:58
The log captures changes across a dashboard application, primarily focusing on frontend configuration and shipping/discount validation logic.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-configuration/src/index.ejs`**
    *   **24/11/2025, 12:17:41**: The initial state of this EJS template defines the application's base HTML, CSP, and `systemjs-importmap` configurations. It includes conditional imports for `@gokwik` modules based on `isLocal`, `dev`, `qa`, `sandbox`, and `production` environments, with production including New Relic and Microsoft Clarity tracking. The `isLocal` environment initially points `@gokwik/utilities` and `@gokwik/dashboard` to `sandbox-dashboard.dev.gokwik.in`.
    *   **24/11/2025, 16:50:58**: The `isLocal` environment configuration was updated, changing the source for `@gokwik/utilities` and `@gokwik/dashboard` from `sandbox-dashboard.dev.gokwik.in` to `dev-dashboard.dev.gokwik.in`.
    *   **24/11/2025, 16:52:06**: Further adjustments were made to the `isLocal` environment, directing `@gokwik/utilities` and `@gokwik/dashboard` to `qa-dashboard.dev.gokwik.in`.
    *   **24/11/2025, 16:53:39**: The `isLocal` environment's `systemjs-importmap` for `@gokwik/utilities` and `@gokwik/dashboard` was reverted to `sandbox-dashboard.dev.gokwik.in`, effectively returning to its initial `sandbox` configuration.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shipping-component/shippingBasedMethods.tsx`**
    *   **24/11/2025, 12:31:55**: This React component is introduced, designed for configuring shipping methods. It contains form fields for shipping name, price, min/max order values, and advanced conditions. It includes functionality for uploading/downloading CSVs (e.g., pincodes) and API calls for customer segments and presigned URLs for file uploads.
    *   **24/11/2025, 12:36:01**: No functional code changes were observed in this update.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/helpers/validations.ts`**
    *   **24/11/2025, 12:45:40**: This file defines various validation functions (`validateTieredDiscount`, `validateDynamicDiscount`, `validateBuyXatYDiscount`, `validateDiscountCapping`, `validateGWP`) used across the application. These functions enforce rules like unique codes, valid ranges (e.g., upper limit > lower limit), and preventing range overlaps for different discount and shipping tiers.
    *   **Subsequent timestamps (24/11/2025, 12:47:57 to 24/11/2025, 17:34:51)**: No functional code changes were observed across multiple updates, suggesting repeated saving, minor formatting changes, or reversion of test modifications. The core validation logic remained consistent.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shipping-component/weightShipping.tsx`**
    *   **24/11/2025, 15:16:01**: This React component, `WeightBaseShippingMethods`, is added to handle weight-based shipping configurations. It features a form for defining shipping name, ID, min/max weight, and price, along with a table for managing existing rates. It uses `validateWeightRangeDifference` for form validation.
    *   **24/11/2025, 15:23:28**: No functional code changes were observed in this update.
    *   **24/11/2025, 15:27:43**: The `validateWeightRangeDifference` function call within `getValesFromForm` was modified to pass an additional boolean argument (`isEditEnabled` or `false`), providing context for add vs. edit operations.
    *   **24/11/2025, 16:40:20**: A `console.log(weightConfig)` statement was removed from the `if (isEditEnabled)` block in `getValesFromForm`.
    *   **24/11/2025, 16:49:44**: The `if (isEditEnabled)` block in `getValesFromForm` was further refined to filter existing shipping rates before re-validating the updated configuration.
    *   **24/11/2025, 17:07:59**: The `validateWeightRangeDifference` call for adding new entries was changed to explicitly pass `weightConfig.weight_based_shipping_rates` instead of the entire `weightConfig` object.
    *   **24/11/2025, 17:20:50**: The validation logic for new entries was temporarily refactored to call `validateWeightRangeDifference` twice (once for `min_weight`, once for `max_weight` with fewer arguments), and error message handling was updated.
    *   **24/11/2025, 17:24:39**: The validation logic for new entries was reverted or corrected, returning to a single `validateWeightRangeDifference` call with 4 arguments.
    *   **24/11/2025, 20:15:07**: A `console.log(weightConfigs, "===")` was added to the `useEffect` hook.
    *   **24/11/2025, 20:19:27**: The `useEffect` hook's `setWeightConfig` logic was updated to conditionally use `weightConfigs` only if it has elements, preventing overwriting with an empty array. The debug `console.log` was slightly adjusted.
    *   **24/11/2025, 20:19:36**: The `console.log` statement was removed from the `useEffect` hook.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/pages/settings/shipping-settings/shippingBasedService.tsx`**
    *   **24/11/2025, 20:17:43**: This `ShippingService` component is introduced, acting as a container for different shipping configuration tabs: "Shipping Method", "Weight Based Shipping", and "Discount Based Shipping". It conditionally renders a `ShippingMethodConfig` if no shipping prices are present.
    *   **24/11/2025, 20:29:59**: A new tab, "Product Based Shipping", was added (key '2'), conditionally rendered based on `merchantConfig?.config?.custom_config?.shipping_service`. This shifted the keys for "Weight Based Shipping" to '3' and "Discount Based Shipping" to '4', with corresponding updates in the `handleTabChange` function.
    *   **25/11/2025, 13:00:14**: A minor formatting change was made to the `Tabs` component's props order (`destroyInactiveTabPane` reordered).

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/components/discounts/productSearch.tsx`**
    *   **25/11/2025, 12:58:37**: This `ProductSearch` React component is added, enabling search and selection of products or collections. It includes features like debounced search, infinite scrolling, managing quantities for selected items, "top-up gift" pricing, and agent-led product filtering.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/constants/apiEndpoints.ts`**
    *   **25/11/2025, 12:59:31**: This file is introduced, centralizing numerous API endpoints related to orders, customers, shipping, taxes, analytics, discounts, Shopify integrations, and merchant configurations.

*   **`/Users/mayuresh.madav/Documents/dashboard/checkout-dashboard-ui/src/library/utilities/api.ts`**
    *   **25/11/2025, 12:59:47**: This file provides utility functions for abstracting API calls, including `fetchShopifyCollectionsOrProducts` (which handles pagination, active status filtering, and data transformation), `updateMerchantData`, `validateGstData`, and `getVariantNCollectionDetailsbyId`.

**Patterns and Recurring Elements:**

*   **Consistent Timestamping:** All changes are precisely timestamped (`DD/MM/YYYY, HH:MM:SS`).
*   **Environment Configuration Focus:** The `index.ejs` and `.env` files show frequent modifications related to switching or defining environment-specific URLs (e.g., `dev`, `qa`, `sandbox`) for various `@gokwik` modules and API endpoints. This suggests active development, testing, and deployment to different environments.
*   **Shipping and Discount Feature Development:** A significant portion of changes is concentrated in the `checkout-dashboard-ui` module, specifically around shipping settings (`shippingBasedMethods.tsx`, `weightShipping.tsx`, `shippingBasedService.tsx`) and general validation (`validations.ts`). This indicates ongoing development and refinement of these core features.
*   **Validation Logic Refinements:** The `validations.ts` file, while appearing mostly static in content, is frequently saved. This, combined with targeted adjustments in `weightShipping.tsx` to how validation functions are called (`validateWeightRangeDifference`), suggests continuous iteration on input validation rules and mechanisms.
*   **Component-Based Architecture:** The presence of multiple `.tsx` files (React components) managing specific UI/feature areas (e.g., `ShippingMethodConfig`, `WeightBaseShippingMethods`, `ProductSearch`, `ShippingService`) points to a component-driven or micro-frontend development approach.
*   **API Centralization:** The `apiEndpoints.ts` file acts as a central repository for all backend API routes, which is then consumed by API utility functions in `api.ts`.
*   **Gokwik Ecosystem:** The code consistently refers to "Gokwik" components, UI kits, and API domains, indicating development within a larger "Gokwik" platform.
*   **Debugging and Cleanup:** The insertion and removal of `console.log` statements in `weightShipping.tsx` indicates active debugging during development.