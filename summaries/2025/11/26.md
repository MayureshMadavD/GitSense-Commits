# Activity Summary for 26/11/2025

## 11:03:11
The provided log details changes to a single file: `/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`.

**File-Specific Updates:**

*   **`/Users/mayuresh.madav/Documents/dashboard/dashboard-ui-utilities/src/services/common.ts`**: This file contains utility functions `makeAPICall` and `logUserEvent`.
    *   **`makeAPICall` function**: This function handles API requests using Axios, incorporating features such as:
        *   Security headers (`X-Content-Type-Options`, `Referrer-Policy`, `X-XSS-Protection`, `Content-Security-Policy`, `Strict-Transport-Security`).
        *   Conditional `withCredentials` based on `skipCookies`.
        *   Loader management (`loaderEvent`).
        *   Special handling for internal users, preventing non-GET operations on specific URLs.
        *   Support for single and multiple file uploads with custom field names.
        *   Robust error handling, particularly for 401 Unauthorized responses, which clears `localStorage` tokens and redirects users to the login page, while preserving the original URL if necessary.
    *   **`logUserEvent` function**: This function is designed to log user interaction events. It includes logic to:
        *   Gather user data (email, name, role) and merchant data (ID, name).
        *   Generate a unique `userSessionId` using `nanoid` and store it in a cookie if one doesn't exist.
        *   Determine the `landing_page` from the `window.location.pathname`.
        *   Parse the `userAgentString` to extract details about the operating system, device, OS version, browser, browser version, and detect if it's a webview (`is_wv`).

**Timestamps of Significant Changes:**

All changes occurred on **22/11/2025** within a short span of time, focusing on the error handling within the `makeAPICall` function's `catch` block.

*   **17:38:55**: The initial state of the `catch` block for 401 errors in `makeAPICall` returned `{ ...error, error: true }`.
*   **17:39:07**: This timestamp marks a modification to the 401 error handling. The return statement was updated to explicitly provide an error message: `{ error: true, message: error?.response?.data?.message || error.message }`. This aimed to give more user-friendly or specific error feedback.
*   **17:39:40**: The code was reverted to its state at 17:38:55. The `catch` block for 401 errors once again returned `{ ...error, error: true }`, undoing the change made moments before.

**Patterns or Recurring Elements:**

*   **Rapid Iteration/Reversion**: The timestamps indicate a very quick change and subsequent reversion of the error handling logic, suggesting either testing, a temporary bug fix, or a change of mind regarding the desired error structure for 401 responses.
*   **Comprehensive Utility Design**: The `common.ts` file acts as a central place for critical dashboard functionalities, handling both network communication (`makeAPICall`) and analytics/tracking (`logUserEvent`).
*   **Security Best Practices**: The `makeAPICall` function includes several standard security headers, demonstrating an emphasis on protecting against common web vulnerabilities.
*   **User/Merchant Context**: Both functions extensively leverage `dashboardStore` to access `userData` and `merchantData`, ensuring that API calls and event logs are made within the appropriate user and merchant context.
*   **Cookie Management**: The use of `getCookie` and `setCookie` for `userSessionId` indicates reliance on client-side cookies for session tracking.